(function(){function $b(a,b,c){this.major=a;this.minor=b;this.revision=c}function ac(a){return isFinite(a)&&!isNaN(a)}function d(a,b){"undefined"!==typeof a?(this.x=a,this.y=b):this.x=this.y=0}function L(a,b,c){"undefined"!==typeof a&&(this.x=a,this.y=b,this.z=c)}function U(a,b){this.ex=a?a.Clone():new d;this.ey=b?b.Clone():new d}function ua(a,b,c){this.ex=a?a.Clone():new L;this.ey=b?b.Clone():new L;this.ez=c?c.Clone():new L}function D(a,b){"undefined"!==typeof b?(this.s=a,this.c=b):"undefined"!==
typeof a&&this.Set(a)}function $(a,b){this.p=new d;this.q=new D;a&&(this.p.Assign(a),this.q.Assign(b))}function ma(){this.localCenter=new d;this.c0=new d;this.c=new d}function B(a,b){return a.x*b.x+a.y*b.y}function t(a,b){return a.x*b.y-a.y*b.x}function bc(a,b){return new d(b*a.y,-b*a.x)}function O(a,b){return new d(-a*b.y,a*b.x)}function Da(a,b){return new d(a.ex.x*b.x+a.ey.x*b.y,a.ex.y*b.x+a.ey.y*b.y)}function hb(a,b){return d.Subtract(a,b).Length()}function ib(a,b){var c=d.Subtract(a,b);return B(c,
c)}function Ea(a,b){return a.x*b.x+a.y*b.y+a.z*b.z}function Fa(a,b){return new L(a.y*b.z-a.z*b.y,a.z*b.x-a.x*b.z,a.x*b.y-a.y*b.x)}function cc(a,b){return L.Add(L.Add(L.Multiply(b.x,a.ex),L.Multiply(b.y,a.ey)),L.Multiply(b.z,a.ez))}function dc(a,b){return new d(a.ex.x*b.x+a.ey.x*b.y,a.ex.y*b.x+a.ey.y*b.y)}function ec(a,b){var c=new D;c.s=a.s*b.c+a.c*b.s;c.c=a.c*b.c-a.s*b.s;return c}function fc(a,b){var c=new D;c.s=a.c*b.s-a.s*b.c;c.c=a.c*b.c+a.s*b.s;return c}function A(a,b){return new d(a.c*b.x-a.s*
b.y,a.s*b.x+a.c*b.y)}function na(a,b){return new d(a.c*b.x+a.s*b.y,-a.s*b.x+a.c*b.y)}function T(a,b){return new d(a.q.c*b.x-a.q.s*b.y+a.p.x,a.q.s*b.x+a.q.c*b.y+a.p.y)}function Aa(a,b){var c=b.x-a.p.x,g=b.y-a.p.y;return new d(a.q.c*c+a.q.s*g,-a.q.s*c+a.q.c*g)}function Fb(a,b){var c=new $;c.q=fc(a.q,b.q);var g=b.p.x-a.p.x,e=b.p.y-a.p.y;c.p.x=a.q.c*g+a.q.s*e;c.p.y=-a.q.s*g+a.q.c*e;return c}function Qa(a){return new d(V(a.x),V(a.y))}function jb(a,b){return new d(S(a.x,b.x),S(a.y,b.y))}function kb(a,b){return new d(I(a.x,
b.x),I(a.y,b.y))}function X(a,b,c){return I(b,S(a,c))}function ka(a,b,c){this.r=a||0;this.g=b||0;this.b=c||0}function W(){}function gc(){this.Reset()}function hc(){this.mass=0;this.center=new d;this.I=0}function E(){this.m_radius=this.m_type=0}function Ga(){this.parent.call(this);this.m_type=E.e_circle;this.m_radius=0;this.m_p=new d;Object.seal(this)}function Ba(){this.parent.call(this);this.m_type=E.e_edge;this.m_radius=Ra;this.m_vertex0=new d;this.m_vertex1=new d;this.m_vertex2=new d;this.m_vertex3=
new d;this.m_hasVertex3=this.m_hasVertex0=!1;Object.seal(this)}function pa(){this.parent.call(this);this.m_type=E.e_chain;this.m_radius=Ra;this.m_prevVertex=new d;this.m_nextVertex=new d;this.m_hasNextVertex=this.m_hasPrevVertex=!1;this.Clear();Object.seal(this)}function va(){this.parent.call(this);this.m_type=E.e_polygon;this.m_radius=Ra;this.m_count=0;this.m_centroid=new d;this.m_vertices=Array(qa);this.m_normals=Array(qa);Object.seal(this)}function ic(){this.proxyIdB=this.proxyIdA=0}function jc(a,
b){return a.proxyIdA==b.proxyIdA?a.proxyIdB-b.proxyIdB:a.proxyIdA-b.proxyIdA}function wa(){this.m_tree=new xa;this.m_pairCount=this.m_proxyCount=this.m_queryProxyId=0;this.m_pairBuffer=[];this.m_moveCount=0;this.m_moveBuffer=[]}function Ha(){this.m_vertices=null;this.m_radius=this.m_count=0}function Gb(){this.count=this.metric=0;this.indexA=[0,0,0];this.indexB=[0,0,0]}function Hb(){this.proxyA=new Ha;this.proxyB=new Ha;this.transformA=new $;this.transformB=new $;this.useRadii=!1}function Ib(){this.pointA=
new d;this.pointB=new d;this.iterations=this.distance=0}function Sa(){this.wA=new d;this.wB=new d;this.w=new d;this.indexB=this.indexA=this.a=0}function Jb(){this.m_v=[new Sa,new Sa,new Sa];this.m_count=0}function ra(a,b,c){++ra.b2_gjkCalls;var g=c.proxyA,e=c.proxyB,f=c.transformA,h=c.transformB;fa.ReadCache(b,g,f,e,h);for(var d=fa.m_v,m=[0,0,0],l=[0,0,0],n=0,p=0;20>p;){for(var n=fa.m_count,q=0;q<n;++q)m[q]=d[q].indexA,l[q]=d[q].indexB;switch(fa.m_count){case 2:fa.Solve2();break;case 3:fa.Solve3()}if(3==
fa.m_count)break;fa.GetClosestPoint(la);la.LengthSquared();fa.GetSearchDirection(la);if(la.LengthSquared()<ga*ga)break;var r=d[fa.m_count];r.indexA=g.GetSupport(f.q.c*-la.x+f.q.s*-la.y,-f.q.s*-la.x+f.q.c*-la.y);q=g.GetVertex(r.indexA);r.wA.x=f.q.c*q.x-f.q.s*q.y+f.p.x;r.wA.y=f.q.s*q.x+f.q.c*q.y+f.p.y;r.indexB=e.GetSupport(h.q.c*la.x+h.q.s*la.y,-h.q.s*la.x+h.q.c*la.y);q=e.GetVertex(r.indexB);r.wB.x=h.q.c*q.x-h.q.s*q.y+h.p.x;r.wB.y=h.q.s*q.x+h.q.c*q.y+h.p.y;r.w.x=r.wB.x-r.wA.x;r.w.y=r.wB.y-r.wA.y;++p;
++ra.b2_gjkIters;for(var R=!1,q=0;q<n;++q)if(r.indexA==m[q]&&r.indexB==l[q]){R=!0;break}if(R)break;++fa.m_count}ra.b2_gjkMaxIters=I(ra.b2_gjkMaxIters,p);fa.GetWitnessPoints(a.pointA,a.pointB);a.distance=hb(a.pointA,a.pointB);a.iterations=p;fa.WriteCache(b);c.useRadii&&(b=g.m_radius,e=e.m_radius,a.distance>b+e&&a.distance>ga?(a.distance-=b+e,Ca.x=a.pointB.x-a.pointA.x,Ca.y=a.pointB.y-a.pointA.y,Ca.Normalize(),a.pointA.x+=b*Ca.x,a.pointA.y+=b*Ca.y,a.pointB.x-=e*Ca.x,a.pointB.y-=e*Ca.y):(e=0.5*(a.pointA.x+
a.pointB.x),b=0.5*(a.pointA.y+a.pointB.y),a.pointA.x=e,a.pointA.y=b,a.pointB.x=e,a.pointB.y=b,a.distance=0))}function Q(){}function ha(){this.localPoint=new d;this.tangentImpulse=this.normalImpulse=0;this.id=new Q}function F(){this.points=Array(ia);this.localNormal=new d;this.localPoint=new d;this.pointCount=this.type=0}function Kb(){this.normal=new d;this.points=Array(ia);this.separations=Array(ia)}function ya(){this.v=new d;this.id=new Q}function Lb(){this.p1=new d;this.p2=new d;this.maxFraction=
0}function kc(){this.normal=new d;this.fraction=0}function Z(){this.lowerBound=new d;this.upperBound=new d}function lc(a,b,c,g,e){a.pointCount=0;c=T(c,b.m_p);var f=T(e,g.m_p);e=f.x-c.x;c=f.y-c.y;f=b.m_radius+g.m_radius;e*e+c*c>f*f||(a.type=F.e_circles,a.localPoint.x=b.m_p.x,a.localPoint.y=b.m_p.y,a.localNormal.x=a.localNormal.y=0,a.pointCount=1,a.points[0]=new ha,a.points[0].localPoint.x=g.m_p.x,a.points[0].localPoint.y=g.m_p.y,a.points[0].id.Reset())}function mc(a,b,c,g,e){a.pointCount=0;e=T(e,g.m_p);
c=Aa(c,e);var f=0,h=-za;e=b.m_radius+g.m_radius;var d=b.m_count,m=b.m_vertices;b=b.m_normals;for(var l=0;l<d;++l){var n=b[l].x*(c.x-m[l].x)+b[l].y*(c.y-m[l].y);if(n>e)return;n>h&&(h=n,f=l)}l=f;n=m[l];d=m[l+1<d?l+1:0];h<ga?(a.pointCount=1,a.type=F.e_faceA,a.localNormal.x=b[f].x,a.localNormal.y=b[f].y,a.localPoint.x=0.5*(n.x+d.x),a.localPoint.y=0.5*(n.y+d.y),a.points[0]=new ha,a.points[0].localPoint.x=g.m_p.x,a.points[0].localPoint.y=g.m_p.y,a.points[0].id.Reset()):(h=(c.x-d.x)*(n.x-d.x)+(c.y-d.y)*
(n.y-d.y),0>=(c.x-n.x)*(d.x-n.x)+(c.y-n.y)*(d.y-n.y)?ib(c,n)>e*e||(a.pointCount=1,a.type=F.e_faceA,a.localNormal.x=c.x-n.x,a.localNormal.y=c.y-n.y,a.localNormal.Normalize(),a.localPoint.x=n.x,a.localPoint.y=n.y,a.points[0]=new ha,a.points[0].localPoint.x=g.m_p.x,a.points[0].localPoint.y=g.m_p.y,a.points[0].id.Reset()):0>=h?ib(c,d)>e*e||(a.pointCount=1,a.type=F.e_faceA,a.localNormal.x=c.x-d.x,a.localNormal.y=c.y-d.y,a.localNormal.Normalize(),a.localPoint.x=d.x,a.localPoint.y=d.y,a.points[0]=new ha,
a.points[0].localPoint.x=g.m_p.x,a.points[0].localPoint.y=g.m_p.y,a.points[0].id.Reset()):(f=0.5*(n.x+d.x),d=0.5*(n.y+d.y),h=(c.x-f)*b[l].x+(c.y-d)*b[l].y,h>e||(a.pointCount=1,a.type=F.e_faceA,a.localNormal.x=b[l].x,a.localNormal.y=b[l].y,a.localPoint.x=f,a.localPoint.y=d,a.points[0]=new ha,a.points[0].localPoint.x=g.m_p.x,a.points[0].localPoint.y=g.m_p.y,a.points[0].id.Reset())))}function Mb(a,b,c,g,e){var f=b.m_count,h=g.m_count,d=b.m_normals;b=b.m_vertices;g=g.m_vertices;c=Fb(e,c);e=0;for(var m=
-za,l=0;l<f;++l){for(var n=c.q.c*d[l].x-c.q.s*d[l].y,p=c.q.s*d[l].x+c.q.c*d[l].y,q=c.q.c*b[l].x-c.q.s*b[l].y+c.p.x,r=c.q.s*b[l].x+c.q.c*b[l].y+c.p.y,R=za,G=0;G<h;++G){var s=n*(g[G].x-q)+p*(g[G].y-r);s<R&&(R=s)}R>m&&(m=R,e=l)}a[0]=e;return m}function nc(a,b,c,g,e,f){var h=b.m_normals,d=e.m_count;b=e.m_vertices;e=e.m_normals;var m=c.q.c*h[g].x-c.q.s*h[g].y,h=c.q.s*h[g].x+c.q.c*h[g].y;c=f.q.c*m+f.q.s*h;for(var m=-f.q.s*m+f.q.c*h,h=0,l=za,n=0;n<d;++n){var p=c*e[n].x+m*e[n].y;p<l&&(l=p,h=n)}e=h;d=e+1<
d?e+1:0;a[0].v.x=f.q.c*b[e].x-f.q.s*b[e].y+f.p.x;a[0].v.y=f.q.s*b[e].x+f.q.c*b[e].y+f.p.y;a[0].id.indexA=g;a[0].id.indexB=e;a[0].id.typeA=Q.e_face;a[0].id.typeB=Q.e_vertex;a[1].v.x=f.q.c*b[d].x-f.q.s*b[d].y+f.p.x;a[1].v.y=f.q.s*b[d].x+f.q.c*b[d].y+f.p.y;a[1].id.indexA=g;a[1].id.indexB=d;a[1].id.typeA=Q.e_face;a[1].id.typeB=Q.e_vertex}function aa(a,b,c,g,e){a.pointCount=0;var f=b.m_radius+g.m_radius,d=[0],k=Mb(d,b,c,g,e);if(!(k>f)){var m=[0],l=Mb(m,g,e,b,c);if(!(l>f)){var n=0,p=0;l>k+0.1*N?(k=g,g=
b,b=e,n=m[0],a.type=F.e_faceB,p=1):(k=b,b=c,c=e,n=d[0],a.type=F.e_faceA,p=0);nc(aa._local_incidentEdges,k,b,n,g,c);d=k.m_vertices;m=n;e=n+1<k.m_count?n+1:0;g=d[m];k=d[e];aa._localTangent.x=k.x-g.x;aa._localTangent.y=k.y-g.y;aa._localTangent.Normalize();var l=1*aa._localTangent.y,q=-1*aa._localTangent.x,r=0.5*(g.x+k.x),R=0.5*(g.y+k.y),G=b.q.c*aa._localTangent.x-b.q.s*aa._localTangent.y,s=b.q.s*aa._localTangent.x+b.q.c*aa._localTangent.y,n=1*s,d=-1*G;g=T(b,g);k=T(b,k);b=n*g.x+d*g.y;var u=G*k.x+s*k.y+
f,x=Array(2),k=Array(2),m=Ta(x,aa._local_incidentEdges,-G,-s,-(G*g.x+s*g.y)+f,m);if(!(2>m||(m=Ta(k,x,G,s,u,e),2>m))){a.localNormal.x=l;a.localNormal.y=q;a.localPoint.x=r;a.localPoint.y=R;for(e=m=0;e<ia;++e)n*k[e].v.x+d*k[e].v.y-b<=f&&(g=a.points[m]=new ha,g.localPoint.Assign(Aa(c,k[e].v)),g.id.Assign(k[e].id),p&&(l=new Q,l.Assign(g.id),g.id.indexA=l.indexB,g.id.indexB=l.indexA,g.id.typeA=l.typeB,g.id.typeB=l.typeA),++m);a.pointCount=m}}}}function Nb(a,b,c,g,e){a.pointCount=0;c=Aa(c,T(e,g.m_p));var f=
b.m_vertex1,d=b.m_vertex2,k=d.x-f.x,m=d.y-f.y,l=k*(d.x-c.x)+m*(d.y-c.y),n=k*(c.x-f.x)+m*(c.y-f.y),p=b.m_radius+g.m_radius;e=new Q;e.indexB=0;e.typeB=Q.e_vertex;if(0>=n){if(k=f,l=c.x-k.x,n=c.y-k.y,!(l*l+n*n>p*p)){if(b.m_hasVertex0&&(d=b.m_vertex0,0<(f.x-d.x)*(f.x-c.x)+(f.y-d.y)*(f.y-c.y)))return;e.indexA=0;e.typeA=Q.e_vertex;a.pointCount=1;a.type=F.e_circles;a.localNormal.x=a.localNormal.y=0;a.localPoint.x=k.x;a.localPoint.y=k.y;a.points[0]=new ha;a.points[0].id.Assign(e);a.points[0].localPoint.x=
g.m_p.x;a.points[0].localPoint.y=g.m_p.y}}else if(0>=l){if(k=d,l=c.x-k.x,n=c.y-k.y,!(l*l+n*n>p*p)){if(b.m_hasVertex3&&(f=b.m_vertex3,0<(f.x-d.x)*(c.x-d.x)+(f.y-d.y)*(c.y-d.y)))return;e.indexA=1;e.typeA=Q.e_vertex;a.pointCount=1;a.type=F.e_circles;a.localNormal.x=a.localNormal.y=0;a.localPoint.x=k.x;a.localPoint.y=k.y;a.points[0]=new ha;a.points[0].id.Assign(e);a.points[0].localPoint.x=g.m_p.x;a.points[0].localPoint.y=g.m_p.y}}else{var q=k*k+m*m;b=1/q*(l*f.y+n*d.y);l=c.x-1/q*(l*f.x+n*d.x);n=c.y-b;
l*l+n*n>p*p||(d=-m,b=k,0>d*(c.x-f.x)+b*(c.y-f.y)&&(d=-d,b=-b),e.indexA=0,e.typeA=Q.e_face,a.pointCount=1,a.type=F.e_faceA,a.localNormal.x=d,a.localNormal.y=b,a.localNormal.Normalize(),a.localPoint.x=f.x,a.localPoint.y=f.y,a.points[0]=new ha,a.points[0].id.Assign(e),a.points[0].localPoint.x=g.m_p.x,a.points[0].localPoint.y=g.m_p.y)}}function Y(){this.separation=this.index=this.type=0}function oc(){this.vertices=Array(qa);this.normals=Array(qa);this.count=0}function pc(){this.i2=this.i1=0;this.v1=new d;
this.v2=new d;this.normal=new d;this.sideNormal1=new d;this.sideOffset1=0;this.sideNormal2=new d;this.sideOffset2=0}function J(){this.m_polygonB=new oc;this.m_xf=new $;this.m_centroidB=new d;this.m_v0=new d;this.m_v1=new d;this.m_v2=new d;this.m_v3=new d;this.m_normal0=new d;this.m_normal1=new d;this.m_normal2=new d;this.m_normal=new d;this.m_type2=this.m_type1=0;this.m_lowerLimit=new d;this.m_upperLimit=new d;this.m_radius=0;this.m_front=!1}function Ua(a,b,c,g,e){Ua.collider.Collide(a,b,c,g,e)}function Ta(a,
b,c,g,e,f){var d=0,k=c*b[0].v.x+g*b[0].v.y-e;c=c*b[1].v.x+g*b[1].v.y-e;0>=k&&(a[d++]=b[0]);0>=c&&(a[d++]=b[1]);0>k*c&&(k/=k-c,a[d]=new ya,a[d].v.x=b[0].v.x+k*(b[1].v.x-b[0].v.x),a[d].v.y=b[0].v.y+k*(b[1].v.y-b[0].v.y),a[d].id.indexA=f,a[d].id.indexB=b[0].id.indexB,a[d].id.typeA=Q.e_vertex,a[d].id.typeB=Q.e_face,++d);return d}function ba(a,b,c,g,e,f){ba.input.proxyA.Set(a,b);ba.input.proxyB.Set(c,g);ba.input.transformA=e;ba.input.transformB=f;ba.input.useRadii=!0;ba.cache.count=0;ra(ba.output,ba.cache,
ba.input);return ba.output.distance<10*ga}function lb(a,b){return!(0<b.lowerBound.x-a.upperBound.x||0<b.lowerBound.y-a.upperBound.y||0<a.lowerBound.x-b.upperBound.x||0<a.lowerBound.y-b.upperBound.y)}function Ia(){this.aabb=new Z;this.userData=null;this.child1=this.child2=this.height=this.parent=0}function xa(){this.m_root=P;this.m_nodeCapacity=16;this.m_nodeCount=0;this.m_nodes=Array(this.m_nodeCapacity);for(var a=0;a<this.m_nodeCapacity-1;++a)this.m_nodes[a]=new Ia,this.m_nodes[a].parent=a+1,this.m_nodes[a].height=
-1;this.m_nodes[this.m_nodeCapacity-1]=new Ia;this.m_nodes[this.m_nodeCapacity-1].parent=P;this.m_nodes[this.m_nodeCapacity-1].height=-1;this.m_insertionCount=this.m_path=this.m_freeList=0}function qc(){this.proxyA=new Ha;this.proxyB=new Ha;this.sweepA=new ma;this.sweepB=new ma;this.tMax=0}function ca(){this.t=this.state=0}function da(){this.m_sweepB=this.m_sweepA=this.m_proxyB=this.m_proxyA=null;this.m_type=0;this.m_localPoint=new d;this.m_axis=new d}function M(a,b){mb.start();++M.b2_toiCalls;a.state=
ca.e_unknown;a.t=b.tMax;var c=b.proxyA,g=b.proxyB;M._temp_sweepA.Assign(b.sweepA);M._temp_sweepB.Assign(b.sweepB);M._temp_sweepA.Normalize();M._temp_sweepB.Normalize();var e=b.tMax,f=I(N,c.m_radius+g.m_radius-3*N),d=0.25*N,k=0,m=0,l=new Gb;l.count=0;var n=new Hb;n.proxyA.Assign(b.proxyA);n.proxyB.Assign(b.proxyB);for(n.useRadii=!1;;){M._temp_sweepA.GetTransform(n.transformA,k);M._temp_sweepB.GetTransform(n.transformB,k);var p=new Ib;ra(p,l,n);if(0>=p.distance){a.state=ca.e_overlapped;a.t=0;break}if(p.distance<
f+d){a.state=ca.e_touching;a.t=k;break}p=new da;p.Initialize(l,c,M._temp_sweepA,g,M._temp_sweepB,k);for(var q=!1,r=e,R=0;;){var G=[],s=p.FindMinSeparation(G,r);if(s>f+d){a.state=ca.e_separated;a.t=e;q=!0;break}if(s>f-d){k=r;break}var u=p.Evaluate(G[0],G[1],k);if(u<f-d){a.state=ca.e_failed;a.t=k;q=!0;break}if(u<=f+d){a.state=ca.e_touching;a.t=k;q=!0;break}for(var x=0,z=k,t=r;;){var v;v=x&1?z+(f-u)*(t-z)/(s-u):0.5*(z+t);++x;++M.b2_toiRootIters;var w=p.Evaluate(G[0],G[1],v);if(V(w-f)<d){r=v;break}w>
f?(z=v,u=w):(t=v,s=w);if(50==x)break}M.b2_toiMaxRootIters=I(M.b2_toiMaxRootIters,x);++R;if(R==qa)break}++m;++M.b2_toiIters;if(q)break;if(20==m){a.state=ca.e_failed;a.t=k;break}}M.b2_toiMaxIters=I(M.b2_toiMaxIters,m);mb.stop();M.b2_toiMaxTime=I(M.b2_toiMaxTime,mb.elapsedTime);M.b2_toiTime+=mb.elapsedTime}function nb(){this.type=u.b2_staticBody;this.position=new d(0,0);this.angle=0;this.linearVelocity=new d(0,0);this.angularDamping=this.linearDamping=this.angularVelocity=0;this.awake=this.allowSleep=
!0;this.bullet=this.fixedRotation=!1;this.active=!0;this.userData=null;this.gravityScale=1;Object.seal(this)}function u(a,b){this.m_flags=this.m_islandIndex=0;a.bullet&&(this.m_flags|=u.e_bulletFlag);a.fixedRotation&&(this.m_flags|=u.e_fixedRotationFlag);a.allowSleep&&(this.m_flags|=u.e_autoSleepFlag);a.awake&&(this.m_flags|=u.e_awakeFlag);a.active&&(this.m_flags|=u.e_activeFlag);this.m_world=b;this.m_xf=new $;this.m_xf.p.Assign(a.position);this.m_xf.q.Set(a.angle);this.m_sweep=new ma;this.m_sweep.localCenter.SetZero();
this.m_sweep.c0.Assign(this.m_xf.p);this.m_sweep.c.Assign(this.m_xf.p);this.m_sweep.a0=a.angle;this.m_sweep.a=a.angle;this.m_sweep.alpha0=0;this.m_next=this.m_prev=this.m_contactList=this.m_jointList=null;this.m_linearVelocity=a.linearVelocity.Clone();this.m_angularVelocity=a.angularVelocity;this.m_linearDamping=a.linearDamping;this.m_angularDamping=a.angularDamping;this.m_gravityScale=a.gravityScale;this.m_force=new d;this.m_sleepTime=this.m_torque=0;this.m_type=a.type;this.m_invMass=this.m_type==
u.b2_dynamicBody?this.m_mass=1:this.m_mass=0;this.m_invI=this.m_I=0;this.m_userData=a.userData;this.m_fixtureList=null;this.m_fixtureCount=0}function Va(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0}function Wa(){this.userData=this.shape=null;this.friction=0.2;this.density=this.restitution=0;this.isSensor=!1;this.filter=new Va;Object.seal(this)}function Rc(){this.aabb=new Z;this.fixture=null;this.proxyId=this.childIndex=0}function Ob(){this.m_proxies=this.m_next=this.m_body=this.m_userData=
null;this.m_proxyCount=0;this.m_shape=null;this.m_density=0;this.m_filter=new Va;this.m_isSensor=!1;this.m_restitution=this.m_friction=0}function rc(){}function Pb(){}function sc(){this.normalImpulses=Array(ia);this.tangentImpulses=Array(ia);this.count=0}function Qb(){}function tc(){}function uc(){}function Xa(){this.positionIterations=this.velocityIterations=this.dtRatio=this.inv_dt=this.dt=0;this.warmStarting=!1}function vc(){this.c=new d;this.a=0}function wc(){this.v=new d;this.w=0}function xc(){this.step=
new Xa;this.velocities=this.positions=null}function K(a){this.m_contactManager=new Rb;this.m_jointList=this.m_bodyList=this.g_debugDraw=this.m_destructionListener=null;this.m_jointCount=this.m_bodyCount=0;this.m_continuousPhysics=this.m_warmStarting=!0;this.m_subStepping=!1;this.m_allowSleep=this.m_stepComplete=!0;this.m_gravity=a;this.m_flags=K.e_clearForces;this.m_inv_dt0=0;this.p_step=new Xa;this.p_island=new H}function yc(){this.callback=this.broadPhase=null}function zc(){this.callback=this.broadPhase=
null}function Sb(a,b){return a>b?a:b}function Tb(){this.fcn=null;this.primary=!1}function ob(){this.next=this.prev=this.contact=this.other=null}function v(){this.m_nodeA=new ob;this.m_nodeB=new ob;this.m_manifold=new F}function pb(){this.parent.call(this)}function qb(){this.parent.call(this)}function Ja(){this.parent.call(this)}function Ka(){this.parent.call(this)}function La(){this.parent.call(this)}function Ma(){this.parent.call(this)}function Na(){this.parent.call(this)}function Rb(){this.m_broadPhase=
new wa;this.m_contactList=null;this.m_contactCount=0;this.m_contactFilter=Ac;this.m_contactListener=Bc}function Cc(){this.rA=new d;this.rB=new d;this.velocityBias=this.tangentMass=this.normalMass=this.tangentImpulse=this.normalImpulse=0}function Dc(){this.localPoints=Array(ia);this.localNormal=new d;this.localPoint=new d;this.invMassB=this.invMassA=this.indexB=this.indexA=0;this.localCenterA=new d;this.localCenterB=new d;this.pointCount=this.radiusB=this.radiusA=this.type=this.invIB=this.invIA=0}
function Ec(){this.points=Array(ia);for(var a=0;a<this.points.length;++a)this.points[a]=new Cc;this.normal=new d;this.normalMass=new U;this.K=new U;this.contactIndex=this.pointCount=this.tangentSpeed=this.restitution=this.friction=this.invIB=this.invIA=this.invMassB=this.invMassA=this.indexB=this.indexA=0}function Ub(){this.normal=new d;this.point=new d;this.separation=0}function Fc(){this.step=new Xa;this.contacts=null;this.count=0;this.velocities=this.positions=null}function C(){this.m_positionConstraints=
[];this.m_velocityConstraints=[]}function H(){this.m_bodies=[];this.m_contacts=[];this.m_joints=[];this.m_velocities=[];this.m_positions=[]}function Vb(){this.next=this.prev=this.joint=this.other=null}function ja(){this.type=s.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=!1}function s(a){this.m_type=a.type;this.m_next=this.m_prev=null;this.m_bodyA=a.bodyA;this.m_bodyB=a.bodyB;this.m_index=0;this.m_collideConnected=a.collideConnected;this.m_islandFlag=!1;this.m_userData=
a.userData;this.m_edgeA=new Vb;this.m_edgeA.joint=null;this.m_edgeA.other=null;this.m_edgeA.prev=null;this.m_edgeA.next=null;this.m_edgeB=new Vb;this.m_edgeB.joint=null;this.m_edgeB.other=null;this.m_edgeB.prev=null;this.m_edgeB.next=null}function Ya(){this.parent.call(this);this.type=s.e_revoluteJoint;this.localAnchorA=new d;this.localAnchorB=new d;this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0;this.enableMotor=this.enableLimit=!1;Object.seal(this)}function rb(a){this.parent.call(this,
a);this.m_localAnchorA=a.localAnchorA.Clone();this.m_localAnchorB=a.localAnchorB.Clone();this.m_referenceAngle=a.referenceAngle;this.m_impulse=new L;this.m_motorImpulse=0;this.m_lowerAngle=a.lowerAngle;this.m_upperAngle=a.upperAngle;this.m_maxMotorTorque=a.maxMotorTorque;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=s.e_inactiveLimit;this.m_indexB=this.m_indexA=0;this.m_rA=new d;this.m_rB=new d;this.m_localCenterA=new d;this.m_localCenterB=
new d;this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=0;this.m_mass=new ua;this.m_motorMass=0}function Gc(){this.parent.call(this);this.type=s.e_mouseJoint;this.target=new d(0,0);this.maxForce=0;this.frequencyHz=5;this.dampingRatio=0.7;Object.seal(this)}function sb(a){this.parent.call(this,a);this.m_targetA=a.target.Clone();this.m_localAnchorB=Aa(this.m_bodyB.GetTransform(),this.m_targetA);this.m_maxForce=a.maxForce;this.m_impulse=new d;this.m_frequencyHz=a.frequencyHz;this.m_dampingRatio=
a.dampingRatio;this.m_indexB=this.m_indexA=this.m_gamma=this.m_beta=0;this.m_rB=new d;this.m_localCenterB=new d;this.m_invIB=this.m_invMassB=0;this.m_mass=new U;this.m_C=new d}function Za(){this.parent.call(this);this.type=s.e_distanceJoint;this.localAnchorA=new d(0,0);this.localAnchorB=new d(0,0);this.length=1;this.dampingRatio=this.frequencyHz=0;Object.seal(this)}function tb(a){this.parent.call(this,a);this.m_localAnchorA=a.localAnchorA.Clone();this.m_localAnchorB=a.localAnchorB.Clone();this.m_length=
a.length;this.m_frequencyHz=a.frequencyHz;this.m_dampingRatio=a.dampingRatio;this.m_indexB=this.m_indexA=this.m_bias=this.m_gamma=this.m_impulse=0;this.m_u=new d;this.m_rA=new d;this.m_rB=new d;this.m_localCenterA=new d;this.m_localCenterB=new d;this.m_mass=this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=0}function $a(){this.parent.call(this);this.type=s.e_prismaticJoint;this.localAnchorA=new d;this.localAnchorB=new d;this.localAxisA=new d(1,0);this.referenceAngle=0;this.enableLimit=!1;
this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0;Object.seal(this)}function ub(a){this.parent.call(this,a);this.m_localAnchorA=a.localAnchorA.Clone();this.m_localAnchorB=a.localAnchorB.Clone();this.m_localXAxisA=a.localAxisA.Clone();this.m_localXAxisA.Normalize();this.m_localYAxisA=O(1,this.m_localXAxisA);this.m_referenceAngle=a.referenceAngle;this.m_impulse=new L;this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=a.lowerTranslation;
this.m_upperTranslation=a.upperTranslation;this.m_maxMotorForce=a.maxMotorForce;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=s.e_inactiveLimit;this.m_axis=new d;this.m_perp=new d;this.m_indexB=this.m_indexA=0;this.m_localCenterA=new d;this.m_localCenterB=new d;this.m_a2=this.m_a1=this.m_s2=this.m_s1=this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=0;this.m_K=new ua;this.m_motorMass=0}function ab(){this.parent.call(this);
this.type=s.e_frictionJoint;this.localAnchorA=new d;this.localAnchorB=new d;this.maxTorque=this.maxForce=0;Object.seal(this)}function vb(a){this.parent.call(this,a);this.m_localAnchorA=a.localAnchorA.Clone();this.m_localAnchorB=a.localAnchorB.Clone();this.m_linearImpulse=new d;this.m_angularImpulse=0;this.m_maxForce=a.maxForce;this.m_maxTorque=a.maxTorque;this.m_indexB=this.m_indexA=0;this.m_rA=new d;this.m_rB=new d;this.m_localCenterA=new d;this.m_localCenterB=new d;this.m_invIB=this.m_invIA=this.m_invMassB=
this.m_invMassA=0;this.m_linearMass=new U;this.m_angularMass=0}function bb(){this.parent.call(this);this.type=s.e_weldJoint;this.localAnchorA=new d(0,0);this.localAnchorB=new d(0,0);this.dampingRatio=this.frequencyHz=this.referenceAngle=0;Object.seal(this)}function wb(a){this.parent.call(this,a);this.m_indexB=this.m_indexA=this.m_gamma=this.m_bias=0;this.m_rA=new d;this.m_rB=new d;this.m_localCenterA=new d;this.m_localCenterB=new d;this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=0;this.m_mass=
new ua;this.m_localAnchorA=a.localAnchorA.Clone();this.m_localAnchorB=a.localAnchorB.Clone();this.m_referenceAngle=a.referenceAngle;this.m_frequencyHz=a.frequencyHz;this.m_dampingRatio=a.dampingRatio;this.m_impulse=new L}function cb(){this.parent.call(this);this.type=s.e_wheelJoint;this.localAnchorA=new d;this.localAnchorB=new d;this.localAxisA=new d(1,0);this.enableMotor=!1;this.motorSpeed=this.maxMotorTorque=0;this.frequencyHz=2;this.dampingRatio=0.7;Object.seal(this)}function xb(a){this.parent.call(this,
a);this.m_indexB=this.m_indexA=0;this.m_localCenterA=new d;this.m_localCenterB=new d;this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=0;this.m_localAnchorA=a.localAnchorA.Clone();this.m_localAnchorB=a.localAnchorB.Clone();this.m_localXAxisA=a.localAxisA.Clone();this.m_localYAxisA=O(1,this.m_localXAxisA);this.m_springImpulse=this.m_springMass=this.m_motorImpulse=this.m_motorMass=this.m_impulse=this.m_mass=0;this.m_maxMotorTorque=a.maxMotorTorque;this.m_motorSpeed=a.motorSpeed;this.m_enableMotor=
a.enableMotor;this.m_frequencyHz=a.frequencyHz;this.m_dampingRatio=a.dampingRatio;this.m_gamma=this.m_bias=0;this.m_ax=new d;this.m_ay=new d;this.m_sAy=this.m_sBy=this.m_sAx=this.m_sBx=0}function yb(){this.parent.call(this);this.type=s.e_gearJoint;this.joint2=this.joint1=null;this.ratio=1;Object.seal(this)}function zb(a){this.parent.call(this,a);this.m_joint1=a.joint1;this.m_joint2=a.joint2;this.m_typeA=this.m_joint1.GetType();this.m_typeB=this.m_joint2.GetType();var b,c;this.m_bodyC=this.m_joint1.GetBodyA();
this.m_bodyA=this.m_joint1.GetBodyB();b=this.m_bodyA.m_xf;var g=this.m_bodyA.m_sweep.a;c=this.m_bodyC.m_xf;var e=this.m_bodyC.m_sweep.a;this.m_localAnchorA=new d;this.m_localAnchorB=new d;this.m_localAnchorC=new d;this.m_localAnchorD=new d;this.m_localAxisC=new d;this.m_localAxisD=new d;this.m_typeA==s.e_revoluteJoint?(c=a.joint1,this.m_localAnchorC.Assign(c.m_localAnchorA),this.m_localAnchorA.Assign(c.m_localAnchorB),this.m_referenceAngleA=c.m_referenceAngle,this.m_localAxisC.SetZero(),b=g-e-this.m_referenceAngleA):
(e=a.joint1,this.m_localAnchorC.Assign(e.m_localAnchorA),this.m_localAnchorA.Assign(e.m_localAnchorB),this.m_referenceAngleA=e.m_referenceAngle,this.m_localAxisC.Assign(e.m_localXAxisA),g=this.m_localAnchorC,b=na(c.q,d.Add(A(b.q,this.m_localAnchorA),d.Subtract(b.p,c.p))),b=B(d.Subtract(b,g),this.m_localAxisC));this.m_bodyD=this.m_joint2.GetBodyA();this.m_bodyB=this.m_joint2.GetBodyB();c=this.m_bodyB.m_xf;var e=this.m_bodyB.m_sweep.a,g=this.m_bodyD.m_xf,f=this.m_bodyD.m_sweep.a;this.m_typeB==s.e_revoluteJoint?
(c=a.joint2,this.m_localAnchorD.Assign(c.m_localAnchorA),this.m_localAnchorB.Assign(c.m_localAnchorB),this.m_referenceAngleB=c.m_referenceAngle,this.m_localAxisD.SetZero(),c=e-f-this.m_referenceAngleB):(e=a.joint2,this.m_localAnchorD.Assign(e.m_localAnchorA),this.m_localAnchorB.Assign(e.m_localAnchorB),this.m_referenceAngleB=e.m_referenceAngle,this.m_localAxisD.Assign(e.m_localXAxisA),e=this.m_localAnchorD,c=na(g.q,d.Add(A(c.q,this.m_localAnchorB),d.Subtract(c.p,g.p))),c=B(d.Subtract(c,e),this.m_localAxisD));
this.m_ratio=a.ratio;this.m_constant=b+this.m_ratio*c;this.m_indexA=this.m_indexB=this.m_indexC=this.m_indexD=this.m_impulse=0;this.m_lcA=new d;this.m_lcB=new d;this.m_lcC=new d;this.m_lcD=new d;this.m_iA=this.m_iB=this.m_iC=this.m_iD=this.m_mA=this.m_mB=this.m_mC=this.m_mD=0;this.m_JvAC=new d;this.m_JvBD=new d;this.m_mass=this.m_JwA=this.m_JwB=this.m_JwC=this.m_JwD=0}function db(){this.parent.call(this);this.type=s.e_motorJoint;this.linearOffset=new d;this.angularOffset=0;this.maxTorque=this.maxForce=
1;this.correctionFactor=0.3;Object.seal(this)}function Ab(a){this.parent.call(this,a);this.m_linearOffset=a.linearOffset.Clone();this.m_angularOffset=a.angularOffset;this.m_linearImpulse=new d;this.m_angularImpulse=0;this.m_maxForce=a.maxForce;this.m_maxTorque=a.maxTorque;this.m_correctionFactor=a.correctionFactor;this.m_indexB=this.m_indexA=0;this.m_rA=new d;this.m_rB=new d;this.m_localCenterA=new d;this.m_localCenterB=new d;this.m_linearError=new d;this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=
this.m_angularError=0;this.m_linearMass=new U;this.m_angularMass=0}function Bb(){this.parent.call(this);this.type=s.e_pulleyJoint;this.groundAnchorA=new d(-1,1);this.groundAnchorB=new d(1,1);this.localAnchorA=new d(-1,0);this.localAnchorB=new d(1,0);this.lengthB=this.lengthA=0;this.ratio=1;this.collideConnected=!0;Object.seal(this)}function Cb(a){this.parent.call(this,a);this.m_indexB=this.m_indexA=0;this.m_uA=new d;this.m_uB=new d;this.m_rA=new d;this.m_rB=new d;this.m_localCenterA=new d;this.m_localCenterB=
new d;this.m_mass=this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=0;this.m_groundAnchorA=a.groundAnchorA.Clone();this.m_groundAnchorB=a.groundAnchorB.Clone();this.m_localAnchorA=a.localAnchorA.Clone();this.m_localAnchorB=a.localAnchorB.Clone();this.m_lengthA=a.lengthA;this.m_lengthB=a.lengthB;this.m_ratio=a.ratio;this.m_constant=a.lengthA+this.m_ratio*a.lengthB;this.m_impulse=0}function eb(){this.parent.call(this);this.type=s.e_ropeJoint;this.localAnchorA=new d(-1,0);this.localAnchorB=new d(1,
0);this.maxLength=0;Object.seal(this)}function Db(a){this.parent.call(this,a);this.m_localAnchorA=a.localAnchorA.Clone();this.m_localAnchorB=a.localAnchorB.Clone();this.m_maxLength=a.maxLength;this.m_impulse=this.m_mass=0;this.m_state=s.e_inactiveLimit;this.m_indexB=this.m_indexA=this.m_length=0;this.m_u=new d;this.m_rA=new d;this.m_rB=new d;this.m_localCenterA=new d;this.m_localCenterB=new d;this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=0}function Hc(){this.m_count=0;this.m_as=this.m_Ls=
this.m_ims=this.m_vs=this.m_p0s=this.m_ps=null;this.m_damping=0;this.m_gravity=new d;this.m_k2=1;this.m_k3=0.1}Function.prototype._extend=function(a){this.prototype.parent=a;for(var b in a.prototype)this.prototype[b]||(this.prototype[b]=a.prototype[b])};Function.prototype._implement=function(a){return this._extend(a)};Array.prototype.qsort=function(a,b,c){"undefined"===typeof a&&(a=0);"undefined"===typeof b&&(b=this.length-a);"undefined"===typeof c&&(c=function(a,b){return a<b});for(var g=[],e=0;;){for(;a+
1<b;b++){var f=this[a+Math.floor(Math.random()*(b-a))];g[e++]=b;for(var d=a-1;;){for(;c(this[++d],f););for(;c(f,this[--b]););if(d>=b)break;var k=this[d];this[d]=this[b];this[b]=k}}if(0===e)break;a=b;b=g[--e]}return this};Array.prototype.collapse=function(a,b){"undefined"===typeof b&&(b=this.length);for(var c=0,g=0;g<b;++g)a(this[g])||(g===c?++c:this[c++]=this[g]);return c};Array.prototype.lower_bound=function(a,b,c,g){"undefined"===typeof g&&(g=function(a,b){return a<b});for(b-=a;0<b;){var e=Math.floor(b/
2),f=a+e;g(this[f],c)?(a=++f,b-=e+1):b=e}return a};Array.prototype.upper_bound=function(a,b,c,g){"undefined"===typeof g&&(g=function(a,b){return a<b});for(b-=a;0<b;){var e=Math.floor(b/2),f=a+e;g(c,this[f])?b=e:(a=++f,b-=e+1)}return a};Array.prototype.rotate=function(a,b,c){for(var g=b;a!=g;){var e=this[a];this[a]=this[g];this[g]=e;++a;++g;g===c?g=b:a===b&&(b=g)}};var oa=function(){function a(a,b){this.name=a;this.parent=b;this.children={};this.totalTime=this.elapsedTime=this.startTime=0;this.running=
!1;this.childrenCount=0}function b(a,c){if(a.name===c.parent)return a;for(var g in a.children){var d;if(d=b(a.children[g],c))return d}return null}"undefined"===typeof performance&&(window.performance={now:function(){return+new Date}});a.prototype={start:function(){this.startTime=performance.now();this.running=!0},stop:function(a){if(this.running){this.running=!1;this.elapsedTime+=performance.now()-this.startTime;a&&this.start();for(var b in this.children)this.children[b].stop()}},reset:function(a){a||
(this.running=!0,this.totalTime+=this.elapsedTime,this.start());this.elapsedTime=0;for(var b in this.children)this.children[b].reset(!0)}};var c=[],g=new a("root");return{create:function(b,g){if(!c)throw Error("late profile creation not allowed");var d=new a(b,g||"root");c.push(d);return d},destroy:function(a){a.childrenCount--;delete a.children[a.name]},init:function(){for(;c.length;){var a=c.pop();(a.parentNode=b(g,a))?(a.parentNode.children[a.name]=a,a.parentNode.childrenCount++):c.unshift(a)}c=
null},reset:function(){g.reset(!0)},profileRoot:g}}(),za=Number.MAX_VALUE,ga=2.220446049250313E-16,ea=Math.PI,ia=2,qa=8,N=0.005,sa=2/180*ea,Ra=2*N,fb=8/180*ea,gb=0.5*ea,Wb=gb*gb,Xb=2/180*ea;$b.prototype={toString:function(){return this.major+"."+this.minor+"."+this.revision}};var Sc=new $b(2,3,1),Tc=Math.sin,Uc=Math.cos,Vc=Math.floor,Oa=Math.sqrt,Yb=Math.atan2;d.prototype={Clone:function(){return new d(this.x,this.y)},SetZero:function(){this.y=this.x=0;return this},Set:function(a,b){this.x=a;this.y=
b;return this},Assign:function(a){this.x=a.x;this.y=a.y;return this},Negate:function(){var a=new d;a.Set(-this.x,-this.y);return a},get_i:function(a){switch(a){case 0:return this.x;case 1:return this.y}},set_i:function(a,b){switch(a){case 0:return this.x=b;case 1:return this.y=b}},Add:function(a){this.x+=a.x;this.y+=a.y;return this},Subtract:function(a){this.x-=a.x;this.y-=a.y;return this},Multiply:function(a){this.x*=a;this.y*=a;return this},Length:function(){return Oa(this.x*this.x+this.y*this.y)},
LengthSquared:function(){return this.x*this.x+this.y*this.y},Normalize:function(){var a=this.Length();if(a<ga)return 0;var b=1/a;this.x*=b;this.y*=b;return a},IsValid:function(){return ac(this.x)&&ac(this.y)},Skew:function(){return new d(-this.y,this.x)},_serialize:function(a){a=a||[];a[0]=this.x;a[1]=this.y;return a},_deserialize:function(a){this.x=a[0];this.y=a[1]}};d.Add=function(a,b){return new d(a.x+b.x,a.y+b.y)};d.Subtract=function(a,b){return new d(a.x-b.x,a.y-b.y)};d.Equals=function(a,b){return a.x==
b.x&&a.y==b.y};d.Multiply=function(a,b){return new d(a*b.x,a*b.y)};d.Negate=function(a){return new d(-a.x,-a.y)};L.prototype={Clone:function(){return new L(this.x,this.y,this.z)},SetZero:function(){this.z=this.y=this.x=0},Set:function(a,b,c){this.x=a;this.y=b;this.z=c},Negate:function(){var a=new L;a.Set(-this.x,-this.y,-this.z);return a},Add:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z},Subtract:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z},Multiply:function(a){this.x*=a;this.y*=a;this.z*=
a},Invert:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},x:0,y:0,z:0};L.Multiply=function(a,b){return new L(a*b.x,a*b.y,a*b.z)};L.Add=function(a,b){return new L(a.x+b.x,a.y+b.y,a.z+b.z)};L.Subtract=function(a,b){return new L(a.x-b.x,a.y-b.y,a.z-b.z)};U.prototype={Set:function(a,b){this.ex.Assign(a);this.ey.Assign(b)},Assign:function(a){this.ex.Assign(a.ex);this.ey.Assign(a.ey)},SetIdentity:function(){this.ex.x=1;this.ey.x=0;this.ex.y=0;this.ey.y=1},SetZero:function(){this.ex.x=
0;this.ey.x=0;this.ex.y=0;this.ey.y=0},GetInverse:function(){var a=this.ex.x,b=this.ey.x,c=this.ex.y,g=this.ey.y,e=new U,f=a*g-b*c;0!=f&&(f=1/f);e.ex.x=f*g;e.ey.x=-f*b;e.ex.y=-f*c;e.ey.y=f*a;return e},Solve:function(a){var b=this.ex.x,c=this.ey.x,g=this.ex.y,e=this.ey.y,f=b*e-c*g;0!=f&&(f=1/f);var h=new d;h.x=f*(e*a.x-c*a.y);h.y=f*(b*a.y-g*a.x);return h}};U.Add=function(a,b){return new U(d.Add(a.ex,b.ex),d.Add(a.ey,b.ey))};ua.prototype={SetZero:function(){this.ex.SetZero();this.ey.SetZero();this.ez.SetZero()},
Solve33:function(a){var b=Ea(this.ex,Fa(this.ey,this.ez));0!=b&&(b=1/b);var c=new L;c.x=b*Ea(a,Fa(this.ey,this.ez));c.y=b*Ea(this.ex,Fa(a,this.ez));c.z=b*Ea(this.ex,Fa(this.ey,a));return c},Solve22:function(a){var b=this.ex.x,c=this.ey.x,g=this.ex.y,e=this.ey.y,f=b*e-c*g;0!=f&&(f=1/f);var h=new d;h.x=f*(e*a.x-c*a.y);h.y=f*(b*a.y-g*a.x);return h},GetInverse22:function(a){var b=this.ex.x,c=this.ey.x,g=this.ex.y,e=this.ey.y,f=b*e-c*g;0!=f&&(f=1/f);a.ex.x=f*e;a.ey.x=-f*c;a.ex.z=0;a.ex.y=-f*g;a.ey.y=f*
b;a.ey.z=0;a.ez.x=0;a.ez.y=0;a.ez.z=0},GetSymInverse33:function(a){var b=Ea(this.ex,Fa(this.ey,this.ez));0!=b&&(b=1/b);var c=this.ex.x,g=this.ey.x,e=this.ez.x,f=this.ey.y,d=this.ez.y,k=this.ez.z;a.ex.x=b*(f*k-d*d);a.ex.y=b*(e*d-g*k);a.ex.z=b*(g*d-e*f);a.ey.x=a.ex.y;a.ey.y=b*(c*k-e*e);a.ey.z=b*(e*g-c*d);a.ez.x=a.ex.z;a.ez.y=a.ey.z;a.ez.z=b*(c*f-g*g)}};D.prototype={Clone:function(){return new D(this.s,this.c)},Assign:function(a){this.s=a.s;this.c=a.c},Set:function(a){this.s=Tc(a);this.c=Uc(a)},SetIdentity:function(){this.s=
0;this.c=1},GetAngle:function(){return Yb(this.s,this.c)},GetXAxis:function(){return new d(this.c,this.s)},GetYAxis:function(){return new d(-this.s,this.c)},s:0,c:1};$.prototype={Clone:function(){return new $(this.p,this.q)},Assign:function(a){this.p.Assign(a.p);this.q.Assign(a.q)},SetIdentity:function(){this.p.SetZero();this.q.SetIdentity()},Set:function(a,b){this.p.Assign(a);this.q.Set(b)}};ma.prototype={Assign:function(a){this.localCenter.Assign(a.localCenter);this.c0.Assign(a.c0);this.c.Assign(a.c);
this.a=a.a;this.a0=a.a0;this.alpha0=a.alpha0},Clone:function(){var a=new ma;a.localCenter.Assign(this.localCenter);a.c0.Assign(this.c0);a.c.Assign(this.c);a.a=this.a;a.a0=this.a0;a.alpha0=this.alpha0;return a},GetTransform:function(a,b){a.p.x=(1-b)*this.c0.x+b*this.c.x;a.p.y=(1-b)*this.c0.y+b*this.c.y;a.q.Set((1-b)*this.a0+b*this.a);a.p.x-=a.q.c*this.localCenter.x-a.q.s*this.localCenter.y;a.p.y-=a.q.s*this.localCenter.x+a.q.c*this.localCenter.y},Advance:function(a){var b=(a-this.alpha0)/(1-this.alpha0);
this.c0.Add(d.Multiply(b,d.Subtract(this.c,this.c0)));this.a0+=b*(this.a-this.a0);this.alpha0=a},Normalize:function(){var a=2*ea,a=a*Vc(this.a0/a);this.a0-=a;this.a-=a},a0:0,a:0,alpha0:0};var V=Math.abs,S=Math.min,I=Math.max;ka.prototype={Set:function(a,b,c){this.r=a;this.g=b;this.b=c}};W.prototype={SetFlags:function(a){this.m_drawFlags=a},GetFlags:function(){return this.m_drawFlags},AppendFlags:function(a){this.m_drawFlags|=a},ClearFlags:function(a){this.m_drawFlags&=~a},ToggleFlags:function(a){this.m_drawFlags^=
a},DrawPolygon:function(a,b,c){},DrawSolidPolygon:function(a,b,c){},DrawCircle:function(a,b,c){},DrawSolidCircle:function(a,b,c,g){},DrawSegment:function(a,b,c){},DrawTransform:function(a){},m_drawFlags:0};W.e_shapeBit=1;W.e_jointBit=2;W.e_aabbBit=4;W.e_centerOfMassBit=8;W.e_contactPoints=16;W.e_contactNormals=32;W.e_contactImpulses=64;W.e_frictionImpulses=128;W.e_statistics=256;W.e_profile=512;W.e_pairBit=1024;"undefined"===typeof performance&&(window.performance={now:function(){return+new Date}});
gc.prototype={Reset:function(){this.m_start=performance.now()},GetMilliseconds:function(){return performance.now()-this.m_start}};E.prototype={Clone:function(){},GetType:function(){return this.m_type},GetChildCount:function(){},TestPoint:function(a,b){},RayCast:function(a,b,c,g){},ComputeAABB:function(a,b,c){},ComputeMass:function(a,b){},_serialize:function(a){a=a||{};a.m_type=this.m_type;a.m_radius=this.m_radius;return a},_deserialize:function(a){this.m_radius=a.m_radius}};E.e_circle=0;E.e_edge=
1;E.e_polygon=2;E.e_chain=3;E.e_typeCount=4;Ga.prototype={Clone:function(){var a=new Ga;a.m_radius=this.m_radius;a.m_p=this.m_p.Clone();return a},GetChildCount:function(){return 1},TestPoint:function(a,b){var c=d.Add(a.p,A(a.q,this.m_p)),c=d.Subtract(b,c);return B(c,c)<=this.m_radius*this.m_radius},RayCast:function(a,b,c,g){c=d.Add(c.p,A(c.q,this.m_p));c=d.Subtract(b.p1,c);var e=B(c,c)-this.m_radius*this.m_radius;g=d.Subtract(b.p2,b.p1);var f=B(c,g),h=B(g,g),e=f*f-h*e;if(0>e||h<ga)return!1;f=-(f+
Oa(e));return 0<=f&&f<=b.maxFraction*h?(f/=h,a.fraction=f,a.normal=d.Add(c,d.Multiply(f,g)),a.normal.Normalize(),!0):!1},ComputeAABB:function(a,b,c){c=b.p.x+(b.q.c*this.m_p.x-b.q.s*this.m_p.y);b=b.p.y+(b.q.s*this.m_p.x+b.q.c*this.m_p.y);a.lowerBound.x=c-this.m_radius;a.lowerBound.y=b-this.m_radius;a.upperBound.x=c+this.m_radius;a.upperBound.y=b+this.m_radius},ComputeMass:function(a,b){a.mass=b*ea*this.m_radius*this.m_radius;a.center=this.m_p;a.I=a.mass*(0.5*this.m_radius*this.m_radius+B(this.m_p,
this.m_p))},GetSupport:function(a){return 0},GetSupportVertex:function(a){return this.m_p},GetVertexCount:function(){return 1},GetVertex:function(a){return this.m_p},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.m_p=this.m_p._serialize();return a},_deserialize:function(a){this.parent.prototype._deserialize.call(this,a);this.m_p._deserialize(a.m_p)}};Ga._extend(E);Ba.prototype={Set:function(a,b){this.m_vertex1.Assign(a);this.m_vertex2.Assign(b);this.m_hasVertex3=this.m_hasVertex0=
!1},Clone:function(){var a=new Ba;a.m_vertex0=this.m_vertex0.Clone();a.m_vertex1=this.m_vertex1.Clone();a.m_vertex2=this.m_vertex2.Clone();a.m_vertex3=this.m_vertex3.Clone();a.m_hasVertex0=this.m_hasVertex0;a.m_hasVertex3=this.m_hasVertex3;return a},GetChildCount:function(){return 1},TestPoint:function(a,b){return!1},RayCast:function(a,b,c,g){var e=na(c.q,d.Subtract(b.p1,c.p));g=na(c.q,d.Subtract(b.p2,c.p));var f=d.Subtract(g,e);g=this.m_vertex1;var h=this.m_vertex2,k=d.Subtract(h,g),k=new d(k.y,
-k.x);k.Normalize();var m=B(k,d.Subtract(g,e)),l=B(k,f);if(0==l)return!1;l=m/l;if(0>l||b.maxFraction<l)return!1;b=d.Add(e,d.Multiply(l,f));e=d.Subtract(h,g);h=B(e,e);if(0==h)return!1;g=B(d.Subtract(b,g),e)/h;if(0>g||1<g)return!1;a.fraction=l;a.normal=0<m?A(c.q,k).Negate():A(c.q,k);return!0},ComputeAABB:function(a,b,c){var g=b.q.c*this.m_vertex1.x-b.q.s*this.m_vertex1.y+b.p.x;c=b.q.s*this.m_vertex1.x+b.q.c*this.m_vertex1.y+b.p.y;var e=b.q.c*this.m_vertex2.x-b.q.s*this.m_vertex2.y+b.p.x,f=b.q.s*this.m_vertex2.x+
b.q.c*this.m_vertex2.y+b.p.y;b=S(g,e);var d=S(c,f),g=I(g,e);c=I(c,f);a.lowerBound.x=b-this.m_radius;a.lowerBound.y=d-this.m_radius;a.upperBound.x=g+this.m_radius;a.upperBound.y=c+this.m_radius},ComputeMass:function(a,b){a.mass=0;a.center=d.Multiply(0.5,d.Add(this.m_vertex1,this.m_vertex2));a.I=0},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.m_vertex1=this.m_vertex1._serialize();a.m_vertex2=this.m_vertex2._serialize();(a.m_hasVertex0=this.m_hasVertex0)&&(a.m_vertex0=
this.m_vertex0._serialize());(a.m_hasVertex3=this.m_hasVertex3)&&(a.m_vertex3=this.m_vertex3._serialize());return a},_deserialize:function(a){this.parent.prototype._deserialize.call(this,a);this.m_vertex1._deserialize(a.m_vertex1);this.m_vertex2._deserialize(a.m_vertex2);(this.m_hasVertex0=a.m_hasVertex0)&&this.m_vertex0._deserialize(a.m_vertex0);(this.m_hasVertex3=a.m_hasVertex3)&&this.m_vertex3._deserialize(a.m_vertex3)}};Ba._extend(E);pa._tempEdge=new Ba;pa.prototype={Clear:function(){this.m_vertices=
null;this.m_count=0},CreateLoop:function(a,b){this.m_count=b+1;this.m_vertices=Array(this.m_count);for(var c=0;c<b;++c)this.m_vertices[c]=a[c].Clone();this.m_vertices[b]=this.m_vertices[0].Clone();this.m_prevVertex.Assign(this.m_vertices[this.m_count-2]);this.m_nextVertex.Assign(this.m_vertices[1]);this.m_hasNextVertex=this.m_hasPrevVertex=!0},CreateChain:function(a,b){this.m_count=b;this.m_vertices=Array(b);for(var c=0;c<b;++c)this.m_vertices[c]=a[c].Clone();this.m_hasNextVertex=this.m_hasPrevVertex=
!1;this.m_prevVertex.SetZero();this.m_nextVertex.SetZero()},SetPrevVertex:function(a){this.m_prevVertex.Assign(a);this.m_hasPrevVertex=!0},SetNextVertex:function(a){this.m_nextVertex.Assign(a);this.m_hasNextVertex=!0},Clone:function(){var a=new pa;a.m_count=this.m_count;a.m_vertices=Array(this.m_count);for(var b=0;b<this.m_count;++b)a.m_vertices[b]=this.m_vertices[b].Clone();a.m_prevVertex=this.m_prevVertex.Clone();a.m_nextVertex=this.m_nextVertex.Clone();a.m_hasPrevVertex=this.m_hasPrevVertex;a.m_hasNextVertex=
this.m_hasNextVertex;return a},GetChildCount:function(){return this.m_count-1},GetChildEdge:function(a,b){a.m_type=E.e_edge;a.m_radius=this.m_radius;a.m_vertex1=this.m_vertices[b+0];a.m_vertex2=this.m_vertices[b+1];0<b?(a.m_vertex0=this.m_vertices[b-1],a.m_hasVertex0=!0):(a.m_vertex0=this.m_prevVertex,a.m_hasVertex0=this.m_hasPrevVertex);b<this.m_count-2?(a.m_vertex3=this.m_vertices[b+2],a.m_hasVertex3=!0):(a.m_vertex3=this.m_nextVertex,a.m_hasVertex3=this.m_hasNextVertex)},TestPoint:function(a,b){return!1},
RayCast:function(a,b,c,g){var e=g+1;e==this.m_count&&(e=0);pa._tempEdge.m_vertex1=this.m_vertices[g].Clone();pa._tempEdge.m_vertex2=this.m_vertices[e].Clone();return pa._tempEdge.RayCast(a,b,c,0)},ComputeAABB:function(a,b,c){var g=c+1;g==this.m_count&&(g=0);var e=b.q.c*this.m_vertices[c].x-b.q.s*this.m_vertices[c].y+b.p.x;c=b.q.s*this.m_vertices[c].x+b.q.c*this.m_vertices[c].y+b.p.y;var f=b.q.c*this.m_vertices[g].x-b.q.s*this.m_vertices[g].y+b.p.x;b=b.q.s*this.m_vertices[g].x+b.q.c*this.m_vertices[g].y+
b.p.y;a.lowerBound.x=S(e,f);a.lowerBound.y=S(c,b);a.upperBound.x=I(e,f);a.upperBound.y=I(c,b)},ComputeMass:function(a,b){a.mass=0;a.center.SetZero();a.I=0},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.m_count=this.m_count;a.m_vertices=[];for(var b=0;b<this.m_count;++b)a.m_vertices.push(this.m_vertices[b]._serialize());(a.m_hasPrevVertex=this.m_hasPrevVertex)&&(a.m_prevVertex=this.m_prevVertex._serialize());(a.m_hasNextVertex=this.m_hasNextVertex)&&(a.m_nextVertex=
this.m_nextVertex._serialize());return a},_deserialize:function(a){this.parent.prototype._deserialize.call(this,a);this.m_count=a.m_count;this.m_vertices=[];for(var b=0;b<this.m_count;++b)this.m_vertices[b]=new d,this.m_vertices[b]._deserialize(a.m_vertices[b]);(this.m_hasPrevVertex=a.m_hasPrevVertex)&&this.m_prevVertex._deserialize(a.m_prevVertex);(this.m_hasNextVertex=a.m_hasNextVertex)&&this.m_nextVertex._deserialize(a.m_nextVertex)}};pa._extend(E);va.prototype={Clone:function(){var a=new va;a.m_count=
this.m_count;a.m_centroid=this.m_centroid.Clone();for(var b=0;b<this.m_count;++b)a.m_vertices[b]=this.m_vertices[b].Clone(),a.m_normals[b]=this.m_normals[b].Clone();return a},GetChildCount:function(){return 1},Set:function(a,b){if(3>b)this.SetAsBox(1,1);else{for(var c=S(b,qa),g=Array(qa),e=0,f=0;f<c;++f){for(var h=a[f],k=!0,m=0;m<e;++m)if(ib(h,g[m])<0.5*N){k=!1;break}k&&(g[e++]=h.Clone())}c=e;if(3>c)this.SetAsBox(1,1);else{e=0;h=g[0].x;for(f=1;f<c;++f)if(m=g[f].x,m>h||m==h&&g[f].y<g[e].y)e=f,h=m;
for(var l=Array(qa),k=0,f=e;;){l[k]=f;for(var n=0,m=1;m<c;++m)if(n==f)n=m;else{var p=d.Subtract(g[n],g[l[k]]),h=d.Subtract(g[m],g[l[k]]),q=t(p,h);0>q&&(n=m);0==q&&h.LengthSquared()>p.LengthSquared()&&(n=m)}++k;f=n;if(n==e)break}if(3>k)this.SetAsBox(1,1);else{this.m_count=k;for(f=0;f<k;++f)this.m_vertices[f]=g[l[f]].Clone();for(f=0;f<k;++f)c=d.Subtract(this.m_vertices[f+1<k?f+1:0],this.m_vertices[f]),this.m_normals[f]=bc(c,1).Clone(),this.m_normals[f].Normalize();this.m_centroid=va.ComputeCentroid(this.m_vertices,
k)}}}},SetAsBox:function(a,b,c,g){this.m_count=4;this.m_vertices[0]=new d(-a,-b);this.m_vertices[1]=new d(a,-b);this.m_vertices[2]=new d(a,b);this.m_vertices[3]=new d(-a,b);this.m_normals[0]=new d(0,-1);this.m_normals[1]=new d(1,0);this.m_normals[2]=new d(0,1);this.m_normals[3]=new d(-1,0);if(c)for(this.m_centroid.Assign(c),a=new $,a.p=c,a.q.Set(g),c=0;c<this.m_count;++c)this.m_vertices[c].Assign(T(a,this.m_vertices[c])),this.m_normals[c].Assign(A(a.q,this.m_normals[c]))},TestPoint:function(a,b){for(var c=
na(a.q,d.Subtract(b,a.p)),g=0;g<this.m_count;++g)if(0<B(this.m_normals[g],d.Subtract(c,this.m_vertices[g])))return!1;return!0},RayCast:function(a,b,c,g){g=na(c.q,d.Subtract(b.p1,c.p));var e=na(c.q,d.Subtract(b.p2,c.p)),e=d.Subtract(e,g),f=0;b=b.maxFraction;for(var h=-1,k=0;k<this.m_count;++k){var m=B(this.m_normals[k],d.Subtract(this.m_vertices[k],g)),l=B(this.m_normals[k],e);if(0==l){if(0>m)return!1}else 0>l&&m<f*l?(f=m/l,h=k):0<l&&m<b*l&&(b=m/l);if(b<f)return!1}return 0<=h?(a.fraction=f,a.normal=
A(c.q,this.m_normals[h]),!0):!1},ComputeAABB:function(a,b,c){c=b.q.c*this.m_vertices[0].x-b.q.s*this.m_vertices[0].y+b.p.x;for(var g=b.q.s*this.m_vertices[0].x+b.q.c*this.m_vertices[0].y+b.p.y,e=c,f=g,d=1;d<this.m_count;++d){var k=b.q.c*this.m_vertices[d].x-b.q.s*this.m_vertices[d].y+b.p.x,m=b.q.s*this.m_vertices[d].x+b.q.c*this.m_vertices[d].y+b.p.y;c=S(c,k);g=S(g,m);e=I(e,k);f=I(f,m)}a.lowerBound.x=c-this.m_radius;a.lowerBound.y=g-this.m_radius;a.upperBound.x=e+this.m_radius;a.upperBound.y=f+this.m_radius},
ComputeMass:function(a,b){for(var c=new d(0,0),g=0,e=0,f=new d(0,0),h=0;h<this.m_count;++h)f.Add(this.m_vertices[h]);f.Multiply(1/this.m_count);for(var k=1/3,h=0;h<this.m_count;++h){var m=d.Subtract(this.m_vertices[h],f),l=h+1<this.m_count?d.Subtract(this.m_vertices[h+1],f):d.Subtract(this.m_vertices[0],f),n=t(m,l),p=0.5*n,g=g+p;c.Add(d.Multiply(p*k,d.Add(m,l)));var p=m.x,m=m.y,q=l.x,l=l.y,e=e+0.25*k*n*(p*p+q*p+q*q+(m*m+l*m+l*l))}a.mass=b*g;c.Multiply(1/g);a.center=d.Add(c,f);a.I=b*e;a.I+=a.mass*
(B(a.center,a.center)-B(c,c))},GetVertexCount:function(){return this.m_count},GetVertex:function(a){return this.m_vertices[a]},Validate:function(){for(var a=0;a<this.m_count;++a)for(var b=a,c=a<this.m_count-1?b+1:0,g=this.m_vertices[b],e=d.Subtract(this.m_vertices[c],g),f=0;f<this.m_count;++f)if(f!=b&&f!=c){var h=d.Subtract(this.m_vertices[f],g);if(0>t(e,h))return!1}return!0},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.m_count=this.m_count;a.m_centroid=this.m_centroid._serialize();
a.m_vertices=[];a.m_normals=[];for(var b=0;b<this.m_count;++b)a.m_vertices.push(this.m_vertices[b]._serialize()),a.m_normals.push(this.m_normals[b]._serialize());return a},_deserialize:function(a){this.parent.prototype._deserialize.call(this,a);this.m_count=a.m_count;this.m_centroid._deserialize(a.m_centroid);this.m_vertices=[];this.m_normals=[];for(var b=0;b<this.m_count;++b)this.m_vertices[b]=new d,this.m_vertices[b]._deserialize(a.m_vertices[b]),this.m_normals[b]=new d,this.m_normals[b]._deserialize(a.m_normals[b])}};
va.ComputeCentroid=function(a,b){for(var c=new d,g=0,e=new d(0,0),f=1/3,h=0;h<b;++h){var k=e,m=a[h],l=h+1<b?a[h+1]:a[0],n=d.Subtract(m,k),p=d.Subtract(l,k),n=0.5*t(n,p),g=g+n;c.Add(d.Multiply(n,d.Multiply(f,d.Add(d.Add(k,m),l))))}c.Multiply(1/g);return c};va._extend(E);wa.prototype={CreateProxy:function(a,b){var c=this.m_tree.CreateProxy(a,b);++this.m_proxyCount;this.BufferMove(c);return c},DestroyProxy:function(a){this.UnBufferMove(a);--this.m_proxyCount;this.m_tree.DestroyProxy(a)},MoveProxy:function(a,
b,c){this.m_tree.MoveProxy(a,b,c)&&this.BufferMove(a)},TouchProxy:function(a){this.BufferMove(a)},GetFatAABB:function(a){return this.m_tree.GetFatAABB(a)},GetUserData:function(a){return this.m_tree.GetUserData(a)},TestOverlap:function(a,b){var c=this.m_tree.GetFatAABB(a),g=this.m_tree.GetFatAABB(b);return lb(c,g)},GetProxyCount:function(){return this.m_proxyCount},UpdatePairs:function(a){this.m_pairCount=0;for(var b=this.m_pairBuffer.length=0;b<this.m_moveCount;++b)if(this.m_queryProxyId=this.m_moveBuffer[b],
this.m_queryProxyId!=wa.e_nullProxy){var c=this.m_tree.GetFatAABB(this.m_queryProxyId);this.m_tree.Query(this,c)}this.m_moveCount=0;this.m_pairBuffer.sort(jc);for(b=0;b<this.m_pairCount;){var c=this.m_pairBuffer[b],g=this.m_tree.GetUserData(c.proxyIdA),e=this.m_tree.GetUserData(c.proxyIdB);a.AddPair(g,e);for(++b;b<this.m_pairCount;){g=this.m_pairBuffer[b];if(g.proxyIdA!=c.proxyIdA||g.proxyIdB!=c.proxyIdB)break;++b}}},Query:function(a,b){this.m_tree.Query(a,b)},RayCast:function(a,b){this.m_tree.RayCast(a,
b)},GetTreeHeight:function(){return this.m_tree.GetHeight()},GetTreeBalance:function(){return this.m_tree.GetMaxBalance()},GetTreeQuality:function(){return this.m_tree.GetAreaRatio()},ShiftOrigin:function(a){this.m_tree.ShiftOrigin(a)},BufferMove:function(a){this.m_moveBuffer[this.m_moveCount]=a;++this.m_moveCount},UnBufferMove:function(a){for(var b=0;b<this.m_moveCount;++b)this.m_moveBuffer[b]==a&&(this.m_moveBuffer[b]=wa.e_nullProxy)},QueryCallback:function(a){if(a==this.m_queryProxyId)return!0;
this.m_pairBuffer[this.m_pairCount]=new ic;this.m_pairBuffer[this.m_pairCount].proxyIdA=S(a,this.m_queryProxyId);this.m_pairBuffer[this.m_pairCount].proxyIdB=I(a,this.m_queryProxyId);++this.m_pairCount;return!0}};wa.e_nullProxy=-1;Ha.prototype={Assign:function(a){this.m_vertices=a.m_vertices;this.m_count=a.m_count;this.m_radius=a.m_radius},Set:function(a,b){switch(a.GetType()){case E.e_circle:this.m_vertices=[a.m_p];this.m_count=1;this.m_radius=a.m_radius;break;case E.e_polygon:this.m_vertices=a.m_vertices;
this.m_count=a.m_count;this.m_radius=a.m_radius;break;case E.e_chain:this.m_vertices=[a.m_vertices[b]];this.m_vertices[1]=b+1<a.m_count?a.m_vertices[b+1]:a.m_vertices[0];this.m_count=2;this.m_radius=a.m_radius;break;case E.e_edge:this.m_vertices=[a.m_vertex1,a.m_vertex2],this.m_count=2,this.m_radius=a.m_radius}},GetSupport:function(a,b){for(var c=0,g=this.m_vertices[0].x*a+this.m_vertices[0].y*b,e=1;e<this.m_count;++e){var f=this.m_vertices[e].x*a+this.m_vertices[e].y*b;f>g&&(c=e,g=f)}return c},GetSupportVertex:function(a,
b){return this.m_vertices[this.GetSupport(a,b)]},GetVertexCount:function(){return this.m_count},GetVertex:function(a){return this.m_vertices[a]}};Sa.prototype={Assign:function(a){this.wA.x=a.wA.x;this.wA.y=a.wA.y;this.wB.x=a.wB.x;this.wB.y=a.wB.y;this.w.x=a.w.x;this.w.y=a.w.y;this.a=a.a;this.indexA=a.indexA;this.indexB=a.indexB}};Jb.prototype={ReadCache:function(a,b,c,g,e){this.m_count=a.count;for(var f=this.m_v,d=0;d<this.m_count;++d){var k=f[d];k.indexA=a.indexA[d];k.indexB=a.indexB[d];var m=b.GetVertex(k.indexA),
l=g.GetVertex(k.indexB);k.wA.x=c.q.c*m.x-c.q.s*m.y+c.p.x;k.wA.y=c.q.s*m.x+c.q.c*m.y+c.p.y;k.wB.x=e.q.c*l.x-e.q.s*l.y+e.p.x;k.wB.y=e.q.s*l.x+e.q.c*l.y+e.p.y;k.w.x=k.wB.x-k.wA.x;k.w.y=k.wB.y-k.wA.y;k.a=0}1<this.m_count&&(a=a.metric,d=this.GetMetric(),d<0.5*a||2*a<d||d<ga)&&(this.m_count=0);0==this.m_count&&(k=f[0],k.indexA=0,k.indexB=0,m=b.GetVertex(0),l=g.GetVertex(0),k.wA.x=c.q.c*m.x-c.q.s*m.y+c.p.x,k.wA.y=c.q.s*m.x+c.q.c*m.y+c.p.y,k.wB.x=e.q.c*l.x-e.q.s*l.y+e.p.x,k.wB.y=e.q.s*l.x+e.q.c*l.y+e.p.y,
k.w.x=k.wB.x-k.wA.x,k.w.y=k.wB.y-k.wA.y,this.m_count=k.a=1)},WriteCache:function(a){a.metric=this.GetMetric();a.count=this.m_count;for(var b=this.m_v,c=0;c<this.m_count;++c)a.indexA[c]=b[c].indexA,a.indexB[c]=b[c].indexB},GetSearchDirection:function(a){switch(this.m_count){case 1:a.x=-this.m_v[0].w.x;a.y=-this.m_v[0].w.y;break;case 2:var b=this.m_v[1].w.x-this.m_v[0].w.x,c=this.m_v[1].w.y-this.m_v[0].w.y;0<b*-this.m_v[0].w.y-c*-this.m_v[0].w.x?(a.x=-1*c,a.y=1*b):(a.x=1*c,a.y=-1*b)}},GetClosestPoint:function(a){switch(this.m_count){case 1:a.x=
this.m_v[0].w.x;a.y=this.m_v[0].w.y;break;case 2:a.x=this.m_v[0].a*this.m_v[0].w.x+this.m_v[1].a*this.m_v[1].w.x;a.y=this.m_v[0].a*this.m_v[0].w.y+this.m_v[1].a*this.m_v[1].w.y;break;case 3:a.x=a.y=0}},GetWitnessPoints:function(a,b){switch(this.m_count){case 1:a.x=this.m_v[0].wA.x;a.y=this.m_v[0].wA.y;b.x=this.m_v[0].wB.x;b.y=this.m_v[0].wB.y;break;case 2:a.x=this.m_v[0].a*this.m_v[0].wA.x+this.m_v[1].a*this.m_v[1].wA.x;a.y=this.m_v[0].a*this.m_v[0].wA.y+this.m_v[1].a*this.m_v[1].wA.y;b.x=this.m_v[0].a*
this.m_v[0].wB.x+this.m_v[1].a*this.m_v[1].wB.x;b.y=this.m_v[0].a*this.m_v[0].wB.y+this.m_v[1].a*this.m_v[1].wB.y;break;case 3:a.x=this.m_v[0].a*this.m_v[0].wA.x+this.m_v[1].a*this.m_v[1].wA.x+this.m_v[2].a*this.m_v[2].wA.x,a.y=this.m_v[0].a*this.m_v[0].wA.y+this.m_v[1].a*this.m_v[1].wA.y+this.m_v[2].a*this.m_v[2].wA.y,b.x=a.x,b.y=a.y}},GetMetric:function(){switch(this.m_count){case 1:return 0;case 2:return hb(this.m_v[0].w,this.m_v[1].w);case 3:return(this.m_v[1].w.x-this.m_v[0].w.x)*(this.m_v[2].w.y-
this.m_v[0].w.y)-(this.m_v[1].w.y-this.m_v[0].w.y)*(this.m_v[2].w.x-this.m_v[0].w.x)}},Solve2:function(){var a=this.m_v[0].w,b=this.m_v[1].w,c=b.x-a.x,g=b.y-a.y,a=-(a.x*c+a.y*g);0>=a?this.m_count=this.m_v[0].a=1:(b=b.x*c+b.y*g,0>=b?(this.m_count=this.m_v[1].a=1,this.m_v[0].Assign(this.m_v[1])):(c=1/(b+a),this.m_v[0].a=b*c,this.m_v[1].a=a*c,this.m_count=2))},Solve3:function(){var a=this.m_v[0].w,b=this.m_v[1].w,c=this.m_v[2].w,g=b.x-a.x,e=b.y-a.y,f=b.x*g+b.y*e,d=-(a.x*g+a.y*e),k=c.x-a.x,m=c.y-a.y,
l=c.x*k+c.y*m,n=-(a.x*k+a.y*m),p=c.x-b.x,q=c.y-b.y,r=c.x*p+c.y*q,p=-(b.x*p+b.y*q),e=g*m-e*k,g=e*(b.x*c.y-b.y*c.x),c=e*(c.x*a.y-c.y*a.x),a=e*(a.x*b.y-a.y*b.x);0>=d&&0>=n?this.m_count=this.m_v[0].a=1:0<f&&0<d&&0>=a?(l=1/(f+d),this.m_v[0].a=f*l,this.m_v[1].a=d*l,this.m_count=2):0<l&&0<n&&0>=c?(f=1/(l+n),this.m_v[0].a=l*f,this.m_v[2].a=n*f,this.m_count=2,this.m_v[1].Assign(this.m_v[2])):0>=f&&0>=p?(this.m_count=this.m_v[1].a=1,this.m_v[0].Assign(this.m_v[1])):0>=l&&0>=r?(this.m_count=this.m_v[2].a=1,
this.m_v[0].Assign(this.m_v[2])):0<r&&0<p&&0>=g?(f=1/(r+p),this.m_v[1].a=r*f,this.m_v[2].a=p*f,this.m_count=2,this.m_v[0].Assign(this.m_v[2])):(f=1/(g+c+a),this.m_v[0].a=g*f,this.m_v[1].a=c*f,this.m_v[2].a=a*f,this.m_count=3)}};var fa=new Jb,Ca=new d,la=new d;ra.b2_gjkCalls=0;ra.b2_gjkIters=0;ra.b2_gjkMaxIters=0;Q.prototype={indexA:0,indexB:0,typeA:0,typeB:0,Reset:function(){this.indexA=this.indexB=this.typeA=this.typeB=0},Get:function(){return this.indexA|this.indexB<<8|this.typeA<<16|this.typeB<<
24},Assign:function(a){this.indexA=a.indexA;this.indexB=a.indexB;this.typeA=a.typeA;this.typeB=a.typeB}};Q.e_vertex=0;Q.e_face=1;ha.prototype={Clone:function(){var a=new ha;a.localPoint.x=this.localPoint.x;a.localPoint.y=this.localPoint.y;a.normalImpulse=this.normalImpulse;a.tangentImpulse=this.tangentImpulse;a.id.Assign(this.id);return a}};F.prototype={Clone:function(){var a=new F;a.pointCount=this.pointCount;a.type=this.type;a.localPoint.x=this.localPoint.x;a.localPoint.y=this.localPoint.y;a.localNormal.x=
this.localNormal.x;a.localNormal.y=this.localNormal.y;for(var b=0;b<this.pointCount;++b)a.points[b]=this.points[b].Clone();return a},Assign:function(a){this.pointCount=a.pointCount;this.type=a.type;this.localPoint.x=a.localPoint.x;this.localPoint.y=a.localPoint.y;this.localNormal.x=a.localNormal.x;this.localNormal.y=a.localNormal.y;for(var b=0;b<this.pointCount;++b)this.points[b]=a.points[b].Clone()}};F.e_circles=0;F.e_faceA=1;F.e_faceB=2;F.b2_nullState=0;F.b2_addState=1;F.b2_persistState=2;F.b2_removeState=
3;Kb.prototype={Initialize:function(a,b,c,g,e){if(0!=a.pointCount)switch(a.type){case F.e_circles:this.normal.x=1;this.normal.y=0;var f=b.q.c*a.localPoint.x-b.q.s*a.localPoint.y+b.p.x,h=b.q.s*a.localPoint.x+b.q.c*a.localPoint.y+b.p.y;b=g.q.c*a.points[0].localPoint.x-g.q.s*a.points[0].localPoint.y+g.p.x;a=g.q.s*a.points[0].localPoint.x+g.q.c*a.points[0].localPoint.y+g.p.y;g=f-b;var k=h-a;g*g+k*k>ga*ga&&(this.normal.x=b-f,this.normal.y=a-h,this.normal.Normalize());var f=f+c*this.normal.x,h=h+c*this.normal.y,
k=b-e*this.normal.x,m=a-e*this.normal.y;this.points[0]=new d(0.5*(f+k),0.5*(h+m));this.separations[0]=(k-f)*this.normal.x+(m-h)*this.normal.y;break;case F.e_faceA:this.normal.x=b.q.c*a.localNormal.x-b.q.s*a.localNormal.y;this.normal.y=b.q.s*a.localNormal.x+b.q.c*a.localNormal.y;for(var l=b.q.c*a.localPoint.x-b.q.s*a.localPoint.y+b.p.x,n=b.q.s*a.localPoint.x+b.q.c*a.localPoint.y+b.p.y,p=0;p<a.pointCount;++p){var q=g.q.c*a.points[p].localPoint.x-g.q.s*a.points[p].localPoint.y+g.p.x,r=g.q.s*a.points[p].localPoint.x+
g.q.c*a.points[p].localPoint.y+g.p.y,h=(q-l)*this.normal.x+(r-n)*this.normal.y,f=q+(c-h)*this.normal.x,h=r+(c-h)*this.normal.y,k=q-e*this.normal.x,m=r-e*this.normal.y;this.points[p]=new d(0.5*(f+k),0.5*(h+m));this.separations[p]=(k-f)*this.normal.x+(m-h)*this.normal.y}break;case F.e_faceB:this.normal.x=g.q.c*a.localNormal.x-g.q.s*a.localNormal.y;this.normal.y=g.q.s*a.localNormal.x+g.q.c*a.localNormal.y;l=g.q.c*a.localPoint.x-g.q.s*a.localPoint.y+g.p.x;n=g.q.s*a.localPoint.x+g.q.c*a.localPoint.y+g.p.y;
for(p=0;p<a.pointCount;++p)q=b.q.c*a.points[p].localPoint.x-b.q.s*a.points[p].localPoint.y+b.p.x,r=b.q.s*a.points[p].localPoint.x+b.q.c*a.points[p].localPoint.y+b.p.y,h=(q-l)*this.normal.x+(r-n)*this.normal.y,k=q+(e-h)*this.normal.x,m=r+(e-h)*this.normal.y,f=q-c*this.normal.x,h=r-c*this.normal.y,this.points[p]=new d(0.5*(f+k),0.5*(h+m)),this.separations[p]=(f-k)*this.normal.x+(h-m)*this.normal.y;this.normal.x=-this.normal.x;this.normal.y=-this.normal.y}}};Z.prototype={Assign:function(a){this.lowerBound.x=
a.lowerBound.x;this.lowerBound.y=a.lowerBound.y;this.upperBound.x=a.upperBound.x;this.upperBound.y=a.upperBound.y},Clone:function(){var a=new Z;a.lowerBound.x=this.lowerBound.x;a.lowerBound.y=this.lowerBound.y;a.upperBound.x=this.upperBound.x;a.upperBound.y=this.upperBound.y;return a},IsValid:function(){return 0<=this.upperBound.x-this.lowerBound.x&&0<=this.upperBound.y-this.lowerBound.y&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},GetCenter:function(){return new d(0.5*(this.lowerBound.x+
this.upperBound.x),0.5*(this.lowerBound.y+this.upperBound.y))},GetExtents:function(){return new d(0.5*(this.upperBound.x-this.lowerBound.x),0.5*(this.upperBound.y-this.lowerBound.y))},GetPerimeter:function(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))},Combine:function(a,b){b?(this.lowerBound.x=S(a.lowerBound.x,b.lowerBound.x),this.lowerBound.y=S(a.lowerBound.y,b.lowerBound.y),this.upperBound.x=I(a.upperBound.x,b.upperBound.x),this.upperBound.y=I(a.upperBound.y,
b.upperBound.y)):(this.lowerBound.x=S(this.lowerBound.x,a.lowerBound.x),this.lowerBound.y=S(this.lowerBound.y,a.lowerBound.y),this.upperBound.x=I(this.upperBound.x,a.upperBound.x),this.upperBound.y=I(this.upperBound.y,a.upperBound.y))},Contains:function(a){return this.lowerBound.x<=a.lowerBound.x&&this.lowerBound.y<=a.lowerBound.y&&a.upperBound.x<=this.upperBound.x&&a.upperBound.y<=this.upperBound.y},RayCast:function(a,b){for(var c=-za,g=za,e=b.p1,f=d.Subtract(b.p2,b.p1),h=Qa(f),k=new d,m=0;2>m;++m)if(h.get_i(m)<
ga){if(e.get_i(m)<this.lowerBound.get_i(m)||this.upperBound.get_i(m)<e.get_i(m))return!1}else{var l=1/f.get_i(m),n=(this.lowerBound.get_i(m)-e.get_i(m))*l,l=(this.upperBound.get_i(m)-e.get_i(m))*l,p=-1;n>l&&(p=l,l=n,n=p,p=1);n>c&&(k.x=k.y=0,k.set_i(m,p),c=n);g=S(g,l);if(c>g)return!1}if(0>c||b.maxFraction<c)return!1;a.fraction=c;a.normal.x=k.x;a.normal.y=k.y;return!0}};aa._localTangent=new d;aa._local_incidentEdges=[new ya,new ya];Y.e_unknown=0;Y.e_edgeA=1;Y.e_edgeB=2;J._temp_edge=new d;J._temp_edge0=
new d;J._temp_edge2=new d;J.prototype={Collide:function(a,b,c,g,e){this.m_xf.Assign(Fb(c,e));this.m_centroidB.x=this.m_xf.q.c*g.m_centroid.x-this.m_xf.q.s*g.m_centroid.y+this.m_xf.p.x;this.m_centroidB.y=this.m_xf.q.s*g.m_centroid.x+this.m_xf.q.c*g.m_centroid.y+this.m_xf.p.y;this.m_v0.x=b.m_vertex0.x;this.m_v0.y=b.m_vertex0.y;this.m_v1.x=b.m_vertex1.x;this.m_v1.y=b.m_vertex1.y;this.m_v2.x=b.m_vertex2.x;this.m_v2.y=b.m_vertex2.y;this.m_v3.x=b.m_vertex3.x;this.m_v3.y=b.m_vertex3.y;c=b.m_hasVertex0;b=
b.m_hasVertex3;J._temp_edge.x=this.m_v2.x-this.m_v1.x;J._temp_edge.y=this.m_v2.y-this.m_v1.y;J._temp_edge.Normalize();this.m_normal1.x=J._temp_edge.y;this.m_normal1.y=-J._temp_edge.x;e=this.m_normal1.x*(this.m_centroidB.x-this.m_v1.x)+this.m_normal1.y*(this.m_centroidB.y-this.m_v1.y);var f=0,d=0,k=!1,m=!1;c&&(J._temp_edge0.x=this.m_v1.x-this.m_v0.x,J._temp_edge0.y=this.m_v1.y-this.m_v0.y,J._temp_edge0.Normalize(),this.m_normal0.x=J._temp_edge0.y,this.m_normal0.y=-J._temp_edge0.x,k=0<=J._temp_edge0.x*
J._temp_edge.y-J._temp_edge0.y*J._temp_edge.x,f=this.m_normal0.x*(this.m_centroidB.x-this.m_v0.x)+this.m_normal0.y*(this.m_centroidB.y-this.m_v0.y));b&&(J._temp_edge2.x=this.m_v3.x-this.m_v2.x,J._temp_edge2.y=this.m_v3.y-this.m_v2.y,J._temp_edge2.Normalize(),this.m_normal2.x=J._temp_edge2.y,this.m_normal2.y=-J._temp_edge2.x,m=0<J._temp_edge.x*J._temp_edge2.y-J._temp_edge.y*J._temp_edge2.x,d=this.m_normal2.x*(this.m_centroidB.x-this.m_v2.x)+this.m_normal2.y*(this.m_centroidB.y-this.m_v2.y));c&&b?k&&
m?(this.m_front=0<=f||0<=e||0<=d)?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=this.m_normal0.x,this.m_lowerLimit.y=this.m_normal0.y,this.m_upperLimit.x=this.m_normal2.x,this.m_upperLimit.y=this.m_normal2.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal1.x,this.m_lowerLimit.y=-this.m_normal1.y,this.m_upperLimit.x=-this.m_normal1.x,this.m_upperLimit.y=-this.m_normal1.y):k?(this.m_front=0<=f||0<=e&&0<=
d)?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=this.m_normal0.x,this.m_lowerLimit.y=this.m_normal0.y,this.m_upperLimit.x=this.m_normal1.x,this.m_upperLimit.y=this.m_normal1.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal2.x,this.m_lowerLimit.y=-this.m_normal2.y,this.m_upperLimit.x=-this.m_normal1.x,this.m_upperLimit.y=-this.m_normal1.y):m?(this.m_front=0<=d||0<=f&&0<=e)?(this.m_normal.x=this.m_normal1.x,
this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y,this.m_upperLimit.x=this.m_normal2.x,this.m_upperLimit.y=this.m_normal2.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal1.x,this.m_lowerLimit.y=-this.m_normal1.y,this.m_upperLimit.x=-this.m_normal0.x,this.m_upperLimit.y=-this.m_normal0.y):(this.m_front=0<=f&&0<=e&&0<=d)?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,
this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y,this.m_upperLimit.x=this.m_normal1.x,this.m_upperLimit.y=this.m_normal1.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal2.x,this.m_lowerLimit.y=-this.m_normal2.y,this.m_upperLimit.x=-this.m_normal0.x,this.m_upperLimit.y=-this.m_normal0.y):c?k?((this.m_front=0<=f||0<=e)?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=this.m_normal0.x,
this.m_lowerLimit.y=this.m_normal0.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y),this.m_upperLimit.x=-this.m_normal1.x,this.m_upperLimit.y=-this.m_normal1.y):(this.m_front=0<=f&&0<=e)?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y,this.m_upperLimit.x=-this.m_normal1.x,this.m_upperLimit.y=-this.m_normal1.y):
(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y,this.m_upperLimit.x=-this.m_normal0.x,this.m_upperLimit.y=-this.m_normal0.y):b?m?(this.m_front=0<=e||0<=d)?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal1.x,this.m_lowerLimit.y=-this.m_normal1.y,this.m_upperLimit.x=this.m_normal2.x,this.m_upperLimit.y=this.m_normal2.y):(this.m_normal.x=-this.m_normal1.x,
this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal1.x,this.m_lowerLimit.y=-this.m_normal1.y,this.m_upperLimit.x=this.m_normal1.x,this.m_upperLimit.y=this.m_normal1.y):((this.m_front=0<=e&&0<=d)?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal1.x,this.m_lowerLimit.y=-this.m_normal1.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal2.x,this.m_lowerLimit.y=-this.m_normal2.y),
this.m_upperLimit.x=this.m_normal1.x,this.m_upperLimit.y=this.m_normal1.y):(this.m_front=0<=e)?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal1.x,this.m_lowerLimit.y=-this.m_normal1.y,this.m_upperLimit.x=-this.m_normal1.x,this.m_upperLimit.y=-this.m_normal1.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y,this.m_upperLimit.x=this.m_normal1.x,this.m_upperLimit.y=
this.m_normal1.y);this.m_polygonB.count=g.m_count;for(f=0;f<g.m_count;++f)this.m_polygonB.vertices[f]=T(this.m_xf,g.m_vertices[f]),this.m_polygonB.normals[f]=A(this.m_xf.q,g.m_normals[f]);this.m_radius=2*Ra;a.pointCount=0;b=this.ComputeEdgeSeparation();if(!(b.type==Y.e_unknown||b.separation>this.m_radius||(e=this.ComputePolygonSeparation(),e.type!=Y.e_unknown&&e.separation>this.m_radius))){c=new Y;c=e.type==Y.e_unknown?b:e.separation>0.98*b.separation+0.001?e:b;e=Array(2);b=new pc;if(c.type==Y.e_edgeA){a.type=
F.e_faceA;d=0;k=this.m_normal.x*this.m_polygonB.normals[0].x+this.m_normal.y*this.m_polygonB.normals[0].y;for(f=1;f<this.m_polygonB.count;++f)m=this.m_normal.x*this.m_polygonB.normals[f].x+this.m_normal.y*this.m_polygonB.normals[f].y,m<k&&(k=m,d=f);f=d;d=f+1<this.m_polygonB.count?f+1:0;e[0]=new ya;e[0].v.x=this.m_polygonB.vertices[f].x;e[0].v.y=this.m_polygonB.vertices[f].y;e[0].id.indexA=0;e[0].id.indexB=f;e[0].id.typeA=Q.e_face;e[0].id.typeB=Q.e_vertex;e[1]=new ya;e[1].v.x=this.m_polygonB.vertices[d].x;
e[1].v.y=this.m_polygonB.vertices[d].y;e[1].id.indexA=0;e[1].id.indexB=d;e[1].id.typeA=Q.e_face;e[1].id.typeB=Q.e_vertex;this.m_front?(b.i1=0,b.i2=1,b.v1.x=this.m_v1.x,b.v1.y=this.m_v1.y,b.v2.x=this.m_v2.x,b.v2.y=this.m_v2.y,b.normal.x=this.m_normal1.x,b.normal.y=this.m_normal1.y):(b.i1=1,b.i2=0,b.v1.x=this.m_v2.x,b.v1.y=this.m_v2.y,b.v2.x=this.m_v1.x,b.v2.y=this.m_v1.y,b.normal.x=-this.m_normal1.x,b.normal.y=-this.m_normal1.y)}else a.type=F.e_faceB,e[0]=new ya,e[0].v=this.m_v1,e[0].id.indexA=0,e[0].id.indexB=
c.index,e[0].id.typeA=Q.e_vertex,e[0].id.typeB=Q.e_face,e[1]=new ya,e[1].v=this.m_v2,e[1].id.indexA=0,e[1].id.indexB=c.index,e[1].id.typeA=Q.e_vertex,e[1].id.typeB=Q.e_face,b.i1=c.index,b.i2=b.i1+1<this.m_polygonB.count?b.i1+1:0,b.v1.x=this.m_polygonB.vertices[b.i1].x,b.v1.y=this.m_polygonB.vertices[b.i1].y,b.v2.x=this.m_polygonB.vertices[b.i2].x,b.v2.y=this.m_polygonB.vertices[b.i2].y,b.normal.x=this.m_polygonB.normals[b.i1].x,b.normal.y=this.m_polygonB.normals[b.i1].y;b.sideNormal1.x=b.normal.y;
b.sideNormal1.y=-b.normal.x;b.sideNormal2.x=-b.sideNormal1.x;b.sideNormal2.y=-b.sideNormal1.y;b.sideOffset1=b.sideNormal1.x*b.v1.x+b.sideNormal1.y*b.v1.y;b.sideOffset2=b.sideNormal2.x*b.v2.x+b.sideNormal2.y*b.v2.y;f=Array(2);d=Array(2);e=Ta(f,e,b.sideNormal1.x,b.sideNormal1.y,b.sideOffset1,b.i1);if(!(e<ia||(e=Ta(d,f,b.sideNormal2.x,b.sideNormal2.y,b.sideOffset2,b.i2),e<ia))){c.type==Y.e_edgeA?(a.localNormal.x=b.normal.x,a.localNormal.y=b.normal.y,a.localPoint.x=b.v1.x,a.localPoint.y=b.v1.y):(a.localNormal.x=
g.m_normals[b.i1].x,a.localNormal.y=g.m_normals[b.i1].y,a.localPoint.x=g.m_vertices[b.i1].x,a.localPoint.y=g.m_vertices[b.i1].y);for(f=g=0;f<ia;++f)b.normal.x*(d[f].v.x-b.v1.x)+b.normal.y*(d[f].v.y-b.v1.y)<=this.m_radius&&(e=a.points[g]=new ha,c.type==Y.e_edgeA?(e.localPoint.Assign(Aa(this.m_xf,d[f].v)),e.id.Assign(d[f].id)):(e.localPoint.x=d[f].v.x,e.localPoint.y=d[f].v.y,e.id.typeA=d[f].id.typeB,e.id.typeB=d[f].id.typeA,e.id.indexA=d[f].id.indexB,e.id.indexB=d[f].id.indexA),++g);a.pointCount=g}}},
ComputeEdgeSeparation:function(){var a=new Y;a.type=Y.e_edgeA;a.index=this.m_front?0:1;a.separation=Number.MAX_VALUE;for(var b=0;b<this.m_polygonB.count;++b){var c=this.m_normal.x*(this.m_polygonB.vertices[b].x-this.m_v1.x)+this.m_normal.y*(this.m_polygonB.vertices[b].y-this.m_v1.y);c<a.separation&&(a.separation=c)}return a},ComputePolygonSeparation:function(){var a=new Y;a.type=Y.e_unknown;a.index=-1;a.separation=-Number.MAX_VALUE;for(var b=-this.m_normal.y,c=this.m_normal.x,g=0;g<this.m_polygonB.count;++g){var e=
-this.m_polygonB.normals[g].x,d=-this.m_polygonB.normals[g].y,h=S(e*(this.m_polygonB.vertices[g].x-this.m_v1.x)+d*(this.m_polygonB.vertices[g].y-this.m_v1.y),e*(this.m_polygonB.vertices[g].x-this.m_v2.x)+d*(this.m_polygonB.vertices[g].y-this.m_v2.y));if(h>this.m_radius){a.type=Y.e_edgeB;a.index=g;a.separation=h;break}if(0<=e*b+d*c){if((e-this.m_upperLimit.x)*this.m_normal.x+(d-this.m_upperLimit.y)*this.m_normal.y<-sa)continue}else if((e-this.m_lowerLimit.x)*this.m_normal.x+(d-this.m_lowerLimit.y)*
this.m_normal.y<-sa)continue;h>a.separation&&(a.type=Y.e_edgeB,a.index=g,a.separation=h)}return a}};J.e_isolated=0;J.e_concave=1;J.e_convex=2;Ua.collider=new J;ba.input=new Hb;ba.cache=new Gb;ba.output=new Ib;var P=-1;Ia.prototype={IsLeaf:function(){return this.child1==P}};xa.aabbExtensionFattener=new d(0.1,0.1);xa.prototype={CreateProxy:function(a,b){var c=this.AllocateNode();this.m_nodes[c].aabb.lowerBound.Assign(d.Subtract(a.lowerBound,xa.aabbExtensionFattener));this.m_nodes[c].aabb.upperBound.Assign(d.Add(a.upperBound,
xa.aabbExtensionFattener));this.m_nodes[c].userData=b;this.m_nodes[c].height=0;this.InsertLeaf(c);return c},DestroyProxy:function(a){this.RemoveLeaf(a);this.FreeNode(a)},MoveProxy:function(a,b,c){if(this.m_nodes[a].aabb.Contains(b))return!1;this.RemoveLeaf(a);this.m_nodes[a].aabb.Assign(b);this.m_nodes[a].aabb.lowerBound.Subtract(xa.aabbExtensionFattener);this.m_nodes[a].aabb.upperBound.Add(xa.aabbExtensionFattener);b=d.Multiply(2,c);0>b.x?this.m_nodes[a].aabb.lowerBound.x+=b.x:this.m_nodes[a].aabb.upperBound.x+=
b.x;0>b.y?this.m_nodes[a].aabb.lowerBound.y+=b.y:this.m_nodes[a].aabb.upperBound.y+=b.y;this.InsertLeaf(a);return!0},GetUserData:function(a){return this.m_nodes[a].userData},GetFatAABB:function(a){return this.m_nodes[a].aabb},Query:function(a,b){var c=[];for(c.push(this.m_root);0<c.length;){var g=c.pop();if(g!=P){var e=this.m_nodes[g];if(lb(e.aabb,b))if(e.IsLeaf()){if(!1==a.QueryCallback(g))break}else c.push(e.child1),c.push(e.child2)}}},RayCast:function(a,b){var c=b.p1,g=b.p2,e=d.Subtract(g,c);e.Normalize();
var e=O(1,e),f=Qa(e),h=b.maxFraction,k=new Z,m=d.Add(c,d.Multiply(h,d.Subtract(g,c)));k.lowerBound.Assign(jb(c,m));k.upperBound.Assign(kb(c,m));var l=[];for(l.push(this.m_root);0<l.length;)if(m=l.pop(),m!=P){var n=this.m_nodes[m];if(!1!=lb(n.aabb,k)){var p=n.aabb.GetCenter(),q=n.aabb.GetExtents();if(!(0<V(B(e,d.Subtract(c,p)))-B(f,q)))if(n.IsLeaf()){n=new Lb;n.p1.Assign(b.p1);n.p2.Assign(b.p2);n.maxFraction=h;m=a.RayCastCallback(n,m);if(0==m)break;0<m&&(h=m,m=d.Add(c,d.Multiply(h,d.Subtract(g,c))),
k.lowerBound.Assign(jb(c,m)),k.upperBound.Assign(kb(c,m)))}else l.push(n.child1),l.push(n.child2)}}},Validate:function(){this.ValidateStructure(this.m_root);this.ValidateMetrics(this.m_root);for(var a=0,b=this.m_freeList;b!=P;)b=this.m_nodes[b].parent,++a},GetHeight:function(){return this.m_root==P?0:this.m_nodes[this.m_root].height},GetMaxBalance:function(){for(var a=0,b=0;b<this.m_nodeCapacity;++b){var c=this.m_nodes[b];1>=c.height||(c=V(this.m_nodes[c.child2].height-this.m_nodes[c.child1].height),
a=I(a,c))}return a},GetAreaRatio:function(){if(this.m_root==P)return 0;for(var a=this.m_nodes[this.m_root].aabb.GetPerimeter(),b=0,c=0;c<this.m_nodeCapacity;++c){var g=this.m_nodes[c];0>g.height||(b+=g.aabb.GetPerimeter())}return b/a},RebuildBottomUp:function(){for(var a=Array(this.m_nodeCount),b=0,c=0;c<this.m_nodeCapacity;++c)0>this.m_nodes[c].height||(this.m_nodes[c].IsLeaf()?(this.m_nodes[c].parent=P,a[b]=c,++b):this.FreeNode(c));for(;1<b;){for(var g=za,e=-1,d=-1,c=0;c<b;++c)for(var h=this.m_nodes[a[c]].aabb,
k=c+1;k<b;++k){var m=this.m_nodes[a[k]].aabb,l=new Z;l.Combine(h,m);m=l.GetPerimeter();m<g&&(e=c,d=k,g=m)}c=a[e];g=a[d];h=this.m_nodes[c];k=this.m_nodes[g];m=this.AllocateNode();l=this.m_nodes[m];l.child1=c;l.child2=g;l.height=1+I(h.height,k.height);l.aabb.Combine(h.aabb,k.aabb);l.parent=P;h.parent=m;k.parent=m;a[d]=a[b-1];a[e]=m;--b}this.m_root=a[0];this.Validate()},ShiftOrigin:function(a){for(var b=0;b<this.m_nodeCapacity;++b)this.m_nodes[b].aabb.lowerBound.Subtract(a),this.m_nodes[b].aabb.upperBound.Subtract(a)},
AllocateNode:function(){if(this.m_freeList==P){var a=this.m_nodes;this.m_nodeCapacity*=2;this.m_nodes=a.concat(Array(this.m_nodeCapacity-this.m_nodeCount));for(a=this.m_nodeCount;a<this.m_nodeCapacity-1;++a)this.m_nodes[a]=new Ia,this.m_nodes[a].parent=a+1,this.m_nodes[a].height=-1;this.m_nodes[this.m_nodeCapacity-1]=new Ia;this.m_nodes[this.m_nodeCapacity-1].parent=P;this.m_nodes[this.m_nodeCapacity-1].height=-1;this.m_freeList=this.m_nodeCount}a=this.m_freeList;this.m_freeList=this.m_nodes[a].parent;
this.m_nodes[a].parent=P;this.m_nodes[a].child1=P;this.m_nodes[a].child2=P;this.m_nodes[a].height=0;this.m_nodes[a].userData=null;++this.m_nodeCount;return a},FreeNode:function(a){this.m_nodes[a].parent=this.m_freeList;this.m_nodes[a].height=-1;this.m_freeList=a;--this.m_nodeCount},InsertLeaf:function(a){++this.m_insertionCount;if(this.m_root==P)this.m_root=a,this.m_nodes[this.m_root].parent=P;else{for(var b=this.m_nodes[a].aabb,c=this.m_root;!1==this.m_nodes[c].IsLeaf();){var g=this.m_nodes[c].child1,
e=this.m_nodes[c].child2,d=this.m_nodes[c].aabb.GetPerimeter(),h=new Z;h.Combine(this.m_nodes[c].aabb,b);var k=h.GetPerimeter(),h=2*k,k=2*(k-d),m;if(this.m_nodes[g].IsLeaf())m=new Z,m.Combine(b,this.m_nodes[g].aabb),d=m.GetPerimeter()+k;else{m=new Z;m.Combine(b,this.m_nodes[g].aabb);var l=this.m_nodes[g].aabb.GetPerimeter();m=m.GetPerimeter();d=m-l+k}this.m_nodes[e].IsLeaf()?(m=new Z,m.Combine(b,this.m_nodes[e].aabb),k=m.GetPerimeter()+k):(m=new Z,m.Combine(b,this.m_nodes[e].aabb),l=this.m_nodes[e].aabb.GetPerimeter(),
m=m.GetPerimeter(),k=m-l+k);if(h<d&&h<k)break;c=d<k?g:e}g=this.m_nodes[c].parent;e=this.AllocateNode();this.m_nodes[e].parent=g;this.m_nodes[e].userData=null;this.m_nodes[e].aabb.Combine(b,this.m_nodes[c].aabb);this.m_nodes[e].height=this.m_nodes[c].height+1;g!=P?(this.m_nodes[g].child1==c?this.m_nodes[g].child1=e:this.m_nodes[g].child2=e,this.m_nodes[e].child1=c,this.m_nodes[e].child2=a,this.m_nodes[c].parent=e,this.m_nodes[a].parent=e):(this.m_nodes[e].child1=c,this.m_nodes[e].child2=a,this.m_nodes[c].parent=
e,this.m_root=this.m_nodes[a].parent=e);for(c=this.m_nodes[a].parent;c!=P;)c=this.Balance(c),g=this.m_nodes[c].child1,e=this.m_nodes[c].child2,this.m_nodes[c].height=1+I(this.m_nodes[g].height,this.m_nodes[e].height),this.m_nodes[c].aabb.Combine(this.m_nodes[g].aabb,this.m_nodes[e].aabb),c=this.m_nodes[c].parent}},RemoveLeaf:function(a){if(a==this.m_root)this.m_root=P;else{var b=this.m_nodes[a].parent,c=this.m_nodes[b].parent;a=this.m_nodes[b].child1==a?this.m_nodes[b].child2:this.m_nodes[b].child1;
if(c!=P)for(this.m_nodes[c].child1==b?this.m_nodes[c].child1=a:this.m_nodes[c].child2=a,this.m_nodes[a].parent=c,this.FreeNode(b),b=c;b!=P;)b=this.Balance(b),c=this.m_nodes[b].child1,a=this.m_nodes[b].child2,this.m_nodes[b].aabb.Combine(this.m_nodes[c].aabb,this.m_nodes[a].aabb),this.m_nodes[b].height=1+I(this.m_nodes[c].height,this.m_nodes[a].height),b=this.m_nodes[b].parent;else this.m_root=a,this.m_nodes[a].parent=P,this.FreeNode(b)}},Balance:function(a){var b=this.m_nodes[a];if(b.IsLeaf()||2>
b.height)return a;var c=b.child1,g=b.child2,e=this.m_nodes[c],d=this.m_nodes[g],h=d.height-e.height;if(1<h){var c=d.child1,h=d.child2,k=this.m_nodes[c],m=this.m_nodes[h];d.child1=a;d.parent=b.parent;b.parent=g;d.parent!=P?this.m_nodes[d.parent].child1==a?this.m_nodes[d.parent].child1=g:this.m_nodes[d.parent].child2=g:this.m_root=g;k.height>m.height?(d.child2=c,b.child2=h,m.parent=a,b.aabb.Combine(e.aabb,m.aabb),d.aabb.Combine(b.aabb,k.aabb),b.height=1+I(e.height,m.height),d.height=1+I(b.height,k.height)):
(d.child2=h,b.child2=c,k.parent=a,b.aabb.Combine(e.aabb,k.aabb),d.aabb.Combine(b.aabb,m.aabb),b.height=1+I(e.height,k.height),d.height=1+I(b.height,m.height));return g}return-1>h?(g=e.child1,h=e.child2,k=this.m_nodes[g],m=this.m_nodes[h],e.child1=a,e.parent=b.parent,b.parent=c,e.parent!=P?this.m_nodes[e.parent].child1==a?this.m_nodes[e.parent].child1=c:this.m_nodes[e.parent].child2=c:this.m_root=c,k.height>m.height?(e.child2=g,b.child1=h,m.parent=a,b.aabb.Combine(d.aabb,m.aabb),e.aabb.Combine(b.aabb,
k.aabb),b.height=1+I(d.height,m.height),e.height=1+I(b.height,k.height)):(e.child2=h,b.child1=g,k.parent=a,b.aabb.Combine(d.aabb,k.aabb),e.aabb.Combine(b.aabb,m.aabb),b.height=1+I(d.height,k.height),e.height=1+I(b.height,m.height)),c):a},ComputeHeight:function(a){"undefined"===typeof a&&(a=this.m_root);var b=this.m_nodes[a];if(b.IsLeaf())return 0;a=this.ComputeHeight(b.child1);b=this.ComputeHeight(b.child2);return 1+I(a,b)},ValidateStructure:function(a){if(a!=P){a=this.m_nodes[a];var b=a.child1,c=
a.child2;a.IsLeaf()||(this.ValidateStructure(b),this.ValidateStructure(c))}},ValidateMetrics:function(a){if(a!=P){a=this.m_nodes[a];var b=a.child1,c=a.child2;a.IsLeaf()||(I(this.m_nodes[b].height,this.m_nodes[c].height),(new Z).Combine(this.m_nodes[b].aabb,this.m_nodes[c].aabb),this.ValidateMetrics(b),this.ValidateMetrics(c))}}};ca.e_unknown=0;ca.e_failed=1;ca.e_overlapped=2;ca.e_touching=3;ca.e_separated=4;var w=new $,y=new $;da.prototype={Initialize:function(a,b,c,g,e,d){this.m_proxyA=b;this.m_proxyB=
g;var h=a.count;this.m_sweepA=c;this.m_sweepB=e;this.m_sweepA.GetTransform(w,d);this.m_sweepB.GetTransform(y,d);1==h?(this.m_type=da.e_points,h=this.m_proxyA.GetVertex(a.indexA[0]),a=this.m_proxyB.GetVertex(a.indexB[0]),b=w.q.c*h.x-w.q.s*h.y+w.p.x,h=w.q.s*h.x+w.q.c*h.y+w.p.y,e=y.q.c*a.x-y.q.s*a.y+y.p.x,d=y.q.s*a.x+y.q.c*a.y+y.p.y,this.m_axis.x=e-b,this.m_axis.y=d-h,a=this.m_axis.Normalize()):(a.indexA[0]==a.indexA[1]?(this.m_type=da.e_faceB,e=g.GetVertex(a.indexB[0]),d=g.GetVertex(a.indexB[1]),this.m_axis.x=
1*(d.y-e.y),this.m_axis.y=-1*(d.x-e.x),this.m_axis.Normalize(),g=y.q.c*this.m_axis.x-y.q.s*this.m_axis.y,c=y.q.s*this.m_axis.x+y.q.c*this.m_axis.y,this.m_localPoint.x=0.5*(e.x+d.x),this.m_localPoint.y=0.5*(e.y+d.y),e=y.q.c*this.m_localPoint.x-y.q.s*this.m_localPoint.y+y.p.x,d=y.q.s*this.m_localPoint.x+y.q.c*this.m_localPoint.y+y.p.y,h=b.GetVertex(a.indexA[0]),b=w.q.c*h.x-w.q.s*h.y+w.p.x,h=w.q.s*h.x+w.q.c*h.y+w.p.y,a=(b-e)*g+(h-d)*c):(this.m_type=da.e_faceA,b=this.m_proxyA.GetVertex(a.indexA[0]),e=
this.m_proxyA.GetVertex(a.indexA[1]),this.m_axis.x=1*(e.y-b.y),this.m_axis.y=-1*(e.x-b.x),this.m_axis.Normalize(),g=w.q.c*this.m_axis.x-w.q.s*this.m_axis.y,c=w.q.s*this.m_axis.x+w.q.c*this.m_axis.y,this.m_localPoint.x=0.5*(b.x+e.x),this.m_localPoint.y=0.5*(b.y+e.y),b=w.q.c*this.m_localPoint.x-w.q.s*this.m_localPoint.y+w.p.x,h=w.q.s*this.m_localPoint.x+w.q.c*this.m_localPoint.y+w.p.y,a=this.m_proxyB.GetVertex(a.indexB[0]),e=y.q.c*a.x-y.q.s*a.y+y.p.x,d=y.q.s*a.x+y.q.c*a.y+y.p.y,a=(e-b)*g+(d-h)*c),0>
a&&(this.m_axis.x=-this.m_axis.x,this.m_axis.y=-this.m_axis.y,a=-a));return a},FindMinSeparation:function(a,b){this.m_sweepA.GetTransform(w,b);this.m_sweepB.GetTransform(y,b);switch(this.m_type){case da.e_points:var c=w.q.c*this.m_axis.x+w.q.s*this.m_axis.y,g=y.q.c*-this.m_axis.x+y.q.s*-this.m_axis.y,e=-y.q.s*-this.m_axis.x+y.q.c*-this.m_axis.y;a[0]=this.m_proxyA.GetSupport(c,-w.q.s*this.m_axis.x+w.q.c*this.m_axis.y);a[1]=this.m_proxyB.GetSupport(g,e);var e=this.m_proxyA.GetVertex(a[0]),d=this.m_proxyB.GetVertex(a[1]),
c=w.q.c*e.x-w.q.s*e.y+w.p.x,h=w.q.s*e.x+w.q.c*e.y+w.p.y,g=y.q.c*d.x-y.q.s*d.y+y.p.x,d=y.q.s*d.x+y.q.c*d.y+y.p.y;return(g-c)*this.m_axis.x+(d-h)*this.m_axis.y;case da.e_faceA:var k=w.q.c*this.m_axis.x-w.q.s*this.m_axis.y,m=w.q.s*this.m_axis.x+w.q.c*this.m_axis.y,c=w.q.c*this.m_localPoint.x-w.q.s*this.m_localPoint.y+w.p.x,h=w.q.s*this.m_localPoint.x+w.q.c*this.m_localPoint.y+w.p.y,g=y.q.c*-k+y.q.s*-m,e=-y.q.s*-k+y.q.c*-m;a[0]=-1;a[1]=this.m_proxyB.GetSupport(g,e);d=this.m_proxyB.GetVertex(a[1]);g=y.q.c*
d.x-y.q.s*d.y+y.p.x;d=y.q.s*d.x+y.q.c*d.y+y.p.y;return(g-c)*k+(d-h)*m;case da.e_faceB:return k=y.q.c*this.m_axis.x-y.q.s*this.m_axis.y,m=y.q.s*this.m_axis.x+y.q.c*this.m_axis.y,g=y.q.c*this.m_localPoint.x-y.q.s*this.m_localPoint.y+y.p.x,d=y.q.s*this.m_localPoint.x+y.q.c*this.m_localPoint.y+y.p.y,c=w.q.c*-k+w.q.s*-m,e=-w.q.s*-k+w.q.c*-m,a[1]=-1,a[0]=this.m_proxyA.GetSupport(c,e),e=this.m_proxyA.GetVertex(a[0]),c=w.q.c*e.x-w.q.s*e.y+w.p.x,h=w.q.s*e.x+w.q.c*e.y+w.p.y,(c-g)*k+(h-d)*m}},Evaluate:function(a,
b,c){this.m_sweepA.GetTransform(w,c);this.m_sweepB.GetTransform(y,c);switch(this.m_type){case da.e_points:var d=this.m_proxyA.GetVertex(a),e=this.m_proxyB.GetVertex(b);a=w.q.c*d.x-w.q.s*d.y+w.p.x;d=w.q.s*d.x+w.q.c*d.y+w.p.y;b=y.q.c*e.x-y.q.s*e.y+y.p.x;e=y.q.s*e.x+y.q.c*e.y+y.p.y;return c=(b-a)*this.m_axis.x+(e-d)*this.m_axis.y;case da.e_faceA:c=w.q.c*this.m_axis.x-w.q.s*this.m_axis.y;var f=w.q.s*this.m_axis.x+w.q.c*this.m_axis.y;a=w.q.c*this.m_localPoint.x-w.q.s*this.m_localPoint.y+w.p.x;d=w.q.s*
this.m_localPoint.x+w.q.c*this.m_localPoint.y+w.p.y;e=this.m_proxyB.GetVertex(b);b=y.q.c*e.x-y.q.s*e.y+y.p.x;e=y.q.s*e.x+y.q.c*e.y+y.p.y;return(b-a)*c+(e-d)*f;case da.e_faceB:return c=y.q.c*this.m_axis.x-y.q.s*this.m_axis.y,f=y.q.s*this.m_axis.x+y.q.c*this.m_axis.y,b=y.q.c*this.m_localPoint.x-y.q.s*this.m_localPoint.y+y.p.x,e=y.q.s*this.m_localPoint.x+y.q.c*this.m_localPoint.y+y.p.y,d=this.m_proxyA.GetVertex(a),a=w.q.c*d.x-w.q.s*d.y+w.p.x,d=w.q.s*d.x+w.q.c*d.y+w.p.y,(a-b)*c+(d-e)*f}}};da.e_points=
0;da.e_faceA=1;da.e_faceB=2;var mb=oa.create("toi","solveTOI");M._temp_sweepA=new ma;M._temp_sweepB=new ma;M.b2_toiTime=0;M.b2_toiMaxTime=0;M.b2_toiCalls=0;M.b2_toiIters=0;M.b2_toiMaxIters=0;M.b2_toiRootIters=0;M.b2_toiMaxRootIters=0;nb.prototype={_deserialize:function(a){this.type=a.type;this.position._deserialize(a.position);this.angle=a.angle;this.linearVelocity._deserialize(a.linearVelocity);this.angularVelocity=a.angularVelocity;this.linearDamping=a.linearDamping;this.angularDamping=a.angularDamping;
this.allowSleep=a.allowSleep;this.awake=a.awake;this.fixedRotation=a.fixedRotation;this.bullet=a.bullet;this.active=a.active;this.gravityScale=a.gravityScale}};u.b2_staticBody=0;u.b2_kinematicBody=1;u.b2_dynamicBody=2;u.e_islandFlag=1;u.e_awakeFlag=2;u.e_autoSleepFlag=4;u.e_bulletFlag=8;u.e_fixedRotationFlag=16;u.e_activeFlag=32;u.e_toiFlag=64;u.m_local_oldCenter=new d;u.m_local_xf1=new $;u.prototype={CreateFixture:function(a,b){if("undefined"!==typeof b){var c=new Wa;c.shape=a;c.density=b;return this.CreateFixture(c)}if(!0==
this.m_world.IsLocked())return null;c=new Ob;c.Create(this,a);this.m_flags&u.e_activeFlag&&c.CreateProxies(this.m_world.m_contactManager.m_broadPhase,this.m_xf);c.m_next=this.m_fixtureList;this.m_fixtureList=c;++this.m_fixtureCount;c.m_body=this;0<c.m_density&&this.ResetMassData();this.m_world.m_flags|=K.e_newFixture;return c},DestroyFixture:function(a){if(!0!=this.m_world.IsLocked()){for(var b=this.m_fixtureList;null!=b;){if(b==a){this.m_fixtureList=a.m_next;break}b=b.m_next}for(b=this.m_contactList;b;){var c=
b.contact,b=b.next,d=c.GetFixtureA(),e=c.GetFixtureB();a!=d&&a!=e||this.m_world.m_contactManager.Destroy(c)}this.m_flags&u.e_activeFlag&&a.DestroyProxies(this.m_world.m_contactManager.m_broadPhase);a.Destroy();a.m_body=null;a.m_next=null;--this.m_fixtureCount;this.ResetMassData()}},SetTransform:function(a,b){if(!0!=this.m_world.IsLocked()){this.m_xf.q.Set(b);this.m_xf.p.Assign(a);this.m_sweep.c.Assign(T(this.m_xf,this.m_sweep.localCenter));this.m_sweep.a=b;this.m_sweep.c0.Assign(this.m_sweep.c);this.m_sweep.a0=
b;for(var c=this.m_world.m_contactManager.m_broadPhase,d=this.m_fixtureList;d;d=d.m_next)d.Synchronize(c,this.m_xf,this.m_xf)}},GetTransform:function(){return this.m_xf},GetPosition:function(){return this.m_xf.p},GetAngle:function(){return this.m_sweep.a},GetWorldCenter:function(){return this.m_sweep.c},GetLocalCenter:function(){return this.m_sweep.localCenter},SetLinearVelocity:function(a){this.m_type!=u.b2_staticBody&&(0<B(a,a)&&this.SetAwake(!0),this.m_linearVelocity=a)},GetLinearVelocity:function(){return this.m_linearVelocity},
SetAngularVelocity:function(a){this.m_type!=u.b2_staticBody&&(0<a*a&&this.SetAwake(!0),this.m_angularVelocity=a)},GetAngularVelocity:function(){return this.m_angularVelocity},ApplyForce:function(a,b,c){this.m_type==u.b2_dynamicBody&&(c&&0==(this.m_flags&u.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&u.e_awakeFlag&&(this.m_force.Add(a),this.m_torque+=t(d.Subtract(b,this.m_sweep.c),a)))},ApplyForceToCenter:function(a,b){this.m_type==u.b2_dynamicBody&&(b&&0==(this.m_flags&u.e_awakeFlag)&&this.SetAwake(!0),
this.m_flags&u.e_awakeFlag&&this.m_force.Add(a))},ApplyTorque:function(a,b){this.m_type==u.b2_dynamicBody&&(b&&0==(this.m_flags&u.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&u.e_awakeFlag&&(this.m_torque+=a))},ApplyLinearImpulse:function(a,b,c){this.m_type==u.b2_dynamicBody&&(c&&0==(this.m_flags&u.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&u.e_awakeFlag&&(this.m_linearVelocity.Add(d.Multiply(this.m_invMass,a)),this.m_angularVelocity+=this.m_invI*t(d.Subtract(b,this.m_sweep.c),a)))},ApplyAngularImpulse:function(a,
b){this.m_type==u.b2_dynamicBody&&(b&&0==(this.m_flags&u.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&u.e_awakeFlag&&(this.m_angularVelocity+=this.m_invI*a))},GetMass:function(){return this.m_mass},GetInertia:function(){return this.m_I+this.m_mass*B(this.m_sweep.localCenter,this.m_sweep.localCenter)},GetMassData:function(a){a.mass=this.m_mass;a.I=this.m_I+this.m_mass*B(this.m_sweep.localCenter,this.m_sweep.localCenter);a.center=this.m_sweep.localCenter},SetMassData:function(a){!0!=this.m_world.IsLocked()&&
this.m_type==u.b2_dynamicBody&&(this.m_invI=this.m_I=this.m_invMass=0,this.m_mass=a.mass,0>=this.m_mass&&(this.m_mass=1),this.m_invMass=1/this.m_mass,0<a.I&&0==(this.m_flags&u.e_fixedRotationFlag)&&(this.m_I=a.I-this.m_mass*B(a.center,a.center),this.m_invI=1/this.m_I),u.m_local_oldCenter.Assign(this.m_sweep.c),this.m_sweep.localCenter.Assign(a.center),this.m_sweep.c0.Assign(T(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.Assign(this.m_sweep.c0),this.m_linearVelocity.Add(O(this.m_angularVelocity,
d.Subtract(this.m_sweep.c,u.m_local_oldCenter))))},ResetMassData:function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0;this.m_sweep.localCenter.SetZero();if(this.m_type==u.b2_staticBody||this.m_type==u.b2_kinematicBody)this.m_sweep.c0.Assign(this.m_xf.p),this.m_sweep.c.Assign(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a;else{for(var a=new d(0,0),b=this.m_fixtureList;b;b=b.m_next)if(0!=b.m_density){var c=new hc;b.GetMassData(c);this.m_mass+=c.mass;a.Add(d.Multiply(c.mass,c.center));this.m_I+=
c.I}0<this.m_mass?(this.m_invMass=1/this.m_mass,a.Multiply(this.m_invMass)):this.m_invMass=this.m_mass=1;0<this.m_I&&0==(this.m_flags&u.e_fixedRotationFlag)?(this.m_I-=this.m_mass*B(a,a),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0;u.m_local_oldCenter.Assign(this.m_sweep.c);this.m_sweep.localCenter.Assign(a);this.m_sweep.c0.Assign(T(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.Assign(this.m_sweep.c0);this.m_linearVelocity.Add(O(this.m_angularVelocity,d.Subtract(this.m_sweep.c,u.m_local_oldCenter)))}},
GetWorldPoint:function(a){return T(this.m_xf,a)},GetWorldVector:function(a){return A(this.m_xf.q,a)},GetLocalPoint:function(a){return Aa(this.m_xf,a)},GetLocalVector:function(a){return na(this.m_xf.q,a)},GetLinearVelocityFromWorldPoint:function(a){return d.Add(this.m_linearVelocity,O(this.m_angularVelocity,d.Subtract(a,this.m_sweep.c)))},GetLinearVelocityFromLocalPoint:function(a){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(a))},GetLinearDamping:function(){return this.m_linearDamping},
SetLinearDamping:function(a){this.m_linearDamping=a},GetAngularDamping:function(){return this.m_angularDamping},SetAngularDamping:function(a){this.m_angularDamping=a},GetGravityScale:function(){return this.m_gravityScale},SetGravityScale:function(a){this.m_gravityScale=a},SetType:function(a){if(!0!=this.m_world.IsLocked()&&this.m_type!=a){this.m_type=a;this.ResetMassData();this.m_type==u.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Assign(this.m_sweep.c),
this.SynchronizeFixtures());this.SetAwake(!0);this.m_force.SetZero();this.m_torque=0;for(a=this.m_contactList;a;){var b=a;a=a.next;this.m_world.m_contactManager.Destroy(b.contact)}this.m_contactList=null;a=this.m_world.m_contactManager.m_broadPhase;for(b=this.m_fixtureList;b;b=b.m_next)for(var c=b.m_proxyCount,d=0;d<c;++d)a.TouchProxy(b.m_proxies[d].proxyId)}},GetType:function(){return this.m_type},SetBullet:function(a){this.m_flags=a?this.m_flags|u.e_bulletFlag:this.m_flags&~u.e_bulletFlag},IsBullet:function(){return(this.m_flags&
u.e_bulletFlag)==u.e_bulletFlag},SetSleepingAllowed:function(a){a?this.m_flags|=u.e_autoSleepFlag:(this.m_flags&=~u.e_autoSleepFlag,this.SetAwake(!0))},IsSleepingAllowed:function(){return(this.m_flags&u.e_autoSleepFlag)==u.e_autoSleepFlag},SetAwake:function(a){a?0==(this.m_flags&u.e_awakeFlag)&&(this.m_flags|=u.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~u.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},IsAwake:function(){return(this.m_flags&
u.e_awakeFlag)==u.e_awakeFlag},SetActive:function(a){if(a!=this.IsActive())if(a){this.m_flags|=u.e_activeFlag;a=this.m_world.m_contactManager.m_broadPhase;for(var b=this.m_fixtureList;b;b=b.m_next)b.CreateProxies(a,this.m_xf)}else{this.m_flags&=~u.e_activeFlag;a=this.m_world.m_contactManager.m_broadPhase;for(b=this.m_fixtureList;b;b=b.m_next)b.DestroyProxies(a);for(a=this.m_contactList;a;)b=a,a=a.next,this.m_world.m_contactManager.Destroy(b.contact);this.m_contactList=null}},IsActive:function(){return(this.m_flags&
u.e_activeFlag)==u.e_activeFlag},SetFixedRotation:function(a){(this.m_flags&u.e_fixedRotationFlag)==u.e_fixedRotationFlag!=a&&(this.m_flags=a?this.m_flags|u.e_fixedRotationFlag:this.m_flags&~u.e_fixedRotationFlag,this.m_angularVelocity=0,this.ResetMassData())},IsFixedRotation:function(){return(this.m_flags&u.e_fixedRotationFlag)==u.e_fixedRotationFlag},GetFixtureList:function(){return this.m_fixtureList},GetJointList:function(){return this.m_jointList},GetContactList:function(){return this.m_contactList},
GetNext:function(){return this.m_next},GetUserData:function(){return this.m_userData},SetUserData:function(a){this.m_userData=a},GetWorld:function(){return this.m_world},SynchronizeFixtures:function(){u.m_local_xf1.q.Set(this.m_sweep.a0);u.m_local_xf1.p.Assign(d.Subtract(this.m_sweep.c0,A(u.m_local_xf1.q,this.m_sweep.localCenter)));for(var a=this.m_world.m_contactManager.m_broadPhase,b=this.m_fixtureList;b;b=b.m_next)b.Synchronize(a,u.m_local_xf1,this.m_xf)},SynchronizeTransform:function(){this.m_xf.q.Set(this.m_sweep.a);
this.m_xf.p.Assign(d.Subtract(this.m_sweep.c,A(this.m_xf.q,this.m_sweep.localCenter)))},ShouldCollide:function(a){if(this.m_type!=u.b2_dynamicBody&&a.m_type!=u.b2_dynamicBody)return!1;for(var b=this.m_jointList;b;b=b.next)if(b.other==a&&!1==b.joint.m_collideConnected)return!1;return!0},Advance:function(a){this.m_sweep.Advance(a);this.m_sweep.c.Assign(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.m_xf.q.Set(this.m_sweep.a);this.m_xf.p.Assign(d.Subtract(this.m_sweep.c,A(this.m_xf.q,this.m_sweep.localCenter)))},
_serialize:function(a){a=a||{};a.fixtures=null;a.type=this.m_type;a.position=this.GetPosition()._serialize();a.angle=this.GetAngle();a.linearVelocity=this.GetLinearVelocity()._serialize();a.angularVelocity=this.GetAngularVelocity();a.linearDamping=this.GetLinearDamping();a.angularDamping=this.GetAngularDamping();a.allowSleep=this.IsSleepingAllowed();a.awake=this.IsAwake();a.fixedRotation=this.IsFixedRotation();a.bullet=this.IsBullet();a.active=this.IsActive();a.gravityScale=this.GetGravityScale();
return a}};Va.prototype={Clone:function(){var a=new Va;a.categoryBits=this.categoryBits;a.maskBits=this.maskBits;a.groupIndex=this.groupIndex;return a},Assign:function(a){this.categoryBits=a.categoryBits;this.maskBits=a.maskBits;this.groupIndex=a.groupIndex},_serialize:function(a){a=a||{};a.categoryBits=this.categoryBits;a.maskBits=this.maskBits;a.groupIndex=this.groupIndex;return a},_deserialize:function(a){this.categoryBits=a.categoryBits;this.maskBits=a.maskBits;this.groupIndex=a.groupIndex}};
Wa.prototype={_deserialize:function(a){this.friction=a.friction;this.restitution=a.restitution;this.density=a.density;this.isSensor=a.isSensor;this.filter._deserialize(a.filter)}};Ob.prototype={GetType:function(){return this.m_shape.GetType()},GetShape:function(){return this.m_shape},SetSensor:function(a){a!=this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=a)},IsSensor:function(){return this.m_isSensor},SetFilterData:function(a){this.m_filter=a;this.Refilter()},GetFilterData:function(){return this.m_filter},
Refilter:function(){if(null!=this.m_body){for(var a=this.m_body.GetContactList();a;){var b=a.contact,c=b.GetFixtureA(),d=b.GetFixtureB();c!=this&&d!=this||b.FlagForFiltering();a=a.next}a=this.m_body.GetWorld();if(null!=a)for(a=a.m_contactManager.m_broadPhase,b=0;b<this.m_proxyCount;++b)a.TouchProxy(this.m_proxies[b].proxyId)}},GetBody:function(){return this.m_body},GetNext:function(){return this.m_next},GetUserData:function(){return this.m_userData},SetUserData:function(a){this.m_userData=a},TestPoint:function(a){return this.m_shape.TestPoint(this.m_body.GetTransform(),
a)},RayCast:function(a,b,c){return this.m_shape.RayCast(a,b,this.m_body.GetTransform(),c)},GetMassData:function(a){this.m_shape.ComputeMass(a,this.m_density)},SetDensity:function(a){this.m_density=a},GetDensity:function(){return this.m_density},GetFriction:function(){return this.m_friction},SetFriction:function(a){this.m_friction=a},GetRestitution:function(){return this.m_restitution},SetRestitution:function(a){this.m_restitution=a},GetAABB:function(a){return this.m_proxies[a].aabb},Create:function(a,
b){this.m_userData=b.userData;this.m_friction=b.friction;this.m_restitution=b.restitution;this.m_body=a;this.m_next=null;this.m_filter.Assign(b.filter);this.m_isSensor=b.isSensor;this.m_shape=b.shape.Clone();var c=this.m_shape.GetChildCount();this.m_proxies=Array(c);for(var d=0;d<c;++d)this.m_proxies[d]=new Rc,this.m_proxies[d].fixture=null,this.m_proxies[d].proxyId=wa.e_nullProxy;this.m_proxyCount=0;this.m_density=b.density},Destroy:function(){this.m_shape=this.m_proxies=null},CreateProxies:function(a,
b){this.m_proxyCount=this.m_shape.GetChildCount();for(var c=0;c<this.m_proxyCount;++c){var d=this.m_proxies[c];this.m_shape.ComputeAABB(d.aabb,b,c);d.proxyId=a.CreateProxy(d.aabb,d);d.fixture=this;d.childIndex=c}},DestroyProxies:function(a){for(var b=0;b<this.m_proxyCount;++b){var c=this.m_proxies[b];a.DestroyProxy(c.proxyId);c.proxyId=wa.e_nullProxy}this.m_proxyCount=0},Synchronize:function(a,b,c){if(0!=this.m_proxyCount)for(var g=0;g<this.m_proxyCount;++g){var e=this.m_proxies[g],f=new Z,h=new Z;
this.m_shape.ComputeAABB(f,b,e.childIndex);this.m_shape.ComputeAABB(h,c,e.childIndex);e.aabb.Combine(f,h);f=d.Subtract(c.p,b.p);a.MoveProxy(e.proxyId,e.aabb,f)}},_serialize:function(a){a=a||{};a.shape=null;a.friction=this.m_friction;a.restitution=this.m_restitution;a.density=this.m_density;a.isSensor=this.m_isSensor;a.filter=this.m_filter._serialize();return a}};rc.prototype={SayGoodbyeJoint:function(a){},SayGoodbyeFixture:function(a){}};Pb.prototype={ShouldCollide:function(a,b){var c=a.GetFilterData(),
d=b.GetFilterData();return c.groupIndex==d.groupIndex&&0!=c.groupIndex?0<c.groupIndex:0!=(c.maskBits&d.categoryBits)&&0!=(c.categoryBits&d.maskBits)}};Qb.prototype={BeginContact:function(a){},EndContact:function(a){},PreSolve:function(a,b){},PostSolve:function(a,b){}};tc.prototype={ReportFixture:function(a){return!1}};uc.prototype={ReportFixture:function(a,b,c,d){}};var Ic=oa.create("step"),Jc=oa.create("collide","step"),Kc=oa.create("solve","step"),Lc=oa.create("solveTOI","step"),Mc=oa.create("broadphase",
"step");yc.prototype={QueryCallback:function(a){a=this.broadPhase.GetUserData(a);return this.callback.ReportFixture(a.fixture)}};zc.prototype={RayCastCallback:function(a,b){var c=this.broadPhase.GetUserData(b),g=c.fixture,e=c.childIndex,c=new kc;if(g.RayCast(c,a,e)){var e=c.fraction,f=d.Add(d.Multiply(1-e,a.p1),d.Multiply(e,a.p2));return this.callback.ReportFixture(g,f,c.normal,e)}return a.maxFraction}};K.m_local_sweep_backupA=new ma;K.m_local_sweep_backupB=new ma;K.m_local_sweep_backupC=new ma;K.prototype=
{Destroy:function(){for(var a=this.m_bodyList;a;){for(var b=a.m_next,a=a.m_fixtureList;a;){var c=a.m_next;a.m_proxyCount=0;a.Destroy();a=c}a=b}},SetDestructionListener:function(a){this.m_destructionListener=a},SetContactFilter:function(a){this.m_contactManager.m_contactFilter=a},SetContactListener:function(a){this.m_contactManager.m_contactListener=a},SetDebugDraw:function(a){this.g_debugDraw=a},CreateBody:function(a){if(this.IsLocked())return null;a=new u(a,this);a.m_prev=null;if(a.m_next=this.m_bodyList)this.m_bodyList.m_prev=
a;this.m_bodyList=a;++this.m_bodyCount;return a},DestroyBody:function(a){if(!this.IsLocked()){for(var b=a.m_jointList;b;){var c=b,b=b.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(c.joint);this.DestroyJoint(c.joint);a.m_jointList=b}a.m_jointList=null;for(b=a.m_contactList;b;)c=b,b=b.next,this.m_contactManager.Destroy(c.contact);a.m_contactList=null;for(b=a.m_fixtureList;b;)c=b,b=b.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(c),c.DestroyProxies(this.m_contactManager.m_broadPhase),
c.Destroy(),a.m_fixtureList=b,a.m_fixtureCount-=1;a.m_fixtureList=null;a.m_fixtureCount=0;a.m_prev&&(a.m_prev.m_next=a.m_next);a.m_next&&(a.m_next.m_prev=a.m_prev);a==this.m_bodyList&&(this.m_bodyList=a.m_next);a.m_destroyed=!0;--this.m_bodyCount}},CreateJoint:function(a){if(this.IsLocked())return null;var b=s.Create(a);b.m_prev=null;if(b.m_next=this.m_jointList)this.m_jointList.m_prev=b;this.m_jointList=b;++this.m_jointCount;b.m_edgeA.joint=b;b.m_edgeA.other=b.m_bodyB;b.m_edgeA.prev=null;if(b.m_edgeA.next=
b.m_bodyA.m_jointList)b.m_bodyA.m_jointList.prev=b.m_edgeA;b.m_bodyA.m_jointList=b.m_edgeA;b.m_edgeB.joint=b;b.m_edgeB.other=b.m_bodyA;b.m_edgeB.prev=null;if(b.m_edgeB.next=b.m_bodyB.m_jointList)b.m_bodyB.m_jointList.prev=b.m_edgeB;b.m_bodyB.m_jointList=b.m_edgeB;var c=a.bodyA,d=a.bodyB;if(!1==a.collideConnected)for(a=d.GetContactList();a;)a.other==c&&a.contact.FlagForFiltering(),a=a.next;return b},DestroyJoint:function(a){if(!this.IsLocked()){var b=a.m_collideConnected;a.m_prev&&(a.m_prev.m_next=
a.m_next);a.m_next&&(a.m_next.m_prev=a.m_prev);a==this.m_jointList&&(this.m_jointList=a.m_next);var c=a.m_bodyA,d=a.m_bodyB;c.SetAwake(!0);d.SetAwake(!0);a.m_edgeA.prev&&(a.m_edgeA.prev.next=a.m_edgeA.next);a.m_edgeA.next&&(a.m_edgeA.next.prev=a.m_edgeA.prev);a.m_edgeA==c.m_jointList&&(c.m_jointList=a.m_edgeA.next);a.m_edgeA.prev=null;a.m_edgeA.next=null;a.m_edgeB.prev&&(a.m_edgeB.prev.next=a.m_edgeB.next);a.m_edgeB.next&&(a.m_edgeB.next.prev=a.m_edgeB.prev);a.m_edgeB==d.m_jointList&&(d.m_jointList=
a.m_edgeB.next);a.m_edgeB.prev=null;a.m_edgeB.next=null;s.Destroy(a);--this.m_jointCount;if(!1==b)for(a=d.GetContactList();a;)a.other==c&&a.contact.FlagForFiltering(),a=a.next}},Step:function(a,b,c){Ic.start();this.m_flags&K.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~K.e_newFixture);this.m_flags|=K.e_locked;this.p_step.dt=a;this.p_step.velocityIterations=b;this.p_step.positionIterations=c;this.p_step.inv_dt=0<a?1/a:0;this.p_step.dtRatio=this.m_inv_dt0*a;this.p_step.warmStarting=
this.m_warmStarting;Jc.start();this.m_contactManager.Collide();Jc.stop();this.m_stepComplete&&0<this.p_step.dt&&(Kc.start(),this.Solve(this.p_step),Kc.stop());this.m_continuousPhysics&&0<this.p_step.dt&&(Lc.start(),this.SolveTOI(this.p_step),Lc.stop());0<this.p_step.dt&&(this.m_inv_dt0=this.p_step.inv_dt);this.m_flags&K.e_clearForces&&this.ClearForces();this.m_flags&=~K.e_locked;Ic.stop()},ClearForces:function(){for(var a=this.m_bodyList;a;a=a.GetNext())a.m_force.x=a.m_force.y=0,a.m_torque=0},DrawDebugData:function(){if(null!=
this.g_debugDraw){var a=this.g_debugDraw.GetFlags();if(a&W.e_shapeBit)for(var b=this.m_bodyList;b;b=b.GetNext())for(var c=b.GetTransform(),g=b.GetFixtureList();g;g=g.GetNext())!1==b.IsActive()?this.DrawShape(g,c,new ka(0.5,0.5,0.3)):b.GetType()==u.b2_staticBody?this.DrawShape(g,c,new ka(0.5,0.9,0.5)):b.GetType()==u.b2_kinematicBody?this.DrawShape(g,c,new ka(0.5,0.5,0.9)):!1==b.IsAwake()?this.DrawShape(g,c,new ka(0.6,0.6,0.6)):this.DrawShape(g,c,new ka(0.9,0.7,0.7));if(a&W.e_jointBit)for(c=this.m_jointList;c;c=
c.GetNext())this.DrawJoint(c);if(a&W.e_pairBit)for(c=new ka(0.3,0.9,0.9),b=this.m_contactManager.m_contactList;b;b=b.GetNext()){var e=b.GetFixtureA(),g=b.GetFixtureB(),e=e.GetAABB(b.GetChildIndexA()).GetCenter(),g=g.GetAABB(b.GetChildIndexB()).GetCenter();this.g_debugDraw.DrawSegment(e,g,c)}if(a&W.e_aabbBit)for(var c=new ka(0.9,0.3,0.9),e=new ka(0.3,0.3,0.9),f=this.m_contactManager.m_broadPhase,b=this.m_bodyList;b;b=b.GetNext())if(!1!=b.IsActive())for(g=b.GetFixtureList();g;g=g.GetNext())for(var h=
0;h<g.m_proxyCount;++h){var k=f.GetFatAABB(g.m_proxies[h].proxyId),m=[];m[0]=new d(k.lowerBound.x,k.lowerBound.y);m[1]=new d(k.upperBound.x,k.lowerBound.y);m[2]=new d(k.upperBound.x,k.upperBound.y);m[3]=new d(k.lowerBound.x,k.upperBound.y);this.g_debugDraw.DrawPolygon(m,4,c);k=new Z;g.GetShape().ComputeAABB(k,b.GetTransform(),0);m=[];m[0]=new d(k.lowerBound.x,k.lowerBound.y);m[1]=new d(k.upperBound.x,k.lowerBound.y);m[2]=new d(k.upperBound.x,k.upperBound.y);m[3]=new d(k.lowerBound.x,k.upperBound.y);
this.g_debugDraw.DrawPolygon(m,4,e)}if(a&W.e_centerOfMassBit)for(b=this.m_bodyList;b;b=b.GetNext())c=b.GetTransform().Clone(),c.p=b.GetWorldCenter(),this.g_debugDraw.DrawTransform(c)}},QueryAABB:function(a,b){var c=new yc;c.broadPhase=this.m_contactManager.m_broadPhase;c.callback=a;this.m_contactManager.m_broadPhase.Query(c,b)},RayCast:function(a,b,c){var d=new zc;d.broadPhase=this.m_contactManager.m_broadPhase;d.callback=a;a=new Lb;a.maxFraction=1;a.p1=b;a.p2=c;this.m_contactManager.m_broadPhase.RayCast(d,
a)},GetBodyList:function(){return this.m_bodyList},GetJointList:function(){return this.m_jointList},GetContactList:function(){return this.m_contactManager.m_contactList},SetAllowSleeping:function(a){if(a!=this.m_allowSleep&&(this.m_allowSleep=a,!1==this.m_allowSleep))for(a=this.m_bodyList;a;a=a.m_next)a.SetAwake(!0)},GetAllowSleeping:function(){return this.m_allowSleep},SetWarmStarting:function(a){this.m_warmStarting=a},GetWarmStarting:function(){return this.m_warmStarting},SetContinuousPhysics:function(a){this.m_continuousPhysics=
a},GetContinuousPhysics:function(){return this.m_continuousPhysics},SetSubStepping:function(a){this.m_subStepping=a},GetSubStepping:function(){return this.m_subStepping},GetProxyCount:function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},GetBodyCount:function(){return this.m_bodyCount},GetJointCount:function(){return this.m_jointCount},GetContactCount:function(){return this.m_contactManager.m_contactCount},GetTreeHeight:function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()},
GetTreeBalance:function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()},GetTreeQuality:function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()},SetGravity:function(a){this.m_gravity=a},GetGravity:function(){return this.m_gravity},IsLocked:function(){return(this.m_flags&K.e_locked)==K.e_locked},SetAutoClearForces:function(a){this.m_flags=a?this.m_flags|K.e_clearForces:this.m_flags&~K.e_clearForces},GetAutoClearForces:function(){return(this.m_flags&K.e_clearForces)==K.e_clearForces},
ShiftOrigin:function(a){if((this.m_flags&K.e_locked)!=K.e_locked){for(var b=this.m_bodyList;b;b=b.m_next)b.m_xf.p.Subtract(a),b.m_sweep.c0.Subtract(a),b.m_sweep.c.Subtract(a);for(b=this.m_jointList;b;b=b.m_next)b.ShiftOrigin(a);this.m_contactManager.m_broadPhase.ShiftOrigin(a)}},GetContactManager:function(){return this.m_contactManager},Solve:function(a){this.p_island.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,this.m_contactManager.m_contactListener);for(var b=
this.m_bodyList;b;b=b.m_next)b.m_flags&=~u.e_islandFlag;for(var c=this.m_contactManager.m_contactList;c;c=c.m_next)c.m_flags&=~v.e_islandFlag;for(c=this.m_jointList;c;c=c.m_next)c.m_islandFlag=!1;for(var c=Array(this.m_bodyCount),d=this.m_bodyList;d;d=d.m_next)if(!(d.m_flags&u.e_islandFlag)&&!1!=d.IsAwake()&&!1!=d.IsActive()&&d.GetType()!=u.b2_staticBody){this.p_island.Clear();var e=0;c[e++]=d;for(d.m_flags|=u.e_islandFlag;0<e;)if(b=c[--e],this.p_island.AddBody(b),b.SetAwake(!0),b.GetType()!=u.b2_staticBody){for(var f=
b.m_contactList;f;f=f.next){var h=f.contact;if(!(h.m_flags&v.e_islandFlag)&&!1!=h.IsEnabled()&&!1!=h.IsTouching()){var k=h.m_fixtureB.m_isSensor;h.m_fixtureA.m_isSensor||k||(this.p_island.AddContact(h),h.m_flags|=v.e_islandFlag,h=f.other,h.m_flags&u.e_islandFlag||(c[e++]=h,h.m_flags|=u.e_islandFlag))}}for(b=b.m_jointList;b;b=b.next)!0!=b.joint.m_islandFlag&&(h=b.other,!1!=h.IsActive()&&(this.p_island.AddJoint(b.joint),b.joint.m_islandFlag=!0,h.m_flags&u.e_islandFlag||(c[e++]=h,h.m_flags|=u.e_islandFlag)))}this.p_island.Solve(a,
this.m_gravity,this.m_allowSleep);for(e=0;e<this.p_island.m_bodyCount;++e)b=this.p_island.m_bodies[e],b.GetType()==u.b2_staticBody&&(b.m_flags&=~u.e_islandFlag)}Mc.start();for(b=this.m_bodyList;b;b=b.GetNext())0!=(b.m_flags&u.e_islandFlag)&&b.GetType()!=u.b2_staticBody&&b.SynchronizeFixtures();this.m_contactManager.FindNewContacts();Mc.stop()},SolveTOI:function(a){this.p_island.Initialize(64,32,0,this.m_contactManager.m_contactListener);if(this.m_stepComplete){for(var b=this.m_bodyList;b;b=b.m_next)b.m_flags&=
~u.e_islandFlag,b.m_sweep.alpha0=0;for(var c=this.m_contactManager.m_contactList;c;c=c.m_next)c.m_flags&=~(v.e_toiFlag|v.e_islandFlag),c.m_toiCount=0,c.m_toi=1}for(;;){for(var d=null,b=1,c=this.m_contactManager.m_contactList;c;c=c.m_next)if(!1!=c.IsEnabled()&&!(8<c.m_toiCount)){var e=1;if(c.m_flags&v.e_toiFlag)e=c.m_toi;else{var f=c.GetFixtureA(),h=c.GetFixtureB();if(f.IsSensor()||h.IsSensor())continue;var e=f.GetBody(),k=h.GetBody(),m=e.m_type,l=k.m_type,n=e.IsAwake()&&m!=u.b2_staticBody,p=k.IsAwake()&&
l!=u.b2_staticBody;if(!1==n&&!1==p)continue;m=e.IsBullet()||m!=u.b2_dynamicBody;l=k.IsBullet()||l!=u.b2_dynamicBody;if(!1==m&&!1==l)continue;l=e.m_sweep.alpha0;e.m_sweep.alpha0<k.m_sweep.alpha0?(l=k.m_sweep.alpha0,e.m_sweep.Advance(l)):k.m_sweep.alpha0<e.m_sweep.alpha0&&(l=e.m_sweep.alpha0,k.m_sweep.Advance(l));n=c.GetChildIndexA();p=c.GetChildIndexB();m=new qc;m.proxyA.Set(f.GetShape(),n);m.proxyB.Set(h.GetShape(),p);m.sweepA.Assign(e.m_sweep);m.sweepB.Assign(k.m_sweep);m.tMax=1;e=new ca;M(e,m);
k=e.t;e=e.state==ca.e_touching?S(l+(1-l)*k,1):1;c.m_toi=e;c.m_flags|=v.e_toiFlag}e<b&&(d=c,b=e)}if(null==d||1-10*ga<b){this.m_stepComplete=!0;break}f=d.GetFixtureA();h=d.GetFixtureB();e=f.GetBody();k=h.GetBody();K.m_local_sweep_backupA.Assign(e.m_sweep);K.m_local_sweep_backupB.Assign(k.m_sweep);e.Advance(b);k.Advance(b);d.Update(this.m_contactManager.m_contactListener);d.m_flags&=~v.e_toiFlag;++d.m_toiCount;if(!1==d.IsEnabled()||!1==d.IsTouching())d.SetEnabled(!1),e.m_sweep.Assign(K.m_local_sweep_backupA),
k.m_sweep.Assign(K.m_local_sweep_backupB),e.SynchronizeTransform(),k.SynchronizeTransform();else{e.SetAwake(!0);k.SetAwake(!0);this.p_island.Clear();this.p_island.AddBody(e);this.p_island.AddBody(k);this.p_island.AddContact(d);e.m_flags|=u.e_islandFlag;k.m_flags|=u.e_islandFlag;d.m_flags|=v.e_islandFlag;c=[e,k];for(d=0;2>d;++d)if(f=c[d],f.m_type==u.b2_dynamicBody)for(h=f.m_contactList;h&&this.p_island.m_bodyCount!=this.p_island.m_bodyCapacity&&this.p_island.m_contactCount!=this.p_island.m_contactCapacity;h=
h.next)l=h.contact,l.m_flags&v.e_islandFlag||(m=h.other,m.m_type==u.b2_dynamicBody&&!1==f.IsBullet()&&!1==m.IsBullet())||(n=l.m_fixtureB.m_isSensor,l.m_fixtureA.m_isSensor||n||(K.m_local_sweep_backupC.Assign(m.m_sweep),0==(m.m_flags&u.e_islandFlag)&&m.Advance(b),l.Update(this.m_contactManager.m_contactListener),!1==l.IsEnabled()?(m.m_sweep.Assign(K.m_local_sweep_backupC),m.SynchronizeTransform()):!1==l.IsTouching()?(m.m_sweep.Assign(K.m_local_sweep_backupC),m.SynchronizeTransform()):(l.m_flags|=v.e_islandFlag,
this.p_island.AddContact(l),m.m_flags&u.e_islandFlag||(m.m_flags|=u.e_islandFlag,m.m_type!=u.b2_staticBody&&m.SetAwake(!0),this.p_island.AddBody(m)))));c=new Xa;c.dt=(1-b)*a.dt;c.inv_dt=1/c.dt;c.dtRatio=1;c.positionIterations=20;c.velocityIterations=a.velocityIterations;c.warmStarting=!1;this.p_island.SolveTOI(c,e.m_islandIndex,k.m_islandIndex);for(d=0;d<this.p_island.m_bodyCount;++d)if(f=this.p_island.m_bodies[d],f.m_flags&=~u.e_islandFlag,f.m_type==u.b2_dynamicBody)for(f.SynchronizeFixtures(),h=
f.m_contactList;h;h=h.next)h.contact.m_flags&=~(v.e_toiFlag|v.e_islandFlag);this.m_contactManager.FindNewContacts();if(this.m_subStepping){this.m_stepComplete=!1;break}}}},DrawJoint:function(a){var b=a.GetBodyA(),c=a.GetBodyB(),b=b.GetTransform(),c=c.GetTransform(),d=b.p,e=c.p,c=a.GetAnchorA(),b=a.GetAnchorB(),f=new ka(0.5,0.8,0.8);switch(a.GetType()){case s.e_distanceJoint:this.g_debugDraw.DrawSegment(c,b,f);break;case s.e_pulleyJoint:d=a.GetGroundAnchorA();a=a.GetGroundAnchorB();this.g_debugDraw.DrawSegment(d,
c,f);this.g_debugDraw.DrawSegment(a,b,f);this.g_debugDraw.DrawSegment(d,a,f);break;case s.e_mouseJoint:break;case s.e_motorJoint:this.g_debugDraw.DrawPoint(a.GetLinearOffset(),5,f);default:this.g_debugDraw.DrawSegment(d,c,f),this.g_debugDraw.DrawSegment(c,b,f),this.g_debugDraw.DrawSegment(e,b,f)}},DrawShape:function(a,b,c){switch(a.GetType()){case E.e_circle:var g=a.GetShape();a=T(b,g.m_p);g=g.m_radius;b=A(b.q,new d(1,0));this.g_debugDraw.DrawSolidCircle(a,g,b,c);break;case E.e_edge:a=a.GetShape();
var e=T(b,a.m_vertex1),f=T(b,a.m_vertex2);this.g_debugDraw.DrawSegment(e,f,c);break;case E.e_chain:a=a.GetShape();var h=a.m_count;a=a.m_vertices;e=T(b,a[0]);for(g=1;g<h;++g)f=T(b,a[g]),this.g_debugDraw.DrawSegment(e,f,c),e=f;break;case E.e_polygon:e=a.GetShape();h=e.m_count;a=Array(qa);for(g=0;g<h;++g)a[g]=T(b,e.m_vertices[g]);this.g_debugDraw.DrawSolidPolygon(a,h,c)}}};K.e_newFixture=1;K.e_locked=2;K.e_clearForces=4;ob.prototype={Clear:function(){this.other=this.prev=this.next=null}};v.m_local_tempManifold=
new F;v.prototype={Create:function(a,b,c,d){this.m_toi=0;this.m_flags=v.e_enabledFlag;this.m_fixtureA=a||null;this.m_fixtureB=c||null;this.m_indexA=b||0;this.m_indexB=d||0;this.m_manifold.pointCount=0;this.m_next=this.m_prev=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null;this.m_toiCount=0;a?(this.m_friction=Oa(this.m_fixtureA.m_friction*this.m_fixtureB.m_friction),
this.m_restitution=Sb(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)):this.m_restitution=this.m_friction=0;this.m_tangentSpeed=0},GetManifold:function(){return this.m_manifold},GetWorldManifold:function(a){var b=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody(),d=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,b.GetTransform(),d.m_radius,c.GetTransform(),e.m_radius)},IsTouching:function(){return(this.m_flags&v.e_touchingFlag)==v.e_touchingFlag},
SetEnabled:function(a){this.m_flags=a?this.m_flags|v.e_enabledFlag:this.m_flags&~v.e_enabledFlag},IsEnabled:function(){return(this.m_flags&v.e_enabledFlag)==v.e_enabledFlag},GetNext:function(){return this.m_next},GetFixtureA:function(){return this.m_fixtureA},GetChildIndexA:function(){return this.m_indexA},GetFixtureB:function(){return this.m_fixtureB},GetChildIndexB:function(){return this.m_indexB},SetFriction:function(a){this.m_friction=a},GetFriction:function(){return this.m_friction},ResetFriction:function(){this.m_friction=
Oa(this.m_fixtureA.m_friction*this.m_fixtureB.m_friction)},SetRestitution:function(a){this.m_restitution=a},GetRestitution:function(){return this.m_restitution},ResetRestitution:function(){this.m_restitution=Sb(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},SetTangentSpeed:function(a){this.m_tangentSpeed=a},GetTangentSpeed:function(){return this.m_tangentSpeed},Evaluate:function(a,b,c){},FlagForFiltering:function(){this.m_flags|=v.e_filterFlag},m_oldManifold:null,Update:function(a){v.m_local_tempManifold.Assign(this.m_manifold);
this.m_flags|=v.e_enabledFlag;var b=!1,c=(this.m_flags&v.e_touchingFlag)==v.e_touchingFlag,d=this.m_fixtureA.IsSensor(),e=this.m_fixtureB.IsSensor(),d=d||e,e=this.m_fixtureA.GetBody(),f=this.m_fixtureB.GetBody(),b=e.GetTransform(),h=f.GetTransform();if(d)e=this.m_fixtureA.GetShape(),f=this.m_fixtureB.GetShape(),b=ba(e,this.m_indexA,f,this.m_indexB,b,h),this.m_manifold.pointCount=0;else{this.Evaluate(this.m_manifold,b,h);b=0<this.m_manifold.pointCount;for(h=0;h<this.m_manifold.pointCount;++h){var k=
this.m_manifold.points[h];k.normalImpulse=0;k.tangentImpulse=0;for(var m=k.id,l=0;l<v.m_local_tempManifold.pointCount;++l){var n=v.m_local_tempManifold.points[l];if(n.id.Get()==m.Get()){k.normalImpulse=n.normalImpulse;k.tangentImpulse=n.tangentImpulse;break}}}b!=c&&(e.SetAwake(!0),f.SetAwake(!0))}this.m_flags=b?this.m_flags|v.e_touchingFlag:this.m_flags&~v.e_touchingFlag;!1==c&&!0==b&&a&&a.BeginContact(this);!0==c&&!1==b&&a&&a.EndContact(this);!1==d&&b&&a&&a.PreSolve(this,v.m_local_tempManifold)}};
v.e_islandFlag=1;v.e_touchingFlag=2;v.e_enabledFlag=4;v.e_filterFlag=8;v.e_bulletHitFlag=16;v.e_toiFlag=32;pb.prototype={Evaluate:function(a,b,c){lc(a,this.m_fixtureA.GetShape(),b,this.m_fixtureB.GetShape(),c)},Create:function(a,b,c,d){this.parent.prototype.Create.call(this,a,0,c,0)}};pb._extend(v);var Eb=new Ba;qb.prototype={Evaluate:function(a,b,c){this.m_fixtureA.GetShape().GetChildEdge(Eb,this.m_indexA);Nb(a,Eb,b,this.m_fixtureB.GetShape(),c)},Create:function(a,b,c,d){this.parent.prototype.Create.call(this,
a,b,c,d)}};qb._extend(v);Ja.prototype={Evaluate:function(a,b,c){this.m_fixtureA.GetShape().GetChildEdge(Eb,this.m_indexA);Ua(a,Eb,b,this.m_fixtureB.GetShape(),c)},Create:function(a,b,c,d){this.parent.prototype.Create.call(this,a,b,c,d)}};Ja.Create=function(a,b,c,d){return new Ja(a,b,c,d)};Ja._extend(v);Ka.prototype={Evaluate:function(a,b,c){Nb(a,this.m_fixtureA.GetShape(),b,this.m_fixtureB.GetShape(),c)},Create:function(a,b,c,d){this.parent.prototype.Create.call(this,a,0,c,0)}};Ka.Create=function(a,
b,c,d){return new Ka(a,c)};Ka._extend(v);La.prototype={Evaluate:function(a,b,c){Ua(a,this.m_fixtureA.GetShape(),b,this.m_fixtureB.GetShape(),c)},Create:function(a,b,c,d){this.parent.prototype.Create.call(this,a,0,c,0)}};La.Create=function(a,b,c,d){return new La(a,c)};La._extend(v);Ma.prototype={Evaluate:function(a,b,c){mc(a,this.m_fixtureA.GetShape(),b,this.m_fixtureB.GetShape(),c)},Create:function(a,b,c,d){this.parent.prototype.Create.call(this,a,0,c,0)}};Ma.Create=function(a,b,c,d){return new Ma(a,
c)};Ma._extend(v);Na.prototype={Evaluate:function(a,b,c){aa(a,this.m_fixtureA.GetShape(),b,this.m_fixtureB.GetShape(),c)},Create:function(a,b,c,d){this.parent.prototype.Create.call(this,a,0,c,0)}};Na.Create=function(a,b,c,d){return new Na(a,c)};Na._extend(v);v.AddType=function(a,b,c){v.s_registers[b]||(v.s_registers[b]=[]);v.s_registers[b][c]=new Tb;v.s_registers[b][c].fcn=a;v.s_registers[b][c].primary=!0;b!=c&&(v.s_registers[c]||(v.s_registers[c]=[]),v.s_registers[c][b]=new Tb,v.s_registers[c][b].fcn=
a,v.s_registers[c][b].primary=!1);a.garbage=[];a.alloc=2};v.InitializeRegisters=function(){v.AddType(pb,E.e_circle,E.e_circle);v.AddType(Ma,E.e_polygon,E.e_circle);v.AddType(Na,E.e_polygon,E.e_polygon);v.AddType(Ka,E.e_edge,E.e_circle);v.AddType(La,E.e_edge,E.e_polygon);v.AddType(qb,E.e_chain,E.e_circle);v.AddType(Ja,E.e_chain,E.e_polygon)};v.RetrieveGarbage=function(a){var b;if(b=a.garbage.pop())return b;for(b=0;b<a.alloc-1;++b)a.garbage.push(new a);a.alloc+=32;return new a};v.Create=function(a,
b,c,d){!1==v.s_initialized&&(v.InitializeRegisters(),v.s_initialized=!0);var e=a.GetType(),f=c.GetType(),h=v.s_registers[e]?v.s_registers[e][f]?v.s_registers[e][f].fcn:null:null;return h?(h=v.RetrieveGarbage(h),v.s_registers[e][f].primary?h.Create(a,b,c,d):h.Create(c,d,a,b),h):null};v.Destroy=function(a){var b=a.m_fixtureA,c=a.m_fixtureB;0<a.m_manifold.pointCount&&!1==b.IsSensor()&&!1==c.IsSensor()&&(b.GetBody().SetAwake(!0),c.GetBody().SetAwake(!0));b=b.GetType();c=c.GetType();a.m_nodeA.Clear();
a.m_nodeB.Clear();v.s_registers[b][c].fcn.garbage.push(a)};v.s_registers=[];v.s_initialized=!1;var Ac=new Pb,Bc=new Qb;Rb.prototype={AddPair:function(a,b){var c=a.fixture,d=b.fixture,e=a.childIndex,f=b.childIndex,h=c.GetBody(),k=d.GetBody();if(h!=k){for(var m=k.GetContactList();m;){if(m.other==h){var l=m.contact.GetFixtureA(),n=m.contact.GetFixtureB(),p=m.contact.GetChildIndexA(),q=m.contact.GetChildIndexB();if(l==c&&n==d&&p==e&&q==f||l==d&&n==c&&p==f&&q==e)return}m=m.next}!1==k.ShouldCollide(h)||
this.m_contactFilter&&!1==this.m_contactFilter.ShouldCollide(c,d)||(e=v.Create(c,e,d,f),null!=e&&(c=e.GetFixtureA(),d=e.GetFixtureB(),e.GetChildIndexA(),e.GetChildIndexB(),h=c.GetBody(),k=d.GetBody(),e.m_prev=null,e.m_next=this.m_contactList,null!=this.m_contactList&&(this.m_contactList.m_prev=e),this.m_contactList=e,e.m_nodeA.contact=e,e.m_nodeA.other=k,e.m_nodeA.prev=null,e.m_nodeA.next=h.m_contactList,null!=h.m_contactList&&(h.m_contactList.prev=e.m_nodeA),h.m_contactList=e.m_nodeA,e.m_nodeB.contact=
e,e.m_nodeB.other=h,e.m_nodeB.prev=null,e.m_nodeB.next=k.m_contactList,null!=k.m_contactList&&(k.m_contactList.prev=e.m_nodeB),k.m_contactList=e.m_nodeB,!1==c.IsSensor()&&!1==d.IsSensor()&&(h.SetAwake(!0),k.SetAwake(!0)),++this.m_contactCount))}},FindNewContacts:function(){this.m_broadPhase.UpdatePairs(this)},Destroy:function(a){var b=a.GetFixtureA(),c=a.GetFixtureB(),b=b.GetBody(),c=c.GetBody();this.m_contactListener&&a.IsTouching()&&this.m_contactListener.EndContact(a);a.m_prev&&(a.m_prev.m_next=
a.m_next);a.m_next&&(a.m_next.m_prev=a.m_prev);a==this.m_contactList&&(this.m_contactList=a.m_next);a.m_nodeA.prev&&(a.m_nodeA.prev.next=a.m_nodeA.next);a.m_nodeA.next&&(a.m_nodeA.next.prev=a.m_nodeA.prev);a.m_nodeA==b.m_contactList&&(b.m_contactList=a.m_nodeA.next);a.m_nodeB.prev&&(a.m_nodeB.prev.next=a.m_nodeB.next);a.m_nodeB.next&&(a.m_nodeB.next.prev=a.m_nodeB.prev);a.m_nodeB==c.m_contactList&&(c.m_contactList=a.m_nodeB.next);v.Destroy(a);--this.m_contactCount},Collide:function(){for(var a=this.m_contactList;a;){var b=
a.GetFixtureA(),c=a.GetFixtureB(),d=a.GetChildIndexA(),e=a.GetChildIndexB(),f=b.GetBody(),h=c.GetBody();if(a.m_flags&v.e_filterFlag){if(!1==h.ShouldCollide(f)){b=a;a=b.GetNext();this.Destroy(b);continue}if(this.m_contactFilter&&!1==this.m_contactFilter.ShouldCollide(b,c)){b=a;a=b.GetNext();this.Destroy(b);continue}a.m_flags&=~v.e_filterFlag}f=f.IsAwake()&&f.m_type!=u.b2_staticBody;h=h.IsAwake()&&h.m_type!=u.b2_staticBody;!1==f&&!1==h?a=a.GetNext():!1==this.m_broadPhase.TestOverlap(b.m_proxies[d].proxyId,
c.m_proxies[e].proxyId)?(b=a,a=b.GetNext(),this.Destroy(b)):(a.Update(this.m_contactListener),a=a.GetNext())}}};Ub.prototype={Initialize:function(a,b,c,d){switch(a.type){case F.e_circles:var e=b.q.c*a.localPoint.x-b.q.s*a.localPoint.y+b.p.x;b=b.q.s*a.localPoint.x+b.q.c*a.localPoint.y+b.p.y;var f=c.q.c*a.localPoints[0].x-c.q.s*a.localPoints[0].y+c.p.x;c=c.q.s*a.localPoints[0].x+c.q.c*a.localPoints[0].y+c.p.y;this.point.x=0.5*(e+f);this.point.y=0.5*(b+c);this.normal.x=f-e;this.normal.y=c-b;c=this.normal.x;
b=this.normal.y;this.normal.Normalize();this.separation=c*this.normal.x+b*this.normal.y-a.radiusA-a.radiusB;break;case F.e_faceA:this.normal.x=b.q.c*a.localNormal.x-b.q.s*a.localNormal.y;this.normal.y=b.q.s*a.localNormal.x+b.q.c*a.localNormal.y;var e=b.q.c*a.localPoint.x-b.q.s*a.localPoint.y+b.p.x,f=b.q.s*a.localPoint.x+b.q.c*a.localPoint.y+b.p.y,h=c.q.c*a.localPoints[d].x-c.q.s*a.localPoints[d].y+c.p.x;c=c.q.s*a.localPoints[d].x+c.q.c*a.localPoints[d].y+c.p.y;this.separation=(h-e)*this.normal.x+
(c-f)*this.normal.y-a.radiusA-a.radiusB;this.point.x=h;this.point.y=c;break;case F.e_faceB:this.normal.x=c.q.c*a.localNormal.x-c.q.s*a.localNormal.y,this.normal.y=c.q.s*a.localNormal.x+c.q.c*a.localNormal.y,e=c.q.c*a.localPoint.x-c.q.s*a.localPoint.y+c.p.x,f=c.q.s*a.localPoint.x+c.q.c*a.localPoint.y+c.p.y,h=b.q.c*a.localPoints[d].x-b.q.s*a.localPoints[d].y+b.p.x,c=b.q.s*a.localPoints[d].x+b.q.c*a.localPoints[d].y+b.p.y,this.separation=(h-e)*this.normal.x+(c-f)*this.normal.y-a.radiusA-a.radiusB,this.point.x=
h,this.point.y=c,this.normal.x=-this.normal.x,this.normal.y=-this.normal.y}}};C.cs_xfA=new $;C.cs_xfB=new $;C.temp_solver_manifold=new Ub;C.prototype={Init:function(a){this.m_step=a.step;this.m_count=a.count;this.m_positionConstraints.length=this.m_count;this.m_velocityConstraints.length=this.m_count;this.m_positions=a.positions;this.m_velocities=a.velocities;this.m_contacts=a.contacts;for(a=0;a<this.m_count;++a){var b=this.m_contacts[a],c=b.m_fixtureA,d=b.m_fixtureB,e=c.GetShape(),f=d.GetShape(),
e=e.m_radius,h=f.m_radius,k=c.GetBody(),m=d.GetBody(),d=b.GetManifold(),c=d.pointCount,f=this.m_velocityConstraints[a]||new Ec;f.friction=b.m_friction;f.restitution=b.m_restitution;f.tangentSpeed=b.m_tangentSpeed;f.indexA=k.m_islandIndex;f.indexB=m.m_islandIndex;f.invMassA=k.m_invMass;f.invMassB=m.m_invMass;f.invIA=k.m_invI;f.invIB=m.m_invI;f.contactIndex=a;f.pointCount=c;f.K.SetZero();f.normalMass.SetZero();this.m_velocityConstraints[a]=f;b=this.m_positionConstraints[a]||new Dc;b.indexA=k.m_islandIndex;
b.indexB=m.m_islandIndex;b.invMassA=k.m_invMass;b.invMassB=m.m_invMass;b.localCenterA.x=k.m_sweep.localCenter.x;b.localCenterA.y=k.m_sweep.localCenter.y;b.localCenterB.x=m.m_sweep.localCenter.x;b.localCenterB.y=m.m_sweep.localCenter.y;b.invIA=k.m_invI;b.invIB=m.m_invI;b.localNormal.x=d.localNormal.x;b.localNormal.y=d.localNormal.y;b.localPoint.x=d.localPoint.x;b.localPoint.y=d.localPoint.y;b.pointCount=c;b.radiusA=e;b.radiusB=h;b.type=d.type;this.m_positionConstraints[a]=b;for(e=0;e<c;++e)h=d.points[e],
k=f.points[e],this.m_step.warmStarting?(k.normalImpulse=this.m_step.dtRatio*h.normalImpulse,k.tangentImpulse=this.m_step.dtRatio*h.tangentImpulse):(k.normalImpulse=0,k.tangentImpulse=0),k.rA.SetZero(),k.rB.SetZero(),k.normalMass=0,k.tangentMass=0,k.velocityBias=0,b.localPoints[e]=h.localPoint}},InitializeVelocityConstraints:function(){for(var a=0;a<this.m_count;++a){var b=this.m_velocityConstraints[a],c=this.m_positionConstraints[a],d=c.radiusA,e=c.radiusB,f=this.m_contacts[b.contactIndex].GetManifold(),
h=b.indexA,k=b.indexB,m=b.invMassA,l=b.invMassB,n=b.invIA,p=b.invIB,q=c.localCenterA,r=c.localCenterB,c=this.m_positions[h].c,R=this.m_velocities[h].v,G=this.m_velocities[h].w,s=this.m_positions[k].c,u=this.m_positions[k].a,x=this.m_velocities[k].v,k=this.m_velocities[k].w;C.cs_xfA.q.Set(this.m_positions[h].a);C.cs_xfB.q.Set(u);C.cs_xfA.p.x=c.x-(C.cs_xfA.q.c*q.x-C.cs_xfA.q.s*q.y);C.cs_xfA.p.y=c.y-(C.cs_xfA.q.s*q.x+C.cs_xfA.q.c*q.y);C.cs_xfB.p.x=s.x-(C.cs_xfB.q.c*r.x-C.cs_xfB.q.s*r.y);C.cs_xfB.p.y=
s.y-(C.cs_xfB.q.s*r.x+C.cs_xfB.q.c*r.y);h=new Kb;h.Initialize(f,C.cs_xfA,d,C.cs_xfB,e);b.normal.x=h.normal.x;b.normal.y=h.normal.y;d=b.pointCount;for(e=0;e<d;++e)f=b.points[e],f.rA.x=h.points[e].x-c.x,f.rA.y=h.points[e].y-c.y,f.rB.x=h.points[e].x-s.x,f.rB.y=h.points[e].y-s.y,q=f.rA.x*b.normal.y-f.rA.y*b.normal.x,r=f.rB.x*b.normal.y-f.rB.y*b.normal.x,q=m+l+n*q*q+p*r*r,f.normalMass=0<q?1/q:0,r=1*b.normal.y,u=-1*b.normal.x,q=f.rA.x*u-f.rA.y*r,r=f.rB.x*u-f.rB.y*r,q=m+l+n*q*q+p*r*r,f.tangentMass=0<q?1/
q:0,f.velocityBias=0,q=b.normal.x*(x.x+-k*f.rB.y-R.x- -G*f.rA.y)+b.normal.y*(x.y+k*f.rB.x-R.y-G*f.rA.x),-1>q&&(f.velocityBias=-b.restitution*q);2==b.pointCount&&(R=b.points[0],s=b.points[1],c=R.rA.x*b.normal.y-R.rA.y*b.normal.x,R=R.rB.x*b.normal.y-R.rB.y*b.normal.x,G=s.rA.x*b.normal.y-s.rA.y*b.normal.x,k=s.rB.x*b.normal.y-s.rB.y*b.normal.x,s=m+l+n*c*c+p*R*R,x=m+l+n*G*G+p*k*k,m=m+l+n*c*G+p*R*k,s*s<1E3*(s*x-m*m)?(b.K.ex.x=s,b.K.ex.y=m,b.K.ey.x=m,b.K.ey.y=x,b.normalMass.Assign(b.K.GetInverse())):b.pointCount=
1)}},WarmStart:function(){for(var a=0;a<this.m_count;++a){for(var b=this.m_velocityConstraints[a],c=b.indexA,d=b.indexB,e=b.invMassA,f=b.invIA,h=b.invMassB,k=b.invIB,m=b.pointCount,l=this.m_velocities[c].v,n=this.m_velocities[c].w,p=this.m_velocities[d].v,q=this.m_velocities[d].w,r=b.normal,s=1*r.y,G=-1*r.x,u=0;u<m;++u){var t=b.points[u],x=t.normalImpulse*r.x+t.tangentImpulse*s,z=t.normalImpulse*r.y+t.tangentImpulse*G,n=n-f*(t.rA.x*z-t.rA.y*x);l.x-=e*x;l.y-=e*z;q+=k*(t.rB.x*z-t.rB.y*x);p.x+=h*x;p.y+=
h*z}this.m_velocities[c].w=n;this.m_velocities[d].w=q}},SolveVelocityConstraints:function(){for(var a=0;a<this.m_count;++a){for(var b=this.m_velocityConstraints[a],c=b.indexA,d=b.indexB,e=b.invMassA,f=b.invIA,h=b.invMassB,k=b.invIB,m=b.pointCount,l=this.m_velocities[c].v,n=this.m_velocities[c].w,p=this.m_velocities[d].v,q=this.m_velocities[d].w,r=b.normal,s=1*r.y,G=-1*r.x,u=b.friction,t=0;t<m;++t){var x=b.points[t],z=p.x+-q*x.rB.y-l.x- -n*x.rA.y,v=p.y+q*x.rB.x-l.y-n*x.rA.x,z=x.tangentMass*-(z*s+v*
G-b.tangentSpeed),v=u*x.normalImpulse,v=X(x.tangentImpulse+z,-v,v),z=v-x.tangentImpulse;x.tangentImpulse=v;v=z*s;z*=G;l.x-=e*v;l.y-=e*z;n-=f*(x.rA.x*z-x.rA.y*v);p.x+=h*v;p.y+=h*z;q+=k*(x.rB.x*z-x.rB.y*v)}if(1==b.pointCount)x=b.points[0],z=p.x+-q*x.rB.y-l.x- -n*x.rA.y,v=p.y+q*x.rB.x-l.y-n*x.rA.x,z=-x.normalMass*(z*r.x+v*r.y-x.velocityBias),v=I(x.normalImpulse+z,0),z=v-x.normalImpulse,x.normalImpulse=v,v=z*r.x,z*=r.y,l.x-=e*v,l.y-=e*z,n-=f*(x.rA.x*z-x.rA.y*v),p.x+=h*v,p.y+=h*z,q+=k*(x.rB.x*z-x.rB.y*
v);else for(var m=b.points[0],s=b.points[1],x=m.normalImpulse,t=s.normalImpulse,z=(p.x+-q*m.rB.y-l.x- -n*m.rA.y)*r.x+(p.y+q*m.rB.x-l.y-n*m.rA.x)*r.y,v=(p.x+-q*s.rB.y-l.x- -n*s.rA.y)*r.x+(p.y+q*s.rB.x-l.y-n*s.rA.x)*r.y,w=z-m.velocityBias,y=v-s.velocityBias,w=w-(b.K.ex.x*x+b.K.ey.x*t),y=y-(b.K.ex.y*x+b.K.ey.y*t);;){G=-(b.normalMass.ex.x*w+b.normalMass.ey.x*y);u=-(b.normalMass.ex.y*w+b.normalMass.ey.y*y);if(0<=G&&0<=u){x=G-x;t=u-t;b=x*r.x;x*=r.y;z=t*r.x;r=t*r.y;l.x-=e*(b+z);l.y-=e*(x+r);n-=f*(m.rA.x*
x-m.rA.y*b+(s.rA.x*r-s.rA.y*z));p.x+=h*(b+z);p.y+=h*(x+r);q+=k*(m.rB.x*x-m.rB.y*b+(s.rB.x*r-s.rB.y*z));m.normalImpulse=G;s.normalImpulse=u;break}G=-m.normalMass*w;u=0;v=b.K.ex.y*G+y;if(0<=G&&0<=v){x=G-x;t=u-t;b=x*r.x;x*=r.y;z=t*r.x;r=t*r.y;l.x-=e*(b+z);l.y-=e*(x+r);n-=f*(m.rA.x*x-m.rA.y*b+(s.rA.x*r-s.rA.y*z));p.x+=h*(b+z);p.y+=h*(x+r);q+=k*(m.rB.x*x-m.rB.y*b+(s.rB.x*r-s.rB.y*z));m.normalImpulse=G;s.normalImpulse=u;break}G=0;u=-s.normalMass*y;z=b.K.ey.x*u+w;if(0<=u&&0<=z){x=G-x;t=u-t;b=x*r.x;x*=r.y;
z=t*r.x;r=t*r.y;l.x-=e*(b+z);l.y-=e*(x+r);n-=f*(m.rA.x*x-m.rA.y*b+(s.rA.x*r-s.rA.y*z));p.x+=h*(b+z);p.y+=h*(x+r);q+=k*(m.rB.x*x-m.rB.y*b+(s.rB.x*r-s.rB.y*z));m.normalImpulse=G;s.normalImpulse=u;break}u=G=0;z=w;v=y;if(0<=z&&0<=v){x=G-x;t=u-t;b=x*r.x;x*=r.y;z=t*r.x;r=t*r.y;l.x-=e*(b+z);l.y-=e*(x+r);n-=f*(m.rA.x*x-m.rA.y*b+(s.rA.x*r-s.rA.y*z));p.x+=h*(b+z);p.y+=h*(x+r);q+=k*(m.rB.x*x-m.rB.y*b+(s.rB.x*r-s.rB.y*z));m.normalImpulse=G;s.normalImpulse=u;break}break}this.m_velocities[c].w=n;this.m_velocities[d].w=
q}},StoreImpulses:function(){for(var a=0;a<this.m_count;++a)for(var b=this.m_velocityConstraints[a],c=this.m_contacts[b.contactIndex].GetManifold(),d=0;d<b.pointCount;++d)c.points[d].normalImpulse=b.points[d].normalImpulse,c.points[d].tangentImpulse=b.points[d].tangentImpulse},SolvePositionConstraints:function(){for(var a=0,b=0;b<this.m_count;++b){for(var c=this.m_positionConstraints[b],d=c.indexA,e=c.indexB,f=c.localCenterA,h=c.invMassA,k=c.invIA,m=c.localCenterB,l=c.invMassB,n=c.invIB,p=c.pointCount,
q=this.m_positions[d].c,r=this.m_positions[d].a,s=this.m_positions[e].c,u=this.m_positions[e].a,t=0;t<p;++t){C.cs_xfA.q.Set(r);C.cs_xfB.q.Set(u);C.cs_xfA.p.x=q.x-(C.cs_xfA.q.c*f.x-C.cs_xfA.q.s*f.y);C.cs_xfA.p.y=q.y-(C.cs_xfA.q.s*f.x+C.cs_xfA.q.c*f.y);C.cs_xfB.p.x=s.x-(C.cs_xfB.q.c*m.x-C.cs_xfB.q.s*m.y);C.cs_xfB.p.y=s.y-(C.cs_xfB.q.s*m.x+C.cs_xfB.q.c*m.y);C.temp_solver_manifold.Initialize(c,C.cs_xfA,C.cs_xfB,t);var v=C.temp_solver_manifold.normal,x=C.temp_solver_manifold.point,z=C.temp_solver_manifold.separation,
w=x.x-q.x,y=x.y-q.y,A=x.x-s.x,x=x.y-s.y,a=S(a,z),z=X(0.2*(z+N),-0.2,0),B=w*v.y-y*v.x,D=A*v.y-x*v.x,B=h+l+k*B*B+n*D*D,B=0<B?-z/B:0,z=B*v.x,v=B*v.y;q.x-=h*z;q.y-=h*v;r-=k*(w*v-y*z);s.x+=l*z;s.y+=l*v;u+=n*(A*v-x*z)}this.m_positions[d].a=r;this.m_positions[e].a=u}return a>=-3*N},SolveTOIPositionConstraints:function(a,b){for(var c=0,g=0;g<this.m_count;++g){var e=this.m_positionConstraints[g],f=e.indexA,h=e.indexB,k=e.localCenterA,m=e.localCenterB,l=e.pointCount,n=0,p=0;if(f==a||f==b)n=e.invMassA,p=e.invIA;
var q=0,r=0;if(h==a||h==b)q=e.invMassB,r=e.invIB;for(var s=this.m_positions[f].c,u=this.m_positions[f].a,v=this.m_positions[h].c,w=this.m_positions[h].a,x=0;x<l;++x){C.cs_xfA.q.Set(u);C.cs_xfB.q.Set(w);C.cs_xfA.p.Assign(d.Subtract(s,A(C.cs_xfA.q,k)));C.cs_xfB.p.Assign(d.Subtract(v,A(C.cs_xfB.q,m)));C.temp_solver_manifold.Initialize(e,C.cs_xfA,C.cs_xfB,x);var z=C.temp_solver_manifold.normal,y=C.temp_solver_manifold.point,B=C.temp_solver_manifold.separation,D=d.Subtract(y,s),y=d.Subtract(y,v),c=S(c,
B),B=X(0.75*(B+N),-0.2,0),E=t(D,z),I=t(y,z),E=n+q+p*E*E+r*I*I,z=d.Multiply(0<E?-B/E:0,z);s.Subtract(d.Multiply(n,z));u-=p*t(D,z);v.Add(d.Multiply(q,z));w+=r*t(y,z)}this.m_positions[f].a=u;this.m_positions[h].a=w}return c>=-1.5*N}};var Nc=oa.create("solve initialization","solve"),Oc=oa.create("warm starting","solve initialization"),Pc=oa.create("solve velocities","solve"),Qc=oa.create("solve positions","solve");H._solverData=new xc;H._solverDef=new Fc;H._solver=new C;H.prototype={Clear:function(){this.m_jointCount=
this.m_contactCount=this.m_bodyCount=0},Initialize:function(a,b,c,d){this.m_listener=d;this.m_bodyCapacity=a;this.m_contactCapacity=b;this.m_jointCapacity=c;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;this.m_bodies.length=a;this.m_contacts.length=b;this.m_joints.length=c;this.m_velocities.length=a;this.m_positions.length=a},Solve:function(a,b,c){Nc.start();for(var d=a.dt,e=0;e<this.m_bodyCount;++e){var f=this.m_bodies[e];this.m_positions[e].c.Assign(f.m_sweep.c);var h=f.m_sweep.a;this.m_velocities[e].v.Assign(f.m_linearVelocity);
var k=f.m_angularVelocity;f.m_sweep.c0.Assign(f.m_sweep.c);f.m_sweep.a0=f.m_sweep.a;f.m_type==u.b2_dynamicBody&&(this.m_velocities[e].v.x+=d*(f.m_gravityScale*b.x+f.m_invMass*f.m_force.x),this.m_velocities[e].v.y+=d*(f.m_gravityScale*b.y+f.m_invMass*f.m_force.y),k+=d*f.m_invI*f.m_torque,this.m_velocities[e].v.x*=1/(1+d*f.m_linearDamping),this.m_velocities[e].v.y*=1/(1+d*f.m_linearDamping),k*=1/(1+d*f.m_angularDamping));this.m_positions[e].a=h;this.m_velocities[e].w=k}H._solverData.step=a;H._solverData.positions=
this.m_positions;H._solverData.velocities=this.m_velocities;H._solverDef.step=a;H._solverDef.contacts=this.m_contacts;H._solverDef.count=this.m_contactCount;H._solverDef.positions=this.m_positions;H._solverDef.velocities=this.m_velocities;H._solverDef.allocator=this.m_allocator;H._solver.Init(H._solverDef);H._solver.InitializeVelocityConstraints();a.warmStarting&&(Oc.start(),H._solver.WarmStart(),Oc.stop());for(e=0;e<this.m_jointCount;++e)this.m_joints[e].InitVelocityConstraints(H._solverData);Nc.stop();
Pc.start();for(e=0;e<a.velocityIterations;++e){for(k=0;k<this.m_jointCount;++k)this.m_joints[k].SolveVelocityConstraints(H._solverData);H._solver.SolveVelocityConstraints()}H._solver.StoreImpulses();Pc.stop();Qc.start();for(e=0;e<this.m_bodyCount;++e){f=this.m_positions[e].c;h=this.m_positions[e].a;b=this.m_velocities[e].v;var k=this.m_velocities[e].w,m=d*b.x,l=d*b.y,m=m*m+l*l;4<m&&(m=2/Oa(m),b.x*=m,b.y*=m);m=d*k;m*m>Wb&&(m=gb/V(m),k*=m);f.x+=d*b.x;f.y+=d*b.y;h+=d*k;this.m_positions[e].a=h;this.m_velocities[e].w=
k}h=!1;for(e=0;e<a.positionIterations;++e){f=H._solver.SolvePositionConstraints();b=!0;for(k=0;k<this.m_jointCount;++k)m=this.m_joints[k].SolvePositionConstraints(H._solverData),b=b&&m;if(f&&b){h=!0;break}}for(e=0;e<this.m_bodyCount;++e)a=this.m_bodies[e],a.m_sweep.c.Assign(this.m_positions[e].c),a.m_sweep.a=this.m_positions[e].a,a.m_linearVelocity.Assign(this.m_velocities[e].v),a.m_angularVelocity=this.m_velocities[e].w,a.SynchronizeTransform();Qc.stop();this.Report(H._solver.m_velocityConstraints);
if(c){c=za;a=Xb*Xb;for(e=0;e<this.m_bodyCount;++e)f=this.m_bodies[e],f.GetType()!=u.b2_staticBody&&(0==(f.m_flags&u.e_autoSleepFlag)||f.m_angularVelocity*f.m_angularVelocity>a||1E-4<B(f.m_linearVelocity,f.m_linearVelocity)?c=f.m_sleepTime=0:(f.m_sleepTime+=d,c=S(c,f.m_sleepTime)));if(0.5<=c&&h)for(e=0;e<this.m_bodyCount;++e)f=this.m_bodies[e],f.SetAwake(!1)}},SolveTOI:function(a,b,c){for(var g=0;g<this.m_bodyCount;++g){var e=this.m_bodies[g];this.m_positions[g].c.Assign(e.m_sweep.c);this.m_positions[g].a=
e.m_sweep.a;this.m_velocities[g].v.Assign(e.m_linearVelocity);this.m_velocities[g].w=e.m_angularVelocity}H._solverDef.contacts=this.m_contacts;H._solverDef.count=this.m_contactCount;H._solverDef.step=a;H._solverDef.positions=this.m_positions;H._solverDef.velocities=this.m_velocities;H._solver.Init(H._solverDef);for(g=0;g<a.positionIterations&&!H._solver.SolveTOIPositionConstraints(b,c);++g);this.m_bodies[b].m_sweep.c0.Assign(this.m_positions[b].c);this.m_bodies[b].m_sweep.a0=this.m_positions[b].a;
this.m_bodies[c].m_sweep.c0.Assign(this.m_positions[c].c);this.m_bodies[c].m_sweep.a0=this.m_positions[c].a;H._solver.InitializeVelocityConstraints();for(g=0;g<a.velocityIterations;++g)H._solver.SolveVelocityConstraints();a=a.dt;for(g=0;g<this.m_bodyCount;++g){b=this.m_positions[g].c;c=this.m_positions[g].a;var e=this.m_velocities[g].v,f=this.m_velocities[g].w,h=d.Multiply(a,e);4<B(h,h)&&(h=2/h.Length(),e.Multiply(h));h=a*f;h*h>Wb&&(h=gb/V(h),f*=h);b.Add(d.Multiply(a,e));c+=a*f;this.m_positions[g].a=
c;this.m_velocities[g].w=f;h=this.m_bodies[g];h.m_sweep.c.Assign(b);h.m_sweep.a=c;h.m_linearVelocity.Assign(e);h.m_angularVelocity=f;h.SynchronizeTransform()}this.Report(H._solver.m_velocityConstraints)},AddBody:function(a){a.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount]=a;this.m_positions[this.m_bodyCount]||(this.m_positions[this.m_bodyCount]=new vc,this.m_velocities[this.m_bodyCount]=new wc);++this.m_bodyCount},AddContact:function(a){this.m_contacts[this.m_contactCount++]=a},AddJoint:function(a){this.m_joints[this.m_jointCount++]=
a},Report:function(a){if(null!=this.m_listener)for(var b=0;b<this.m_contactCount;++b){var c=this.m_contacts[b],d=a[b],e=new sc;e.count=d.pointCount;for(var f=0;f<d.pointCount;++f)e.normalImpulses[f]=d.points[f].normalImpulse,e.tangentImpulses[f]=d.points[f].tangentImpulse;this.m_listener.PostSolve(c,e)}}};ja.prototype={_deserialize:function(a,b,c){this.bodyA=b[a.bodyA];this.bodyB=b[a.bodyB];this.collideConnected=a.collideConnected}};s.prototype={GetType:function(){return this.m_type},GetBodyA:function(){return this.m_bodyA},
GetBodyB:function(){return this.m_bodyB},GetAnchorA:function(){},GetAnchorB:function(){},GetReactionForce:function(a){},GetReactionTorque:function(a){},GetNext:function(){return this.m_next},GetUserData:function(){return this.m_userData},SetUserData:function(a){this.m_userData=a},IsActive:function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},GetCollideConnected:function(){return this.m_collideConnected},ShiftOrigin:function(a){},InitVelocityConstraints:function(a){},SolveVelocityConstraints:function(a){},
SolvePositionConstraints:function(a){},_serialize:function(a){a=a||{};a.bodyA=null;a.bodyB=null;a.type=this.m_type;a.collideConnected=this.m_collideConnected;return a}};s.e_inactiveLimit=0;s.e_atLowerLimit=1;s.e_atUpperLimit=2;s.e_equalLimits=3;s.e_unknownJoint=0;s.e_revoluteJoint=1;s.e_prismaticJoint=2;s.e_distanceJoint=3;s.e_pulleyJoint=4;s.e_mouseJoint=5;s.e_gearJoint=6;s.e_wheelJoint=7;s.e_weldJoint=8;s.e_frictionJoint=9;s.e_ropeJoint=10;s.e_motorJoint=11;s.Create=function(a){var b=null;switch(a.type){case s.e_distanceJoint:b=
new tb(a);break;case s.e_mouseJoint:b=new sb(a);break;case s.e_prismaticJoint:b=new ub(a);break;case s.e_revoluteJoint:b=new rb(a);break;case s.e_pulleyJoint:b=new Cb(a);break;case s.e_gearJoint:b=new zb(a);break;case s.e_wheelJoint:b=new xb(a);break;case s.e_weldJoint:b=new wb(a);break;case s.e_frictionJoint:b=new vb(a);break;case s.e_ropeJoint:b=new Db(a);break;case s.e_motorJoint:b=new Ab(a)}return b};s.Destroy=function(a){};Ya.prototype={Initialize:function(a,b,c){this.bodyA=a;this.bodyB=b;this.localAnchorA=
this.bodyA.GetLocalPoint(c);this.localAnchorB=this.bodyB.GetLocalPoint(c);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},_deserialize:function(a,b,c){this.parent.prototype._deserialize.call(this,a,b,c);this.localAnchorA._deserialize(a.localAnchorA);this.localAnchorB._deserialize(a.localAnchorB);this.referenceAngle=a.referenceAngle;this.lowerAngle=a.lowerAngle;this.upperAngle=a.upperAngle;this.maxMotorTorque=a.maxMotorTorque;this.motorSpeed=a.motorSpeed;this.enableLimit=a.enableLimit;
this.enableMotor=a.enableMotor}};Ya._extend(ja);rb.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},GetReferenceAngle:function(){return this.m_referenceAngle},GetJointAngle:function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},GetJointSpeed:function(){return this.m_bodyB.m_angularVelocity-
this.m_bodyA.m_angularVelocity},IsLimitEnabled:function(){return this.m_enableLimit},EnableLimit:function(a){a!=this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=a,this.m_impulse.z=0)},GetLowerLimit:function(){return this.m_lowerAngle},GetUpperLimit:function(){return this.m_upperAngle},SetLimits:function(a,b){if(a!=this.m_lowerAngle||b!=this.m_upperAngle)this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=a,this.m_upperAngle=
b},IsMotorEnabled:function(){return this.m_enableMotor},EnableMotor:function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=a},SetMotorSpeed:function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=a},GetMotorSpeed:function(){return this.m_motorSpeed},SetMaxMotorTorque:function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorTorque=a},GetMaxMotorTorque:function(){return this.m_maxMotorTorque},GetReactionForce:function(a){var b=
new d(this.m_impulse.x,this.m_impulse.y);return d.Multiply(a,b)},GetReactionTorque:function(a){return a*this.m_impulse.z},GetMotorTorque:function(a){return a*this.m_motorImpulse},InitVelocityConstraints:function(a){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA=this.m_bodyA.m_sweep.localCenter;this.m_localCenterB=this.m_bodyB.m_sweep.localCenter;this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;
this.m_invIB=this.m_bodyB.m_invI;var b=a.positions[this.m_indexA].a,c=a.velocities[this.m_indexA].v.Clone(),g=a.velocities[this.m_indexA].w,e=a.positions[this.m_indexB].a,f=a.velocities[this.m_indexB].v.Clone(),h=a.velocities[this.m_indexB].w,k=new D(b),m=new D(e);this.m_rA=A(k,d.Subtract(this.m_localAnchorA,this.m_localCenterA));this.m_rB=A(m,d.Subtract(this.m_localAnchorB,this.m_localCenterB));var k=this.m_invMassA,m=this.m_invMassB,l=this.m_invIA,n=this.m_invIB,p=0==l+n;this.m_mass.ex.x=k+m+this.m_rA.y*
this.m_rA.y*l+this.m_rB.y*this.m_rB.y*n;this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*l-this.m_rB.y*this.m_rB.x*n;this.m_mass.ez.x=-this.m_rA.y*l-this.m_rB.y*n;this.m_mass.ex.y=this.m_mass.ey.x;this.m_mass.ey.y=k+m+this.m_rA.x*this.m_rA.x*l+this.m_rB.x*this.m_rB.x*n;this.m_mass.ez.y=this.m_rA.x*l+this.m_rB.x*n;this.m_mass.ex.z=this.m_mass.ez.x;this.m_mass.ey.z=this.m_mass.ez.y;this.m_mass.ez.z=l+n;this.m_motorMass=l+n;0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass);if(!1==this.m_enableMotor||
p)this.m_motorImpulse=0;this.m_enableLimit&&!1==p?(b=e-b-this.m_referenceAngle,V(this.m_upperAngle-this.m_lowerAngle)<2*sa?this.m_limitState=s.e_equalLimits:b<=this.m_lowerAngle?(this.m_limitState!=s.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=s.e_atLowerLimit):b>=this.m_upperAngle?(this.m_limitState!=s.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=s.e_atUpperLimit):(this.m_limitState=s.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=s.e_inactiveLimit;a.step.warmStarting?
(this.m_impulse.Multiply(a.step.dtRatio),this.m_motorImpulse*=a.step.dtRatio,b=new d(this.m_impulse.x,this.m_impulse.y),c.Subtract(d.Multiply(k,b)),g-=l*(t(this.m_rA,b)+this.m_motorImpulse+this.m_impulse.z),f.Add(d.Multiply(m,b)),h+=n*(t(this.m_rB,b)+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0);a.velocities[this.m_indexA].v.Assign(c);a.velocities[this.m_indexA].w=g;a.velocities[this.m_indexB].v.Assign(f);a.velocities[this.m_indexB].w=h},SolveVelocityConstraints:function(a){var b=
a.velocities[this.m_indexA].v.Clone(),c=a.velocities[this.m_indexA].w,g=a.velocities[this.m_indexB].v.Clone(),e=a.velocities[this.m_indexB].w,f=this.m_invMassA,h=this.m_invMassB,k=this.m_invIA,m=this.m_invIB,l=0==k+m;if(this.m_enableMotor&&this.m_limitState!=s.e_equalLimits&&!1==l){var n=e-c-this.m_motorSpeed,n=-this.m_motorMass*n,p=this.m_motorImpulse,q=a.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=X(this.m_motorImpulse+n,-q,q);n=this.m_motorImpulse-p;c-=k*n;e+=m*n}this.m_enableLimit&&this.m_limitState!=
s.e_inactiveLimit&&!1==l?(l=d.Subtract(d.Subtract(d.Add(g,O(e,this.m_rB)),b),O(c,this.m_rA)),n=new L(l.x,l.y,e-c),n=this.m_mass.Solve33(n).Negate(),this.m_limitState==s.e_equalLimits?this.m_impulse.Add(n):this.m_limitState==s.e_atLowerLimit?(p=this.m_impulse.z+n.z,0>p?(l=d.Add(l.Negate(),d.Multiply(this.m_impulse.z,new d(this.m_mass.ez.x,this.m_mass.ez.y))),l=this.m_mass.Solve22(l),n.x=l.x,n.y=l.y,n.z=-this.m_impulse.z,this.m_impulse.x+=l.x,this.m_impulse.y+=l.y,this.m_impulse.z=0):this.m_impulse.Add(n)):
this.m_limitState==s.e_atUpperLimit&&(p=this.m_impulse.z+n.z,0<p?(l=d.Add(l.Negate(),d.Multiply(this.m_impulse.z,new d(this.m_mass.ez.x,this.m_mass.ez.y))),l=this.m_mass.Solve22(l),n.x=l.x,n.y=l.y,n.z=-this.m_impulse.z,this.m_impulse.x+=l.x,this.m_impulse.y+=l.y,this.m_impulse.z=0):this.m_impulse.Add(n)),l=new d(n.x,n.y),b.Subtract(d.Multiply(f,l)),c-=k*(t(this.m_rA,l)+n.z),g.Add(d.Multiply(h,l)),e+=m*(t(this.m_rB,l)+n.z)):(n=d.Subtract(d.Subtract(d.Add(g,O(e,this.m_rB)),b),O(c,this.m_rA)),n=this.m_mass.Solve22(n.Negate()),
this.m_impulse.x+=n.x,this.m_impulse.y+=n.y,b.Subtract(d.Multiply(f,n)),c-=k*t(this.m_rA,n),g.Add(d.Multiply(h,n)),e+=m*t(this.m_rB,n));a.velocities[this.m_indexA].v.Assign(b);a.velocities[this.m_indexA].w=c;a.velocities[this.m_indexB].v.Assign(g);a.velocities[this.m_indexB].w=e},SolvePositionConstraints:function(a){var b=a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,g=a.positions[this.m_indexB].c.Clone(),e=a.positions[this.m_indexB].a,f=new D(c),h=new D(e),k=0,m=0,m=0==this.m_invIA+
this.m_invIB;if(this.m_enableLimit&&this.m_limitState!=s.e_inactiveLimit&&!1==m){var l=e-c-this.m_referenceAngle,m=0;this.m_limitState==s.e_equalLimits?(l=X(l-this.m_lowerAngle,-fb,fb),m=-this.m_motorMass*l,k=V(l)):this.m_limitState==s.e_atLowerLimit?(l-=this.m_lowerAngle,k=-l,l=X(l+sa,-fb,0),m=-this.m_motorMass*l):this.m_limitState==s.e_atUpperLimit&&(k=l-=this.m_upperAngle,l=X(l-sa,0,fb),m=-this.m_motorMass*l);c-=this.m_invIA*m;e+=this.m_invIB*m}f.Set(c);h.Set(e);var f=A(f,d.Subtract(this.m_localAnchorA,
this.m_localCenterA)),h=A(h,d.Subtract(this.m_localAnchorB,this.m_localCenterB)),l=d.Subtract(d.Subtract(d.Add(g,h),b),f),m=l.Length(),n=this.m_invMassA,p=this.m_invMassB,q=this.m_invIA,r=this.m_invIB,u=new U;u.ex.x=n+p+q*f.y*f.y+r*h.y*h.y;u.ex.y=-q*f.x*f.y-r*h.x*h.y;u.ey.x=u.ex.y;u.ey.y=n+p+q*f.x*f.x+r*h.x*h.x;l=u.Solve(l).Negate();b.Subtract(d.Multiply(n,l));c-=q*t(f,l);g.Add(d.Multiply(p,l));e+=r*t(h,l);a.positions[this.m_indexA].c.Assign(b);a.positions[this.m_indexA].a=c;a.positions[this.m_indexB].c.Assign(g);
a.positions[this.m_indexB].a=e;return m<=N&&k<=sa},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.localAnchorA=this.m_localAnchorA._serialize();a.localAnchorB=this.m_localAnchorB._serialize();a.referenceAngle=this.m_referenceAngle;a.lowerAngle=this.m_lowerAngle;a.upperAngle=this.m_upperAngle;a.maxMotorTorque=this.m_maxMotorTorque;a.motorSpeed=this.m_motorSpeed;a.enableLimit=this.m_enableLimit;a.enableMotor=this.m_enableMotor;return a}};rb._extend(s);Gc._extend(ja);
sb.prototype={GetAnchorA:function(){return this.m_targetA},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(a){return d.Multiply(a,this.m_impulse)},GetReactionTorque:function(a){return 0*a},SetTarget:function(a){!1==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0);this.m_targetA.Assign(a)},GetTarget:function(){return this.m_targetA},SetMaxForce:function(a){this.m_maxForce=a},GetMaxForce:function(){return this.m_maxForce},SetFrequency:function(a){this.m_frequencyHz=
a},GetFrequency:function(){return this.m_frequencyHz},SetDampingRatio:function(a){this.m_dampingRatio=a},GetDampingRatio:function(){return this.m_dampingRatio},ShiftOrigin:function(a){this.m_targetA.Subtract(a)},InitVelocityConstraints:function(a){this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter);this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIB=this.m_bodyB.m_invI;var b=a.positions[this.m_indexB].c.Clone(),c=a.positions[this.m_indexB].a,g=a.velocities[this.m_indexB].v.Clone(),
e=a.velocities[this.m_indexB].w,c=new D(c),f=this.m_bodyB.GetMass(),h=2*ea*this.m_frequencyHz,k=f*h*h,m=a.step.dt;this.m_gamma=m*(2*f*this.m_dampingRatio*h+m*k);0!=this.m_gamma&&(this.m_gamma=1/this.m_gamma);this.m_beta=m*k*this.m_gamma;this.m_rB.Assign(A(c,d.Subtract(this.m_localAnchorB,this.m_localCenterB)));c=new U;c.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma;c.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y;c.ey.x=c.ex.y;c.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+
this.m_gamma;this.m_mass.Assign(c.GetInverse());this.m_C.Assign(d.Subtract(d.Add(b,this.m_rB),this.m_targetA));this.m_C.Multiply(this.m_beta);e*=0.98;a.step.warmStarting?(this.m_impulse.Multiply(a.step.dtRatio),g.Add(d.Multiply(this.m_invMassB,this.m_impulse)),e+=this.m_invIB*t(this.m_rB,this.m_impulse)):this.m_impulse.SetZero();a.velocities[this.m_indexB].v.Assign(g);a.velocities[this.m_indexB].w=e},SolveVelocityConstraints:function(a){var b=a.velocities[this.m_indexB].v.Clone(),c=a.velocities[this.m_indexB].w,
g=d.Add(b,O(c,this.m_rB)),g=Da(this.m_mass,d.Add(d.Add(g,this.m_C),d.Multiply(this.m_gamma,this.m_impulse)).Negate()),e=this.m_impulse.Clone();this.m_impulse.Add(g);var f=a.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>f*f&&this.m_impulse.Multiply(f/this.m_impulse.Length());g.Assign(d.Subtract(this.m_impulse,e));b.Add(d.Multiply(this.m_invMassB,g));c+=this.m_invIB*t(this.m_rB,g);a.velocities[this.m_indexB].v.Assign(b);a.velocities[this.m_indexB].w=c},SolvePositionConstraints:function(a){return!0}};
sb._extend(s);Za.prototype={Initialize:function(a,b,c,g){this.bodyA=a;this.bodyB=b;this.localAnchorA=this.bodyA.GetLocalPoint(c);this.localAnchorB=this.bodyB.GetLocalPoint(g);this.length=d.Subtract(g,c).Length()},_deserialize:function(a,b,c){this.parent.prototype._deserialize.call(this,a,b,c);this.localAnchorA._deserialize(a.localAnchorA);this.localAnchorB._deserialize(a.localAnchorB);this.length=a.length;this.frequencyHz=a.frequencyHz;this.dampingRatio=a.dampingRatio}};Za._extend(ja);tb.prototype=
{GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(a){return d.Multiply(a*this.m_impulse,this.m_u)},GetReactionTorque:function(a){return 0},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},SetLength:function(a){this.m_length=a},GetLength:function(){return this.m_length},SetFrequency:function(a){this.m_frequencyHz=
a},GetFrequency:function(){return this.m_frequencyHz},SetDampingRatio:function(a){this.m_dampingRatio=a},GetDampingRatio:function(){return this.m_dampingRatio},InitVelocityConstraints:function(a){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;
this.m_invIB=this.m_bodyB.m_invI;var b=a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,g=a.velocities[this.m_indexA].v.Clone(),e=a.velocities[this.m_indexA].w,f=a.positions[this.m_indexB].c.Clone(),h=a.positions[this.m_indexB].a,k=a.velocities[this.m_indexB].v.Clone(),m=a.velocities[this.m_indexB].w,c=new D(c),h=new D(h);this.m_rA=A(c,d.Subtract(this.m_localAnchorA,this.m_localCenterA));this.m_rB=A(h,d.Subtract(this.m_localAnchorB,this.m_localCenterB));this.m_u=d.Subtract(d.Subtract(d.Add(f,
this.m_rB),b),this.m_rA);f=this.m_u.Length();f>N?this.m_u.Multiply(1/f):this.m_u.Set(0,0);b=t(this.m_rA,this.m_u);h=t(this.m_rB,this.m_u);b=this.m_invMassA+this.m_invIA*b*b+this.m_invMassB+this.m_invIB*h*h;this.m_mass=0!=b?1/b:0;if(0<this.m_frequencyHz){var f=f-this.m_length,h=2*ea*this.m_frequencyHz,c=this.m_mass*h*h,l=a.step.dt;this.m_gamma=l*(2*this.m_mass*this.m_dampingRatio*h+l*c);this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0;this.m_bias=f*l*c*this.m_gamma;b+=this.m_gamma;this.m_mass=0!=b?1/
b:0}else this.m_bias=this.m_gamma=0;a.step.warmStarting?(this.m_impulse*=a.step.dtRatio,b=d.Multiply(this.m_impulse,this.m_u),g.Subtract(d.Multiply(this.m_invMassA,b)),e-=this.m_invIA*t(this.m_rA,b),k.Add(d.Multiply(this.m_invMassB,b)),m+=this.m_invIB*t(this.m_rB,b)):this.m_impulse=0;a.velocities[this.m_indexA].v.Assign(g);a.velocities[this.m_indexA].w=e;a.velocities[this.m_indexB].v.Assign(k);a.velocities[this.m_indexB].w=m},SolveVelocityConstraints:function(a){var b=a.velocities[this.m_indexA].v.Clone(),
c=a.velocities[this.m_indexA].w,g=a.velocities[this.m_indexB].v.Clone(),e=a.velocities[this.m_indexB].w,f=d.Add(b,O(c,this.m_rA)),h=d.Add(g,O(e,this.m_rB)),f=B(this.m_u,d.Subtract(h,f)),f=-this.m_mass*(f+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=f;f=d.Multiply(f,this.m_u);b.Subtract(d.Multiply(this.m_invMassA,f));c-=this.m_invIA*t(this.m_rA,f);g.Add(d.Multiply(this.m_invMassB,f));e+=this.m_invIB*t(this.m_rB,f);a.velocities[this.m_indexA].v.Assign(b);a.velocities[this.m_indexA].w=c;
a.velocities[this.m_indexB].v.Assign(g);a.velocities[this.m_indexB].w=e},SolvePositionConstraints:function(a){if(0<this.m_frequencyHz)return!0;var b=a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,g=a.positions[this.m_indexB].c.Clone(),e=a.positions[this.m_indexB].a,f=new D(c),h=new D(e),f=A(f,d.Subtract(this.m_localAnchorA,this.m_localCenterA)),h=A(h,d.Subtract(this.m_localAnchorB,this.m_localCenterB)),k=d.Subtract(d.Subtract(d.Add(g,h),b),f),m=k.Normalize()-this.m_length,m=X(m,
-0.2,0.2),k=d.Multiply(-this.m_mass*m,k);b.Subtract(d.Multiply(this.m_invMassA,k));c-=this.m_invIA*t(f,k);g.Add(d.Multiply(this.m_invMassB,k));e+=this.m_invIB*t(h,k);a.positions[this.m_indexA].c.Assign(b);a.positions[this.m_indexA].a=c;a.positions[this.m_indexB].c.Assign(g);a.positions[this.m_indexB].a=e;return V(m)<N},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.localAnchorA=this.m_localAnchorA._serialize();a.localAnchorB=this.m_localAnchorB._serialize();a.length=
this.m_length;a.frequencyHz=this.m_frequencyHz;a.dampingRatio=this.m_dampingRatio;return a}};tb._extend(s);$a.prototype={Initialize:function(a,b,c,d){this.bodyA=a;this.bodyB=b;this.localAnchorA=this.bodyA.GetLocalPoint(c);this.localAnchorB=this.bodyB.GetLocalPoint(c);this.localAxisA=this.bodyA.GetLocalVector(d);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},_deserialize:function(a,b,c){this.parent.prototype._deserialize.call(this,a,b,c);this.localAnchorA._deserialize(a.localAnchorA);
this.localAnchorB._deserialize(a.localAnchorB);this.localAxisA._deserialize(a.localAxisA);this.referenceAngle=a.referenceAngle;this.enableLimit=a.enableLimit;this.lowerTranslation=a.lowerTranslation;this.upperTranslation=a.upperTranslation;this.enableMotor=a.enableMotor;this.maxMotorForce=a.maxMotorForce;this.motorSpeed=a.motorSpeed}};$a._extend(ja);ub.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},
GetReactionForce:function(a){return d.Multiply(a,d.Add(d.Multiply(this.m_impulse.x,this.m_perp),d.Multiply(this.m_motorImpulse+this.m_impulse.z,this.m_axis)))},GetReactionTorque:function(a){return a*this.m_impulse.y},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},GetLocalAxisA:function(){return this.m_localXAxisA},GetReferenceAngle:function(){return this.m_referenceAngle},GetJointTranslation:function(){var a=this.m_bodyA.GetWorldPoint(this.m_localAnchorA),
b=this.m_bodyB.GetWorldPoint(this.m_localAnchorB),a=d.Subtract(b,a),b=this.m_bodyA.GetWorldVector(this.m_localXAxisA);return B(a,b)},GetJointSpeed:function(){var a=this.m_bodyA,b=this.m_bodyB,c=A(a.m_xf.q,d.Subtract(this.m_localAnchorA,a.m_sweep.localCenter)),g=A(b.m_xf.q,d.Subtract(this.m_localAnchorB,b.m_sweep.localCenter)),e=d.Add(a.m_sweep.c,c),f=d.Add(b.m_sweep.c,g),e=d.Subtract(f,e),f=A(a.m_xf.q,this.m_localXAxisA),h=a.m_linearVelocity,k=b.m_linearVelocity,a=a.m_angularVelocity,b=b.m_angularVelocity;
return B(e,O(a,f))+B(f,d.Subtract(d.Subtract(d.Add(k,O(b,g)),h),O(a,c)))},IsLimitEnabled:function(){return this.m_enableLimit},EnableLimit:function(a){a!=this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=a,this.m_impulse.z=0)},GetLowerLimit:function(){return this.m_lowerTranslation},GetUpperLimit:function(){return this.m_upperTranslation},SetLimits:function(a,b){if(a!=this.m_lowerTranslation||b!=this.m_upperTranslation)this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),
this.m_lowerTranslation=a,this.m_upperTranslation=b,this.m_impulse.z=0},IsMotorEnabled:function(){return this.m_enableMotor},EnableMotor:function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=a},SetMotorSpeed:function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=a},GetMotorSpeed:function(){return this.m_motorSpeed},SetMaxMotorForce:function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=a},GetMaxMotorForce:function(){return this.m_maxMotorForce},
GetMotorForce:function(a){return a*this.m_motorImpulse},InitVelocityConstraints:function(a){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA=this.m_bodyA.m_sweep.localCenter;this.m_localCenterB=this.m_bodyB.m_sweep.localCenter;this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var b=a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,g=a.velocities[this.m_indexA].v.Clone(),
e=a.velocities[this.m_indexA].w,f=a.positions[this.m_indexB].c.Clone(),h=a.positions[this.m_indexB].a,k=a.velocities[this.m_indexB].v.Clone(),m=a.velocities[this.m_indexB].w,l=new D(c),h=new D(h),n=A(l,d.Subtract(this.m_localAnchorA,this.m_localCenterA)),p=A(h,d.Subtract(this.m_localAnchorB,this.m_localCenterB)),q=d.Add(d.Subtract(f,b),d.Subtract(p,n)),b=this.m_invMassA,f=this.m_invMassB,h=this.m_invIA,c=this.m_invIB;this.m_axis=A(l,this.m_localXAxisA);this.m_a1=t(d.Add(q,n),this.m_axis);this.m_a2=
t(p,this.m_axis);this.m_motorMass=b+f+h*this.m_a1*this.m_a1+c*this.m_a2*this.m_a2;0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass);this.m_perp=A(l,this.m_localYAxisA);this.m_s1=t(d.Add(q,n),this.m_perp);this.m_s2=t(p,this.m_perp);var l=b+f+h*this.m_s1*this.m_s1+c*this.m_s2*this.m_s2,n=h*this.m_s1+c*this.m_s2,p=h*this.m_s1*this.m_a1+c*this.m_s2*this.m_a2,r=h+c;0==r&&(r=1);var u=h*this.m_a1+c*this.m_a2,v=b+f+h*this.m_a1*this.m_a1+c*this.m_a2*this.m_a2;this.m_K.ex.Set(l,n,p);this.m_K.ey.Set(n,
r,u);this.m_K.ez.Set(p,u,v);this.m_enableLimit?(q=B(this.m_axis,q),V(this.m_upperTranslation-this.m_lowerTranslation)<2*N?this.m_limitState=s.e_equalLimits:q<=this.m_lowerTranslation?this.m_limitState!=s.e_atLowerLimit&&(this.m_limitState=s.e_atLowerLimit,this.m_impulse.z=0):q>=this.m_upperTranslation?this.m_limitState!=s.e_atUpperLimit&&(this.m_limitState=s.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=s.e_inactiveLimit,this.m_impulse.z=0)):(this.m_limitState=s.e_inactiveLimit,this.m_impulse.z=
0);!1==this.m_enableMotor&&(this.m_motorImpulse=0);a.step.warmStarting?(this.m_impulse.Multiply(a.step.dtRatio),this.m_motorImpulse*=a.step.dtRatio,q=d.Add(d.Multiply(this.m_impulse.x,this.m_perp),d.Multiply(this.m_motorImpulse+this.m_impulse.z,this.m_axis)),l=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,n=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,g.Subtract(d.Multiply(b,q)),e-=h*l,k.Add(d.Multiply(f,
q)),m+=c*n):(this.m_impulse.SetZero(),this.m_motorImpulse=0);a.velocities[this.m_indexA].v.Assign(g);a.velocities[this.m_indexA].w=e;a.velocities[this.m_indexB].v.Assign(k);a.velocities[this.m_indexB].w=m},SolveVelocityConstraints:function(a){var b=a.velocities[this.m_indexA].v.Clone(),c=a.velocities[this.m_indexA].w,g=a.velocities[this.m_indexB].v.Clone(),e=a.velocities[this.m_indexB].w,f=this.m_invMassA,h=this.m_invMassB,k=this.m_invIA,m=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!=s.e_equalLimits){var l=
B(this.m_axis,d.Subtract(g,b))+this.m_a2*e-this.m_a1*c,n=this.m_motorMass*(this.m_motorSpeed-l),p=this.m_motorImpulse,l=a.step.dt*this.m_maxMotorForce;this.m_motorImpulse=X(this.m_motorImpulse+n,-l,l);n=this.m_motorImpulse-p;p=d.Multiply(n,this.m_axis);l=n*this.m_a1;n*=this.m_a2;b.Subtract(d.Multiply(f,p));c-=k*l;g.Add(d.Multiply(h,p));e+=m*n}p=new d;p.x=B(this.m_perp,d.Subtract(g,b))+this.m_s2*e-this.m_s1*c;p.y=e-c;if(this.m_enableLimit&&this.m_limitState!=s.e_inactiveLimit){var n=B(this.m_axis,
d.Subtract(g,b))+this.m_a2*e-this.m_a1*c,l=new L(p.x,p.y,n),n=this.m_impulse.Clone(),q=this.m_K.Solve33(l.Negate());this.m_impulse.Add(q);this.m_limitState==s.e_atLowerLimit?this.m_impulse.z=I(this.m_impulse.z,0):this.m_limitState==s.e_atUpperLimit&&(this.m_impulse.z=S(this.m_impulse.z,0));p=d.Subtract(p.Negate(),d.Multiply(this.m_impulse.z-n.z,new d(this.m_K.ez.x,this.m_K.ez.y)));p=d.Add(this.m_K.Solve22(p),new d(n.x,n.y));this.m_impulse.x=p.x;this.m_impulse.y=p.y;q=L.Subtract(this.m_impulse,n);
p=d.Add(d.Multiply(q.x,this.m_perp),d.Multiply(q.z,this.m_axis));l=q.x*this.m_s1+q.y+q.z*this.m_a1;n=q.x*this.m_s2+q.y+q.z*this.m_a2}else q=this.m_K.Solve22(p.Negate()),this.m_impulse.x+=q.x,this.m_impulse.y+=q.y,p=d.Multiply(q.x,this.m_perp),l=q.x*this.m_s1+q.y,n=q.x*this.m_s2+q.y;b.Subtract(d.Multiply(f,p));c-=k*l;g.Add(d.Multiply(h,p));e+=m*n;a.velocities[this.m_indexA].v.Assign(b);a.velocities[this.m_indexA].w=c;a.velocities[this.m_indexB].v.Assign(g);a.velocities[this.m_indexB].w=e},SolvePositionConstraints:function(a){var b=
a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,g=a.positions[this.m_indexB].c.Clone(),e=a.positions[this.m_indexB].a,f=new D(c),h=new D(e),k=this.m_invMassA,m=this.m_invMassB,l=this.m_invIA,n=this.m_invIB,p=A(f,d.Subtract(this.m_localAnchorA,this.m_localCenterA)),q=A(h,d.Subtract(this.m_localAnchorB,this.m_localCenterB)),r=d.Subtract(d.Subtract(d.Add(g,q),b),p),s=A(f,this.m_localXAxisA),u=t(d.Add(r,p),s),h=t(q,s),f=A(f,this.m_localYAxisA),v=t(d.Add(r,p),f),w=t(q,f),x=new L,y=
new d;y.x=B(f,r);y.y=e-c-this.m_referenceAngle;var p=V(y.x),q=V(y.y),C=!1,E=0;this.m_enableLimit&&(r=B(s,r),V(this.m_upperTranslation-this.m_lowerTranslation)<2*N?(E=X(r,-0.2,0.2),p=I(p,V(r)),C=!0):r<=this.m_lowerTranslation?(E=X(r-this.m_lowerTranslation+N,-0.2,0),p=I(p,this.m_lowerTranslation-r),C=!0):r>=this.m_upperTranslation&&(E=X(r-this.m_upperTranslation-N,0,0.2),p=I(p,r-this.m_upperTranslation),C=!0));if(C){var C=k+m+l*v*v+n*w*w,H=l*v+n*w,x=l*v*u+n*w*h,F=l+n;0==F&&(F=1);var J=l*u+n*h,K=k+
m+l*u*u+n*h*h,r=new ua;r.ex.Set(C,H,x);r.ey.Set(H,F,J);r.ez.Set(x,J,K);x=new L;x.x=y.x;x.y=y.y;x.z=E;x=r.Solve33(x.Negate())}else C=k+m+l*v*v+n*w*w,H=l*v+n*w,F=l+n,0==F&&(F=1),r=new U,r.ex.Set(C,H),r.ey.Set(H,F),y=r.Solve(y.Negate()),x.x=y.x,x.y=y.y,x.z=0;s=d.Add(d.Multiply(x.x,f),d.Multiply(x.z,s));u=x.x*v+x.y+x.z*u;h=x.x*w+x.y+x.z*h;b.Subtract(d.Multiply(k,s));c-=l*u;g.Add(d.Multiply(m,s));e+=n*h;a.positions[this.m_indexA].c.Assign(b);a.positions[this.m_indexA].a=c;a.positions[this.m_indexB].c.Assign(g);
a.positions[this.m_indexB].a=e;return p<=N&&q<=sa},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.localAnchorA=this.m_localAnchorA._serialize();a.localAnchorB=this.m_localAnchorB._serialize();a.localAxisA=this.m_localXAxisA._serialize();a.referenceAngle=this.m_referenceAngle;a.enableLimit=this.m_enableLimit;a.lowerTranslation=this.m_lowerTranslation;a.upperTranslation=this.m_upperTranslation;a.enableMotor=this.m_enableMotor;a.maxMotorForce=this.m_maxMotorForce;a.motorSpeed=
this.m_motorSpeed;return a}};ub._extend(s);ab.prototype={Initialize:function(a,b,c){this.bodyA=a;this.bodyB=b;this.localAnchorA.Assign(this.bodyA.GetLocalPoint(c));this.localAnchorB.Assign(this.bodyB.GetLocalPoint(c))},_deserialize:function(a,b,c){this.parent.prototype._deserialize.call(this,a,b,c);this.localAnchorA._deserialize(a.localAnchorA);this.localAnchorB._deserialize(a.localAnchorB);this.maxForce=a.maxForce;this.maxTorque=a.maxTorque}};ab._extend(ja);vb.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},
GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(a){return d.Multiply(a,this.m_linearImpulse)},GetReactionTorque:function(a){return a*this.m_angularImpulse},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},SetMaxForce:function(a){this.m_maxForce=a},GetMaxForce:function(){return this.m_maxForce},SetMaxTorque:function(a){this.m_maxTorque=a},GetMaxTorque:function(){return this.m_maxTorque},
InitVelocityConstraints:function(a){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var b=a.positions[this.m_indexA].a,c=a.velocities[this.m_indexA].v.Clone(),g=a.velocities[this.m_indexA].w,e=a.positions[this.m_indexB].a,
f=a.velocities[this.m_indexB].v.Clone(),h=a.velocities[this.m_indexB].w,b=new D(b),e=new D(e);this.m_rA=A(b,d.Subtract(this.m_localAnchorA,this.m_localCenterA));this.m_rB=A(e,d.Subtract(this.m_localAnchorB,this.m_localCenterB));var e=this.m_invMassA,b=this.m_invMassB,k=this.m_invIA,m=this.m_invIB,l=new U;l.ex.x=e+b+k*this.m_rA.y*this.m_rA.y+m*this.m_rB.y*this.m_rB.y;l.ex.y=-k*this.m_rA.x*this.m_rA.y-m*this.m_rB.x*this.m_rB.y;l.ey.x=l.ex.y;l.ey.y=e+b+k*this.m_rA.x*this.m_rA.x+m*this.m_rB.x*this.m_rB.x;
this.m_linearMass=l.GetInverse();this.m_angularMass=k+m;0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass);a.step.warmStarting?(this.m_linearImpulse.Multiply(a.step.dtRatio),this.m_angularImpulse*=a.step.dtRatio,l=new d(this.m_linearImpulse.x,this.m_linearImpulse.y),c.Subtract(d.Multiply(e,l)),g-=k*(t(this.m_rA,l)+this.m_angularImpulse),f.Add(d.Multiply(b,l)),h+=m*(t(this.m_rB,l)+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0);a.velocities[this.m_indexA].v.Assign(c);
a.velocities[this.m_indexA].w=g;a.velocities[this.m_indexB].v.Assign(f);a.velocities[this.m_indexB].w=h},SolveVelocityConstraints:function(a){var b=a.velocities[this.m_indexA].v.Clone(),c=a.velocities[this.m_indexA].w,g=a.velocities[this.m_indexB].v.Clone(),e=a.velocities[this.m_indexB].w,f=this.m_invMassA,h=this.m_invMassB,k=this.m_invIA,m=this.m_invIB,l=a.step.dt,n;n=-this.m_angularMass*(e-c);var p=this.m_angularImpulse,q=l*this.m_maxTorque;this.m_angularImpulse=X(this.m_angularImpulse+n,-q,q);
n=this.m_angularImpulse-p;c-=k*n;e+=m*n;n=d.Add(g,d.Subtract(O(e,this.m_rB),d.Subtract(b,O(c,this.m_rA))));n=Da(this.m_linearMass,n).Negate();p=this.m_linearImpulse.Clone();this.m_linearImpulse.Add(n);q=l*this.m_maxForce;this.m_linearImpulse.LengthSquared()>q*q&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(q));n=d.Subtract(this.m_linearImpulse,p);b.Subtract(d.Multiply(f,n));c-=k*t(this.m_rA,n);g.Add(d.Multiply(h,n));e+=m*t(this.m_rB,n);a.velocities[this.m_indexA].v.Assign(b);a.velocities[this.m_indexA].w=
c;a.velocities[this.m_indexB].v.Assign(g);a.velocities[this.m_indexB].w=e},SolvePositionConstraints:function(a){return!0},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.localAnchorA=this.m_localAnchorA._serialize();a.localAnchorB=this.m_localAnchorB._serialize();a.maxForce=this.m_maxForce;a.maxTorque=this.m_maxTorque;return a}};vb._extend(s);bb.prototype={Initialize:function(a,b,c){this.bodyA=a;this.bodyB=b;this.localAnchorA.Assign(this.bodyA.GetLocalPoint(c));this.localAnchorB.Assign(this.bodyB.GetLocalPoint(c));
this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},_deserialize:function(a,b,c){this.parent.prototype._deserialize.call(this,a,b,c);this.localAnchorA._deserialize(a.localAnchorA);this.localAnchorB._deserialize(a.localAnchorB);this.referenceAngle=a.referenceAngle;this.frequencyHz=a.frequencyHz;this.dampingRatio=a.dampingRatio}};bb._extend(ja);wb.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},
GetReactionForce:function(a){var b=new d(this.m_impulse.x,this.m_impulse.y);return d.Multiply(a,b)},GetReactionTorque:function(a){return a*this.m_impulse.z},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},GetReferenceAngle:function(){return this.m_referenceAngle},SetFrequency:function(a){this.m_frequencyHz=a},GetFrequency:function(){return this.m_frequencyHz},SetDampingRatio:function(a){this.m_dampingRatio=a},GetDampingRatio:function(){return this.m_dampingRatio},
InitVelocityConstraints:function(a){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var b=a.positions[this.m_indexA].a,c=a.velocities[this.m_indexA].v.Clone(),g=a.velocities[this.m_indexA].w,e=a.positions[this.m_indexB].a,
f=a.velocities[this.m_indexB].v.Clone(),h=a.velocities[this.m_indexB].w,k=new D(b),m=new D(e);this.m_rA.Assign(A(k,d.Subtract(this.m_localAnchorA,this.m_localCenterA)));this.m_rB.Assign(A(m,d.Subtract(this.m_localAnchorB,this.m_localCenterB)));var k=this.m_invMassA,m=this.m_invMassB,l=this.m_invIA,n=this.m_invIB,p=new ua;p.ex.x=k+m+this.m_rA.y*this.m_rA.y*l+this.m_rB.y*this.m_rB.y*n;p.ey.x=-this.m_rA.y*this.m_rA.x*l-this.m_rB.y*this.m_rB.x*n;p.ez.x=-this.m_rA.y*l-this.m_rB.y*n;p.ex.y=p.ey.x;p.ey.y=
k+m+this.m_rA.x*this.m_rA.x*l+this.m_rB.x*this.m_rB.x*n;p.ez.y=this.m_rA.x*l+this.m_rB.x*n;p.ex.z=p.ez.x;p.ey.z=p.ez.y;p.ez.z=l+n;if(0<this.m_frequencyHz){p.GetInverse22(this.m_mass);var p=l+n,q=0<p?1/p:0,b=e-b-this.m_referenceAngle,e=2*ea*this.m_frequencyHz,r=q*e*e,s=a.step.dt;this.m_gamma=s*(2*q*this.m_dampingRatio*e+s*r);this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0;this.m_bias=b*s*r*this.m_gamma;p+=this.m_gamma;this.m_mass.ez.z=0!=p?1/p:0}else 0==p.ez.z?p.GetInverse22(this.m_mass):p.GetSymInverse33(this.m_mass),
this.m_bias=this.m_gamma=0;a.step.warmStarting?(this.m_impulse.Multiply(a.step.dtRatio),p=new d(this.m_impulse.x,this.m_impulse.y),c.Subtract(d.Multiply(k,p)),g-=l*(t(this.m_rA,p)+this.m_impulse.z),f.Add(d.Multiply(m,p)),h+=n*(t(this.m_rB,p)+this.m_impulse.z)):this.m_impulse.SetZero();a.velocities[this.m_indexA].v.Assign(c);a.velocities[this.m_indexA].w=g;a.velocities[this.m_indexB].v.Assign(f);a.velocities[this.m_indexB].w=h},SolveVelocityConstraints:function(a){var b=a.velocities[this.m_indexA].v.Clone(),
c=a.velocities[this.m_indexA].w,g=a.velocities[this.m_indexB].v.Clone(),e=a.velocities[this.m_indexB].w,f=this.m_invMassA,h=this.m_invMassB,k=this.m_invIA,m=this.m_invIB;if(0<this.m_frequencyHz){var l=-this.m_mass.ez.z*(e-c+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=l;c-=k*l;e+=m*l;l=d.Subtract(d.Subtract(d.Add(g,O(e,this.m_rB)),b),O(c,this.m_rA));l=dc(this.m_mass,l).Negate();this.m_impulse.x+=l.x;this.m_impulse.y+=l.y;l=l.Clone();b.Subtract(d.Multiply(f,l));c-=k*t(this.m_rA,l);
g.Add(d.Multiply(h,l));e+=m*t(this.m_rB,l)}else{var l=d.Subtract(d.Subtract(d.Add(g,O(e,this.m_rB)),b),O(c,this.m_rA)),l=new L(l.x,l.y,e-c),n=cc(this.m_mass,l).Negate();this.m_impulse.Add(n);l=new d(n.x,n.y);b.Subtract(d.Multiply(f,l));c-=k*(t(this.m_rA,l)+n.z);g.Add(d.Multiply(h,l));e+=m*(t(this.m_rB,l)+n.z)}a.velocities[this.m_indexA].v.Assign(b);a.velocities[this.m_indexA].w=c;a.velocities[this.m_indexB].v.Assign(g);a.velocities[this.m_indexB].w=e},SolvePositionConstraints:function(a){var b=a.positions[this.m_indexA].c.Clone(),
c=a.positions[this.m_indexA].a,g=a.positions[this.m_indexB].c.Clone(),e=a.positions[this.m_indexB].a,f=new D(c),h=new D(e),k=this.m_invMassA,m=this.m_invMassB,l=this.m_invIA,n=this.m_invIB,f=A(f,d.Subtract(this.m_localAnchorA,this.m_localCenterA)),h=A(h,d.Subtract(this.m_localAnchorB,this.m_localCenterB)),p,q,r=new ua;r.ex.x=k+m+f.y*f.y*l+h.y*h.y*n;r.ey.x=-f.y*f.x*l-h.y*h.x*n;r.ez.x=-f.y*l-h.y*n;r.ex.y=r.ey.x;r.ey.y=k+m+f.x*f.x*l+h.x*h.x*n;r.ez.y=f.x*l+h.x*n;r.ex.z=r.ez.x;r.ey.z=r.ez.y;r.ez.z=l+n;
if(0<this.m_frequencyHz){var s=d.Subtract(d.Subtract(d.Add(g,h),b),f);p=s.Length();q=0;r=r.Solve22(s).Negate();b.Subtract(d.Multiply(k,r));c-=l*t(f,r);g.Add(d.Multiply(m,r));e+=n*t(h,r)}else{var s=d.Subtract(d.Subtract(d.Add(g,h),b),f),u=e-c-this.m_referenceAngle;p=s.Length();q=V(u);u=new L(s.x,s.y,u);0<r.ez.z?s=r.Solve33(u).Invert():(r=r.Solve22(s).Invert(),s=new L(r.x,r.y,0));r=new d(s.x,s.y);b.Subtract(d.Multiply(k,r));c-=l*(t(f,r)+s.z);g.Add(d.Multiply(m,r));e+=n*(t(h,r)+s.z)}a.positions[this.m_indexA].c.Assign(b);
a.positions[this.m_indexA].a=c;a.positions[this.m_indexB].c.Assign(g);a.positions[this.m_indexB].a=e;return p<=N&&q<=sa},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.localAnchorA=this.m_localAnchorA._serialize();a.localAnchorB=this.m_localAnchorB._serialize();a.referenceAngle=this.m_referenceAngle;a.frequencyHz=this.m_frequencyHz;a.dampingRatio=this.m_dampingRatio;return a}};wb._extend(s);cb.prototype={Initialize:function(a,b,c,d){this.bodyA=a;this.bodyB=b;this.localAnchorA.Assign(this.bodyA.GetLocalPoint(c));
this.localAnchorB.Assign(this.bodyB.GetLocalPoint(c));this.localAxisA.Assign(this.bodyA.GetLocalVector(d))},_deserialize:function(a,b,c){this.parent.prototype._deserialize.call(this,a,b,c);this.localAnchorA._deserialize(a.localAnchorA);this.localAnchorB._deserialize(a.localAnchorB);this.localAxisA._deserialize(a.localAxisA);this.enableMotor=a.enableMotor;this.maxMotorTorque=a.maxMotorTorque;this.motorSpeed=a.motorSpeed;this.frequencyHz=a.frequencyHz;this.dampingRatio=a.dampingRatio}};cb._extend(ja);
xb.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(a){return d.Multiply(a,d.Add(d.Multiply(this.m_impulse,this.m_ay),d.Multiply(this.m_springImpulse,this.m_ax)))},GetReactionTorque:function(a){return a*this.m_motorImpulse},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},GetLocalAxisA:function(){return this.m_localXAxisA},
GetJointTranslation:function(){var a=this.m_bodyA,b=this.m_bodyB,c=a.GetWorldPoint(this.m_localAnchorA),b=b.GetWorldPoint(this.m_localAnchorB),c=d.Subtract(b,c),a=a.GetWorldVector(this.m_localXAxisA);return B(c,a)},GetJointSpeed:function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},IsMotorEnabled:function(){return this.m_enableMotor},EnableMotor:function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=a},SetMotorSpeed:function(a){this.m_bodyA.SetAwake(!0);
this.m_bodyB.SetAwake(!0);this.m_motorSpeed=a},GetMotorSpeed:function(){return this.m_motorSpeed},SetMaxMotorTorque:function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorTorque=a},GetMaxMotorTorque:function(){return this.m_maxMotorTorque},GetMotorTorque:function(a){return a*this.m_motorImpulse},SetSpringFrequencyHz:function(a){this.m_frequencyHz=a},GetSpringFrequencyHz:function(){return this.m_frequencyHz},SetSpringDampingRatio:function(a){this.m_dampingRatio=a},GetSpringDampingRatio:function(){return this.m_dampingRatio},
InitVelocityConstraints:function(a){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var b=this.m_invMassA,c=this.m_invMassB,g=this.m_invIA,e=this.m_invIB,f=a.positions[this.m_indexA].c.Clone(),h=a.positions[this.m_indexA].a,
k=a.velocities[this.m_indexA].v.Clone(),m=a.velocities[this.m_indexA].w,l=a.positions[this.m_indexB].c.Clone(),n=a.positions[this.m_indexB].a,p=a.velocities[this.m_indexB].v.Clone(),q=a.velocities[this.m_indexB].w,h=new D(h),r=new D(n),n=A(h,d.Subtract(this.m_localAnchorA,this.m_localCenterA)),r=A(r,d.Subtract(this.m_localAnchorB,this.m_localCenterB)),f=d.Subtract(d.Subtract(d.Add(l,r),f),n);this.m_ay.Assign(A(h,this.m_localYAxisA));this.m_sAy=t(d.Add(f,n),this.m_ay);this.m_sBy=t(r,this.m_ay);this.m_mass=
b+c+g*this.m_sAy*this.m_sAy+e*this.m_sBy*this.m_sBy;0<this.m_mass&&(this.m_mass=1/this.m_mass);this.m_gamma=this.m_bias=this.m_springMass=0;0<this.m_frequencyHz?(this.m_ax.Assign(A(h,this.m_localXAxisA)),this.m_sAx=t(d.Add(f,n),this.m_ax),this.m_sBx=t(r,this.m_ax),b=b+c+g*this.m_sAx*this.m_sAx+e*this.m_sBx*this.m_sBx,0<b&&(this.m_springMass=1/b,c=B(f,this.m_ax),l=2*ea*this.m_frequencyHz,f=2*this.m_springMass*this.m_dampingRatio*l,l*=this.m_springMass*l,h=a.step.dt,this.m_gamma=h*(f+h*l),0<this.m_gamma&&
(this.m_gamma=1/this.m_gamma),this.m_bias=c*h*l*this.m_gamma,this.m_springMass=b+this.m_gamma,0<this.m_springMass&&(this.m_springMass=1/this.m_springMass))):this.m_springImpulse=0;this.m_enableMotor?(this.m_motorMass=g+e,0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass)):this.m_motorImpulse=this.m_motorMass=0;a.step.warmStarting?(this.m_impulse*=a.step.dtRatio,this.m_springImpulse*=a.step.dtRatio,this.m_motorImpulse*=a.step.dtRatio,g=d.Add(d.Multiply(this.m_impulse,this.m_ay),d.Multiply(this.m_springImpulse,
this.m_ax)),e=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,b=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse,k.Subtract(d.Multiply(this.m_invMassA,g)),m-=this.m_invIA*e,p.Add(d.Multiply(this.m_invMassB,g)),q+=this.m_invIB*b):this.m_motorImpulse=this.m_springImpulse=this.m_impulse=0;a.velocities[this.m_indexA].v.Assign(k);a.velocities[this.m_indexA].w=m;a.velocities[this.m_indexB].v.Assign(p);a.velocities[this.m_indexB].w=q},SolveVelocityConstraints:function(a){var b=
this.m_invMassA,c=this.m_invMassB,g=this.m_invIA,e=this.m_invIB,f=a.velocities[this.m_indexA].v.Clone(),h=a.velocities[this.m_indexA].w,k=a.velocities[this.m_indexB].v.Clone(),m=a.velocities[this.m_indexB].w,l=B(this.m_ax,d.Subtract(k,f))+this.m_sBx*m-this.m_sAx*h,l=-this.m_springMass*(l+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=l;var n=d.Multiply(l,this.m_ax),p=l*this.m_sAx,l=l*this.m_sBx;f.Subtract(d.Multiply(b,n));h-=g*p;k.Add(d.Multiply(c,n));m+=e*l;l=m-h-this.m_motorSpeed;
l*=-this.m_motorMass;n=this.m_motorImpulse;p=a.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=X(this.m_motorImpulse+l,-p,p);l=this.m_motorImpulse-n;h-=g*l;m+=e*l;l=B(this.m_ay,d.Subtract(k,f))+this.m_sBy*m-this.m_sAy*h;l*=-this.m_mass;this.m_impulse+=l;n=d.Multiply(l,this.m_ay);p=l*this.m_sAy;l*=this.m_sBy;f.Subtract(d.Multiply(b,n));h-=g*p;k.Add(d.Multiply(c,n));m+=e*l;a.velocities[this.m_indexA].v.Assign(f);a.velocities[this.m_indexA].w=h;a.velocities[this.m_indexB].v.Assign(k);a.velocities[this.m_indexB].w=
m},SolvePositionConstraints:function(a){var b=a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,g=a.positions[this.m_indexB].c.Clone(),e=a.positions[this.m_indexB].a,f=new D(c),h=new D(e),k=A(f,d.Subtract(this.m_localAnchorA,this.m_localCenterA)),h=A(h,d.Subtract(this.m_localAnchorB,this.m_localCenterB)),m=d.Add(d.Subtract(g,b),d.Subtract(h,k)),f=A(f,this.m_localYAxisA),k=t(d.Add(m,k),f),h=t(h,f),m=B(m,f),l=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*
this.m_sBy*this.m_sBy,l=0!=l?-m/l:0,f=d.Multiply(l,f),k=l*k,h=l*h;b.Subtract(d.Multiply(this.m_invMassA,f));c-=this.m_invIA*k;g.Add(d.Multiply(this.m_invMassB,f));e+=this.m_invIB*h;a.positions[this.m_indexA].c.Assign(b);a.positions[this.m_indexA].a=c;a.positions[this.m_indexB].c.Assign(g);a.positions[this.m_indexB].a=e;return V(m)<=N},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.localAnchorA=this.m_localAnchorA._serialize();a.localAnchorB=this.m_localAnchorB._serialize();
a.localAxisA=this.m_localAxisA._serialize();a.enableMotor=this.m_enableMotor;a.maxMotorTorque=this.m_maxMotorTorque;a.motorSpeed=this.m_motorSpeed;a.frequencyHz=this.m_frequencyHz;a.dampingRatio=this.m_dampingRatio;return a}};xb._extend(s);yb.prototype={_deserialize:function(a,b,c){this.parent.prototype._deserialize.call(this,a,b,c);this.joint1=a.joint1;this.joint2=a.joint2;this.ratio=a.ratio}};yb._extend(ja);zb.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},
GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(a){var b=d.Multiply(this.m_impulse,this.m_JvAC);return d.Multiply(a,b)},GetReactionTorque:function(a){return a*this.m_impulse*this.m_JwA},GetJoint1:function(){return this.m_joint1},GetJoint2:function(){return this.m_joint2},SetRatio:function(a){this.m_ratio=a},GetRatio:function(){return this.m_ratio},InitVelocityConstraints:function(a){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;
this.m_indexC=this.m_bodyC.m_islandIndex;this.m_indexD=this.m_bodyD.m_islandIndex;this.m_lcA.Assign(this.m_bodyA.m_sweep.localCenter);this.m_lcB.Assign(this.m_bodyB.m_sweep.localCenter);this.m_lcC.Assign(this.m_bodyC.m_sweep.localCenter);this.m_lcD.Assign(this.m_bodyD.m_sweep.localCenter);this.m_mA=this.m_bodyA.m_invMass;this.m_mB=this.m_bodyB.m_invMass;this.m_mC=this.m_bodyC.m_invMass;this.m_mD=this.m_bodyD.m_invMass;this.m_iA=this.m_bodyA.m_invI;this.m_iB=this.m_bodyB.m_invI;this.m_iC=this.m_bodyC.m_invI;
this.m_iD=this.m_bodyD.m_invI;var b=a.positions[this.m_indexA].a,c=a.velocities[this.m_indexA].v.Clone(),g=a.velocities[this.m_indexA].w,e=a.positions[this.m_indexB].a,f=a.velocities[this.m_indexB].v.Clone(),h=a.velocities[this.m_indexB].w,k=a.positions[this.m_indexC].a,m=a.velocities[this.m_indexC].v.Clone(),l=a.velocities[this.m_indexC].w,n=a.positions[this.m_indexD].a,p=a.velocities[this.m_indexD].v.Clone(),q=a.velocities[this.m_indexD].w,b=new D(b),e=new D(e),r=new D(k),k=new D(n);this.m_mass=
0;this.m_typeA==s.e_revoluteJoint?(this.m_JvAC.SetZero(),this.m_JwC=this.m_JwA=1,this.m_mass+=this.m_iA+this.m_iC):(n=A(r,this.m_localAxisC),r=A(r,d.Subtract(this.m_localAnchorC,this.m_lcC)),b=A(b,d.Subtract(this.m_localAnchorA,this.m_lcA)),this.m_JvAC.Assign(n),this.m_JwC=t(r,n),this.m_JwA=t(b,n),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA);this.m_typeB==s.e_revoluteJoint?(this.m_JvBD.SetZero(),this.m_JwD=this.m_JwB=this.m_ratio,this.m_mass+=this.m_ratio*
this.m_ratio*(this.m_iB+this.m_iD)):(n=A(k,this.m_localAxisD),b=A(k,d.Subtract(this.m_localAnchorD,this.m_lcD)),e=A(e,d.Subtract(this.m_localAnchorB,this.m_lcB)),this.m_JvBD.Assign(d.Multiply(this.m_ratio,n)),this.m_JwD=this.m_ratio*t(b,n),this.m_JwB=this.m_ratio*t(e,n),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB);this.m_mass=0<this.m_mass?1/this.m_mass:0;a.step.warmStarting?(c.Add(d.Multiply(this.m_mA*this.m_impulse,
this.m_JvAC)),g+=this.m_iA*this.m_impulse*this.m_JwA,f.Add(d.Multiply(this.m_mB*this.m_impulse,this.m_JvBD)),h+=this.m_iB*this.m_impulse*this.m_JwB,m.Subtract(d.Multiply(this.m_mC*this.m_impulse,this.m_JvAC)),l-=this.m_iC*this.m_impulse*this.m_JwC,p.Subtract(d.Multiply(this.m_mD*this.m_impulse,this.m_JvBD)),q-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0;a.velocities[this.m_indexA].v.Assign(c);a.velocities[this.m_indexA].w=g;a.velocities[this.m_indexB].v.Assign(f);a.velocities[this.m_indexB].w=
h;a.velocities[this.m_indexC].v.Assign(m);a.velocities[this.m_indexC].w=l;a.velocities[this.m_indexD].v.Assign(p);a.velocities[this.m_indexD].w=q},SolveVelocityConstraints:function(a){var b=a.velocities[this.m_indexA].v.Clone(),c=a.velocities[this.m_indexA].w,g=a.velocities[this.m_indexB].v.Clone(),e=a.velocities[this.m_indexB].w,f=a.velocities[this.m_indexC].v.Clone(),h=a.velocities[this.m_indexC].w,k=a.velocities[this.m_indexD].v.Clone(),m=a.velocities[this.m_indexD].w,l=B(this.m_JvAC,d.Subtract(b,
f))+B(this.m_JvBD,d.Subtract(g,k)),l=l+(this.m_JwA*c-this.m_JwC*h+(this.m_JwB*e-this.m_JwD*m)),l=-this.m_mass*l;this.m_impulse+=l;b.Add(d.Multiply(this.m_mA*l,this.m_JvAC));c+=this.m_iA*l*this.m_JwA;g.Add(d.Multiply(this.m_mB*l,this.m_JvBD));e+=this.m_iB*l*this.m_JwB;f.Subtract(d.Multiply(this.m_mC*l,this.m_JvAC));h-=this.m_iC*l*this.m_JwC;k.Subtract(d.Multiply(this.m_mD*l,this.m_JvBD));m-=this.m_iD*l*this.m_JwD;a.velocities[this.m_indexA].v.Assign(b);a.velocities[this.m_indexA].w=c;a.velocities[this.m_indexB].v.Assign(g);
a.velocities[this.m_indexB].w=e;a.velocities[this.m_indexC].v.Assign(f);a.velocities[this.m_indexC].w=h;a.velocities[this.m_indexD].v.Assign(k);a.velocities[this.m_indexD].w=m},SolvePositionConstraints:function(a){var b=a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,g=a.positions[this.m_indexB].c.Clone(),e=a.positions[this.m_indexB].a,f=a.positions[this.m_indexC].c.Clone(),h=a.positions[this.m_indexC].a,k=a.positions[this.m_indexD].c.Clone(),m=a.positions[this.m_indexD].a,l=new D(c),
n=new D(e),p=new D(h),q=new D(m),r=new d,u=new d,v,w,y=0;if(this.m_typeA==s.e_revoluteJoint)r.SetZero(),l=v=1,y+=this.m_iA+this.m_iC,p=c-h-this.m_referenceAngleA;else{w=A(p,this.m_localAxisC);v=A(p,d.Subtract(this.m_localAnchorC,this.m_lcC));var x=A(l,d.Subtract(this.m_localAnchorA,this.m_lcA));r.Assign(w);l=t(v,w);v=t(x,w);y+=this.m_mC+this.m_mA+this.m_iC*l*l+this.m_iA*v*v;w=d.Subtract(this.m_localAnchorC,this.m_lcC);p=na(p,d.Add(x,d.Subtract(b,f)));p=B(d.Subtract(p,w),this.m_localAxisC)}if(this.m_typeB==
s.e_revoluteJoint)u.SetZero(),n=w=this.m_ratio,y+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),q=e-m-this.m_referenceAngleB;else{w=A(q,this.m_localAxisD);var z=A(q,d.Subtract(this.m_localAnchorD,this.m_lcD)),x=A(n,d.Subtract(this.m_localAnchorB,this.m_lcB));u.Assign(d.Multiply(this.m_ratio,w));n=this.m_ratio*t(z,w);w=this.m_ratio*t(x,w);y+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*n*n+this.m_iB*w*w;z=d.Subtract(this.m_localAnchorD,this.m_lcD);q=na(q,d.Add(x,d.Subtract(g,k)));q=
B(d.Subtract(q,z),this.m_localAxisD)}q=p+this.m_ratio*q-this.m_constant;p=0;0<y&&(p=-q/y);b.Add(d.Multiply(this.m_mA,d.Multiply(p,r)));c+=this.m_iA*p*v;g.Add(d.Multiply(this.m_mB,d.Multiply(p,u)));e+=this.m_iB*p*w;f.Subtract(d.Multiply(this.m_mC,d.Multiply(p,r)));h-=this.m_iC*p*l;k.Subtract(d.Multiply(this.m_mD,d.Multiply(p,u)));m-=this.m_iD*p*n;a.positions[this.m_indexA].c.Assign(b);a.positions[this.m_indexA].a=c;a.positions[this.m_indexB].c.Assign(g);a.positions[this.m_indexB].a=e;a.positions[this.m_indexC].c.Assign(f);
a.positions[this.m_indexC].a=h;a.positions[this.m_indexD].c.Assign(k);a.positions[this.m_indexD].a=m;return 0<N},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.joint1=this.m_joint1.__temp_joint_id;a.joint2=this.m_joint2.__temp_joint_id;a.ratio=this.m_ratio;return a}};zb._extend(s);db.prototype={Initialize:function(a,b){this.bodyA=a;this.bodyB=b;var c=this.bodyB.GetPosition();this.linearOffset.Assign(this.bodyA.GetLocalPoint(c));c=this.bodyA.GetAngle();this.angularOffset=
this.bodyB.GetAngle()-c},_deserialize:function(a,b,c){this.parent.prototype._deserialize.call(this,a,b,c);this.linearOffset._deserialize(a.linearOffset);this.angularOffset=a.angularOffset;this.maxForce=a.maxForce;this.maxTorque=a.maxTorque;this.correctionFactor=a.correctionFactor}};db._extend(ja);Ab.prototype={GetAnchorA:function(){return this.m_bodyA.GetPosition()},GetAnchorB:function(){return this.m_bodyB.GetPosition()},GetReactionForce:function(a){return d.Multiply(a,this.m_linearImpulse)},GetReactionTorque:function(a){return a*
this.m_angularImpulse},SetLinearOffset:function(a){if(a.x!=this.m_linearOffset.x||a.y!=this.m_linearOffset.y)this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Assign(a)},GetLinearOffset:function(){return this.m_linearOffset},SetAngularOffset:function(a){a!=this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=a)},GetAngularOffset:function(){return this.m_angularOffset},SetMaxForce:function(a){this.m_maxForce=a},GetMaxForce:function(){return this.m_maxForce},
SetMaxTorque:function(a){this.m_maxTorque=a},GetMaxTorque:function(){return this.m_maxTorque},SetCorrectionFactor:function(a){this.m_correctionFactor=a},GetCorrectionFactor:function(){return this.m_correctionFactor},InitVelocityConstraints:function(a){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=
this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var b=a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,g=a.velocities[this.m_indexA].v.Clone(),e=a.velocities[this.m_indexA].w,f=a.positions[this.m_indexB].c.Clone(),h=a.positions[this.m_indexB].a,k=a.velocities[this.m_indexB].v.Clone(),m=a.velocities[this.m_indexB].w,l=new D(c),n=new D(h);this.m_rA.Assign(A(l,this.m_localCenterA.Negate()));this.m_rB.Assign(A(n,this.m_localCenterB.Negate()));
var n=this.m_invMassA,p=this.m_invMassB,q=this.m_invIA,r=this.m_invIB,s=new U;s.ex.x=n+p+q*this.m_rA.y*this.m_rA.y+r*this.m_rB.y*this.m_rB.y;s.ex.y=-q*this.m_rA.x*this.m_rA.y-r*this.m_rB.x*this.m_rB.y;s.ey.x=s.ex.y;s.ey.y=n+p+q*this.m_rA.x*this.m_rA.x+r*this.m_rB.x*this.m_rB.x;this.m_linearMass.Assign(s.GetInverse());this.m_angularMass=q+r;0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass);this.m_linearError.x=f.x+this.m_rB.x-b.x-this.m_rA.x-(l.c*this.m_linearOffset.x-l.s*this.m_linearOffset.y);
this.m_linearError.y=f.y+this.m_rB.y-b.y-this.m_rA.y-(l.s*this.m_linearOffset.x+l.c*this.m_linearOffset.y);this.m_angularError=h-c-this.m_angularOffset;a.step.warmStarting?(this.m_linearImpulse.Multiply(a.step.dtRatio),this.m_angularImpulse*=a.step.dtRatio,b=new d(this.m_linearImpulse.x,this.m_linearImpulse.y),g.Subtract(d.Multiply(n,b)),e-=q*(t(this.m_rA,b)+this.m_angularImpulse),k.Add(d.Multiply(p,b)),m+=r*(t(this.m_rB,b)+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=
0);a.velocities[this.m_indexA].v.Assign(g);a.velocities[this.m_indexA].w=e;a.velocities[this.m_indexB].v.Assign(k);a.velocities[this.m_indexB].w=m},SolveVelocityConstraints:function(a){var b=a.velocities[this.m_indexA].v.Clone(),c=a.velocities[this.m_indexA].w,g=a.velocities[this.m_indexB].v.Clone(),e=a.velocities[this.m_indexB].w,f=this.m_invMassA,h=this.m_invMassB,k=this.m_invIA,m=this.m_invIB,l=a.step.dt,n=a.step.inv_dt,p=e-c+n*this.m_correctionFactor*this.m_angularError,p=-this.m_angularMass*
p,q=this.m_angularImpulse,r=l*this.m_maxTorque;this.m_angularImpulse=X(this.m_angularImpulse+p,-r,r);p=this.m_angularImpulse-q;c-=k*p;e+=m*p;p=new d(g.x+-e*this.m_rB.x-b.x- -c*this.m_rA.x+n*this.m_correctionFactor*this.m_linearError.x,g.y+e*this.m_rB.y-b.y-c*this.m_rA.y+n*this.m_correctionFactor*this.m_linearError.y);p=Da(this.m_linearMass,p).Negate();q=this.m_linearImpulse.Clone();this.m_linearImpulse.Add(p);r=l*this.m_maxForce;this.m_linearImpulse.LengthSquared()>r*r&&(this.m_linearImpulse.Normalize(),
this.m_linearImpulse.Multiply(r));p.Assign(d.Subtract(this.m_linearImpulse,q));b.Subtract(d.Multiply(f,p));c-=k*t(this.m_rA,p);g.Add(d.Multiply(h,p));e+=m*t(this.m_rB,p);a.velocities[this.m_indexA].v.Assign(b);a.velocities[this.m_indexA].w=c;a.velocities[this.m_indexB].v.Assign(g);a.velocities[this.m_indexB].w=e},SolvePositionConstraints:function(a){return!0},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.linearOffset=this.m_linearOffset._serialize();a.angularOffset=
this.m_angularOffset;a.maxForce=this.m_maxForce;a.maxTorque=this.m_maxTorque;a.correctionFactor=this.m_correctionFactor;return a}};Ab._extend(s);Bb.prototype={Initialize:function(a,b,c,g,e,f,h){this.bodyA=a;this.bodyB=b;this.groundAnchorA.Assign(c);this.groundAnchorB.Assign(g);this.localAnchorA.Assign(this.bodyA.GetLocalPoint(e));this.localAnchorB.Assign(this.bodyB.GetLocalPoint(f));this.lengthA=d.Subtract(e,c).Length();this.lengthB=d.Subtract(f,g).Length();this.ratio=h},_deserialize:function(a,b,
c){this.parent.prototype._deserialize.call(this,a,b,c);this.groundAnchorA._deserialize(a.groundAnchorA);this.groundAnchorB._deserialize(a.groundAnchorB);this.localAnchorA._deserialize(a.localAnchorA);this.localAnchorB._deserialize(a.localAnchorB);this.lengthA=a.lengthA;this.lengthB=a.lengthB;this.ratio=a.ratio}};Bb._extend(ja);Cb.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(a){var b=
d.Multiply(this.m_impulse,this.m_uB);return d.Multiply(a,b)},GetReactionTorque:function(a){return 0},GetGroundAnchorA:function(){return this.m_groundAnchorA},GetGroundAnchorB:function(){return this.m_groundAnchorB},GetLengthA:function(){return this.m_lengthA},GetLengthB:function(){return this.m_lengthB},GetRatio:function(){return this.m_ratio},GetCurrentLengthA:function(){var a=this.m_bodyA.GetWorldPoint(this.m_localAnchorA);return d.Subtract(a,this.m_groundAnchorA).Length()},GetCurrentLengthB:function(){var a=
this.m_bodyB.GetWorldPoint(this.m_localAnchorB);return d.Subtract(a,this.m_groundAnchorB).Length()},ShiftOrigin:function(a){this.m_groundAnchorA.Subtract(a);this.m_groundAnchorB.Subtract(a)},InitVelocityConstraints:function(a){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;
this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var b=a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,g=a.velocities[this.m_indexA].v.Clone(),e=a.velocities[this.m_indexA].w,f=a.positions[this.m_indexB].c.Clone(),h=a.positions[this.m_indexB].a,k=a.velocities[this.m_indexB].v.Clone(),m=a.velocities[this.m_indexB].w,c=new D(c),h=new D(h);this.m_rA.Assign(A(c,d.Subtract(this.m_localAnchorA,this.m_localCenterA)));this.m_rB.Assign(A(h,d.Subtract(this.m_localAnchorB,
this.m_localCenterB)));this.m_uA.Assign(d.Add(b,d.Subtract(this.m_rA,this.m_groundAnchorA)));this.m_uB.Assign(d.Add(f,d.Subtract(this.m_rB,this.m_groundAnchorB)));b=this.m_uA.Length();f=this.m_uB.Length();b>10*N?this.m_uA.Multiply(1/b):this.m_uA.SetZero();f>10*N?this.m_uB.Multiply(1/f):this.m_uB.SetZero();b=t(this.m_rA,this.m_uA);f=t(this.m_rB,this.m_uB);this.m_mass=this.m_invMassA+this.m_invIA*b*b+this.m_ratio*this.m_ratio*(this.m_invMassB+this.m_invIB*f*f);0<this.m_mass&&(this.m_mass=1/this.m_mass);
a.step.warmStarting?(this.m_impulse*=a.step.dtRatio,b=d.Multiply(-this.m_impulse,this.m_uA),f=d.Multiply(-this.m_ratio*this.m_impulse,this.m_uB),g.Add(d.Multiply(this.m_invMassA,b)),e+=this.m_invIA*t(this.m_rA,b),k.Add(d.Multiply(this.m_invMassB,f)),m+=this.m_invIB*t(this.m_rB,f)):this.m_impulse=0;a.velocities[this.m_indexA].v.Assign(g);a.velocities[this.m_indexA].w=e;a.velocities[this.m_indexB].v.Assign(k);a.velocities[this.m_indexB].w=m},SolveVelocityConstraints:function(a){var b=a.velocities[this.m_indexA].v.Clone(),
c=a.velocities[this.m_indexA].w,g=a.velocities[this.m_indexB].v.Clone(),e=a.velocities[this.m_indexB].w,f=d.Add(b,O(c,this.m_rA)),h=d.Add(g,O(e,this.m_rB)),f=-B(this.m_uA,f)-this.m_ratio*B(this.m_uB,h),h=-this.m_mass*f;this.m_impulse+=h;f=d.Multiply(-h,this.m_uA);h=d.Multiply(-this.m_ratio,d.Multiply(h,this.m_uB));b.Add(d.Multiply(this.m_invMassA,f));c+=this.m_invIA*t(this.m_rA,f);g.Add(d.Multiply(this.m_invMassB,h));e+=this.m_invIB*t(this.m_rB,h);a.velocities[this.m_indexA].v.Assign(b);a.velocities[this.m_indexA].w=
c;a.velocities[this.m_indexB].v.Assign(g);a.velocities[this.m_indexB].w=e},SolvePositionConstraints:function(a){var b=a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,g=a.positions[this.m_indexB].c.Clone(),e=a.positions[this.m_indexB].a,f=new D(c),h=new D(e),f=A(f,d.Subtract(this.m_localAnchorA,this.m_localCenterA)),h=A(h,d.Subtract(this.m_localAnchorB,this.m_localCenterB)),k=d.Add(b,d.Subtract(f,this.m_groundAnchorA)),m=d.Add(g,d.Subtract(h,this.m_groundAnchorB)),l=k.Length(),
n=m.Length();l>10*N?k.Multiply(1/l):k.SetZero();n>10*N?m.Multiply(1/n):m.SetZero();var p=t(f,k),q=t(h,m),p=this.m_invMassA+this.m_invIA*p*p+this.m_ratio*this.m_ratio*(this.m_invMassB+this.m_invIB*q*q);0<p&&(p=1/p);n=this.m_constant-l-this.m_ratio*n;l=V(n);n*=-p;k=d.Multiply(-n,k);m=d.Multiply(-this.m_ratio,d.Multiply(n,m));b.Add(d.Multiply(this.m_invMassA,k));c+=this.m_invIA*t(f,k);g.Add(d.Multiply(this.m_invMassB,m));e+=this.m_invIB*t(h,m);a.positions[this.m_indexA].c.Assign(b);a.positions[this.m_indexA].a=
c;a.positions[this.m_indexB].c.Assign(g);a.positions[this.m_indexB].a=e;return l<N},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.groundAnchorA=this.m_groundAnchorA._serialize();a.groundAnchorB=this.m_groundAnchorB._serialize();a.localAnchorA=this.m_localAnchorA._serialize();a.localAnchorB=this.m_localAnchorB._serialize();a.lengthA=this.m_lengthA;a.lengthB=this.m_lengthB;a.ratio=this.m_ratio;return a}};Cb._extend(s);eb.prototype={_deserialize:function(a,b,c){this.parent.prototype._deserialize.call(this,
a,b,c);this.localAnchorA._deserialize(a.localAnchorA);this.localAnchorB._deserialize(a.localAnchorB);this.maxLength=a.maxLength}};eb._extend(ja);Db.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(a){return d.Multiply(a*this.m_impulse,this.m_u)},GetReactionTorque:function(a){return 0},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},
SetMaxLength:function(a){this.m_maxLength=a},GetMaxLength:function(){return this.m_maxLength},GetLimitState:function(){return this.m_state},InitVelocityConstraints:function(a){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=
this.m_bodyB.m_invI;var b=a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,g=a.velocities[this.m_indexA].v.Clone(),e=a.velocities[this.m_indexA].w,f=a.positions[this.m_indexB].c.Clone(),h=a.positions[this.m_indexB].a,k=a.velocities[this.m_indexB].v.Clone(),m=a.velocities[this.m_indexB].w,c=new D(c),h=new D(h);this.m_rA.Assign(A(c,d.Subtract(this.m_localAnchorA,this.m_localCenterA)));this.m_rB.Assign(A(h,d.Subtract(this.m_localAnchorB,this.m_localCenterB)));this.m_u.Assign(d.Subtract(d.Subtract(d.Add(f,
this.m_rB),b),this.m_rA));this.m_length=this.m_u.Length();this.m_state=0<this.m_length-this.m_maxLength?s.e_atUpperLimit:s.e_inactiveLimit;this.m_length>N?(this.m_u.Multiply(1/this.m_length),b=t(this.m_rA,this.m_u),f=t(this.m_rB,this.m_u),b=this.m_invMassA+this.m_invIA*b*b+this.m_invMassB+this.m_invIB*f*f,this.m_mass=0!=b?1/b:0,a.step.warmStarting?(this.m_impulse*=a.step.dtRatio,b=d.Multiply(this.m_impulse,this.m_u),g.Subtract(d.Multiply(this.m_invMassA,b)),e-=this.m_invIA*t(this.m_rA,b),k.Add(d.Multiply(this.m_invMassB,
b)),m+=this.m_invIB*t(this.m_rB,b)):this.m_impulse=0,a.velocities[this.m_indexA].v.Assign(g),a.velocities[this.m_indexA].w=e,a.velocities[this.m_indexB].v.Assign(k),a.velocities[this.m_indexB].w=m):(this.m_u.SetZero(),this.m_impulse=this.m_mass=0)},SolveVelocityConstraints:function(a){var b=a.velocities[this.m_indexA].v.Clone(),c=a.velocities[this.m_indexA].w,g=a.velocities[this.m_indexB].v.Clone(),e=a.velocities[this.m_indexB].w,f=d.Add(b,O(c,this.m_rA)),h=d.Add(g,O(e,this.m_rB)),k=this.m_length-
this.m_maxLength,f=B(this.m_u,d.Subtract(h,f));0>k&&(f+=a.step.inv_dt*k);k=-this.m_mass*f;f=this.m_impulse;this.m_impulse=S(0,this.m_impulse+k);k=this.m_impulse-f;k=d.Multiply(k,this.m_u);b.Subtract(d.Multiply(this.m_invMassA,k));c-=this.m_invIA*t(this.m_rA,k);g.Add(d.Multiply(this.m_invMassB,k));e+=this.m_invIB*t(this.m_rB,k);a.velocities[this.m_indexA].v.Assign(b);a.velocities[this.m_indexA].w=c;a.velocities[this.m_indexB].v.Assign(g);a.velocities[this.m_indexB].w=e},SolvePositionConstraints:function(a){var b=
a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,g=a.positions[this.m_indexB].c.Clone(),e=a.positions[this.m_indexB].a,f=new D(c),h=new D(e),f=A(f,d.Subtract(this.m_localAnchorA,this.m_localCenterA)),h=A(h,d.Subtract(this.m_localAnchorB,this.m_localCenterB)),k=d.Subtract(d.Subtract(d.Add(g,h),b),f),m=k.Normalize(),l=m-this.m_maxLength,l=X(l,0,0.2),k=d.Multiply(-this.m_mass*l,k);b.Subtract(d.Multiply(this.m_invMassA,k));c-=this.m_invIA*t(f,k);g.Add(d.Multiply(this.m_invMassB,k));
e+=this.m_invIB*t(h,k);a.positions[this.m_indexA].c.Assign(b);a.positions[this.m_indexA].a=c;a.positions[this.m_indexB].c.Assign(g);a.positions[this.m_indexB].a=e;return m-this.m_maxLength<N},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.localAnchorA=this.m_localAnchorA._serialize();a.localAnchorB=this.m_localAnchorB._serialize();a.maxLength=this.m_maxLength;return a}};Db._extend(s);var Wc=Math.exp;Hc.prototype={Initialize:function(a){this.m_count=a.count;this.m_ps=
Array(this.m_count);this.m_p0s=Array(this.m_count);this.m_vs=Array(this.m_count);this.m_ims=Array(this.m_count);for(var b=0;b<this.m_count;++b){this.m_ps[b]=a.vertices[b].Clone();this.m_p0s[b]=a.vertices[b].Clone();this.m_vs[b]=new d;var c=a.masses[b];this.m_ims[b]=0<c?1/c:0}var g=this.m_count-1,c=this.m_count-2;this.m_Ls=Array(g);this.m_as=Array(c);for(b=0;b<g;++b){var e=this.m_ps[b],f=this.m_ps[b+1];this.m_Ls[b]=hb(e,f)}for(b=0;b<c;++b)e=this.m_ps[b],f=this.m_ps[b+1],g=this.m_ps[b+2],e=d.Subtract(f,
e),g=d.Subtract(g,f),f=t(e,g),e=B(e,g),this.m_as[b]=Yb(f,e);this.m_gravity=a.gravity.Clone();this.m_damping=a.damping;this.m_k2=a.k2;this.m_k3=a.k3},Step:function(a,b){if(0!=a){for(var c=Wc(-a*this.m_damping),g=0;g<this.m_count;++g)this.m_p0s[g].Assign(this.m_ps[g]),0<this.m_ims[g]&&this.m_vs[g].Add(d.Multiply(a,this.m_gravity)),this.m_vs[g].Multiply(c),this.m_ps[g].Add(d.Multiply(a,this.m_vs[g]));for(g=0;g<b;++g)this.SolveC2(),this.SolveC3(),this.SolveC2();c=1/a;for(g=0;g<this.m_count;++g)this.m_vs[g]=
d.Multiply(c,d.Subtract(this.m_ps[g],this.m_p0s[g]))}},GetVertexCount:function(){return this.m_count},GetVertices:function(){return this.m_ps},Draw:function(a){for(var b=new ka(0.4,0.5,0.7),c=0;c<this.m_count-1;++c)a.DrawSegment(this.m_ps[c],this.m_ps[c+1],b)},SetAngle:function(a){for(var b=this.m_count-2,c=0;c<b;++c)this.m_as[c]=a},SolveC2:function(){for(var a=this.m_count-1,b=0;b<a;++b){var c=this.m_ps[b],g=this.m_ps[b+1],e=d.Subtract(g,c),f=e.Normalize(),h=this.m_ims[b],k=this.m_ims[b+1];if(0!=
h+k){var m=k/(h+k);c.Subtract(d.Multiply(h/(h+k)*this.m_k2*(this.m_Ls[b]-f),e));g.Add(d.Multiply(this.m_k2*m*(this.m_Ls[b]-f),e))}}},SolveC3:function(){for(var a=this.m_count-2,b=0;b<a;++b){var c=this.m_ps[b],g=this.m_ps[b+1],e=this.m_ps[b+2],f=this.m_ims[b],h=this.m_ims[b+1],k=this.m_ims[b+2],m=d.Subtract(g,c),l=d.Subtract(e,g),n=m.LengthSquared(),p=l.LengthSquared();if(0!=n*p){var q=t(m,l),r=B(m,l),q=Yb(q,r),m=d.Multiply(-1/n,m.Skew()),n=d.Multiply(1/p,l.Skew()),l=d.Negate(m),p=d.Subtract(m,n),
m=n,n=f*B(l,l)+h*B(p,p)+k*B(m,m);if(0!=n){n=1/n;for(r=q-this.m_as[b];r>ea;)q-=2*ea,r=q-this.m_as[b];for(;r<-ea;)q+=2*ea,r=q-this.m_as[b];q=-this.m_k3*n*r;c.Add(d.Multiply(f*q,l));g.Add(d.Multiply(h*q,p));e.Add(d.Multiply(k*q,m))}}}}};var Xc=function(){function a(a){return new d(a?a.x||0:0,a?a.y||0:0)}function b(a){for(var b=Array(a.x.length),c=0;c<b.length;++c)b[c]=new d(a.x[c],a.y[c]);return b}function c(b,c){var d=b.name,e;if("undefined"!==typeof b["int"])e=b["int"];else if("undefined"!==typeof b["float"])e=
b["float"];else if("undefined"!==typeof b.string)e=b.string;else if("undefined"!==typeof b.bool)e=b.bool;else if("undefined"!==typeof b.vec2)e=a(b.vec2);else throw Error("unknown property type");if(c.hasOwnProperty(d))throw Error("custom property possibly overwriting an existing one");c[d]=e}function g(){this.world=null;this.stepsPerSecond=this.velocityIterations=this.positionIterations=0;this.fixtures={};this.bodies={};this.joints={};Object.seal(this)}var e={revolute:Ya,distance:Za,prismatic:$a,
wheel:cb,rope:eb,motor:db,weld:bb,friction:ab};return{parseWorld:function(f,h){var k=new g;k.world=h=h||new K(new d(0,0));k.positionIterations=f.positionIterations||0;k.velocityIterations=f.velocityIterations||0;k.stepsPerSecond=f.stepsPerSecond||0;f.gravity&&h.SetGravity(a(f.gravity));h.SetAllowSleeping(f.allowSleep||!1);h.SetAutoClearForces(f.autoClearForces||!1);h.SetWarmStarting(f.warmStarting||!1);h.SetContinuousPhysics(f.continuousPhysics||!1);h.SetSubStepping(f.subStepping||!1);var m=[],l=
f.body;if(l)for(var n=0;n<l.length;++n){var p;p=l[n];var q=h,r=new nb;r.type=p.type||u.b2_staticBody;r.angle=p.angle||0;r.angularDamping=p.angularDamping||0;r.angularVelocity=p.angularVelocity||0;r.awake=p.awake||!1;r.bullet=p.bullet||!1;r.fixedRotation=p.fixedRotation||!1;r.linearDamping=p.linearDamping||!1;r.linearVelocity=a(p.linearVelocity);r.gravityScale="undefined"!==typeof p.gravityScale?p.gravityScale:1;var v=new hc;v.mass=p["massData-mass"]||0;v.center=a(p["massData-center"]);v.I=p["massData-I"]||
0;r.position=a(p.position);q=q.CreateBody(r);q.name=p.name;q.SetMassData(v);if(p.fixture)for(v=0;v<p.fixture.length;++v){var r=p.fixture[v],t=q,w=new Wa;w.density=r.density||0;w.filter.categoryBits="undefined"===typeof r["filter-categoryBits"]?1:r["filter-categoryBits"];w.filter.maskBits="undefined"===typeof r["filter-maskBits"]?65535:r["filter-maskBits"];w.filter.groupIndex="undefined"===typeof r["filter-groupIndex"]?0:r["filter-groupIndex"];w.friction=r.friction||0;w.restitution=r.restitution||
0;w.isSensor=r.sensor||0;var y=void 0;if("undefined"!==typeof r.circle)y=new Ga,y.m_p=a(r.circle.center),y.m_radius=r.circle.radius||0;else if("undefined"!==typeof r.polygon){var x=b(r.polygon.vertices),y=new va;y.Set(x,x.length)}else if("undefined"!==typeof r.chain){x=b(r.chain.vertices);y=new pa;y.m_count=x.length;y.m_vertices=x;if(y.m_hasNextVertex=r.chain.hasNextVertex)y.m_nextVertex=a(r.chain.nextVertex);if(y.m_hasPrevVertex=r.chain.hasPrevVertex)y.m_prevVertex=a(r.chain.prevVertex)}else throw Error("unknown shape type");
w.shape=y;t=t.CreateFixture(w);t.name=r.name;if(r.customProperties)for(w=0;w<r.customProperties.length;++w)c(r,t)}if(p.customProperties)for(v=0;v<p.customProperties.length;++v)c(p,q);p=q;m.push(p);for(q=p.GetFixtureList();q;q=q.GetNext())k.fixtures[q.name]||(k.fixtures[q.name]=[]),k.fixtures[q.name].push(q);k.bodies[p.name]||(k.bodies[p.name]=[]);k.bodies[p.name].push(p)}l=[];if(p=f.joint)for(n=0;n<p.length;++n){q=p[n];v=h;r=m;if(!e[q.type])throw Error("unknown joint type");t=new e[q.type];switch(t.type){case s.e_revoluteJoint:t.localAnchorA=
a(q.anchorA);t.localAnchorB=a(q.anchorB);t.enableLimit=q.enableLimit||!1;t.enableMotor=q.enableMotor||!1;t.lowerAngle=q.lowerLimit||0;t.maxMotorTorque=q.maxMotorTorque||0;t.motorSpeed=q.motorSpeed||0;t.referenceAngle=q.refAngle||0;t.upperAngle=q.upperLimit||0;break;case s.e_distanceJoint:t.localAnchorA=a(q.anchorA);t.localAnchorB=a(q.anchorB);t.dampingRatio=q.dampingRatio||0;t.frequencyHz=q.frequency||0;t.length=q.length||0;break;case s.e_prismaticJoint:t.localAnchorA=a(q.anchorA);t.localAnchorB=
a(q.anchorB);t.enableLimit=q.enableLimit||!1;t.enableMotor=q.enableMotor||!1;t.localAxisA=a(q.localAxisA);t.lowerTranslation=q.lowerLimit||0;t.maxMotorForce=q.maxMotorForce||0;t.motorSpeed=q.motorSpeed||0;t.referenceAngle=q.refAngle||0;t.upperTranslation=q.upperLimit||0;break;case s.e_wheelJoint:t.localAnchorA=a(q.anchorA);t.localAnchorB=a(q.anchorB);t.enableMotor=q.enableMotor||!1;t.localAxisA=a(q.localAxisA);t.maxMotorTorque=q.maxMotorTorque||0;t.motorSpeed=q.motorSpeed||0;t.dampingRatio=q.springDampingRatio||
0;t.frequencyHz=q.springFrequency||0;break;case s.e_ropeJoint:t.localAnchorA=a(q.anchorA);t.localAnchorB=a(q.anchorB);t.maxLength=q.maxLength||0;break;case s.e_motorJoint:t.linearOffset=a(q.anchorA);t.angularOffset=q.refAngle||0;t.maxForce=q.maxForce||0;t.maxTorque=q.maxTorque||0;t.correctionFactor=q.correctionFactor||0;break;case s.e_weldJoint:t.localAnchorA=a(q.anchorA);t.localAnchorB=a(q.anchorB);t.referenceAngle=q.refAngle||0;t.dampingRatio=q.dampingRatio||0;t.frequencyHz=q.frequencyHz||0;break;
case s.e_frictionJoint:t.localAnchorA=a(q.anchorA);t.localAnchorB=a(q.anchorB);t.maxForce=q.maxForce||0;t.maxTorque=q.maxTorque||0;break;default:throw Error("wat?");}t.bodyA=r[q.bodyA||0];t.bodyB=r[q.bodyB||0];t.collideConnected=q.collideConnected||!1;v=v.CreateJoint(t);v.name=q.name;if(q.customProperties)for(r=0;r<q.customProperties.length;++r)c(q,v);q=v;l.push(q);k.joints[q.name]||(k.joints[q.name]=[]);k.joints[q.name].push(q)}return k}}}(),Pa=[{trimmed:"version",name:"b2_version",def:Sc},{trimmed:"Vec2",
name:"b2Vec2",def:d},{trimmed:"Vec3",name:"b2Vec3",def:L},{trimmed:"Mat22",name:"b2Mat22",def:U},{trimmed:"Mat33",name:"b2Mat33",def:ua},{trimmed:"Rot",name:"b2Rot",def:D},{trimmed:"Transform",name:"b2Transform",def:$},{trimmed:"Sweep",name:"b2Sweep",def:ma},{trimmed:"Dot_v2_v2",name:"b2Dot_v2_v2",def:B},{trimmed:"Cross_v2_v2",name:"b2Cross_v2_v2",def:t},{trimmed:"Cross_v2_f",name:"b2Cross_v2_f",def:bc},{trimmed:"Cross_f_v2",name:"b2Cross_f_v2",def:O},{trimmed:"Mul_m22_v2",name:"b2Mul_m22_v2",def:Da},
{trimmed:"MulT_m22_v2",name:"b2MulT_m22_v2",def:function(a,b){return new d(B(b,a.ex),B(b,a.ey))}},{trimmed:"Distance",name:"b2Distance",def:hb},{trimmed:"DistanceSquared",name:"b2DistanceSquared",def:ib},{trimmed:"Dot_v3_v3",name:"b2Dot_v3_v3",def:Ea},{trimmed:"Cross_v3_v3",name:"b2Cross_v3_v3",def:Fa},{trimmed:"Mul_m22_m22",name:"b2Mul_m22_m22",def:function(a,b){return new U(Da(a,b.ex),Da(a,b.ey))}},{trimmed:"MulT_m22_m22",name:"b2MulT_m22_m22",def:function(a,b){var c=new d(B(a.ex,b.ex),B(a.ey,b.ex)),
g=new d(B(a.ex,b.ey),B(a.ey,b.ey));return new U(c,g)}},{trimmed:"Mul_m33_v3",name:"b2Mul_m33_v3",def:cc},{trimmed:"Mul22_m33_v2",name:"b2Mul22_m33_v2",def:dc},{trimmed:"Mul_r_r",name:"b2Mul_r_r",def:ec},{trimmed:"MulT_r_r",name:"b2MulT_r_r",def:fc},{trimmed:"Mul_r_v2",name:"b2Mul_r_v2",def:A},{trimmed:"MulT_r_v2",name:"b2MulT_r_v2",def:na},{trimmed:"Mul_t_v2",name:"b2Mul_t_v2",def:T},{trimmed:"Min_v2",name:"b2Min_v2",def:jb},{trimmed:"Max_v2",name:"b2Max_v2",def:kb},{trimmed:"Clamp",name:"b2Clamp",
def:X},{trimmed:"MulT_t_v2",name:"b2MulT_t_v2",def:Aa},{trimmed:"Mul_t_t",name:"b2Mul_t_t",def:function(a,b){var c=new $;c.q=ec(a.q,b.q);c.p=d.Add(A(a.q,b.p),a.p);return c}},{trimmed:"MulT_t_t",name:"b2MulT_t_t",def:Fb},{trimmed:"Clamp_v2",name:"b2Clamp_v2",def:function(a,b,c){return kb(b,jb(a,c))}},{trimmed:"NextPowerOfTwo",name:"b2NextPowerOfTwo",def:function(a){a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;return(a|a>>16)+1}},{trimmed:"Abs_v2",name:"b2Abs_v2",def:Qa},{trimmed:"Abs_m22",name:"b2Abs_m22",def:function(a){return new U(Qa(a.ex),
Qa(a.ey))}},{trimmed:"IsPowerOfTwo",name:"b2IsPowerOfTwo",def:function(a){return 0<a&&0==(a&a-1)}},{trimmed:"RandomFloat",name:"b2RandomFloat",def:function(a,b){var c=Math.random();return"undefined"!==typeof a?(b-a)*c+a:2*c-1}},{trimmed:"Timer",name:"b2Timer",def:gc},{trimmed:"Color",name:"b2Color",def:ka},{trimmed:"Draw",name:"b2Draw",def:W},{trimmed:"ContactID",name:"b2ContactID",def:Q},{trimmed:"ManifoldPoint",name:"b2ManifoldPoint",def:ha},{trimmed:"Manifold",name:"b2Manifold",def:F},{trimmed:"WorldManifold",
name:"b2WorldManifold",def:Kb},{trimmed:"GetPointStates",name:"b2GetPointStates",def:function(a,b,c,d){for(var e=0;e<ia;++e)a[e]=F.b2_nullState,b[e]=F.b2_nullState;for(e=0;e<c.pointCount;++e){var f=c.points[e].id;a[e]=F.b2_removeState;for(var h=0;h<d.pointCount;++h)if(d.points[h].id.Get()==f.Get()){a[e]=F.b2_persistState;break}}for(e=0;e<d.pointCount;++e)for(f=d.points[e].id,b[e]=F.b2_addState,h=0;h<c.pointCount;++h)if(c.points[h].id.Get()==f.Get()){b[e]=F.b2_persistState;break}}},{trimmed:"ClipVertex",
name:"b2ClipVertex",def:ya},{trimmed:"RayCastInput",name:"b2RayCastInput",def:Lb},{trimmed:"RayCastOutput",name:"b2RayCastOutput",def:kc},{trimmed:"AABB",name:"b2AABB",def:Z},{trimmed:"CollideCircles",name:"b2CollideCircles",def:lc},{trimmed:"CollidePolygonAndCircle",name:"b2CollidePolygonAndCircle",def:mc},{trimmed:"FindMaxSeparation",name:"b2FindMaxSeparation",def:Mb},{trimmed:"FindIncidentEdge",name:"b2FindIncidentEdge",def:nc},{trimmed:"CollidePolygons",name:"b2CollidePolygons",def:aa},{trimmed:"CollideEdgeAndCircle",
name:"b2CollideEdgeAndCircle",def:Nb},{trimmed:"EPAxis",name:"b2EPAxis",def:Y},{trimmed:"TempPolygon",name:"b2TempPolygon",def:oc},{trimmed:"ReferenceFace",name:"b2ReferenceFace",def:pc},{trimmed:"EPCollider",name:"b2EPCollider",def:J},{trimmed:"CollideEdgeAndPolygon",name:"b2CollideEdgeAndPolygon",def:Ua},{trimmed:"ClipSegmentToLine",name:"b2ClipSegmentToLine",def:Ta},{trimmed:"TestShapeOverlap",name:"b2TestShapeOverlap",def:ba},{trimmed:"TestOverlap",name:"b2TestOverlap",def:lb},{trimmed:"Shape",
name:"b2Shape",def:E},{trimmed:"CircleShape",name:"b2CircleShape",def:Ga},{trimmed:"EdgeShape",name:"b2EdgeShape",def:Ba},{trimmed:"ChainShape",name:"b2ChainShape",def:pa},{trimmed:"PolygonShape",name:"b2PolygonShape",def:va},{trimmed:"Pair",name:"b2Pair",def:ic},{trimmed:"PairLessThan",name:"b2PairLessThan",def:jc},{trimmed:"BroadPhase",name:"b2BroadPhase",def:wa},{trimmed:"DistanceProxy",name:"b2DistanceProxy",def:Ha},{trimmed:"SimplexCache",name:"b2SimplexCache",def:Gb},{trimmed:"DistanceInput",
name:"b2DistanceInput",def:Hb},{trimmed:"DistanceOutput",name:"b2DistanceOutput",def:Ib},{trimmed:"SimplexVertex",name:"b2SimplexVertex",def:Sa},{trimmed:"Simplex",name:"b2Simplex",def:Jb},{trimmed:"DistanceFunc",name:"b2DistanceFunc",def:ra},{trimmed:"TreeNode",name:"b2TreeNode",def:Ia},{trimmed:"DynamicTree",name:"b2DynamicTree",def:xa},{trimmed:"TOIInput",name:"b2TOIInput",def:qc},{trimmed:"TOIOutput",name:"b2TOIOutput",def:ca},{trimmed:"SeparationFunction",name:"b2SeparationFunction",def:da},
{trimmed:"TimeOfImpact",name:"b2TimeOfImpact",def:M},{trimmed:"BodyDef",name:"b2BodyDef",def:nb},{trimmed:"Body",name:"b2Body",def:u},{trimmed:"Filter",name:"b2Filter",def:Va},{trimmed:"FixtureDef",name:"b2FixtureDef",def:Wa},{trimmed:"Fixture",name:"b2Fixture",def:Ob},{trimmed:"DestructionListener",name:"b2DestructionListener",def:rc},{trimmed:"ContactFilter",name:"b2ContactFilter",def:Pb},{trimmed:"ContactImpulse",name:"b2ContactImpulse",def:sc},{trimmed:"ContactListener",name:"b2ContactListener",
def:Qb},{trimmed:"QueryCallback",name:"b2QueryCallback",def:tc},{trimmed:"RayCastCallback",name:"b2RayCastCallback",def:uc},{trimmed:"TimeStep",name:"b2TimeStep",def:Xa},{trimmed:"Position",name:"b2Position",def:vc},{trimmed:"Velocity",name:"b2Velocity",def:wc},{trimmed:"SolverData",name:"b2SolverData",def:xc},{trimmed:"World",name:"b2World",def:K},{trimmed:"MixFriction",name:"b2MixFriction",def:function(a,b){return Oa(a*b)}},{trimmed:"MixRestitution",name:"b2MixRestitution",def:Sb},{trimmed:"ContactRegister",
name:"b2ContactRegister",def:Tb},{trimmed:"ContactEdge",name:"b2ContactEdge",def:ob},{trimmed:"Contact",name:"b2Contact",def:v},{trimmed:"CircleContact",name:"b2CircleContact",def:pb},{trimmed:"PolygonContact",name:"b2PolygonContact",def:Na},{trimmed:"ChainAndCircleContact",name:"b2ChainAndCircleContact",def:qb},{trimmed:"ChainAndPolygonContact",name:"b2ChainAndPolygonContact",def:Ja},{trimmed:"EdgeAndCircleContact",name:"b2EdgeAndCircleContact",def:Ka},{trimmed:"EdgeAndPolygonContact",name:"b2EdgeAndPolygonContact",
def:La},{trimmed:"PolygonAndCircleContact",name:"b2PolygonAndCircleContact",def:Ma},{trimmed:"defaultFilter",name:"b2_defaultFilter",def:Ac},{trimmed:"defaultListener",name:"b2_defaultListener",def:Bc},{trimmed:"ContactManager",name:"b2ContactManager",def:Rb},{trimmed:"VelocityConstraintPoint",name:"b2VelocityConstraintPoint",def:Cc},{trimmed:"ContactPositionConstraint",name:"b2ContactPositionConstraint",def:Dc},{trimmed:"ContactVelocityConstraint",name:"b2ContactVelocityConstraint",def:Ec},{trimmed:"PositionSolverManifold",
name:"b2PositionSolverManifold",def:Ub},{trimmed:"ContactSolverDef",name:"b2ContactSolverDef",def:Fc},{trimmed:"ContactSolver",name:"b2ContactSolver",def:C},{trimmed:"Island",name:"b2Island",def:H},{trimmed:"Jacobian",name:"b2Jacobian",def:function(){this.linear=new d;this.angularB=this.angularA=0}},{trimmed:"JointEdge",name:"b2JointEdge",def:Vb},{trimmed:"JointDef",name:"b2JointDef",def:ja},{trimmed:"Joint",name:"b2Joint",def:s},{trimmed:"RevoluteJointDef",name:"b2RevoluteJointDef",def:Ya},{trimmed:"RevoluteJoint",
name:"b2RevoluteJoint",def:rb},{trimmed:"MouseJointDef",name:"b2MouseJointDef",def:Gc},{trimmed:"MouseJoint",name:"b2MouseJoint",def:sb},{trimmed:"DistanceJointDef",name:"b2DistanceJointDef",def:Za},{trimmed:"DistanceJoint",name:"b2DistanceJoint",def:tb},{trimmed:"PrismaticJointDef",name:"b2PrismaticJointDef",def:$a},{trimmed:"PrismaticJoint",name:"b2PrismaticJoint",def:ub},{trimmed:"FrictionJointDef",name:"b2FrictionJointDef",def:ab},{trimmed:"FrictionJoint",name:"b2FrictionJoint",def:vb},{trimmed:"WeldJointDef",
name:"b2WeldJointDef",def:bb},{trimmed:"WeldJoint",name:"b2WeldJoint",def:wb},{trimmed:"WheelJointDef",name:"b2WheelJointDef",def:cb},{trimmed:"WheelJoint",name:"b2WheelJoint",def:xb},{trimmed:"GearJointDef",name:"b2GearJointDef",def:yb},{trimmed:"GearJoint",name:"b2GearJoint",def:zb},{trimmed:"MotorJointDef",name:"b2MotorJointDef",def:db},{trimmed:"MotorJoint",name:"b2MotorJoint",def:Ab},{trimmed:"PulleyJointDef",name:"b2PulleyJointDef",def:Bb},{trimmed:"PulleyJoint",name:"b2PulleyJoint",def:Cb},
{trimmed:"RopeJointDef",name:"b2RopeJointDef",def:eb},{trimmed:"RopeJoint",name:"b2RopeJoint",def:Db},{trimmed:"RopeDef",name:"b2RopeDef",def:function(){this.vertices=null;this.count=0;this.masses=null;this.gravity=new d;this.damping=0.1;this.k2=0.9;this.k3=0.1}},{trimmed:"Rope",name:"b2Rope",def:Hc},{trimmed:"maxManifoldPoints",name:"b2_maxManifoldPoints",def:ia},{trimmed:"maxPolygonVertices",name:"b2_maxPolygonVertices",def:qa},{trimmed:"aabbExtension",name:"b2_aabbExtension",def:0.1},{trimmed:"aabbMultiplier",
name:"b2_aabbMultiplier",def:2},{trimmed:"linearSlop",name:"b2_linearSlop",def:N},{trimmed:"angularSlop",name:"b2_angularSlop",def:sa},{trimmed:"polygonRadius",name:"b2_polygonRadius",def:Ra},{trimmed:"maxSubSteps",name:"b2_maxSubSteps",def:8},{trimmed:"maxTOIContacts",name:"b2_maxTOIContacts",def:32},{trimmed:"velocityThreshold",name:"b2_velocityThreshold",def:1},{trimmed:"maxLinearCorrection",name:"b2_maxLinearCorrection",def:0.2},{trimmed:"maxAngularCorrection",name:"b2_maxAngularCorrection",def:fb},
{trimmed:"maxTranslation",name:"b2_maxTranslation",def:2},{trimmed:"maxTranslationSquared",name:"b2_maxTranslationSquared",def:4},{trimmed:"maxRotation",name:"b2_maxRotation",def:gb},{trimmed:"maxRotationSquared",name:"b2_maxRotationSquared",def:Wb},{trimmed:"baumgarte",name:"b2_baumgarte",def:0.2},{trimmed:"toiBaugarte",name:"b2_toiBaugarte",def:0.75},{trimmed:"timeToSleep",name:"b2_timeToSleep",def:0.5},{trimmed:"linearSleepTolerance",name:"b2_linearSleepTolerance",def:0.01},{trimmed:"angularSleepTolerance",
name:"b2_angularSleepTolerance",def:Xb},{trimmed:"epsilon",name:"b2_epsilon",def:ga},{trimmed:"JsonSerializer",name:"b2JsonSerializer",def:{serialize:function(a){var b=[],c,d,e;for(e=a.GetBodyList();e;e=e.GetNext())for(c=e.GetFixtureList();c;c=c.GetNext())d=c.GetShape(),c.__temp_shape_id=b.length,b.push(d._serialize());var f=[];for(e=a.GetBodyList();e;e=e.GetNext())for(e.__temp_fixture_ids=[],c=e.GetFixtureList();c;c=c.GetNext())d=c._serialize(),d.shape=c.__temp_shape_id,delete c.__temp_shape_id,
e.__temp_fixture_ids.push(f.length),f.push(d);var h=[];for(e=a.GetBodyList();e;e=e.GetNext()){d=e._serialize();d.fixtures=[];for(c=0;c<e.__temp_fixture_ids.length;++c)d.fixtures.push(e.__temp_fixture_ids[c]);delete e.__temp_fixture_ids;e.__temp_body_id=h.length;h.push(d)}var k=[];e=a.GetJointList();for(c=0;e;e=e.GetNext(),++c)e.__temp_joint_id=c;for(e=a.GetJointList();e;e=e.GetNext())e.GetType()!==s.e_mouseJoint&&(d=e._serialize(),d.bodyA=e.GetBodyA().__temp_body_id,d.bodyB=e.GetBodyB().__temp_body_id,
k.push(d));for(e=a.GetJointList();e;e=e.GetNext())delete e.__temp_joint_id;for(e=a.GetBodyList();e;e=e.GetNext())delete e.__temp_body_id;return{shapes:b,fixtures:f,bodies:h,joints:k}},deserialize:function(a,b,c){a=JSON.parse(a);if(c){for(var d=b.GetBodyList();d;)c=d.GetNext(),b.DestroyBody(d),d=c;for(d=b.GetJointList();d;)c=d.GetNext(),b.DestroyJoint(d),d=c}var e=[];for(c=0;c<a.shapes.length;++c){var d=a.shapes[c],f;switch(d.m_type){case E.e_circle:f=new Ga;break;case E.e_edge:f=new Ba;break;case E.e_chain:f=
new pa;break;case E.e_polygon:f=new va}f._deserialize(d);e.push(f)}d=[];for(c=0;c<a.fixtures.length;++c){f=a.fixtures[c];var h=new Wa;h._deserialize(f);h.shape=e[f.shape];d.push(h)}f=[];for(c=0;c<a.bodies.length;++c){e=a.bodies[c];h=new nb;h._deserialize(e);for(var h=b.CreateBody(h),k=0;k<e.fixtures.length;++k)h.CreateFixture(d[e.fixtures[k]]);f.push(h)}d=[];e=[];for(c=0;c<a.joints.length;++c){h=a.joints[c];switch(h.type){case s.e_revoluteJoint:k=new Ya;break;case s.e_prismaticJoint:k=new $a;break;
case s.e_distanceJoint:k=new Za;break;case s.e_pulleyJoint:k=new Bb;break;case s.e_gearJoint:k=new yb;break;case s.e_wheelJoint:k=new cb;break;case s.e_weldJoint:k=new bb;break;case s.e_frictionJoint:k=new ab;break;case s.e_ropeJoint:k=new eb;break;case s.e_motorJoint:k=new db;break;default:throw Error("unknown joint");}k._deserialize(h,f);h.type===s.e_gearJoint?(e.push([k,d.length]),d.push(null)):(h=b.CreateJoint(k),d.push(h))}for(c=0;c<e.length;++c)e[c][0].joint1=d[e[c][0].joint1],e[c][0].joint2=
d[e[c][0].joint2],h=b.CreateJoint(e[c][0]),d[e[c][1]]=h}}},{trimmed:"RUBELoader",name:"b2RUBELoader",def:Xc},{trimmed:"Profiler",name:"b2Profiler",def:oa}];if("undefined"!==typeof b2_compatibility&&"undefined"!==typeof window)for(var ta=0;ta<Pa.length;++ta)window[Pa[ta].name]=Pa[ta].def;else{for(var Zb={},ta=0;ta<Pa.length;++ta)Zb[Pa[ta].trimmed]=Pa[ta].def;"undefined"!==typeof module?module.exports=Zb:window.b2=Zb}})();
