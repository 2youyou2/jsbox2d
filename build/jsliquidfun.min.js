(function(){function hc(a,b,c){this.major=a;this.minor=b;this.revision=c}function ic(a){return isFinite(a)&&!isNaN(a)}function d(a,b){"undefined"!==typeof a?(this.x=a,this.y=b):this.x=this.y=0}function N(a,b,c){"undefined"!==typeof a&&(this.x=a,this.y=b,this.z=c)}function $(a,b){this.ex=a?a.Clone():new d;this.ey=b?b.Clone():new d}function Ba(a,b,c){this.ex=a?a.Clone():new N;this.ey=b?b.Clone():new N;this.ez=c?c.Clone():new N}function F(a,b){"undefined"!==typeof b?(this.s=a,this.c=b):"undefined"!==
typeof a&&this.Set(a)}function Y(a,b){this.p=new d;this.q=new F;a&&(this.p.Assign(a),this.q.Assign(b))}function sa(){this.localCenter=new d;this.c0=new d;this.c=new d}function v(a,b){return a.x*b.x+a.y*b.y}function u(a,b){return a.x*b.y-a.y*b.x}function jc(a,b){return new d(b*a.y,-b*a.x)}function S(a,b){return new d(-a*b.y,a*b.x)}function Ma(a,b){return new d(a.ex.x*b.x+a.ey.x*b.y,a.ex.y*b.x+a.ey.y*b.y)}function Na(a,b){return d.Subtract(a,b).Length()}function rb(a,b){var c=d.Subtract(a,b);return v(c,
c)}function Oa(a,b){return a.x*b.x+a.y*b.y+a.z*b.z}function Pa(a,b){return new N(a.y*b.z-a.z*b.y,a.z*b.x-a.x*b.z,a.x*b.y-a.y*b.x)}function kc(a,b){return N.Add(N.Add(N.Multiply(b.x,a.ex),N.Multiply(b.y,a.ey)),N.Multiply(b.z,a.ez))}function lc(a,b){return new d(a.ex.x*b.x+a.ey.x*b.y,a.ex.y*b.x+a.ey.y*b.y)}function mc(a,b){var c=new F;c.s=a.s*b.c+a.c*b.s;c.c=a.c*b.c-a.s*b.s;return c}function nc(a,b){var c=new F;c.s=a.c*b.s-a.s*b.c;c.c=a.c*b.c+a.s*b.s;return c}function C(a,b){return new d(a.c*b.x-a.s*
b.y,a.s*b.x+a.c*b.y)}function pa(a,b){return new d(a.c*b.x+a.s*b.y,-a.s*b.x+a.c*b.y)}function V(a,b){return new d(a.q.c*b.x-a.q.s*b.y+a.p.x,a.q.s*b.x+a.q.c*b.y+a.p.y)}function Ca(a,b){var c=b.x-a.p.x,e=b.y-a.p.y;return new d(a.q.c*c+a.q.s*e,-a.q.s*c+a.q.c*e)}function oc(a,b){var c=new Y;c.q=mc(a.q,b.q);c.p=d.Add(C(a.q,b.p),a.p);return c}function Nb(a,b){var c=new Y;c.q=nc(a.q,b.q);var e=b.p.x-a.p.x,f=b.p.y-a.p.y;c.p.x=a.q.c*e+a.q.s*f;c.p.y=-a.q.s*e+a.q.c*f;return c}function $a(a){return new d(aa(a.x),
aa(a.y))}function Da(a,b){return new d(O(a.x,b.x),O(a.y,b.y))}function Ea(a,b){return new d(H(a.x,b.x),H(a.y,b.y))}function ca(a,b,c){return H(b,O(a,c))}function ea(a,b,c){this.r=a||0;this.g=b||0;this.b=c||0}function ba(){}function pc(){this.Reset()}function qc(){this.mass=0;this.center=new d;this.I=0}function G(){this.m_radius=this.m_type=0}function Qa(){this.parent.call(this);this.m_type=G.e_circle;this.m_radius=0;this.m_p=new d;Object.seal(this)}function Ja(){this.parent.call(this);this.m_type=
G.e_edge;this.m_radius=ab;this.m_vertex0=new d;this.m_vertex1=new d;this.m_vertex2=new d;this.m_vertex3=new d;this.m_hasVertex3=this.m_hasVertex0=!1;Object.seal(this)}function qa(){this.parent.call(this);this.m_type=G.e_chain;this.m_radius=ab;this.m_prevVertex=new d;this.m_nextVertex=new d;this.m_hasNextVertex=this.m_hasPrevVertex=!1;this.Clear();Object.seal(this)}function Fa(){this.parent.call(this);this.m_type=G.e_polygon;this.m_radius=ab;this.m_count=0;this.m_centroid=new d;this.m_vertices=Array(wa);
this.m_normals=Array(wa);Object.seal(this)}function rc(){this.proxyIdB=this.proxyIdA=0}function sc(a,b){return a.proxyIdA==b.proxyIdA?a.proxyIdB-b.proxyIdB:a.proxyIdA-b.proxyIdA}function Ga(){this.m_tree=new Ha;this.m_pairCount=this.m_proxyCount=this.m_queryProxyId=0;this.m_pairBuffer=[];this.m_moveCount=0;this.m_moveBuffer=[]}function Ra(){this.m_vertices=null;this.m_radius=this.m_count=0}function Ob(){this.count=this.metric=0;this.indexA=[0,0,0];this.indexB=[0,0,0]}function Pb(){this.proxyA=new Ra;
this.proxyB=new Ra;this.transformA=new Y;this.transformB=new Y;this.useRadii=!1}function Qb(){this.pointA=new d;this.pointB=new d;this.iterations=this.distance=0}function bb(){this.wA=new d;this.wB=new d;this.w=new d;this.indexB=this.indexA=this.a=0}function Rb(){this.m_v=[new bb,new bb,new bb];this.m_count=0}function xa(a,b,c){++xa.b2_gjkCalls;var e=c.proxyA,f=c.proxyB,g=c.transformA,k=c.transformB;ka.ReadCache(b,e,g,f,k);for(var d=ka.m_v,l=[0,0,0],m=[0,0,0],n=0,p=0;20>p;){for(var n=ka.m_count,q=
0;q<n;++q)l[q]=d[q].indexA,m[q]=d[q].indexB;switch(ka.m_count){case 2:ka.Solve2();break;case 3:ka.Solve3()}if(3==ka.m_count)break;ka.GetClosestPoint(ra);ra.LengthSquared();ka.GetSearchDirection(ra);if(ra.LengthSquared()<la*la)break;var r=d[ka.m_count];r.indexA=e.GetSupport(g.q.c*-ra.x+g.q.s*-ra.y,-g.q.s*-ra.x+g.q.c*-ra.y);q=e.GetVertex(r.indexA);r.wA.x=g.q.c*q.x-g.q.s*q.y+g.p.x;r.wA.y=g.q.s*q.x+g.q.c*q.y+g.p.y;r.indexB=f.GetSupport(k.q.c*ra.x+k.q.s*ra.y,-k.q.s*ra.x+k.q.c*ra.y);q=f.GetVertex(r.indexB);
r.wB.x=k.q.c*q.x-k.q.s*q.y+k.p.x;r.wB.y=k.q.s*q.x+k.q.c*q.y+k.p.y;r.w.x=r.wB.x-r.wA.x;r.w.y=r.wB.y-r.wA.y;++p;++xa.b2_gjkIters;for(var J=!1,q=0;q<n;++q)if(r.indexA==l[q]&&r.indexB==m[q]){J=!0;break}if(J)break;++ka.m_count}xa.b2_gjkMaxIters=H(xa.b2_gjkMaxIters,p);ka.GetWitnessPoints(a.pointA,a.pointB);a.distance=Na(a.pointA,a.pointB);a.iterations=p;ka.WriteCache(b);c.useRadii&&(b=e.m_radius,f=f.m_radius,a.distance>b+f&&a.distance>la?(a.distance-=b+f,Ka.x=a.pointB.x-a.pointA.x,Ka.y=a.pointB.y-a.pointA.y,
Ka.Normalize(),a.pointA.x+=b*Ka.x,a.pointA.y+=b*Ka.y,a.pointB.x-=f*Ka.x,a.pointB.y-=f*Ka.y):(f=0.5*(a.pointA.x+a.pointB.x),b=0.5*(a.pointA.y+a.pointB.y),a.pointA.x=f,a.pointA.y=b,a.pointB.x=f,a.pointB.y=b,a.distance=0))}function U(){}function ma(){this.localPoint=new d;this.tangentImpulse=this.normalImpulse=0;this.id=new U}function L(){this.points=Array(na);this.localNormal=new d;this.localPoint=new d;this.pointCount=this.type=0}function Sb(){this.normal=new d;this.points=Array(na);this.separations=
Array(na)}function Ia(){this.v=new d;this.id=new U}function sb(){this.p1=new d;this.p2=new d;this.maxFraction=0}function Tb(){this.normal=new d;this.fraction=0}function X(){this.lowerBound=new d;this.upperBound=new d}function tc(a,b,c,e,f){a.pointCount=0;c=V(c,b.m_p);var g=V(f,e.m_p);f=g.x-c.x;c=g.y-c.y;g=b.m_radius+e.m_radius;f*f+c*c>g*g||(a.type=L.e_circles,a.localPoint.x=b.m_p.x,a.localPoint.y=b.m_p.y,a.localNormal.x=a.localNormal.y=0,a.pointCount=1,a.points[0]=new ma,a.points[0].localPoint.x=
e.m_p.x,a.points[0].localPoint.y=e.m_p.y,a.points[0].id.Reset())}function uc(a,b,c,e,f){a.pointCount=0;f=V(f,e.m_p);c=Ca(c,f);var g=0,k=-W;f=b.m_radius+e.m_radius;var d=b.m_count,l=b.m_vertices;b=b.m_normals;for(var m=0;m<d;++m){var n=b[m].x*(c.x-l[m].x)+b[m].y*(c.y-l[m].y);if(n>f)return;n>k&&(k=n,g=m)}m=g;n=l[m];d=l[m+1<d?m+1:0];k<la?(a.pointCount=1,a.type=L.e_faceA,a.localNormal.x=b[g].x,a.localNormal.y=b[g].y,a.localPoint.x=0.5*(n.x+d.x),a.localPoint.y=0.5*(n.y+d.y),a.points[0]=new ma,a.points[0].localPoint.x=
e.m_p.x,a.points[0].localPoint.y=e.m_p.y,a.points[0].id.Reset()):(k=(c.x-d.x)*(n.x-d.x)+(c.y-d.y)*(n.y-d.y),0>=(c.x-n.x)*(d.x-n.x)+(c.y-n.y)*(d.y-n.y)?rb(c,n)>f*f||(a.pointCount=1,a.type=L.e_faceA,a.localNormal.x=c.x-n.x,a.localNormal.y=c.y-n.y,a.localNormal.Normalize(),a.localPoint.x=n.x,a.localPoint.y=n.y,a.points[0]=new ma,a.points[0].localPoint.x=e.m_p.x,a.points[0].localPoint.y=e.m_p.y,a.points[0].id.Reset()):0>=k?rb(c,d)>f*f||(a.pointCount=1,a.type=L.e_faceA,a.localNormal.x=c.x-d.x,a.localNormal.y=
c.y-d.y,a.localNormal.Normalize(),a.localPoint.x=d.x,a.localPoint.y=d.y,a.points[0]=new ma,a.points[0].localPoint.x=e.m_p.x,a.points[0].localPoint.y=e.m_p.y,a.points[0].id.Reset()):(g=0.5*(n.x+d.x),d=0.5*(n.y+d.y),k=(c.x-g)*b[m].x+(c.y-d)*b[m].y,k>f||(a.pointCount=1,a.type=L.e_faceA,a.localNormal.x=b[m].x,a.localNormal.y=b[m].y,a.localPoint.x=g,a.localPoint.y=d,a.points[0]=new ma,a.points[0].localPoint.x=e.m_p.x,a.points[0].localPoint.y=e.m_p.y,a.points[0].id.Reset())))}function Ub(a,b,c,e,f){var g=
b.m_count,k=e.m_count,d=b.m_normals;b=b.m_vertices;e=e.m_vertices;c=Nb(f,c);f=0;for(var l=-W,m=0;m<g;++m){for(var n=c.q.c*d[m].x-c.q.s*d[m].y,p=c.q.s*d[m].x+c.q.c*d[m].y,q=c.q.c*b[m].x-c.q.s*b[m].y+c.p.x,r=c.q.s*b[m].x+c.q.c*b[m].y+c.p.y,J=W,y=0;y<k;++y){var s=n*(e[y].x-q)+p*(e[y].y-r);s<J&&(J=s)}J>l&&(l=J,f=m)}a[0]=f;return l}function vc(a,b,c,e,f,g){var k=b.m_normals,d=f.m_count;b=f.m_vertices;f=f.m_normals;var l=c.q.c*k[e].x-c.q.s*k[e].y,k=c.q.s*k[e].x+c.q.c*k[e].y;c=g.q.c*l+g.q.s*k;for(var l=
-g.q.s*l+g.q.c*k,k=0,m=W,n=0;n<d;++n){var p=c*f[n].x+l*f[n].y;p<m&&(m=p,k=n)}f=k;d=f+1<d?f+1:0;a[0].v.x=g.q.c*b[f].x-g.q.s*b[f].y+g.p.x;a[0].v.y=g.q.s*b[f].x+g.q.c*b[f].y+g.p.y;a[0].id.indexA=e;a[0].id.indexB=f;a[0].id.typeA=U.e_face;a[0].id.typeB=U.e_vertex;a[1].v.x=g.q.c*b[d].x-g.q.s*b[d].y+g.p.x;a[1].v.y=g.q.s*b[d].x+g.q.c*b[d].y+g.p.y;a[1].id.indexA=e;a[1].id.indexB=d;a[1].id.typeA=U.e_face;a[1].id.typeB=U.e_vertex}function fa(a,b,c,e,f){a.pointCount=0;var g=b.m_radius+e.m_radius,k=[0],d=Ub(k,
b,c,e,f);if(!(d>g)){var l=[0],m=Ub(l,e,f,b,c);if(!(m>g)){var n=0,p=0;m>d+0.1*Q?(d=e,e=b,b=f,n=l[0],a.type=L.e_faceB,p=1):(d=b,b=c,c=f,n=k[0],a.type=L.e_faceA,p=0);vc(fa._local_incidentEdges,d,b,n,e,c);k=d.m_vertices;l=n;f=n+1<d.m_count?n+1:0;e=k[l];d=k[f];fa._localTangent.x=d.x-e.x;fa._localTangent.y=d.y-e.y;fa._localTangent.Normalize();var m=1*fa._localTangent.y,q=-1*fa._localTangent.x,r=0.5*(e.x+d.x),J=0.5*(e.y+d.y),y=b.q.c*fa._localTangent.x-b.q.s*fa._localTangent.y,s=b.q.s*fa._localTangent.x+
b.q.c*fa._localTangent.y,n=1*s,k=-1*y;e=V(b,e);d=V(b,d);b=n*e.x+k*e.y;var t=y*d.x+s*d.y+g,x=Array(2),d=Array(2),l=cb(x,fa._local_incidentEdges,-y,-s,-(y*e.x+s*e.y)+g,l);if(!(2>l||(l=cb(d,x,y,s,t,f),2>l))){a.localNormal.x=m;a.localNormal.y=q;a.localPoint.x=r;a.localPoint.y=J;for(f=l=0;f<na;++f)n*d[f].v.x+k*d[f].v.y-b<=g&&(e=a.points[l]=new ma,e.localPoint.Assign(Ca(c,d[f].v)),e.id.Assign(d[f].id),p&&(m=new U,m.Assign(e.id),e.id.indexA=m.indexB,e.id.indexB=m.indexA,e.id.typeA=m.typeB,e.id.typeB=m.typeA),
++l);a.pointCount=l}}}}function Vb(a,b,c,e,f){a.pointCount=0;c=Ca(c,V(f,e.m_p));var g=b.m_vertex1,d=b.m_vertex2,h=d.x-g.x,l=d.y-g.y,m=h*(d.x-c.x)+l*(d.y-c.y),n=h*(c.x-g.x)+l*(c.y-g.y),p=b.m_radius+e.m_radius;f=new U;f.indexB=0;f.typeB=U.e_vertex;if(0>=n){if(h=g,m=c.x-h.x,n=c.y-h.y,!(m*m+n*n>p*p)){if(b.m_hasVertex0&&(d=b.m_vertex0,0<(g.x-d.x)*(g.x-c.x)+(g.y-d.y)*(g.y-c.y)))return;f.indexA=0;f.typeA=U.e_vertex;a.pointCount=1;a.type=L.e_circles;a.localNormal.x=a.localNormal.y=0;a.localPoint.x=h.x;a.localPoint.y=
h.y;a.points[0]=new ma;a.points[0].id.Assign(f);a.points[0].localPoint.x=e.m_p.x;a.points[0].localPoint.y=e.m_p.y}}else if(0>=m){if(h=d,m=c.x-h.x,n=c.y-h.y,!(m*m+n*n>p*p)){if(b.m_hasVertex3&&(g=b.m_vertex3,0<(g.x-d.x)*(c.x-d.x)+(g.y-d.y)*(c.y-d.y)))return;f.indexA=1;f.typeA=U.e_vertex;a.pointCount=1;a.type=L.e_circles;a.localNormal.x=a.localNormal.y=0;a.localPoint.x=h.x;a.localPoint.y=h.y;a.points[0]=new ma;a.points[0].id.Assign(f);a.points[0].localPoint.x=e.m_p.x;a.points[0].localPoint.y=e.m_p.y}}else{var q=
h*h+l*l;b=1/q*(m*g.y+n*d.y);m=c.x-1/q*(m*g.x+n*d.x);n=c.y-b;m*m+n*n>p*p||(d=-l,b=h,0>d*(c.x-g.x)+b*(c.y-g.y)&&(d=-d,b=-b),f.indexA=0,f.typeA=U.e_face,a.pointCount=1,a.type=L.e_faceA,a.localNormal.x=d,a.localNormal.y=b,a.localNormal.Normalize(),a.localPoint.x=g.x,a.localPoint.y=g.y,a.points[0]=new ma,a.points[0].id.Assign(f),a.points[0].localPoint.x=e.m_p.x,a.points[0].localPoint.y=e.m_p.y)}}function da(){this.separation=this.index=this.type=0}function wc(){this.vertices=Array(wa);this.normals=Array(wa);
this.count=0}function xc(){this.i2=this.i1=0;this.v1=new d;this.v2=new d;this.normal=new d;this.sideNormal1=new d;this.sideOffset1=0;this.sideNormal2=new d;this.sideOffset2=0}function M(){this.m_polygonB=new wc;this.m_xf=new Y;this.m_centroidB=new d;this.m_v0=new d;this.m_v1=new d;this.m_v2=new d;this.m_v3=new d;this.m_normal0=new d;this.m_normal1=new d;this.m_normal2=new d;this.m_normal=new d;this.m_type2=this.m_type1=0;this.m_lowerLimit=new d;this.m_upperLimit=new d;this.m_radius=0;this.m_front=
!1}function db(a,b,c,e,f){db.collider.Collide(a,b,c,e,f)}function cb(a,b,c,e,f,g){var d=0,h=c*b[0].v.x+e*b[0].v.y-f;c=c*b[1].v.x+e*b[1].v.y-f;0>=h&&(a[d++]=b[0]);0>=c&&(a[d++]=b[1]);0>h*c&&(h/=h-c,a[d]=new Ia,a[d].v.x=b[0].v.x+h*(b[1].v.x-b[0].v.x),a[d].v.y=b[0].v.y+h*(b[1].v.y-b[0].v.y),a[d].id.indexA=g,a[d].id.indexB=b[0].id.indexB,a[d].id.typeA=U.e_vertex,a[d].id.typeB=U.e_face,++d);return d}function ga(a,b,c,e,f,g){ga.input.proxyA.Set(a,b);ga.input.proxyB.Set(c,e);ga.input.transformA=f;ga.input.transformB=
g;ga.input.useRadii=!0;ga.cache.count=0;xa(ga.output,ga.cache,ga.input);return ga.output.distance<10*la}function tb(a,b){return!(0<b.lowerBound.x-a.upperBound.x||0<b.lowerBound.y-a.upperBound.y||0<a.lowerBound.x-b.upperBound.x||0<a.lowerBound.y-b.upperBound.y)}function Sa(){this.aabb=new X;this.userData=null;this.child1=this.child2=this.height=this.parent=0}function Ha(){this.m_root=T;this.m_nodeCapacity=16;this.m_nodeCount=0;this.m_nodes=Array(this.m_nodeCapacity);for(var a=0;a<this.m_nodeCapacity-
1;++a)this.m_nodes[a]=new Sa,this.m_nodes[a].parent=a+1,this.m_nodes[a].height=-1;this.m_nodes[this.m_nodeCapacity-1]=new Sa;this.m_nodes[this.m_nodeCapacity-1].parent=T;this.m_nodes[this.m_nodeCapacity-1].height=-1;this.m_insertionCount=this.m_path=this.m_freeList=0}function yc(){this.proxyA=new Ra;this.proxyB=new Ra;this.sweepA=new sa;this.sweepB=new sa;this.tMax=0}function ha(){this.t=this.state=0}function ia(){this.m_sweepB=this.m_sweepA=this.m_proxyB=this.m_proxyA=null;this.m_type=0;this.m_localPoint=
new d;this.m_axis=new d}function R(a,b){ub.start();++R.b2_toiCalls;a.state=ha.e_unknown;a.t=b.tMax;var c=b.proxyA,e=b.proxyB;R._temp_sweepA.Assign(b.sweepA);R._temp_sweepB.Assign(b.sweepB);R._temp_sweepA.Normalize();R._temp_sweepB.Normalize();var f=b.tMax,g=H(Q,c.m_radius+e.m_radius-3*Q),d=0.25*Q,h=0,l=0,m=new Ob;m.count=0;var n=new Pb;n.proxyA.Assign(b.proxyA);n.proxyB.Assign(b.proxyB);for(n.useRadii=!1;;){R._temp_sweepA.GetTransform(n.transformA,h);R._temp_sweepB.GetTransform(n.transformB,h);var p=
new Qb;xa(p,m,n);if(0>=p.distance){a.state=ha.e_overlapped;a.t=0;break}if(p.distance<g+d){a.state=ha.e_touching;a.t=h;break}p=new ia;p.Initialize(m,c,R._temp_sweepA,e,R._temp_sweepB,h);for(var q=!1,r=f,J=0;;){var y=[],s=p.FindMinSeparation(y,r);if(s>g+d){a.state=ha.e_separated;a.t=f;q=!0;break}if(s>g-d){h=r;break}var t=p.Evaluate(y[0],y[1],h);if(t<g-d){a.state=ha.e_failed;a.t=h;q=!0;break}if(t<=g+d){a.state=ha.e_touching;a.t=h;q=!0;break}for(var x=0,A=h,u=r;;){var v;v=x&1?A+(g-t)*(u-A)/(s-t):0.5*
(A+u);++x;++R.b2_toiRootIters;var w=p.Evaluate(y[0],y[1],v);if(aa(w-g)<d){r=v;break}w>g?(A=v,t=w):(u=v,s=w);if(50==x)break}R.b2_toiMaxRootIters=H(R.b2_toiMaxRootIters,x);++J;if(J==wa)break}++l;++R.b2_toiIters;if(q)break;if(20==l){a.state=ha.e_failed;a.t=h;break}}R.b2_toiMaxIters=H(R.b2_toiMaxIters,l);ub.stop();R.b2_toiMaxTime=H(R.b2_toiMaxTime,ub.elapsedTime);R.b2_toiTime+=ub.elapsedTime}function vb(){this.type=t.b2_staticBody;this.position=new d(0,0);this.angle=0;this.linearVelocity=new d(0,0);this.angularDamping=
this.linearDamping=this.angularVelocity=0;this.awake=this.allowSleep=!0;this.bullet=this.fixedRotation=!1;this.active=!0;this.userData=null;this.gravityScale=1;Object.seal(this)}function t(a,b){this.m_flags=this.m_islandIndex=0;a.bullet&&(this.m_flags|=t.e_bulletFlag);a.fixedRotation&&(this.m_flags|=t.e_fixedRotationFlag);a.allowSleep&&(this.m_flags|=t.e_autoSleepFlag);a.awake&&(this.m_flags|=t.e_awakeFlag);a.active&&(this.m_flags|=t.e_activeFlag);this.m_world=b;this.m_xf=new Y;this.m_xf.p.Assign(a.position);
this.m_xf.q.Set(a.angle);this.m_xf0=new Y;this.m_xf0.Assign(this.m_xf);this.m_sweep=new sa;this.m_sweep.localCenter.SetZero();this.m_sweep.c0.Assign(this.m_xf.p);this.m_sweep.c.Assign(this.m_xf.p);this.m_sweep.a0=a.angle;this.m_sweep.a=a.angle;this.m_sweep.alpha0=0;this.m_next=this.m_prev=this.m_contactList=this.m_jointList=null;this.m_linearVelocity=a.linearVelocity.Clone();this.m_angularVelocity=a.angularVelocity;this.m_linearDamping=a.linearDamping;this.m_angularDamping=a.angularDamping;this.m_gravityScale=
a.gravityScale;this.m_force=new d;this.m_sleepTime=this.m_torque=0;this.m_type=a.type;this.m_invMass=this.m_type==t.b2_dynamicBody?this.m_mass=1:this.m_mass=0;this.m_invI=this.m_I=0;this.m_userData=a.userData;this.m_fixtureList=null;this.m_fixtureCount=0}function eb(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0}function fb(){this.userData=this.shape=null;this.friction=0.2;this.density=this.restitution=0;this.isSensor=!1;this.filter=new eb;Object.seal(this)}function $c(){this.aabb=new X;
this.fixture=null;this.proxyId=this.childIndex=0}function Wb(){this.m_proxies=this.m_next=this.m_body=this.m_userData=null;this.m_proxyCount=0;this.m_shape=null;this.m_density=0;this.m_filter=new eb;this.m_isSensor=!1;this.m_restitution=this.m_friction=0}function zc(){}function Xb(){}function Ac(){this.normalImpulses=Array(na);this.tangentImpulses=Array(na);this.count=0}function Yb(){}function Bc(){}function Cc(){}function gb(){this.positionIterations=this.velocityIterations=this.dtRatio=this.inv_dt=
this.dt=0;this.warmStarting=!1}function Dc(){this.c=new d;this.a=0}function Ec(){this.v=new d;this.w=0}function Fc(){this.step=new gb;this.velocities=this.positions=null}function P(a){this.m_contactManager=new Zb;this.m_jointList=this.m_bodyList=this.g_debugDraw=this.m_destructionListener=null;this.m_jointCount=this.m_bodyCount=0;this.m_continuousPhysics=this.m_warmStarting=!0;this.m_subStepping=!1;this.m_allowSleep=this.m_stepComplete=!0;this.m_gravity=a;this.m_flags=P.e_clearForces;this.m_inv_dt0=
0;this.p_step=new gb;this.p_island=new K;this.m_particleSystem=new D;this.m_particleSystem.m_world=this}function Gc(){this.callback=this.broadPhase=null}function Hc(){this.callback=this.broadPhase=null}function Ic(a){this.m_buffer=Array(a);this.m_back=this.m_front=0;this.m_end=a}function Z(a){this.m_generatorBuffer=[];for(var b=0;b<a;++b)this.m_generatorBuffer[b]=new Z.Generator;this.m_countY=this.m_countX=this.m_generatorCount=0;this.m_diagram=null}function La(a,b,c,e){a instanceof ea?(this.r=255*
a.r,this.g=255*a.g,this.b=255*a.b,this.a=255):"undefined"!==typeof a?(this.r=a,this.g=b,this.b=c,this.a=e):this.r=this.g=this.b=this.a=0}function I(){this.flags=0;this.position=new d;this.velocity=new d;this.color=new La;this.userData=null}function ta(){this.m_system=null;this.m_groupFlags=this.m_lastIndex=this.m_firstIndex=0;this.m_strength=1;this.m_next=this.m_prev=null;this.m_timestamp=-1;this.m_inertia=this.m_mass=0;this.m_center=new d;this.m_linearVelocity=new d;this.m_angularVelocity=0;this.m_transform=
new Y;this.m_transform.SetIdentity();this.m_destroyAutomatically=!0;this.m_toBeSplit=this.m_toBeDestroyed=!1;this.m_userData=null}function ad(){this.weight=this.flags=this.indexA=this.indexB=0;this.normal=new d}function bd(){this.index=0;this.body=null;this.weight=0;this.normal=new d;this.mass=0}function D(){this.m_allGroupFlags=this.m_allParticleFlags=this.m_timestamp=0;this.m_squaredDiameter=this.m_inverseDiameter=this.m_particleDiameter=this.m_gravityScale=this.m_inverseDensity=this.m_density=
1;this.m_maxCount=this.m_internalAllocatedCapacity=this.m_count=0;this.m_flagsBuffer=new D.ParticleBuffer;this.m_positionBuffer=new D.ParticleBuffer;this.m_velocityBuffer=new D.ParticleBuffer;this.m_depthBuffer=this.m_accumulation2Buffer=this.m_accumulationBuffer=null;this.m_colorBuffer=new D.ParticleBuffer;this.m_groupBuffer=null;this.m_userDataBuffer=new D.ParticleBuffer;this.m_proxyCapacity=this.m_proxyCount=0;this.m_proxyBuffer=null;this.m_contactCapacity=this.m_contactCount=0;this.m_contactBuffer=
null;this.m_bodyContactCapacity=this.m_bodyContactCount=0;this.m_bodyContactBuffer=null;this.m_pairCapacity=this.m_pairCount=0;this.m_pairBuffer=null;this.m_triadCapacity=this.m_triadCount=0;this.m_triadBuffer=null;this.m_groupCount=0;this.m_groupList=null;this.m_pressureStrength=0.05;this.m_dampingStrength=1;this.m_viscousStrength=this.m_springStrength=this.m_elasticStrength=0.25;this.m_surfaceTensionStrengthA=0.1;this.m_surfaceTensionStrengthB=0.2;this.m_colorMixingStrength=this.m_ejectionStrength=
this.m_powderStrength=0.5;this.m_world=null}function ya(a,b){return(b+D.yOffset<<D.yShift)+(D.xScale*a+D.xOffset)>>>0}function Ta(a,b){return b&&a>b?b:a}function cd(a){return(a.flags&I.b2_zombieParticle)==I.b2_zombieParticle}function $b(a,b){return a>b?a:b}function ac(){this.fcn=null;this.primary=!1}function wb(){this.next=this.prev=this.contact=this.other=null}function w(){this.m_nodeA=new wb;this.m_nodeB=new wb;this.m_manifold=new L}function xb(){this.parent.call(this)}function yb(){this.parent.call(this)}
function Ua(){this.parent.call(this)}function Va(){this.parent.call(this)}function Wa(){this.parent.call(this)}function Xa(){this.parent.call(this)}function Ya(){this.parent.call(this)}function Zb(){this.m_broadPhase=new Ga;this.m_contactList=null;this.m_contactCount=0;this.m_contactFilter=Jc;this.m_contactListener=Kc}function Lc(){this.rA=new d;this.rB=new d;this.velocityBias=this.tangentMass=this.normalMass=this.tangentImpulse=this.normalImpulse=0}function Mc(){this.localPoints=Array(na);this.localNormal=
new d;this.localPoint=new d;this.invMassB=this.invMassA=this.indexB=this.indexA=0;this.localCenterA=new d;this.localCenterB=new d;this.pointCount=this.radiusB=this.radiusA=this.type=this.invIB=this.invIA=0}function Nc(){this.points=Array(na);for(var a=0;a<this.points.length;++a)this.points[a]=new Lc;this.normal=new d;this.normalMass=new $;this.K=new $;this.contactIndex=this.pointCount=this.tangentSpeed=this.restitution=this.friction=this.invIB=this.invIA=this.invMassB=this.invMassA=this.indexB=this.indexA=
0}function bc(){this.normal=new d;this.point=new d;this.separation=0}function Oc(){this.step=new gb;this.contacts=null;this.count=0;this.velocities=this.positions=null}function E(){this.m_positionConstraints=[];this.m_velocityConstraints=[]}function K(){this.m_bodies=[];this.m_contacts=[];this.m_joints=[];this.m_velocities=[];this.m_positions=[]}function cc(){this.next=this.prev=this.joint=this.other=null}function oa(){this.type=s.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=
!1}function s(a){this.m_type=a.type;this.m_next=this.m_prev=null;this.m_bodyA=a.bodyA;this.m_bodyB=a.bodyB;this.m_index=0;this.m_collideConnected=a.collideConnected;this.m_islandFlag=!1;this.m_userData=a.userData;this.m_edgeA=new cc;this.m_edgeA.joint=null;this.m_edgeA.other=null;this.m_edgeA.prev=null;this.m_edgeA.next=null;this.m_edgeB=new cc;this.m_edgeB.joint=null;this.m_edgeB.other=null;this.m_edgeB.prev=null;this.m_edgeB.next=null}function hb(){this.parent.call(this);this.type=s.e_revoluteJoint;
this.localAnchorA=new d;this.localAnchorB=new d;this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0;this.enableMotor=this.enableLimit=!1;Object.seal(this)}function zb(a){this.parent.call(this,a);this.m_localAnchorA=a.localAnchorA.Clone();this.m_localAnchorB=a.localAnchorB.Clone();this.m_referenceAngle=a.referenceAngle;this.m_impulse=new N;this.m_motorImpulse=0;this.m_lowerAngle=a.lowerAngle;this.m_upperAngle=a.upperAngle;this.m_maxMotorTorque=a.maxMotorTorque;
this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=s.e_inactiveLimit;this.m_indexB=this.m_indexA=0;this.m_rA=new d;this.m_rB=new d;this.m_localCenterA=new d;this.m_localCenterB=new d;this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=0;this.m_mass=new Ba;this.m_motorMass=0}function Pc(){this.parent.call(this);this.type=s.e_mouseJoint;this.target=new d(0,0);this.maxForce=0;this.frequencyHz=5;this.dampingRatio=0.7;Object.seal(this)}
function Ab(a){this.parent.call(this,a);this.m_targetA=a.target.Clone();this.m_localAnchorB=Ca(this.m_bodyB.GetTransform(),this.m_targetA);this.m_maxForce=a.maxForce;this.m_impulse=new d;this.m_frequencyHz=a.frequencyHz;this.m_dampingRatio=a.dampingRatio;this.m_indexB=this.m_indexA=this.m_gamma=this.m_beta=0;this.m_rB=new d;this.m_localCenterB=new d;this.m_invIB=this.m_invMassB=0;this.m_mass=new $;this.m_C=new d}function ib(){this.parent.call(this);this.type=s.e_distanceJoint;this.localAnchorA=new d(0,
0);this.localAnchorB=new d(0,0);this.length=1;this.dampingRatio=this.frequencyHz=0;Object.seal(this)}function Bb(a){this.parent.call(this,a);this.m_localAnchorA=a.localAnchorA.Clone();this.m_localAnchorB=a.localAnchorB.Clone();this.m_length=a.length;this.m_frequencyHz=a.frequencyHz;this.m_dampingRatio=a.dampingRatio;this.m_indexB=this.m_indexA=this.m_bias=this.m_gamma=this.m_impulse=0;this.m_u=new d;this.m_rA=new d;this.m_rB=new d;this.m_localCenterA=new d;this.m_localCenterB=new d;this.m_mass=this.m_invIB=
this.m_invIA=this.m_invMassB=this.m_invMassA=0}function jb(){this.parent.call(this);this.type=s.e_prismaticJoint;this.localAnchorA=new d;this.localAnchorB=new d;this.localAxisA=new d(1,0);this.referenceAngle=0;this.enableLimit=!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0;Object.seal(this)}function Cb(a){this.parent.call(this,a);this.m_localAnchorA=a.localAnchorA.Clone();this.m_localAnchorB=a.localAnchorB.Clone();this.m_localXAxisA=a.localAxisA.Clone();
this.m_localXAxisA.Normalize();this.m_localYAxisA=S(1,this.m_localXAxisA);this.m_referenceAngle=a.referenceAngle;this.m_impulse=new N;this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=a.lowerTranslation;this.m_upperTranslation=a.upperTranslation;this.m_maxMotorForce=a.maxMotorForce;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=s.e_inactiveLimit;this.m_axis=new d;this.m_perp=new d;this.m_indexB=this.m_indexA=0;this.m_localCenterA=
new d;this.m_localCenterB=new d;this.m_a2=this.m_a1=this.m_s2=this.m_s1=this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=0;this.m_K=new Ba;this.m_motorMass=0}function kb(){this.parent.call(this);this.type=s.e_frictionJoint;this.localAnchorA=new d;this.localAnchorB=new d;this.maxTorque=this.maxForce=0;Object.seal(this)}function Db(a){this.parent.call(this,a);this.m_localAnchorA=a.localAnchorA.Clone();this.m_localAnchorB=a.localAnchorB.Clone();this.m_linearImpulse=new d;this.m_angularImpulse=
0;this.m_maxForce=a.maxForce;this.m_maxTorque=a.maxTorque;this.m_indexB=this.m_indexA=0;this.m_rA=new d;this.m_rB=new d;this.m_localCenterA=new d;this.m_localCenterB=new d;this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=0;this.m_linearMass=new $;this.m_angularMass=0}function lb(){this.parent.call(this);this.type=s.e_weldJoint;this.localAnchorA=new d(0,0);this.localAnchorB=new d(0,0);this.dampingRatio=this.frequencyHz=this.referenceAngle=0;Object.seal(this)}function Eb(a){this.parent.call(this,
a);this.m_indexB=this.m_indexA=this.m_gamma=this.m_bias=0;this.m_rA=new d;this.m_rB=new d;this.m_localCenterA=new d;this.m_localCenterB=new d;this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=0;this.m_mass=new Ba;this.m_localAnchorA=a.localAnchorA.Clone();this.m_localAnchorB=a.localAnchorB.Clone();this.m_referenceAngle=a.referenceAngle;this.m_frequencyHz=a.frequencyHz;this.m_dampingRatio=a.dampingRatio;this.m_impulse=new N}function mb(){this.parent.call(this);this.type=s.e_wheelJoint;this.localAnchorA=
new d;this.localAnchorB=new d;this.localAxisA=new d(1,0);this.enableMotor=!1;this.motorSpeed=this.maxMotorTorque=0;this.frequencyHz=2;this.dampingRatio=0.7;Object.seal(this)}function Fb(a){this.parent.call(this,a);this.m_indexB=this.m_indexA=0;this.m_localCenterA=new d;this.m_localCenterB=new d;this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=0;this.m_localAnchorA=a.localAnchorA.Clone();this.m_localAnchorB=a.localAnchorB.Clone();this.m_localXAxisA=a.localAxisA.Clone();this.m_localYAxisA=
S(1,this.m_localXAxisA);this.m_springImpulse=this.m_springMass=this.m_motorImpulse=this.m_motorMass=this.m_impulse=this.m_mass=0;this.m_maxMotorTorque=a.maxMotorTorque;this.m_motorSpeed=a.motorSpeed;this.m_enableMotor=a.enableMotor;this.m_frequencyHz=a.frequencyHz;this.m_dampingRatio=a.dampingRatio;this.m_gamma=this.m_bias=0;this.m_ax=new d;this.m_ay=new d;this.m_sAy=this.m_sBy=this.m_sAx=this.m_sBx=0}function Gb(){this.parent.call(this);this.type=s.e_gearJoint;this.joint2=this.joint1=null;this.ratio=
1;Object.seal(this)}function Hb(a){this.parent.call(this,a);this.m_joint1=a.joint1;this.m_joint2=a.joint2;this.m_typeA=this.m_joint1.GetType();this.m_typeB=this.m_joint2.GetType();var b,c;this.m_bodyC=this.m_joint1.GetBodyA();this.m_bodyA=this.m_joint1.GetBodyB();b=this.m_bodyA.m_xf;var e=this.m_bodyA.m_sweep.a;c=this.m_bodyC.m_xf;var f=this.m_bodyC.m_sweep.a;this.m_localAnchorA=new d;this.m_localAnchorB=new d;this.m_localAnchorC=new d;this.m_localAnchorD=new d;this.m_localAxisC=new d;this.m_localAxisD=
new d;this.m_typeA==s.e_revoluteJoint?(c=a.joint1,this.m_localAnchorC.Assign(c.m_localAnchorA),this.m_localAnchorA.Assign(c.m_localAnchorB),this.m_referenceAngleA=c.m_referenceAngle,this.m_localAxisC.SetZero(),b=e-f-this.m_referenceAngleA):(f=a.joint1,this.m_localAnchorC.Assign(f.m_localAnchorA),this.m_localAnchorA.Assign(f.m_localAnchorB),this.m_referenceAngleA=f.m_referenceAngle,this.m_localAxisC.Assign(f.m_localXAxisA),e=this.m_localAnchorC,b=pa(c.q,d.Add(C(b.q,this.m_localAnchorA),d.Subtract(b.p,
c.p))),b=v(d.Subtract(b,e),this.m_localAxisC));this.m_bodyD=this.m_joint2.GetBodyA();this.m_bodyB=this.m_joint2.GetBodyB();c=this.m_bodyB.m_xf;var f=this.m_bodyB.m_sweep.a,e=this.m_bodyD.m_xf,g=this.m_bodyD.m_sweep.a;this.m_typeB==s.e_revoluteJoint?(c=a.joint2,this.m_localAnchorD.Assign(c.m_localAnchorA),this.m_localAnchorB.Assign(c.m_localAnchorB),this.m_referenceAngleB=c.m_referenceAngle,this.m_localAxisD.SetZero(),c=f-g-this.m_referenceAngleB):(f=a.joint2,this.m_localAnchorD.Assign(f.m_localAnchorA),
this.m_localAnchorB.Assign(f.m_localAnchorB),this.m_referenceAngleB=f.m_referenceAngle,this.m_localAxisD.Assign(f.m_localXAxisA),f=this.m_localAnchorD,c=pa(e.q,d.Add(C(c.q,this.m_localAnchorB),d.Subtract(c.p,e.p))),c=v(d.Subtract(c,f),this.m_localAxisD));this.m_ratio=a.ratio;this.m_constant=b+this.m_ratio*c;this.m_indexA=this.m_indexB=this.m_indexC=this.m_indexD=this.m_impulse=0;this.m_lcA=new d;this.m_lcB=new d;this.m_lcC=new d;this.m_lcD=new d;this.m_iA=this.m_iB=this.m_iC=this.m_iD=this.m_mA=this.m_mB=
this.m_mC=this.m_mD=0;this.m_JvAC=new d;this.m_JvBD=new d;this.m_mass=this.m_JwA=this.m_JwB=this.m_JwC=this.m_JwD=0}function nb(){this.parent.call(this);this.type=s.e_motorJoint;this.linearOffset=new d;this.angularOffset=0;this.maxTorque=this.maxForce=1;this.correctionFactor=0.3;Object.seal(this)}function Ib(a){this.parent.call(this,a);this.m_linearOffset=a.linearOffset.Clone();this.m_angularOffset=a.angularOffset;this.m_linearImpulse=new d;this.m_angularImpulse=0;this.m_maxForce=a.maxForce;this.m_maxTorque=
a.maxTorque;this.m_correctionFactor=a.correctionFactor;this.m_indexB=this.m_indexA=0;this.m_rA=new d;this.m_rB=new d;this.m_localCenterA=new d;this.m_localCenterB=new d;this.m_linearError=new d;this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=this.m_angularError=0;this.m_linearMass=new $;this.m_angularMass=0}function Jb(){this.parent.call(this);this.type=s.e_pulleyJoint;this.groundAnchorA=new d(-1,1);this.groundAnchorB=new d(1,1);this.localAnchorA=new d(-1,0);this.localAnchorB=new d(1,0);
this.lengthB=this.lengthA=0;this.ratio=1;this.collideConnected=!0;Object.seal(this)}function Kb(a){this.parent.call(this,a);this.m_indexB=this.m_indexA=0;this.m_uA=new d;this.m_uB=new d;this.m_rA=new d;this.m_rB=new d;this.m_localCenterA=new d;this.m_localCenterB=new d;this.m_mass=this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=0;this.m_groundAnchorA=a.groundAnchorA.Clone();this.m_groundAnchorB=a.groundAnchorB.Clone();this.m_localAnchorA=a.localAnchorA.Clone();this.m_localAnchorB=a.localAnchorB.Clone();
this.m_lengthA=a.lengthA;this.m_lengthB=a.lengthB;this.m_ratio=a.ratio;this.m_constant=a.lengthA+this.m_ratio*a.lengthB;this.m_impulse=0}function ob(){this.parent.call(this);this.type=s.e_ropeJoint;this.localAnchorA=new d(-1,0);this.localAnchorB=new d(1,0);this.maxLength=0;Object.seal(this)}function Lb(a){this.parent.call(this,a);this.m_localAnchorA=a.localAnchorA.Clone();this.m_localAnchorB=a.localAnchorB.Clone();this.m_maxLength=a.maxLength;this.m_impulse=this.m_mass=0;this.m_state=s.e_inactiveLimit;
this.m_indexB=this.m_indexA=this.m_length=0;this.m_u=new d;this.m_rA=new d;this.m_rB=new d;this.m_localCenterA=new d;this.m_localCenterB=new d;this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=0}function Qc(){this.m_count=0;this.m_as=this.m_Ls=this.m_ims=this.m_vs=this.m_p0s=this.m_ps=null;this.m_damping=0;this.m_gravity=new d;this.m_k2=1;this.m_k3=0.1}Function.prototype._extend=function(a){this.prototype.parent=a;for(var b in a.prototype)this.prototype[b]||(this.prototype[b]=a.prototype[b])};
Function.prototype._implement=function(a){return this._extend(a)};Array.prototype.qsort=function(a,b,c){"undefined"===typeof a&&(a=0);"undefined"===typeof b&&(b=this.length-a);"undefined"===typeof c&&(c=function(a,b){return a<b});for(var e=[],f=0;;){for(;a+1<b;b++){var g=this[a+Math.floor(Math.random()*(b-a))];e[f++]=b;for(var d=a-1;;){for(;c(this[++d],g););for(;c(g,this[--b]););if(d>=b)break;var h=this[d];this[d]=this[b];this[b]=h}}if(0===f)break;a=b;b=e[--f]}return this};Array.prototype.collapse=
function(a,b){"undefined"===typeof b&&(b=this.length);for(var c=0,e=0;e<b;++e)a(this[e])||(e===c?++c:this[c++]=this[e]);return c};Array.prototype.lower_bound=function(a,b,c,e){"undefined"===typeof e&&(e=function(a,b){return a<b});for(b-=a;0<b;){var f=Math.floor(b/2),g=a+f;e(this[g],c)?(a=++g,b-=f+1):b=f}return a};Array.prototype.upper_bound=function(a,b,c,e){"undefined"===typeof e&&(e=function(a,b){return a<b});for(b-=a;0<b;){var f=Math.floor(b/2),g=a+f;e(c,this[g])?b=f:(a=++g,b-=f+1)}return a};Array.prototype.rotate=
function(a,b,c){for(var e=b;a!=e;){var f=this[a];this[a]=this[e];this[e]=f;++a;++e;e===c?e=b:a===b&&(b=e)}};var ua=function(){function a(a,b){this.name=a;this.parent=b;this.children={};this.totalTime=this.elapsedTime=this.startTime=0;this.running=!1;this.childrenCount=0}function b(a,c){if(a.name===c.parent)return a;for(var e in a.children){var d;if(d=b(a.children[e],c))return d}return null}"undefined"===typeof performance&&(window.performance={now:function(){return+new Date}});a.prototype={start:function(){this.startTime=
performance.now();this.running=!0},stop:function(a){if(this.running){this.running=!1;this.elapsedTime+=performance.now()-this.startTime;a&&this.start();for(var b in this.children)this.children[b].stop()}},reset:function(a){a||(this.running=!0,this.totalTime+=this.elapsedTime,this.start());this.elapsedTime=0;for(var b in this.children)this.children[b].reset(!0)}};var c=[],e=new a("root");return{create:function(b,e){if(!c)throw Error("late profile creation not allowed");var d=new a(b,e||"root");c.push(d);
return d},destroy:function(a){a.childrenCount--;delete a.children[a.name]},init:function(){for(;c.length;){var a=c.pop();(a.parentNode=b(e,a))?(a.parentNode.children[a.name]=a,a.parentNode.childrenCount++):c.unshift(a)}c=null},reset:function(){e.reset(!0)},profileRoot:e}}(),W=Number.MAX_VALUE,la=2.220446049250313E-16,ja=Math.PI,na=2,wa=8,Q=0.005,za=2/180*ja,ab=2*Q,pb=8/180*ja,qb=0.5*ja,dc=qb*qb,ec=2/180*ja;hc.prototype={toString:function(){return this.major+"."+this.minor+"."+this.revision}};var dd=
new hc(2,3,1),va=Math.sqrt,ed=Math.sin,fd=Math.cos,gd=Math.floor,fc=Math.atan2;d.prototype={Clone:function(){return new d(this.x,this.y)},SetZero:function(){this.y=this.x=0;return this},Set:function(a,b){this.x=a;this.y=b;return this},Assign:function(a){this.x=a.x;this.y=a.y;return this},Negate:function(){var a=new d;a.Set(-this.x,-this.y);return a},get_i:function(a){switch(a){case 0:return this.x;case 1:return this.y}},set_i:function(a,b){switch(a){case 0:return this.x=b;case 1:return this.y=b}},
Add:function(a){this.x+=a.x;this.y+=a.y;return this},Subtract:function(a){this.x-=a.x;this.y-=a.y;return this},Multiply:function(a){this.x*=a;this.y*=a;return this},Length:function(){return va(this.x*this.x+this.y*this.y)},LengthSquared:function(){return this.x*this.x+this.y*this.y},Normalize:function(){var a=this.Length();if(a<la)return 0;var b=1/a;this.x*=b;this.y*=b;return a},IsValid:function(){return ic(this.x)&&ic(this.y)},Skew:function(){return new d(-this.y,this.x)},_serialize:function(a){a=
a||[];a[0]=this.x;a[1]=this.y;return a},_deserialize:function(a){this.x=a[0];this.y=a[1]}};d.Add=function(a,b){return new d(a.x+b.x,a.y+b.y)};d.Subtract=function(a,b){return new d(a.x-b.x,a.y-b.y)};d.Equals=function(a,b){return a.x==b.x&&a.y==b.y};d.Multiply=function(a,b){return new d(a*b.x,a*b.y)};d.Negate=function(a){return new d(-a.x,-a.y)};N.prototype={Clone:function(){return new N(this.x,this.y,this.z)},SetZero:function(){this.z=this.y=this.x=0},Set:function(a,b,c){this.x=a;this.y=b;this.z=c},
Negate:function(){var a=new N;a.Set(-this.x,-this.y,-this.z);return a},Add:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z},Subtract:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z},Multiply:function(a){this.x*=a;this.y*=a;this.z*=a},Invert:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},x:0,y:0,z:0};N.Multiply=function(a,b){return new N(a*b.x,a*b.y,a*b.z)};N.Add=function(a,b){return new N(a.x+b.x,a.y+b.y,a.z+b.z)};N.Subtract=function(a,b){return new N(a.x-b.x,a.y-b.y,a.z-b.z)};
$.prototype={Set:function(a,b){this.ex.Assign(a);this.ey.Assign(b)},Assign:function(a){this.ex.Assign(a.ex);this.ey.Assign(a.ey)},SetIdentity:function(){this.ex.x=1;this.ey.x=0;this.ex.y=0;this.ey.y=1},SetZero:function(){this.ex.x=0;this.ey.x=0;this.ex.y=0;this.ey.y=0},GetInverse:function(){var a=this.ex.x,b=this.ey.x,c=this.ex.y,e=this.ey.y,f=new $,g=a*e-b*c;0!=g&&(g=1/g);f.ex.x=g*e;f.ey.x=-g*b;f.ex.y=-g*c;f.ey.y=g*a;return f},Solve:function(a){var b=this.ex.x,c=this.ey.x,e=this.ex.y,f=this.ey.y,
g=b*f-c*e;0!=g&&(g=1/g);var k=new d;k.x=g*(f*a.x-c*a.y);k.y=g*(b*a.y-e*a.x);return k}};$.Add=function(a,b){return new $(d.Add(a.ex,b.ex),d.Add(a.ey,b.ey))};Ba.prototype={SetZero:function(){this.ex.SetZero();this.ey.SetZero();this.ez.SetZero()},Solve33:function(a){var b=Oa(this.ex,Pa(this.ey,this.ez));0!=b&&(b=1/b);var c=new N;c.x=b*Oa(a,Pa(this.ey,this.ez));c.y=b*Oa(this.ex,Pa(a,this.ez));c.z=b*Oa(this.ex,Pa(this.ey,a));return c},Solve22:function(a){var b=this.ex.x,c=this.ey.x,e=this.ex.y,f=this.ey.y,
g=b*f-c*e;0!=g&&(g=1/g);var k=new d;k.x=g*(f*a.x-c*a.y);k.y=g*(b*a.y-e*a.x);return k},GetInverse22:function(a){var b=this.ex.x,c=this.ey.x,e=this.ex.y,f=this.ey.y,g=b*f-c*e;0!=g&&(g=1/g);a.ex.x=g*f;a.ey.x=-g*c;a.ex.z=0;a.ex.y=-g*e;a.ey.y=g*b;a.ey.z=0;a.ez.x=0;a.ez.y=0;a.ez.z=0},GetSymInverse33:function(a){var b=Oa(this.ex,Pa(this.ey,this.ez));0!=b&&(b=1/b);var c=this.ex.x,e=this.ey.x,f=this.ez.x,g=this.ey.y,d=this.ez.y,h=this.ez.z;a.ex.x=b*(g*h-d*d);a.ex.y=b*(f*d-e*h);a.ex.z=b*(e*d-f*g);a.ey.x=a.ex.y;
a.ey.y=b*(c*h-f*f);a.ey.z=b*(f*e-c*d);a.ez.x=a.ex.z;a.ez.y=a.ey.z;a.ez.z=b*(c*g-e*e)}};F.prototype={Clone:function(){return new F(this.s,this.c)},Assign:function(a){this.s=a.s;this.c=a.c},Set:function(a){this.s=ed(a);this.c=fd(a)},SetIdentity:function(){this.s=0;this.c=1},GetAngle:function(){return fc(this.s,this.c)},GetXAxis:function(){return new d(this.c,this.s)},GetYAxis:function(){return new d(-this.s,this.c)},s:0,c:1};Y.prototype={Clone:function(){return new Y(this.p,this.q)},Assign:function(a){this.p.Assign(a.p);
this.q.Assign(a.q)},SetIdentity:function(){this.p.SetZero();this.q.SetIdentity()},Set:function(a,b){this.p.Assign(a);this.q.Set(b)}};sa.prototype={Assign:function(a){this.localCenter.Assign(a.localCenter);this.c0.Assign(a.c0);this.c.Assign(a.c);this.a=a.a;this.a0=a.a0;this.alpha0=a.alpha0},Clone:function(){var a=new sa;a.localCenter.Assign(this.localCenter);a.c0.Assign(this.c0);a.c.Assign(this.c);a.a=this.a;a.a0=this.a0;a.alpha0=this.alpha0;return a},GetTransform:function(a,b){a.p.x=(1-b)*this.c0.x+
b*this.c.x;a.p.y=(1-b)*this.c0.y+b*this.c.y;a.q.Set((1-b)*this.a0+b*this.a);a.p.x-=a.q.c*this.localCenter.x-a.q.s*this.localCenter.y;a.p.y-=a.q.s*this.localCenter.x+a.q.c*this.localCenter.y},Advance:function(a){var b=(a-this.alpha0)/(1-this.alpha0);this.c0.Add(d.Multiply(b,d.Subtract(this.c,this.c0)));this.a0+=b*(this.a-this.a0);this.alpha0=a},Normalize:function(){var a=2*ja,a=a*gd(this.a0/a);this.a0-=a;this.a-=a},a0:0,a:0,alpha0:0};var aa=Math.abs,O=Math.min,H=Math.max;ea.prototype={Set:function(a,
b,c){this.r=a;this.g=b;this.b=c}};ba.prototype={SetFlags:function(a){this.m_drawFlags=a},GetFlags:function(){return this.m_drawFlags},AppendFlags:function(a){this.m_drawFlags|=a},ClearFlags:function(a){this.m_drawFlags&=~a},ToggleFlags:function(a){this.m_drawFlags^=a},DrawPolygon:function(a,b,c){},DrawSolidPolygon:function(a,b,c){},DrawCircle:function(a,b,c){},DrawSolidCircle:function(a,b,c,e){},DrawSegment:function(a,b,c){},DrawTransform:function(a){},DrawParticles:function(a,b,c,e){},m_drawFlags:0};
ba.e_shapeBit=1;ba.e_jointBit=2;ba.e_aabbBit=4;ba.e_centerOfMassBit=8;ba.e_contactPoints=16;ba.e_contactNormals=32;ba.e_contactImpulses=64;ba.e_frictionImpulses=128;ba.e_statistics=256;ba.e_profile=512;ba.e_pairBit=1024;"undefined"===typeof performance&&(window.performance={now:function(){return+new Date}});pc.prototype={Reset:function(){this.m_start=performance.now()},GetMilliseconds:function(){return performance.now()-this.m_start}};G.prototype={Clone:function(){},GetType:function(){return this.m_type},
GetChildCount:function(){},TestPoint:function(a,b){},RayCast:function(a,b,c,e){},ComputeAABB:function(a,b,c){},ComputeMass:function(a,b){},ComputeDistance:function(a,b,c,e,f){},_serialize:function(a){a=a||{};a.m_type=this.m_type;a.m_radius=this.m_radius;return a},_deserialize:function(a){this.m_radius=a.m_radius}};G.e_circle=0;G.e_edge=1;G.e_polygon=2;G.e_chain=3;G.e_typeCount=4;Qa.prototype={Clone:function(){var a=new Qa;a.m_radius=this.m_radius;a.m_p=this.m_p.Clone();return a},GetChildCount:function(){return 1},
TestPoint:function(a,b){var c=d.Add(a.p,C(a.q,this.m_p)),c=d.Subtract(b,c);return v(c,c)<=this.m_radius*this.m_radius},RayCast:function(a,b,c,e){c=d.Add(c.p,C(c.q,this.m_p));c=d.Subtract(b.p1,c);var f=v(c,c)-this.m_radius*this.m_radius;e=d.Subtract(b.p2,b.p1);var g=v(c,e),k=v(e,e),f=g*g-k*f;if(0>f||k<la)return!1;g=-(g+va(f));return 0<=g&&g<=b.maxFraction*k?(g/=k,a.fraction=g,a.normal=d.Add(c,d.Multiply(g,e)),a.normal.Normalize(),!0):!1},ComputeAABB:function(a,b,c){c=b.p.x+(b.q.c*this.m_p.x-b.q.s*
this.m_p.y);b=b.p.y+(b.q.s*this.m_p.x+b.q.c*this.m_p.y);a.lowerBound.x=c-this.m_radius;a.lowerBound.y=b-this.m_radius;a.upperBound.x=c+this.m_radius;a.upperBound.y=b+this.m_radius},ComputeMass:function(a,b){a.mass=b*ja*this.m_radius*this.m_radius;a.center=this.m_p;a.I=a.mass*(0.5*this.m_radius*this.m_radius+v(this.m_p,this.m_p))},GetSupport:function(a){return 0},GetSupportVertex:function(a){return this.m_p},GetVertexCount:function(){return 1},GetVertex:function(a){return this.m_p},ComputeDistance:function(a,
b,c,e,f){a=d.Add(a.p,C(a.q,this.m_p));b=d.Subtract(b,a);a=b.Length();c[0]=a-this.m_radius;e.Assign(d.Multiply(1/a,b))},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.m_p=this.m_p._serialize();return a},_deserialize:function(a){this.parent.prototype._deserialize.call(this,a);this.m_p._deserialize(a.m_p)}};Qa._extend(G);Ja.prototype={Set:function(a,b){this.m_vertex1.Assign(a);this.m_vertex2.Assign(b);this.m_hasVertex3=this.m_hasVertex0=!1},Clone:function(){var a=new Ja;
a.m_vertex0=this.m_vertex0.Clone();a.m_vertex1=this.m_vertex1.Clone();a.m_vertex2=this.m_vertex2.Clone();a.m_vertex3=this.m_vertex3.Clone();a.m_hasVertex0=this.m_hasVertex0;a.m_hasVertex3=this.m_hasVertex3;return a},GetChildCount:function(){return 1},TestPoint:function(a,b){return!1},RayCast:function(a,b,c,e){var f=pa(c.q,d.Subtract(b.p1,c.p));e=pa(c.q,d.Subtract(b.p2,c.p));var g=d.Subtract(e,f);e=this.m_vertex1;var k=this.m_vertex2,h=d.Subtract(k,e),h=new d(h.y,-h.x);h.Normalize();var l=v(h,d.Subtract(e,
f)),m=v(h,g);if(0==m)return!1;m=l/m;if(0>m||b.maxFraction<m)return!1;b=d.Add(f,d.Multiply(m,g));f=d.Subtract(k,e);k=v(f,f);if(0==k)return!1;e=v(d.Subtract(b,e),f)/k;if(0>e||1<e)return!1;a.fraction=m;a.normal=0<l?C(c.q,h).Negate():C(c.q,h);return!0},ComputeAABB:function(a,b,c){var e=b.q.c*this.m_vertex1.x-b.q.s*this.m_vertex1.y+b.p.x;c=b.q.s*this.m_vertex1.x+b.q.c*this.m_vertex1.y+b.p.y;var f=b.q.c*this.m_vertex2.x-b.q.s*this.m_vertex2.y+b.p.x,g=b.q.s*this.m_vertex2.x+b.q.c*this.m_vertex2.y+b.p.y;
b=O(e,f);var d=O(c,g),e=H(e,f);c=H(c,g);a.lowerBound.x=b-this.m_radius;a.lowerBound.y=d-this.m_radius;a.upperBound.x=e+this.m_radius;a.upperBound.y=c+this.m_radius},ComputeMass:function(a,b){a.mass=0;a.center=d.Multiply(0.5,d.Add(this.m_vertex1,this.m_vertex2));a.I=0},ComputeDistance:function(a,b,c,e,f){var g=V(a,this.m_vertex1);f=V(a,this.m_vertex2);a=d.Subtract(b,g);var g=d.Subtract(f,g),k=v(a,g);if(0<k){var h=v(g,g);k>h?a.Assign(d.Subtract(b,f)):a.Subtract(d.Multiply(k/h,g))}b=a.Length();c[0]=
b;e.Assign(0<b?d.Multiply(1/b,a):new d(0,0))},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.m_vertex1=this.m_vertex1._serialize();a.m_vertex2=this.m_vertex2._serialize();(a.m_hasVertex0=this.m_hasVertex0)&&(a.m_vertex0=this.m_vertex0._serialize());(a.m_hasVertex3=this.m_hasVertex3)&&(a.m_vertex3=this.m_vertex3._serialize());return a},_deserialize:function(a){this.parent.prototype._deserialize.call(this,a);this.m_vertex1._deserialize(a.m_vertex1);this.m_vertex2._deserialize(a.m_vertex2);
(this.m_hasVertex0=a.m_hasVertex0)&&this.m_vertex0._deserialize(a.m_vertex0);(this.m_hasVertex3=a.m_hasVertex3)&&this.m_vertex3._deserialize(a.m_vertex3)}};Ja._extend(G);qa._tempEdge=new Ja;qa.prototype={Clear:function(){this.m_vertices=null;this.m_count=0},CreateLoop:function(a,b){this.m_count=b+1;this.m_vertices=Array(this.m_count);for(var c=0;c<b;++c)this.m_vertices[c]=a[c].Clone();this.m_vertices[b]=this.m_vertices[0].Clone();this.m_prevVertex.Assign(this.m_vertices[this.m_count-2]);this.m_nextVertex.Assign(this.m_vertices[1]);
this.m_hasNextVertex=this.m_hasPrevVertex=!0},CreateChain:function(a,b){this.m_count=b;this.m_vertices=Array(b);for(var c=0;c<b;++c)this.m_vertices[c]=a[c].Clone();this.m_hasNextVertex=this.m_hasPrevVertex=!1;this.m_prevVertex.SetZero();this.m_nextVertex.SetZero()},SetPrevVertex:function(a){this.m_prevVertex.Assign(a);this.m_hasPrevVertex=!0},SetNextVertex:function(a){this.m_nextVertex.Assign(a);this.m_hasNextVertex=!0},Clone:function(){var a=new qa;a.m_count=this.m_count;a.m_vertices=Array(this.m_count);
for(var b=0;b<this.m_count;++b)a.m_vertices[b]=this.m_vertices[b].Clone();a.m_prevVertex=this.m_prevVertex.Clone();a.m_nextVertex=this.m_nextVertex.Clone();a.m_hasPrevVertex=this.m_hasPrevVertex;a.m_hasNextVertex=this.m_hasNextVertex;return a},GetChildCount:function(){return this.m_count-1},GetChildEdge:function(a,b){a.m_type=G.e_edge;a.m_radius=this.m_radius;a.m_vertex1=this.m_vertices[b+0];a.m_vertex2=this.m_vertices[b+1];0<b?(a.m_vertex0=this.m_vertices[b-1],a.m_hasVertex0=!0):(a.m_vertex0=this.m_prevVertex,
a.m_hasVertex0=this.m_hasPrevVertex);b<this.m_count-2?(a.m_vertex3=this.m_vertices[b+2],a.m_hasVertex3=!0):(a.m_vertex3=this.m_nextVertex,a.m_hasVertex3=this.m_hasNextVertex)},TestPoint:function(a,b){return!1},RayCast:function(a,b,c,e){var f=e+1;f==this.m_count&&(f=0);qa._tempEdge.m_vertex1=this.m_vertices[e].Clone();qa._tempEdge.m_vertex2=this.m_vertices[f].Clone();return qa._tempEdge.RayCast(a,b,c,0)},ComputeAABB:function(a,b,c){var e=c+1;e==this.m_count&&(e=0);var f=b.q.c*this.m_vertices[c].x-
b.q.s*this.m_vertices[c].y+b.p.x;c=b.q.s*this.m_vertices[c].x+b.q.c*this.m_vertices[c].y+b.p.y;var g=b.q.c*this.m_vertices[e].x-b.q.s*this.m_vertices[e].y+b.p.x;b=b.q.s*this.m_vertices[e].x+b.q.c*this.m_vertices[e].y+b.p.y;a.lowerBound.x=O(f,g);a.lowerBound.y=O(c,b);a.upperBound.x=H(f,g);a.upperBound.y=H(c,b)},ComputeMass:function(a,b){a.mass=0;a.center.SetZero();a.I=0},ComputeDistance:function(a,b,c,e,f){this.GetChildEdge(qa._tempEdge,f);qa._tempEdge.ComputeDistance(a,b,c,e,0)},_serialize:function(a){a=
a||{};this.parent.prototype._serialize.call(this,a);a.m_count=this.m_count;a.m_vertices=[];for(var b=0;b<this.m_count;++b)a.m_vertices.push(this.m_vertices[b]._serialize());(a.m_hasPrevVertex=this.m_hasPrevVertex)&&(a.m_prevVertex=this.m_prevVertex._serialize());(a.m_hasNextVertex=this.m_hasNextVertex)&&(a.m_nextVertex=this.m_nextVertex._serialize());return a},_deserialize:function(a){this.parent.prototype._deserialize.call(this,a);this.m_count=a.m_count;this.m_vertices=[];for(var b=0;b<this.m_count;++b)this.m_vertices[b]=
new d,this.m_vertices[b]._deserialize(a.m_vertices[b]);(this.m_hasPrevVertex=a.m_hasPrevVertex)&&this.m_prevVertex._deserialize(a.m_prevVertex);(this.m_hasNextVertex=a.m_hasNextVertex)&&this.m_nextVertex._deserialize(a.m_nextVertex)}};qa._extend(G);Fa.prototype={Clone:function(){var a=new Fa;a.m_count=this.m_count;a.m_centroid=this.m_centroid.Clone();for(var b=0;b<this.m_count;++b)a.m_vertices[b]=this.m_vertices[b].Clone(),a.m_normals[b]=this.m_normals[b].Clone();return a},GetChildCount:function(){return 1},
Set:function(a,b){if(3>b)this.SetAsBox(1,1);else{for(var c=O(b,wa),e=Array(wa),f=0,g=0;g<c;++g){for(var k=a[g],h=!0,l=0;l<f;++l)if(rb(k,e[l])<0.5*Q){h=!1;break}h&&(e[f++]=k.Clone())}c=f;if(3>c)this.SetAsBox(1,1);else{f=0;k=e[0].x;for(g=1;g<c;++g)if(l=e[g].x,l>k||l==k&&e[g].y<e[f].y)f=g,k=l;for(var m=Array(wa),h=0,g=f;;){m[h]=g;for(var n=0,l=1;l<c;++l)if(n==g)n=l;else{var p=d.Subtract(e[n],e[m[h]]),k=d.Subtract(e[l],e[m[h]]),q=u(p,k);0>q&&(n=l);0==q&&k.LengthSquared()>p.LengthSquared()&&(n=l)}++h;
g=n;if(n==f)break}if(3>h)this.SetAsBox(1,1);else{this.m_count=h;for(g=0;g<h;++g)this.m_vertices[g]=e[m[g]].Clone();for(g=0;g<h;++g)c=d.Subtract(this.m_vertices[g+1<h?g+1:0],this.m_vertices[g]),this.m_normals[g]=jc(c,1).Clone(),this.m_normals[g].Normalize();this.m_centroid=Fa.ComputeCentroid(this.m_vertices,h)}}}},SetAsBox:function(a,b,c,e){this.m_count=4;this.m_vertices[0]=new d(-a,-b);this.m_vertices[1]=new d(a,-b);this.m_vertices[2]=new d(a,b);this.m_vertices[3]=new d(-a,b);this.m_normals[0]=new d(0,
-1);this.m_normals[1]=new d(1,0);this.m_normals[2]=new d(0,1);this.m_normals[3]=new d(-1,0);if(c)for(this.m_centroid.Assign(c),a=new Y,a.p=c,a.q.Set(e),c=0;c<this.m_count;++c)this.m_vertices[c].Assign(V(a,this.m_vertices[c])),this.m_normals[c].Assign(C(a.q,this.m_normals[c]))},TestPoint:function(a,b){for(var c=pa(a.q,d.Subtract(b,a.p)),e=0;e<this.m_count;++e)if(0<v(this.m_normals[e],d.Subtract(c,this.m_vertices[e])))return!1;return!0},RayCast:function(a,b,c,e){e=pa(c.q,d.Subtract(b.p1,c.p));var f=
pa(c.q,d.Subtract(b.p2,c.p)),f=d.Subtract(f,e),g=0;b=b.maxFraction;for(var k=-1,h=0;h<this.m_count;++h){var l=v(this.m_normals[h],d.Subtract(this.m_vertices[h],e)),m=v(this.m_normals[h],f);if(0==m){if(0>l)return!1}else 0>m&&l<g*m?(g=l/m,k=h):0<m&&l<b*m&&(b=l/m);if(b<g)return!1}return 0<=k?(a.fraction=g,a.normal=C(c.q,this.m_normals[k]),!0):!1},ComputeAABB:function(a,b,c){c=b.q.c*this.m_vertices[0].x-b.q.s*this.m_vertices[0].y+b.p.x;for(var e=b.q.s*this.m_vertices[0].x+b.q.c*this.m_vertices[0].y+b.p.y,
f=c,g=e,d=1;d<this.m_count;++d){var h=b.q.c*this.m_vertices[d].x-b.q.s*this.m_vertices[d].y+b.p.x,l=b.q.s*this.m_vertices[d].x+b.q.c*this.m_vertices[d].y+b.p.y;c=O(c,h);e=O(e,l);f=H(f,h);g=H(g,l)}a.lowerBound.x=c-this.m_radius;a.lowerBound.y=e-this.m_radius;a.upperBound.x=f+this.m_radius;a.upperBound.y=g+this.m_radius},ComputeMass:function(a,b){for(var c=new d(0,0),e=0,f=0,g=new d(0,0),k=0;k<this.m_count;++k)g.Add(this.m_vertices[k]);g.Multiply(1/this.m_count);for(var h=1/3,k=0;k<this.m_count;++k){var l=
d.Subtract(this.m_vertices[k],g),m=k+1<this.m_count?d.Subtract(this.m_vertices[k+1],g):d.Subtract(this.m_vertices[0],g),n=u(l,m),p=0.5*n,e=e+p;c.Add(d.Multiply(p*h,d.Add(l,m)));var p=l.x,l=l.y,q=m.x,m=m.y,f=f+0.25*h*n*(p*p+q*p+q*q+(l*l+m*l+m*m))}a.mass=b*e;c.Multiply(1/e);a.center=d.Add(c,g);a.I=b*f;a.I+=a.mass*(v(a.center,a.center)-v(c,c))},GetVertexCount:function(){return this.m_count},GetVertex:function(a){return this.m_vertices[a]},Validate:function(){for(var a=0;a<this.m_count;++a)for(var b=
a,c=a<this.m_count-1?b+1:0,e=this.m_vertices[b],f=d.Subtract(this.m_vertices[c],e),g=0;g<this.m_count;++g)if(g!=b&&g!=c){var k=d.Subtract(this.m_vertices[g],e);if(0>u(f,k))return!1}return!0},ComputeDistance:function(a,b,c,e,f){b=pa(a.q,d.Subtract(b,a.p));var g=-Number.MAX_VALUE,k=b;for(f=0;f<this.m_count;++f){var h=v(this.m_normals[f],d.Subtract(b,this.m_vertices[f]));h>g&&(g=h,k=this.m_normals[f])}if(0<g){g*=g;for(f=0;f<this.m_count;++f){var h=d.Subtract(b,this.m_vertices[f]),l=h.LengthSquared();
g>l&&(k=h,g=l)}c[0]=va(g);e.Assign(C(a.q,k));e.Normalize()}else c[0]=g,e.Assign(C(a.q,k))},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.m_count=this.m_count;a.m_centroid=this.m_centroid._serialize();a.m_vertices=[];a.m_normals=[];for(var b=0;b<this.m_count;++b)a.m_vertices.push(this.m_vertices[b]._serialize()),a.m_normals.push(this.m_normals[b]._serialize());return a},_deserialize:function(a){this.parent.prototype._deserialize.call(this,a);this.m_count=a.m_count;
this.m_centroid._deserialize(a.m_centroid);this.m_vertices=[];this.m_normals=[];for(var b=0;b<this.m_count;++b)this.m_vertices[b]=new d,this.m_vertices[b]._deserialize(a.m_vertices[b]),this.m_normals[b]=new d,this.m_normals[b]._deserialize(a.m_normals[b])}};Fa.ComputeCentroid=function(a,b){for(var c=new d,e=0,f=new d(0,0),g=1/3,k=0;k<b;++k){var h=f,l=a[k],m=k+1<b?a[k+1]:a[0],n=d.Subtract(l,h),p=d.Subtract(m,h),n=0.5*u(n,p),e=e+n;c.Add(d.Multiply(n,d.Multiply(g,d.Add(d.Add(h,l),m))))}c.Multiply(1/
e);return c};Fa._extend(G);Ga.prototype={CreateProxy:function(a,b){var c=this.m_tree.CreateProxy(a,b);++this.m_proxyCount;this.BufferMove(c);return c},DestroyProxy:function(a){this.UnBufferMove(a);--this.m_proxyCount;this.m_tree.DestroyProxy(a)},MoveProxy:function(a,b,c){this.m_tree.MoveProxy(a,b,c)&&this.BufferMove(a)},TouchProxy:function(a){this.BufferMove(a)},GetFatAABB:function(a){return this.m_tree.GetFatAABB(a)},GetUserData:function(a){return this.m_tree.GetUserData(a)},TestOverlap:function(a,
b){var c=this.m_tree.GetFatAABB(a),e=this.m_tree.GetFatAABB(b);return tb(c,e)},GetProxyCount:function(){return this.m_proxyCount},UpdatePairs:function(a){this.m_pairCount=0;for(var b=this.m_pairBuffer.length=0;b<this.m_moveCount;++b)if(this.m_queryProxyId=this.m_moveBuffer[b],this.m_queryProxyId!=Ga.e_nullProxy){var c=this.m_tree.GetFatAABB(this.m_queryProxyId);this.m_tree.Query(this,c)}this.m_moveCount=0;this.m_pairBuffer.sort(sc);for(b=0;b<this.m_pairCount;){var c=this.m_pairBuffer[b],e=this.m_tree.GetUserData(c.proxyIdA),
f=this.m_tree.GetUserData(c.proxyIdB);a.AddPair(e,f);for(++b;b<this.m_pairCount;){e=this.m_pairBuffer[b];if(e.proxyIdA!=c.proxyIdA||e.proxyIdB!=c.proxyIdB)break;++b}}},Query:function(a,b){this.m_tree.Query(a,b)},RayCast:function(a,b){this.m_tree.RayCast(a,b)},GetTreeHeight:function(){return this.m_tree.GetHeight()},GetTreeBalance:function(){return this.m_tree.GetMaxBalance()},GetTreeQuality:function(){return this.m_tree.GetAreaRatio()},ShiftOrigin:function(a){this.m_tree.ShiftOrigin(a)},BufferMove:function(a){this.m_moveBuffer[this.m_moveCount]=
a;++this.m_moveCount},UnBufferMove:function(a){for(var b=0;b<this.m_moveCount;++b)this.m_moveBuffer[b]==a&&(this.m_moveBuffer[b]=Ga.e_nullProxy)},QueryCallback:function(a){if(a==this.m_queryProxyId)return!0;this.m_pairBuffer[this.m_pairCount]=new rc;this.m_pairBuffer[this.m_pairCount].proxyIdA=O(a,this.m_queryProxyId);this.m_pairBuffer[this.m_pairCount].proxyIdB=H(a,this.m_queryProxyId);++this.m_pairCount;return!0}};Ga.e_nullProxy=-1;Ra.prototype={Assign:function(a){this.m_vertices=a.m_vertices;this.m_count=
a.m_count;this.m_radius=a.m_radius},Set:function(a,b){switch(a.GetType()){case G.e_circle:this.m_vertices=[a.m_p];this.m_count=1;this.m_radius=a.m_radius;break;case G.e_polygon:this.m_vertices=a.m_vertices;this.m_count=a.m_count;this.m_radius=a.m_radius;break;case G.e_chain:this.m_vertices=[a.m_vertices[b]];this.m_vertices[1]=b+1<a.m_count?a.m_vertices[b+1]:a.m_vertices[0];this.m_count=2;this.m_radius=a.m_radius;break;case G.e_edge:this.m_vertices=[a.m_vertex1,a.m_vertex2],this.m_count=2,this.m_radius=
a.m_radius}},GetSupport:function(a,b){for(var c=0,e=this.m_vertices[0].x*a+this.m_vertices[0].y*b,f=1;f<this.m_count;++f){var g=this.m_vertices[f].x*a+this.m_vertices[f].y*b;g>e&&(c=f,e=g)}return c},GetSupportVertex:function(a,b){return this.m_vertices[this.GetSupport(a,b)]},GetVertexCount:function(){return this.m_count},GetVertex:function(a){return this.m_vertices[a]}};bb.prototype={Assign:function(a){this.wA.x=a.wA.x;this.wA.y=a.wA.y;this.wB.x=a.wB.x;this.wB.y=a.wB.y;this.w.x=a.w.x;this.w.y=a.w.y;
this.a=a.a;this.indexA=a.indexA;this.indexB=a.indexB}};Rb.prototype={ReadCache:function(a,b,c,e,f){this.m_count=a.count;for(var g=this.m_v,d=0;d<this.m_count;++d){var h=g[d];h.indexA=a.indexA[d];h.indexB=a.indexB[d];var l=b.GetVertex(h.indexA),m=e.GetVertex(h.indexB);h.wA.x=c.q.c*l.x-c.q.s*l.y+c.p.x;h.wA.y=c.q.s*l.x+c.q.c*l.y+c.p.y;h.wB.x=f.q.c*m.x-f.q.s*m.y+f.p.x;h.wB.y=f.q.s*m.x+f.q.c*m.y+f.p.y;h.w.x=h.wB.x-h.wA.x;h.w.y=h.wB.y-h.wA.y;h.a=0}1<this.m_count&&(a=a.metric,d=this.GetMetric(),d<0.5*a||
2*a<d||d<la)&&(this.m_count=0);0==this.m_count&&(h=g[0],h.indexA=0,h.indexB=0,l=b.GetVertex(0),m=e.GetVertex(0),h.wA.x=c.q.c*l.x-c.q.s*l.y+c.p.x,h.wA.y=c.q.s*l.x+c.q.c*l.y+c.p.y,h.wB.x=f.q.c*m.x-f.q.s*m.y+f.p.x,h.wB.y=f.q.s*m.x+f.q.c*m.y+f.p.y,h.w.x=h.wB.x-h.wA.x,h.w.y=h.wB.y-h.wA.y,this.m_count=h.a=1)},WriteCache:function(a){a.metric=this.GetMetric();a.count=this.m_count;for(var b=this.m_v,c=0;c<this.m_count;++c)a.indexA[c]=b[c].indexA,a.indexB[c]=b[c].indexB},GetSearchDirection:function(a){switch(this.m_count){case 1:a.x=
-this.m_v[0].w.x;a.y=-this.m_v[0].w.y;break;case 2:var b=this.m_v[1].w.x-this.m_v[0].w.x,c=this.m_v[1].w.y-this.m_v[0].w.y;0<b*-this.m_v[0].w.y-c*-this.m_v[0].w.x?(a.x=-1*c,a.y=1*b):(a.x=1*c,a.y=-1*b)}},GetClosestPoint:function(a){switch(this.m_count){case 1:a.x=this.m_v[0].w.x;a.y=this.m_v[0].w.y;break;case 2:a.x=this.m_v[0].a*this.m_v[0].w.x+this.m_v[1].a*this.m_v[1].w.x;a.y=this.m_v[0].a*this.m_v[0].w.y+this.m_v[1].a*this.m_v[1].w.y;break;case 3:a.x=a.y=0}},GetWitnessPoints:function(a,b){switch(this.m_count){case 1:a.x=
this.m_v[0].wA.x;a.y=this.m_v[0].wA.y;b.x=this.m_v[0].wB.x;b.y=this.m_v[0].wB.y;break;case 2:a.x=this.m_v[0].a*this.m_v[0].wA.x+this.m_v[1].a*this.m_v[1].wA.x;a.y=this.m_v[0].a*this.m_v[0].wA.y+this.m_v[1].a*this.m_v[1].wA.y;b.x=this.m_v[0].a*this.m_v[0].wB.x+this.m_v[1].a*this.m_v[1].wB.x;b.y=this.m_v[0].a*this.m_v[0].wB.y+this.m_v[1].a*this.m_v[1].wB.y;break;case 3:a.x=this.m_v[0].a*this.m_v[0].wA.x+this.m_v[1].a*this.m_v[1].wA.x+this.m_v[2].a*this.m_v[2].wA.x,a.y=this.m_v[0].a*this.m_v[0].wA.y+
this.m_v[1].a*this.m_v[1].wA.y+this.m_v[2].a*this.m_v[2].wA.y,b.x=a.x,b.y=a.y}},GetMetric:function(){switch(this.m_count){case 1:return 0;case 2:return Na(this.m_v[0].w,this.m_v[1].w);case 3:return(this.m_v[1].w.x-this.m_v[0].w.x)*(this.m_v[2].w.y-this.m_v[0].w.y)-(this.m_v[1].w.y-this.m_v[0].w.y)*(this.m_v[2].w.x-this.m_v[0].w.x)}},Solve2:function(){var a=this.m_v[0].w,b=this.m_v[1].w,c=b.x-a.x,e=b.y-a.y,a=-(a.x*c+a.y*e);0>=a?this.m_count=this.m_v[0].a=1:(b=b.x*c+b.y*e,0>=b?(this.m_count=this.m_v[1].a=
1,this.m_v[0].Assign(this.m_v[1])):(c=1/(b+a),this.m_v[0].a=b*c,this.m_v[1].a=a*c,this.m_count=2))},Solve3:function(){var a=this.m_v[0].w,b=this.m_v[1].w,c=this.m_v[2].w,e=b.x-a.x,f=b.y-a.y,g=b.x*e+b.y*f,d=-(a.x*e+a.y*f),h=c.x-a.x,l=c.y-a.y,m=c.x*h+c.y*l,n=-(a.x*h+a.y*l),p=c.x-b.x,q=c.y-b.y,r=c.x*p+c.y*q,p=-(b.x*p+b.y*q),f=e*l-f*h,e=f*(b.x*c.y-b.y*c.x),c=f*(c.x*a.y-c.y*a.x),a=f*(a.x*b.y-a.y*b.x);0>=d&&0>=n?this.m_count=this.m_v[0].a=1:0<g&&0<d&&0>=a?(m=1/(g+d),this.m_v[0].a=g*m,this.m_v[1].a=d*m,
this.m_count=2):0<m&&0<n&&0>=c?(g=1/(m+n),this.m_v[0].a=m*g,this.m_v[2].a=n*g,this.m_count=2,this.m_v[1].Assign(this.m_v[2])):0>=g&&0>=p?(this.m_count=this.m_v[1].a=1,this.m_v[0].Assign(this.m_v[1])):0>=m&&0>=r?(this.m_count=this.m_v[2].a=1,this.m_v[0].Assign(this.m_v[2])):0<r&&0<p&&0>=e?(g=1/(r+p),this.m_v[1].a=r*g,this.m_v[2].a=p*g,this.m_count=2,this.m_v[0].Assign(this.m_v[2])):(g=1/(e+c+a),this.m_v[0].a=e*g,this.m_v[1].a=c*g,this.m_v[2].a=a*g,this.m_count=3)}};var ka=new Rb,Ka=new d,ra=new d;
xa.b2_gjkCalls=0;xa.b2_gjkIters=0;xa.b2_gjkMaxIters=0;U.prototype={indexA:0,indexB:0,typeA:0,typeB:0,Reset:function(){this.indexA=this.indexB=this.typeA=this.typeB=0},Get:function(){return this.indexA|this.indexB<<8|this.typeA<<16|this.typeB<<24},Assign:function(a){this.indexA=a.indexA;this.indexB=a.indexB;this.typeA=a.typeA;this.typeB=a.typeB}};U.e_vertex=0;U.e_face=1;ma.prototype={Clone:function(){var a=new ma;a.localPoint.x=this.localPoint.x;a.localPoint.y=this.localPoint.y;a.normalImpulse=this.normalImpulse;
a.tangentImpulse=this.tangentImpulse;a.id.Assign(this.id);return a}};L.prototype={Clone:function(){var a=new L;a.pointCount=this.pointCount;a.type=this.type;a.localPoint.x=this.localPoint.x;a.localPoint.y=this.localPoint.y;a.localNormal.x=this.localNormal.x;a.localNormal.y=this.localNormal.y;for(var b=0;b<this.pointCount;++b)a.points[b]=this.points[b].Clone();return a},Assign:function(a){this.pointCount=a.pointCount;this.type=a.type;this.localPoint.x=a.localPoint.x;this.localPoint.y=a.localPoint.y;
this.localNormal.x=a.localNormal.x;this.localNormal.y=a.localNormal.y;for(var b=0;b<this.pointCount;++b)this.points[b]=a.points[b].Clone()}};L.e_circles=0;L.e_faceA=1;L.e_faceB=2;L.b2_nullState=0;L.b2_addState=1;L.b2_persistState=2;L.b2_removeState=3;Sb.prototype={Initialize:function(a,b,c,e,f){if(0!=a.pointCount)switch(a.type){case L.e_circles:this.normal.x=1;this.normal.y=0;var g=b.q.c*a.localPoint.x-b.q.s*a.localPoint.y+b.p.x,k=b.q.s*a.localPoint.x+b.q.c*a.localPoint.y+b.p.y;b=e.q.c*a.points[0].localPoint.x-
e.q.s*a.points[0].localPoint.y+e.p.x;a=e.q.s*a.points[0].localPoint.x+e.q.c*a.points[0].localPoint.y+e.p.y;e=g-b;var h=k-a;e*e+h*h>la*la&&(this.normal.x=b-g,this.normal.y=a-k,this.normal.Normalize());var g=g+c*this.normal.x,k=k+c*this.normal.y,h=b-f*this.normal.x,l=a-f*this.normal.y;this.points[0]=new d(0.5*(g+h),0.5*(k+l));this.separations[0]=(h-g)*this.normal.x+(l-k)*this.normal.y;break;case L.e_faceA:this.normal.x=b.q.c*a.localNormal.x-b.q.s*a.localNormal.y;this.normal.y=b.q.s*a.localNormal.x+
b.q.c*a.localNormal.y;for(var m=b.q.c*a.localPoint.x-b.q.s*a.localPoint.y+b.p.x,n=b.q.s*a.localPoint.x+b.q.c*a.localPoint.y+b.p.y,p=0;p<a.pointCount;++p){var q=e.q.c*a.points[p].localPoint.x-e.q.s*a.points[p].localPoint.y+e.p.x,r=e.q.s*a.points[p].localPoint.x+e.q.c*a.points[p].localPoint.y+e.p.y,k=(q-m)*this.normal.x+(r-n)*this.normal.y,g=q+(c-k)*this.normal.x,k=r+(c-k)*this.normal.y,h=q-f*this.normal.x,l=r-f*this.normal.y;this.points[p]=new d(0.5*(g+h),0.5*(k+l));this.separations[p]=(h-g)*this.normal.x+
(l-k)*this.normal.y}break;case L.e_faceB:this.normal.x=e.q.c*a.localNormal.x-e.q.s*a.localNormal.y;this.normal.y=e.q.s*a.localNormal.x+e.q.c*a.localNormal.y;m=e.q.c*a.localPoint.x-e.q.s*a.localPoint.y+e.p.x;n=e.q.s*a.localPoint.x+e.q.c*a.localPoint.y+e.p.y;for(p=0;p<a.pointCount;++p)q=b.q.c*a.points[p].localPoint.x-b.q.s*a.points[p].localPoint.y+b.p.x,r=b.q.s*a.points[p].localPoint.x+b.q.c*a.points[p].localPoint.y+b.p.y,k=(q-m)*this.normal.x+(r-n)*this.normal.y,h=q+(f-k)*this.normal.x,l=r+(f-k)*this.normal.y,
g=q-c*this.normal.x,k=r-c*this.normal.y,this.points[p]=new d(0.5*(g+h),0.5*(k+l)),this.separations[p]=(g-h)*this.normal.x+(k-l)*this.normal.y;this.normal.x=-this.normal.x;this.normal.y=-this.normal.y}}};X.prototype={Assign:function(a){this.lowerBound.x=a.lowerBound.x;this.lowerBound.y=a.lowerBound.y;this.upperBound.x=a.upperBound.x;this.upperBound.y=a.upperBound.y},Clone:function(){var a=new X;a.lowerBound.x=this.lowerBound.x;a.lowerBound.y=this.lowerBound.y;a.upperBound.x=this.upperBound.x;a.upperBound.y=
this.upperBound.y;return a},IsValid:function(){return 0<=this.upperBound.x-this.lowerBound.x&&0<=this.upperBound.y-this.lowerBound.y&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},GetCenter:function(){return new d(0.5*(this.lowerBound.x+this.upperBound.x),0.5*(this.lowerBound.y+this.upperBound.y))},GetExtents:function(){return new d(0.5*(this.upperBound.x-this.lowerBound.x),0.5*(this.upperBound.y-this.lowerBound.y))},GetPerimeter:function(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-
this.lowerBound.y))},Combine:function(a,b){b?(this.lowerBound.x=O(a.lowerBound.x,b.lowerBound.x),this.lowerBound.y=O(a.lowerBound.y,b.lowerBound.y),this.upperBound.x=H(a.upperBound.x,b.upperBound.x),this.upperBound.y=H(a.upperBound.y,b.upperBound.y)):(this.lowerBound.x=O(this.lowerBound.x,a.lowerBound.x),this.lowerBound.y=O(this.lowerBound.y,a.lowerBound.y),this.upperBound.x=H(this.upperBound.x,a.upperBound.x),this.upperBound.y=H(this.upperBound.y,a.upperBound.y))},Contains:function(a){return this.lowerBound.x<=
a.lowerBound.x&&this.lowerBound.y<=a.lowerBound.y&&a.upperBound.x<=this.upperBound.x&&a.upperBound.y<=this.upperBound.y},RayCast:function(a,b){for(var c=-W,e=W,f=b.p1,g=d.Subtract(b.p2,b.p1),k=$a(g),h=new d,l=0;2>l;++l)if(k.get_i(l)<la){if(f.get_i(l)<this.lowerBound.get_i(l)||this.upperBound.get_i(l)<f.get_i(l))return!1}else{var m=1/g.get_i(l),n=(this.lowerBound.get_i(l)-f.get_i(l))*m,m=(this.upperBound.get_i(l)-f.get_i(l))*m,p=-1;n>m&&(p=m,m=n,n=p,p=1);n>c&&(h.x=h.y=0,h.set_i(l,p),c=n);e=O(e,m);
if(c>e)return!1}if(0>c||b.maxFraction<c)return!1;a.fraction=c;a.normal.x=h.x;a.normal.y=h.y;return!0}};fa._localTangent=new d;fa._local_incidentEdges=[new Ia,new Ia];da.e_unknown=0;da.e_edgeA=1;da.e_edgeB=2;M._temp_edge=new d;M._temp_edge0=new d;M._temp_edge2=new d;M.prototype={Collide:function(a,b,c,e,f){this.m_xf.Assign(Nb(c,f));this.m_centroidB.x=this.m_xf.q.c*e.m_centroid.x-this.m_xf.q.s*e.m_centroid.y+this.m_xf.p.x;this.m_centroidB.y=this.m_xf.q.s*e.m_centroid.x+this.m_xf.q.c*e.m_centroid.y+
this.m_xf.p.y;this.m_v0.x=b.m_vertex0.x;this.m_v0.y=b.m_vertex0.y;this.m_v1.x=b.m_vertex1.x;this.m_v1.y=b.m_vertex1.y;this.m_v2.x=b.m_vertex2.x;this.m_v2.y=b.m_vertex2.y;this.m_v3.x=b.m_vertex3.x;this.m_v3.y=b.m_vertex3.y;c=b.m_hasVertex0;b=b.m_hasVertex3;M._temp_edge.x=this.m_v2.x-this.m_v1.x;M._temp_edge.y=this.m_v2.y-this.m_v1.y;M._temp_edge.Normalize();this.m_normal1.x=M._temp_edge.y;this.m_normal1.y=-M._temp_edge.x;f=this.m_normal1.x*(this.m_centroidB.x-this.m_v1.x)+this.m_normal1.y*(this.m_centroidB.y-
this.m_v1.y);var g=0,d=0,h=!1,l=!1;c&&(M._temp_edge0.x=this.m_v1.x-this.m_v0.x,M._temp_edge0.y=this.m_v1.y-this.m_v0.y,M._temp_edge0.Normalize(),this.m_normal0.x=M._temp_edge0.y,this.m_normal0.y=-M._temp_edge0.x,h=0<=M._temp_edge0.x*M._temp_edge.y-M._temp_edge0.y*M._temp_edge.x,g=this.m_normal0.x*(this.m_centroidB.x-this.m_v0.x)+this.m_normal0.y*(this.m_centroidB.y-this.m_v0.y));b&&(M._temp_edge2.x=this.m_v3.x-this.m_v2.x,M._temp_edge2.y=this.m_v3.y-this.m_v2.y,M._temp_edge2.Normalize(),this.m_normal2.x=
M._temp_edge2.y,this.m_normal2.y=-M._temp_edge2.x,l=0<M._temp_edge.x*M._temp_edge2.y-M._temp_edge.y*M._temp_edge2.x,d=this.m_normal2.x*(this.m_centroidB.x-this.m_v2.x)+this.m_normal2.y*(this.m_centroidB.y-this.m_v2.y));c&&b?h&&l?(this.m_front=0<=g||0<=f||0<=d)?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=this.m_normal0.x,this.m_lowerLimit.y=this.m_normal0.y,this.m_upperLimit.x=this.m_normal2.x,this.m_upperLimit.y=this.m_normal2.y):(this.m_normal.x=-this.m_normal1.x,
this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal1.x,this.m_lowerLimit.y=-this.m_normal1.y,this.m_upperLimit.x=-this.m_normal1.x,this.m_upperLimit.y=-this.m_normal1.y):h?(this.m_front=0<=g||0<=f&&0<=d)?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=this.m_normal0.x,this.m_lowerLimit.y=this.m_normal0.y,this.m_upperLimit.x=this.m_normal1.x,this.m_upperLimit.y=this.m_normal1.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,
this.m_lowerLimit.x=-this.m_normal2.x,this.m_lowerLimit.y=-this.m_normal2.y,this.m_upperLimit.x=-this.m_normal1.x,this.m_upperLimit.y=-this.m_normal1.y):l?(this.m_front=0<=d||0<=g&&0<=f)?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y,this.m_upperLimit.x=this.m_normal2.x,this.m_upperLimit.y=this.m_normal2.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal1.x,
this.m_lowerLimit.y=-this.m_normal1.y,this.m_upperLimit.x=-this.m_normal0.x,this.m_upperLimit.y=-this.m_normal0.y):(this.m_front=0<=g&&0<=f&&0<=d)?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y,this.m_upperLimit.x=this.m_normal1.x,this.m_upperLimit.y=this.m_normal1.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal2.x,this.m_lowerLimit.y=-this.m_normal2.y,
this.m_upperLimit.x=-this.m_normal0.x,this.m_upperLimit.y=-this.m_normal0.y):c?h?((this.m_front=0<=g||0<=f)?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=this.m_normal0.x,this.m_lowerLimit.y=this.m_normal0.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y),this.m_upperLimit.x=-this.m_normal1.x,this.m_upperLimit.y=-this.m_normal1.y):(this.m_front=0<=g&&0<=f)?(this.m_normal.x=
this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y,this.m_upperLimit.x=-this.m_normal1.x,this.m_upperLimit.y=-this.m_normal1.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y,this.m_upperLimit.x=-this.m_normal0.x,this.m_upperLimit.y=-this.m_normal0.y):b?l?(this.m_front=0<=f||0<=d)?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=
this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal1.x,this.m_lowerLimit.y=-this.m_normal1.y,this.m_upperLimit.x=this.m_normal2.x,this.m_upperLimit.y=this.m_normal2.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal1.x,this.m_lowerLimit.y=-this.m_normal1.y,this.m_upperLimit.x=this.m_normal1.x,this.m_upperLimit.y=this.m_normal1.y):((this.m_front=0<=f&&0<=d)?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=
-this.m_normal1.x,this.m_lowerLimit.y=-this.m_normal1.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal2.x,this.m_lowerLimit.y=-this.m_normal2.y),this.m_upperLimit.x=this.m_normal1.x,this.m_upperLimit.y=this.m_normal1.y):(this.m_front=0<=f)?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal1.x,this.m_lowerLimit.y=-this.m_normal1.y,this.m_upperLimit.x=-this.m_normal1.x,this.m_upperLimit.y=-this.m_normal1.y):
(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y,this.m_upperLimit.x=this.m_normal1.x,this.m_upperLimit.y=this.m_normal1.y);this.m_polygonB.count=e.m_count;for(g=0;g<e.m_count;++g)this.m_polygonB.vertices[g]=V(this.m_xf,e.m_vertices[g]),this.m_polygonB.normals[g]=C(this.m_xf.q,e.m_normals[g]);this.m_radius=2*ab;a.pointCount=0;b=this.ComputeEdgeSeparation();if(!(b.type==da.e_unknown||b.separation>this.m_radius||
(f=this.ComputePolygonSeparation(),f.type!=da.e_unknown&&f.separation>this.m_radius))){c=new da;c=f.type==da.e_unknown?b:f.separation>0.98*b.separation+0.001?f:b;f=Array(2);b=new xc;if(c.type==da.e_edgeA){a.type=L.e_faceA;d=0;h=this.m_normal.x*this.m_polygonB.normals[0].x+this.m_normal.y*this.m_polygonB.normals[0].y;for(g=1;g<this.m_polygonB.count;++g)l=this.m_normal.x*this.m_polygonB.normals[g].x+this.m_normal.y*this.m_polygonB.normals[g].y,l<h&&(h=l,d=g);g=d;d=g+1<this.m_polygonB.count?g+1:0;f[0]=
new Ia;f[0].v.x=this.m_polygonB.vertices[g].x;f[0].v.y=this.m_polygonB.vertices[g].y;f[0].id.indexA=0;f[0].id.indexB=g;f[0].id.typeA=U.e_face;f[0].id.typeB=U.e_vertex;f[1]=new Ia;f[1].v.x=this.m_polygonB.vertices[d].x;f[1].v.y=this.m_polygonB.vertices[d].y;f[1].id.indexA=0;f[1].id.indexB=d;f[1].id.typeA=U.e_face;f[1].id.typeB=U.e_vertex;this.m_front?(b.i1=0,b.i2=1,b.v1.x=this.m_v1.x,b.v1.y=this.m_v1.y,b.v2.x=this.m_v2.x,b.v2.y=this.m_v2.y,b.normal.x=this.m_normal1.x,b.normal.y=this.m_normal1.y):(b.i1=
1,b.i2=0,b.v1.x=this.m_v2.x,b.v1.y=this.m_v2.y,b.v2.x=this.m_v1.x,b.v2.y=this.m_v1.y,b.normal.x=-this.m_normal1.x,b.normal.y=-this.m_normal1.y)}else a.type=L.e_faceB,f[0]=new Ia,f[0].v=this.m_v1,f[0].id.indexA=0,f[0].id.indexB=c.index,f[0].id.typeA=U.e_vertex,f[0].id.typeB=U.e_face,f[1]=new Ia,f[1].v=this.m_v2,f[1].id.indexA=0,f[1].id.indexB=c.index,f[1].id.typeA=U.e_vertex,f[1].id.typeB=U.e_face,b.i1=c.index,b.i2=b.i1+1<this.m_polygonB.count?b.i1+1:0,b.v1.x=this.m_polygonB.vertices[b.i1].x,b.v1.y=
this.m_polygonB.vertices[b.i1].y,b.v2.x=this.m_polygonB.vertices[b.i2].x,b.v2.y=this.m_polygonB.vertices[b.i2].y,b.normal.x=this.m_polygonB.normals[b.i1].x,b.normal.y=this.m_polygonB.normals[b.i1].y;b.sideNormal1.x=b.normal.y;b.sideNormal1.y=-b.normal.x;b.sideNormal2.x=-b.sideNormal1.x;b.sideNormal2.y=-b.sideNormal1.y;b.sideOffset1=b.sideNormal1.x*b.v1.x+b.sideNormal1.y*b.v1.y;b.sideOffset2=b.sideNormal2.x*b.v2.x+b.sideNormal2.y*b.v2.y;g=Array(2);d=Array(2);f=cb(g,f,b.sideNormal1.x,b.sideNormal1.y,
b.sideOffset1,b.i1);if(!(f<na||(f=cb(d,g,b.sideNormal2.x,b.sideNormal2.y,b.sideOffset2,b.i2),f<na))){c.type==da.e_edgeA?(a.localNormal.x=b.normal.x,a.localNormal.y=b.normal.y,a.localPoint.x=b.v1.x,a.localPoint.y=b.v1.y):(a.localNormal.x=e.m_normals[b.i1].x,a.localNormal.y=e.m_normals[b.i1].y,a.localPoint.x=e.m_vertices[b.i1].x,a.localPoint.y=e.m_vertices[b.i1].y);for(g=e=0;g<na;++g)b.normal.x*(d[g].v.x-b.v1.x)+b.normal.y*(d[g].v.y-b.v1.y)<=this.m_radius&&(f=a.points[e]=new ma,c.type==da.e_edgeA?(f.localPoint.Assign(Ca(this.m_xf,
d[g].v)),f.id.Assign(d[g].id)):(f.localPoint.x=d[g].v.x,f.localPoint.y=d[g].v.y,f.id.typeA=d[g].id.typeB,f.id.typeB=d[g].id.typeA,f.id.indexA=d[g].id.indexB,f.id.indexB=d[g].id.indexA),++e);a.pointCount=e}}},ComputeEdgeSeparation:function(){var a=new da;a.type=da.e_edgeA;a.index=this.m_front?0:1;a.separation=Number.MAX_VALUE;for(var b=0;b<this.m_polygonB.count;++b){var c=this.m_normal.x*(this.m_polygonB.vertices[b].x-this.m_v1.x)+this.m_normal.y*(this.m_polygonB.vertices[b].y-this.m_v1.y);c<a.separation&&
(a.separation=c)}return a},ComputePolygonSeparation:function(){var a=new da;a.type=da.e_unknown;a.index=-1;a.separation=-Number.MAX_VALUE;for(var b=-this.m_normal.y,c=this.m_normal.x,e=0;e<this.m_polygonB.count;++e){var f=-this.m_polygonB.normals[e].x,g=-this.m_polygonB.normals[e].y,d=O(f*(this.m_polygonB.vertices[e].x-this.m_v1.x)+g*(this.m_polygonB.vertices[e].y-this.m_v1.y),f*(this.m_polygonB.vertices[e].x-this.m_v2.x)+g*(this.m_polygonB.vertices[e].y-this.m_v2.y));if(d>this.m_radius){a.type=da.e_edgeB;
a.index=e;a.separation=d;break}if(0<=f*b+g*c){if((f-this.m_upperLimit.x)*this.m_normal.x+(g-this.m_upperLimit.y)*this.m_normal.y<-za)continue}else if((f-this.m_lowerLimit.x)*this.m_normal.x+(g-this.m_lowerLimit.y)*this.m_normal.y<-za)continue;d>a.separation&&(a.type=da.e_edgeB,a.index=e,a.separation=d)}return a}};M.e_isolated=0;M.e_concave=1;M.e_convex=2;db.collider=new M;ga.input=new Pb;ga.cache=new Ob;ga.output=new Qb;var T=-1;Sa.prototype={IsLeaf:function(){return this.child1==T}};Ha.aabbExtensionFattener=
new d(0.1,0.1);Ha.prototype={CreateProxy:function(a,b){var c=this.AllocateNode();this.m_nodes[c].aabb.lowerBound.Assign(d.Subtract(a.lowerBound,Ha.aabbExtensionFattener));this.m_nodes[c].aabb.upperBound.Assign(d.Add(a.upperBound,Ha.aabbExtensionFattener));this.m_nodes[c].userData=b;this.m_nodes[c].height=0;this.InsertLeaf(c);return c},DestroyProxy:function(a){this.RemoveLeaf(a);this.FreeNode(a)},MoveProxy:function(a,b,c){if(this.m_nodes[a].aabb.Contains(b))return!1;this.RemoveLeaf(a);this.m_nodes[a].aabb.Assign(b);
this.m_nodes[a].aabb.lowerBound.Subtract(Ha.aabbExtensionFattener);this.m_nodes[a].aabb.upperBound.Add(Ha.aabbExtensionFattener);b=d.Multiply(2,c);0>b.x?this.m_nodes[a].aabb.lowerBound.x+=b.x:this.m_nodes[a].aabb.upperBound.x+=b.x;0>b.y?this.m_nodes[a].aabb.lowerBound.y+=b.y:this.m_nodes[a].aabb.upperBound.y+=b.y;this.InsertLeaf(a);return!0},GetUserData:function(a){return this.m_nodes[a].userData},GetFatAABB:function(a){return this.m_nodes[a].aabb},Query:function(a,b){var c=[];for(c.push(this.m_root);0<
c.length;){var e=c.pop();if(e!=T){var f=this.m_nodes[e];if(tb(f.aabb,b))if(f.IsLeaf()){if(!1==a.QueryCallback(e))break}else c.push(f.child1),c.push(f.child2)}}},RayCast:function(a,b){var c=b.p1,e=b.p2,f=d.Subtract(e,c);f.Normalize();var f=S(1,f),g=$a(f),k=b.maxFraction,h=new X,l=d.Add(c,d.Multiply(k,d.Subtract(e,c)));h.lowerBound.Assign(Da(c,l));h.upperBound.Assign(Ea(c,l));var m=[];for(m.push(this.m_root);0<m.length;)if(l=m.pop(),l!=T){var n=this.m_nodes[l];if(!1!=tb(n.aabb,h)){var p=n.aabb.GetCenter(),
q=n.aabb.GetExtents();if(!(0<aa(v(f,d.Subtract(c,p)))-v(g,q)))if(n.IsLeaf()){n=new sb;n.p1.Assign(b.p1);n.p2.Assign(b.p2);n.maxFraction=k;l=a.RayCastCallback(n,l);if(0==l)break;0<l&&(k=l,l=d.Add(c,d.Multiply(k,d.Subtract(e,c))),h.lowerBound.Assign(Da(c,l)),h.upperBound.Assign(Ea(c,l)))}else m.push(n.child1),m.push(n.child2)}}},Validate:function(){this.ValidateStructure(this.m_root);this.ValidateMetrics(this.m_root);for(var a=0,b=this.m_freeList;b!=T;)b=this.m_nodes[b].parent,++a},GetHeight:function(){return this.m_root==
T?0:this.m_nodes[this.m_root].height},GetMaxBalance:function(){for(var a=0,b=0;b<this.m_nodeCapacity;++b){var c=this.m_nodes[b];1>=c.height||(c=aa(this.m_nodes[c.child2].height-this.m_nodes[c.child1].height),a=H(a,c))}return a},GetAreaRatio:function(){if(this.m_root==T)return 0;for(var a=this.m_nodes[this.m_root].aabb.GetPerimeter(),b=0,c=0;c<this.m_nodeCapacity;++c){var e=this.m_nodes[c];0>e.height||(b+=e.aabb.GetPerimeter())}return b/a},RebuildBottomUp:function(){for(var a=Array(this.m_nodeCount),
b=0,c=0;c<this.m_nodeCapacity;++c)0>this.m_nodes[c].height||(this.m_nodes[c].IsLeaf()?(this.m_nodes[c].parent=T,a[b]=c,++b):this.FreeNode(c));for(;1<b;){for(var e=W,f=-1,g=-1,c=0;c<b;++c)for(var d=this.m_nodes[a[c]].aabb,h=c+1;h<b;++h){var l=this.m_nodes[a[h]].aabb,m=new X;m.Combine(d,l);l=m.GetPerimeter();l<e&&(f=c,g=h,e=l)}c=a[f];e=a[g];d=this.m_nodes[c];h=this.m_nodes[e];l=this.AllocateNode();m=this.m_nodes[l];m.child1=c;m.child2=e;m.height=1+H(d.height,h.height);m.aabb.Combine(d.aabb,h.aabb);
m.parent=T;d.parent=l;h.parent=l;a[g]=a[b-1];a[f]=l;--b}this.m_root=a[0];this.Validate()},ShiftOrigin:function(a){for(var b=0;b<this.m_nodeCapacity;++b)this.m_nodes[b].aabb.lowerBound.Subtract(a),this.m_nodes[b].aabb.upperBound.Subtract(a)},AllocateNode:function(){if(this.m_freeList==T){var a=this.m_nodes;this.m_nodeCapacity*=2;this.m_nodes=a.concat(Array(this.m_nodeCapacity-this.m_nodeCount));for(a=this.m_nodeCount;a<this.m_nodeCapacity-1;++a)this.m_nodes[a]=new Sa,this.m_nodes[a].parent=a+1,this.m_nodes[a].height=
-1;this.m_nodes[this.m_nodeCapacity-1]=new Sa;this.m_nodes[this.m_nodeCapacity-1].parent=T;this.m_nodes[this.m_nodeCapacity-1].height=-1;this.m_freeList=this.m_nodeCount}a=this.m_freeList;this.m_freeList=this.m_nodes[a].parent;this.m_nodes[a].parent=T;this.m_nodes[a].child1=T;this.m_nodes[a].child2=T;this.m_nodes[a].height=0;this.m_nodes[a].userData=null;++this.m_nodeCount;return a},FreeNode:function(a){this.m_nodes[a].parent=this.m_freeList;this.m_nodes[a].height=-1;this.m_freeList=a;--this.m_nodeCount},
InsertLeaf:function(a){++this.m_insertionCount;if(this.m_root==T)this.m_root=a,this.m_nodes[this.m_root].parent=T;else{for(var b=this.m_nodes[a].aabb,c=this.m_root;!1==this.m_nodes[c].IsLeaf();){var e=this.m_nodes[c].child1,f=this.m_nodes[c].child2,g=this.m_nodes[c].aabb.GetPerimeter(),d=new X;d.Combine(this.m_nodes[c].aabb,b);var h=d.GetPerimeter(),d=2*h,h=2*(h-g),l;if(this.m_nodes[e].IsLeaf())l=new X,l.Combine(b,this.m_nodes[e].aabb),g=l.GetPerimeter()+h;else{l=new X;l.Combine(b,this.m_nodes[e].aabb);
var m=this.m_nodes[e].aabb.GetPerimeter();l=l.GetPerimeter();g=l-m+h}this.m_nodes[f].IsLeaf()?(l=new X,l.Combine(b,this.m_nodes[f].aabb),h=l.GetPerimeter()+h):(l=new X,l.Combine(b,this.m_nodes[f].aabb),m=this.m_nodes[f].aabb.GetPerimeter(),l=l.GetPerimeter(),h=l-m+h);if(d<g&&d<h)break;c=g<h?e:f}e=this.m_nodes[c].parent;f=this.AllocateNode();this.m_nodes[f].parent=e;this.m_nodes[f].userData=null;this.m_nodes[f].aabb.Combine(b,this.m_nodes[c].aabb);this.m_nodes[f].height=this.m_nodes[c].height+1;e!=
T?(this.m_nodes[e].child1==c?this.m_nodes[e].child1=f:this.m_nodes[e].child2=f,this.m_nodes[f].child1=c,this.m_nodes[f].child2=a,this.m_nodes[c].parent=f,this.m_nodes[a].parent=f):(this.m_nodes[f].child1=c,this.m_nodes[f].child2=a,this.m_nodes[c].parent=f,this.m_root=this.m_nodes[a].parent=f);for(c=this.m_nodes[a].parent;c!=T;)c=this.Balance(c),e=this.m_nodes[c].child1,f=this.m_nodes[c].child2,this.m_nodes[c].height=1+H(this.m_nodes[e].height,this.m_nodes[f].height),this.m_nodes[c].aabb.Combine(this.m_nodes[e].aabb,
this.m_nodes[f].aabb),c=this.m_nodes[c].parent}},RemoveLeaf:function(a){if(a==this.m_root)this.m_root=T;else{var b=this.m_nodes[a].parent,c=this.m_nodes[b].parent;a=this.m_nodes[b].child1==a?this.m_nodes[b].child2:this.m_nodes[b].child1;if(c!=T)for(this.m_nodes[c].child1==b?this.m_nodes[c].child1=a:this.m_nodes[c].child2=a,this.m_nodes[a].parent=c,this.FreeNode(b),b=c;b!=T;)b=this.Balance(b),c=this.m_nodes[b].child1,a=this.m_nodes[b].child2,this.m_nodes[b].aabb.Combine(this.m_nodes[c].aabb,this.m_nodes[a].aabb),
this.m_nodes[b].height=1+H(this.m_nodes[c].height,this.m_nodes[a].height),b=this.m_nodes[b].parent;else this.m_root=a,this.m_nodes[a].parent=T,this.FreeNode(b)}},Balance:function(a){var b=this.m_nodes[a];if(b.IsLeaf()||2>b.height)return a;var c=b.child1,e=b.child2,f=this.m_nodes[c],g=this.m_nodes[e],d=g.height-f.height;if(1<d){var c=g.child1,d=g.child2,h=this.m_nodes[c],l=this.m_nodes[d];g.child1=a;g.parent=b.parent;b.parent=e;g.parent!=T?this.m_nodes[g.parent].child1==a?this.m_nodes[g.parent].child1=
e:this.m_nodes[g.parent].child2=e:this.m_root=e;h.height>l.height?(g.child2=c,b.child2=d,l.parent=a,b.aabb.Combine(f.aabb,l.aabb),g.aabb.Combine(b.aabb,h.aabb),b.height=1+H(f.height,l.height),g.height=1+H(b.height,h.height)):(g.child2=d,b.child2=c,h.parent=a,b.aabb.Combine(f.aabb,h.aabb),g.aabb.Combine(b.aabb,l.aabb),b.height=1+H(f.height,h.height),g.height=1+H(b.height,l.height));return e}return-1>d?(e=f.child1,d=f.child2,h=this.m_nodes[e],l=this.m_nodes[d],f.child1=a,f.parent=b.parent,b.parent=
c,f.parent!=T?this.m_nodes[f.parent].child1==a?this.m_nodes[f.parent].child1=c:this.m_nodes[f.parent].child2=c:this.m_root=c,h.height>l.height?(f.child2=e,b.child1=d,l.parent=a,b.aabb.Combine(g.aabb,l.aabb),f.aabb.Combine(b.aabb,h.aabb),b.height=1+H(g.height,l.height),f.height=1+H(b.height,h.height)):(f.child2=d,b.child1=e,h.parent=a,b.aabb.Combine(g.aabb,h.aabb),f.aabb.Combine(b.aabb,l.aabb),b.height=1+H(g.height,h.height),f.height=1+H(b.height,l.height)),c):a},ComputeHeight:function(a){"undefined"===
typeof a&&(a=this.m_root);var b=this.m_nodes[a];if(b.IsLeaf())return 0;a=this.ComputeHeight(b.child1);b=this.ComputeHeight(b.child2);return 1+H(a,b)},ValidateStructure:function(a){if(a!=T){a=this.m_nodes[a];var b=a.child1,c=a.child2;a.IsLeaf()||(this.ValidateStructure(b),this.ValidateStructure(c))}},ValidateMetrics:function(a){if(a!=T){a=this.m_nodes[a];var b=a.child1,c=a.child2;a.IsLeaf()||(H(this.m_nodes[b].height,this.m_nodes[c].height),(new X).Combine(this.m_nodes[b].aabb,this.m_nodes[c].aabb),
this.ValidateMetrics(b),this.ValidateMetrics(c))}}};ha.e_unknown=0;ha.e_failed=1;ha.e_overlapped=2;ha.e_touching=3;ha.e_separated=4;var B=new Y,z=new Y;ia.prototype={Initialize:function(a,b,c,e,f,g){this.m_proxyA=b;this.m_proxyB=e;var d=a.count;this.m_sweepA=c;this.m_sweepB=f;this.m_sweepA.GetTransform(B,g);this.m_sweepB.GetTransform(z,g);1==d?(this.m_type=ia.e_points,d=this.m_proxyA.GetVertex(a.indexA[0]),a=this.m_proxyB.GetVertex(a.indexB[0]),b=B.q.c*d.x-B.q.s*d.y+B.p.x,d=B.q.s*d.x+B.q.c*d.y+B.p.y,
f=z.q.c*a.x-z.q.s*a.y+z.p.x,g=z.q.s*a.x+z.q.c*a.y+z.p.y,this.m_axis.x=f-b,this.m_axis.y=g-d,a=this.m_axis.Normalize()):(a.indexA[0]==a.indexA[1]?(this.m_type=ia.e_faceB,f=e.GetVertex(a.indexB[0]),g=e.GetVertex(a.indexB[1]),this.m_axis.x=1*(g.y-f.y),this.m_axis.y=-1*(g.x-f.x),this.m_axis.Normalize(),e=z.q.c*this.m_axis.x-z.q.s*this.m_axis.y,c=z.q.s*this.m_axis.x+z.q.c*this.m_axis.y,this.m_localPoint.x=0.5*(f.x+g.x),this.m_localPoint.y=0.5*(f.y+g.y),f=z.q.c*this.m_localPoint.x-z.q.s*this.m_localPoint.y+
z.p.x,g=z.q.s*this.m_localPoint.x+z.q.c*this.m_localPoint.y+z.p.y,d=b.GetVertex(a.indexA[0]),b=B.q.c*d.x-B.q.s*d.y+B.p.x,d=B.q.s*d.x+B.q.c*d.y+B.p.y,a=(b-f)*e+(d-g)*c):(this.m_type=ia.e_faceA,b=this.m_proxyA.GetVertex(a.indexA[0]),f=this.m_proxyA.GetVertex(a.indexA[1]),this.m_axis.x=1*(f.y-b.y),this.m_axis.y=-1*(f.x-b.x),this.m_axis.Normalize(),e=B.q.c*this.m_axis.x-B.q.s*this.m_axis.y,c=B.q.s*this.m_axis.x+B.q.c*this.m_axis.y,this.m_localPoint.x=0.5*(b.x+f.x),this.m_localPoint.y=0.5*(b.y+f.y),b=
B.q.c*this.m_localPoint.x-B.q.s*this.m_localPoint.y+B.p.x,d=B.q.s*this.m_localPoint.x+B.q.c*this.m_localPoint.y+B.p.y,a=this.m_proxyB.GetVertex(a.indexB[0]),f=z.q.c*a.x-z.q.s*a.y+z.p.x,g=z.q.s*a.x+z.q.c*a.y+z.p.y,a=(f-b)*e+(g-d)*c),0>a&&(this.m_axis.x=-this.m_axis.x,this.m_axis.y=-this.m_axis.y,a=-a));return a},FindMinSeparation:function(a,b){this.m_sweepA.GetTransform(B,b);this.m_sweepB.GetTransform(z,b);switch(this.m_type){case ia.e_points:var c=B.q.c*this.m_axis.x+B.q.s*this.m_axis.y,e=z.q.c*-this.m_axis.x+
z.q.s*-this.m_axis.y,f=-z.q.s*-this.m_axis.x+z.q.c*-this.m_axis.y;a[0]=this.m_proxyA.GetSupport(c,-B.q.s*this.m_axis.x+B.q.c*this.m_axis.y);a[1]=this.m_proxyB.GetSupport(e,f);var f=this.m_proxyA.GetVertex(a[0]),g=this.m_proxyB.GetVertex(a[1]),c=B.q.c*f.x-B.q.s*f.y+B.p.x,d=B.q.s*f.x+B.q.c*f.y+B.p.y,e=z.q.c*g.x-z.q.s*g.y+z.p.x,g=z.q.s*g.x+z.q.c*g.y+z.p.y;return(e-c)*this.m_axis.x+(g-d)*this.m_axis.y;case ia.e_faceA:var h=B.q.c*this.m_axis.x-B.q.s*this.m_axis.y,l=B.q.s*this.m_axis.x+B.q.c*this.m_axis.y,
c=B.q.c*this.m_localPoint.x-B.q.s*this.m_localPoint.y+B.p.x,d=B.q.s*this.m_localPoint.x+B.q.c*this.m_localPoint.y+B.p.y,e=z.q.c*-h+z.q.s*-l,f=-z.q.s*-h+z.q.c*-l;a[0]=-1;a[1]=this.m_proxyB.GetSupport(e,f);g=this.m_proxyB.GetVertex(a[1]);e=z.q.c*g.x-z.q.s*g.y+z.p.x;g=z.q.s*g.x+z.q.c*g.y+z.p.y;return(e-c)*h+(g-d)*l;case ia.e_faceB:return h=z.q.c*this.m_axis.x-z.q.s*this.m_axis.y,l=z.q.s*this.m_axis.x+z.q.c*this.m_axis.y,e=z.q.c*this.m_localPoint.x-z.q.s*this.m_localPoint.y+z.p.x,g=z.q.s*this.m_localPoint.x+
z.q.c*this.m_localPoint.y+z.p.y,c=B.q.c*-h+B.q.s*-l,f=-B.q.s*-h+B.q.c*-l,a[1]=-1,a[0]=this.m_proxyA.GetSupport(c,f),f=this.m_proxyA.GetVertex(a[0]),c=B.q.c*f.x-B.q.s*f.y+B.p.x,d=B.q.s*f.x+B.q.c*f.y+B.p.y,(c-e)*h+(d-g)*l}},Evaluate:function(a,b,c){this.m_sweepA.GetTransform(B,c);this.m_sweepB.GetTransform(z,c);switch(this.m_type){case ia.e_points:var e=this.m_proxyA.GetVertex(a),f=this.m_proxyB.GetVertex(b);a=B.q.c*e.x-B.q.s*e.y+B.p.x;e=B.q.s*e.x+B.q.c*e.y+B.p.y;b=z.q.c*f.x-z.q.s*f.y+z.p.x;f=z.q.s*
f.x+z.q.c*f.y+z.p.y;return c=(b-a)*this.m_axis.x+(f-e)*this.m_axis.y;case ia.e_faceA:c=B.q.c*this.m_axis.x-B.q.s*this.m_axis.y;var g=B.q.s*this.m_axis.x+B.q.c*this.m_axis.y;a=B.q.c*this.m_localPoint.x-B.q.s*this.m_localPoint.y+B.p.x;e=B.q.s*this.m_localPoint.x+B.q.c*this.m_localPoint.y+B.p.y;f=this.m_proxyB.GetVertex(b);b=z.q.c*f.x-z.q.s*f.y+z.p.x;f=z.q.s*f.x+z.q.c*f.y+z.p.y;return(b-a)*c+(f-e)*g;case ia.e_faceB:return c=z.q.c*this.m_axis.x-z.q.s*this.m_axis.y,g=z.q.s*this.m_axis.x+z.q.c*this.m_axis.y,
b=z.q.c*this.m_localPoint.x-z.q.s*this.m_localPoint.y+z.p.x,f=z.q.s*this.m_localPoint.x+z.q.c*this.m_localPoint.y+z.p.y,e=this.m_proxyA.GetVertex(a),a=B.q.c*e.x-B.q.s*e.y+B.p.x,e=B.q.s*e.x+B.q.c*e.y+B.p.y,(a-b)*c+(e-f)*g}}};ia.e_points=0;ia.e_faceA=1;ia.e_faceB=2;var ub=ua.create("toi","solveTOI");R._temp_sweepA=new sa;R._temp_sweepB=new sa;R.b2_toiTime=0;R.b2_toiMaxTime=0;R.b2_toiCalls=0;R.b2_toiIters=0;R.b2_toiMaxIters=0;R.b2_toiRootIters=0;R.b2_toiMaxRootIters=0;vb.prototype={_deserialize:function(a){this.type=
a.type;this.position._deserialize(a.position);this.angle=a.angle;this.linearVelocity._deserialize(a.linearVelocity);this.angularVelocity=a.angularVelocity;this.linearDamping=a.linearDamping;this.angularDamping=a.angularDamping;this.allowSleep=a.allowSleep;this.awake=a.awake;this.fixedRotation=a.fixedRotation;this.bullet=a.bullet;this.active=a.active;this.gravityScale=a.gravityScale}};t.b2_staticBody=0;t.b2_kinematicBody=1;t.b2_dynamicBody=2;t.e_islandFlag=1;t.e_awakeFlag=2;t.e_autoSleepFlag=4;t.e_bulletFlag=
8;t.e_fixedRotationFlag=16;t.e_activeFlag=32;t.e_toiFlag=64;t.m_local_oldCenter=new d;t.m_local_xf1=new Y;t.prototype={CreateFixture:function(a,b){if("undefined"!==typeof b){var c=new fb;c.shape=a;c.density=b;return this.CreateFixture(c)}if(!0==this.m_world.IsLocked())return null;c=new Wb;c.Create(this,a);this.m_flags&t.e_activeFlag&&c.CreateProxies(this.m_world.m_contactManager.m_broadPhase,this.m_xf);c.m_next=this.m_fixtureList;this.m_fixtureList=c;++this.m_fixtureCount;c.m_body=this;0<c.m_density&&
this.ResetMassData();this.m_world.m_flags|=P.e_newFixture;return c},DestroyFixture:function(a){if(!0!=this.m_world.IsLocked()){for(var b=this.m_fixtureList;null!=b;){if(b==a){this.m_fixtureList=a.m_next;break}b=b.m_next}for(b=this.m_contactList;b;){var c=b.contact,b=b.next,e=c.GetFixtureA(),f=c.GetFixtureB();a!=e&&a!=f||this.m_world.m_contactManager.Destroy(c)}this.m_flags&t.e_activeFlag&&a.DestroyProxies(this.m_world.m_contactManager.m_broadPhase);a.Destroy();a.m_body=null;a.m_next=null;--this.m_fixtureCount;
this.ResetMassData()}},SetTransform:function(a,b){if(!0!=this.m_world.IsLocked()){this.m_xf.q.Set(b);this.m_xf.p.Assign(a);this.m_xf0.Assign(this.m_xf);this.m_sweep.c.Assign(V(this.m_xf,this.m_sweep.localCenter));this.m_sweep.a=b;this.m_sweep.c0.Assign(this.m_sweep.c);this.m_sweep.a0=b;for(var c=this.m_world.m_contactManager.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.Synchronize(c,this.m_xf,this.m_xf)}},GetTransform:function(){return this.m_xf},GetPosition:function(){return this.m_xf.p},GetAngle:function(){return this.m_sweep.a},
GetWorldCenter:function(){return this.m_sweep.c},GetLocalCenter:function(){return this.m_sweep.localCenter},SetLinearVelocity:function(a){this.m_type!=t.b2_staticBody&&(0<v(a,a)&&this.SetAwake(!0),this.m_linearVelocity=a)},GetLinearVelocity:function(){return this.m_linearVelocity},SetAngularVelocity:function(a){this.m_type!=t.b2_staticBody&&(0<a*a&&this.SetAwake(!0),this.m_angularVelocity=a)},GetAngularVelocity:function(){return this.m_angularVelocity},ApplyForce:function(a,b,c){this.m_type==t.b2_dynamicBody&&
(c&&0==(this.m_flags&t.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&t.e_awakeFlag&&(this.m_force.Add(a),this.m_torque+=u(d.Subtract(b,this.m_sweep.c),a)))},ApplyForceToCenter:function(a,b){this.m_type==t.b2_dynamicBody&&(b&&0==(this.m_flags&t.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&t.e_awakeFlag&&this.m_force.Add(a))},ApplyTorque:function(a,b){this.m_type==t.b2_dynamicBody&&(b&&0==(this.m_flags&t.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&t.e_awakeFlag&&(this.m_torque+=a))},ApplyLinearImpulse:function(a,
b,c){this.m_type==t.b2_dynamicBody&&(c&&0==(this.m_flags&t.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&t.e_awakeFlag&&(this.m_linearVelocity.Add(d.Multiply(this.m_invMass,a)),this.m_angularVelocity+=this.m_invI*u(d.Subtract(b,this.m_sweep.c),a)))},ApplyAngularImpulse:function(a,b){this.m_type==t.b2_dynamicBody&&(b&&0==(this.m_flags&t.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&t.e_awakeFlag&&(this.m_angularVelocity+=this.m_invI*a))},GetMass:function(){return this.m_mass},GetInertia:function(){return this.m_I+
this.m_mass*v(this.m_sweep.localCenter,this.m_sweep.localCenter)},GetMassData:function(a){a.mass=this.m_mass;a.I=this.m_I+this.m_mass*v(this.m_sweep.localCenter,this.m_sweep.localCenter);a.center=this.m_sweep.localCenter},SetMassData:function(a){!0!=this.m_world.IsLocked()&&this.m_type==t.b2_dynamicBody&&(this.m_invI=this.m_I=this.m_invMass=0,this.m_mass=a.mass,0>=this.m_mass&&(this.m_mass=1),this.m_invMass=1/this.m_mass,0<a.I&&0==(this.m_flags&t.e_fixedRotationFlag)&&(this.m_I=a.I-this.m_mass*v(a.center,
a.center),this.m_invI=1/this.m_I),t.m_local_oldCenter.Assign(this.m_sweep.c),this.m_sweep.localCenter.Assign(a.center),this.m_sweep.c0.Assign(V(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.Assign(this.m_sweep.c0),this.m_linearVelocity.Add(S(this.m_angularVelocity,d.Subtract(this.m_sweep.c,t.m_local_oldCenter))))},ResetMassData:function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0;this.m_sweep.localCenter.SetZero();if(this.m_type==t.b2_staticBody||this.m_type==t.b2_kinematicBody)this.m_sweep.c0.Assign(this.m_xf.p),
this.m_sweep.c.Assign(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a;else{for(var a=new d(0,0),b=this.m_fixtureList;b;b=b.m_next)if(0!=b.m_density){var c=new qc;b.GetMassData(c);this.m_mass+=c.mass;a.Add(d.Multiply(c.mass,c.center));this.m_I+=c.I}0<this.m_mass?(this.m_invMass=1/this.m_mass,a.Multiply(this.m_invMass)):this.m_invMass=this.m_mass=1;0<this.m_I&&0==(this.m_flags&t.e_fixedRotationFlag)?(this.m_I-=this.m_mass*v(a,a),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0;t.m_local_oldCenter.Assign(this.m_sweep.c);
this.m_sweep.localCenter.Assign(a);this.m_sweep.c0.Assign(V(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.Assign(this.m_sweep.c0);this.m_linearVelocity.Add(S(this.m_angularVelocity,d.Subtract(this.m_sweep.c,t.m_local_oldCenter)))}},GetWorldPoint:function(a){return V(this.m_xf,a)},GetWorldVector:function(a){return C(this.m_xf.q,a)},GetLocalPoint:function(a){return Ca(this.m_xf,a)},GetLocalVector:function(a){return pa(this.m_xf.q,a)},GetLinearVelocityFromWorldPoint:function(a){return d.Add(this.m_linearVelocity,
S(this.m_angularVelocity,d.Subtract(a,this.m_sweep.c)))},GetLinearVelocityFromLocalPoint:function(a){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(a))},GetLinearDamping:function(){return this.m_linearDamping},SetLinearDamping:function(a){this.m_linearDamping=a},GetAngularDamping:function(){return this.m_angularDamping},SetAngularDamping:function(a){this.m_angularDamping=a},GetGravityScale:function(){return this.m_gravityScale},SetGravityScale:function(a){this.m_gravityScale=a},SetType:function(a){if(!0!=
this.m_world.IsLocked()&&this.m_type!=a){this.m_type=a;this.ResetMassData();this.m_type==t.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Assign(this.m_sweep.c),this.SynchronizeFixtures());this.SetAwake(!0);this.m_force.SetZero();this.m_torque=0;for(a=this.m_contactList;a;){var b=a;a=a.next;this.m_world.m_contactManager.Destroy(b.contact)}this.m_contactList=null;a=this.m_world.m_contactManager.m_broadPhase;for(b=this.m_fixtureList;b;b=
b.m_next)for(var c=b.m_proxyCount,e=0;e<c;++e)a.TouchProxy(b.m_proxies[e].proxyId)}},GetType:function(){return this.m_type},SetBullet:function(a){this.m_flags=a?this.m_flags|t.e_bulletFlag:this.m_flags&~t.e_bulletFlag},IsBullet:function(){return(this.m_flags&t.e_bulletFlag)==t.e_bulletFlag},SetSleepingAllowed:function(a){a?this.m_flags|=t.e_autoSleepFlag:(this.m_flags&=~t.e_autoSleepFlag,this.SetAwake(!0))},IsSleepingAllowed:function(){return(this.m_flags&t.e_autoSleepFlag)==t.e_autoSleepFlag},SetAwake:function(a){a?
0==(this.m_flags&t.e_awakeFlag)&&(this.m_flags|=t.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~t.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},IsAwake:function(){return(this.m_flags&t.e_awakeFlag)==t.e_awakeFlag},SetActive:function(a){if(a!=this.IsActive())if(a){this.m_flags|=t.e_activeFlag;a=this.m_world.m_contactManager.m_broadPhase;for(var b=this.m_fixtureList;b;b=b.m_next)b.CreateProxies(a,this.m_xf)}else{this.m_flags&=
~t.e_activeFlag;a=this.m_world.m_contactManager.m_broadPhase;for(b=this.m_fixtureList;b;b=b.m_next)b.DestroyProxies(a);for(a=this.m_contactList;a;)b=a,a=a.next,this.m_world.m_contactManager.Destroy(b.contact);this.m_contactList=null}},IsActive:function(){return(this.m_flags&t.e_activeFlag)==t.e_activeFlag},SetFixedRotation:function(a){(this.m_flags&t.e_fixedRotationFlag)==t.e_fixedRotationFlag!=a&&(this.m_flags=a?this.m_flags|t.e_fixedRotationFlag:this.m_flags&~t.e_fixedRotationFlag,this.m_angularVelocity=
0,this.ResetMassData())},IsFixedRotation:function(){return(this.m_flags&t.e_fixedRotationFlag)==t.e_fixedRotationFlag},GetFixtureList:function(){return this.m_fixtureList},GetJointList:function(){return this.m_jointList},GetContactList:function(){return this.m_contactList},GetNext:function(){return this.m_next},GetUserData:function(){return this.m_userData},SetUserData:function(a){this.m_userData=a},GetWorld:function(){return this.m_world},SynchronizeFixtures:function(){t.m_local_xf1.q.Set(this.m_sweep.a0);
t.m_local_xf1.p.Assign(d.Subtract(this.m_sweep.c0,C(t.m_local_xf1.q,this.m_sweep.localCenter)));for(var a=this.m_world.m_contactManager.m_broadPhase,b=this.m_fixtureList;b;b=b.m_next)b.Synchronize(a,t.m_local_xf1,this.m_xf)},SynchronizeTransform:function(){this.m_xf.q.Set(this.m_sweep.a);this.m_xf.p.Assign(d.Subtract(this.m_sweep.c,C(this.m_xf.q,this.m_sweep.localCenter)))},ShouldCollide:function(a){if(this.m_type!=t.b2_dynamicBody&&a.m_type!=t.b2_dynamicBody)return!1;for(var b=this.m_jointList;b;b=
b.next)if(b.other==a&&!1==b.joint.m_collideConnected)return!1;return!0},Advance:function(a){this.m_sweep.Advance(a);this.m_sweep.c.Assign(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.m_xf.q.Set(this.m_sweep.a);this.m_xf.p.Assign(d.Subtract(this.m_sweep.c,C(this.m_xf.q,this.m_sweep.localCenter)))},_serialize:function(a){a=a||{};a.fixtures=null;a.type=this.m_type;a.position=this.GetPosition()._serialize();a.angle=this.GetAngle();a.linearVelocity=this.GetLinearVelocity()._serialize();a.angularVelocity=
this.GetAngularVelocity();a.linearDamping=this.GetLinearDamping();a.angularDamping=this.GetAngularDamping();a.allowSleep=this.IsSleepingAllowed();a.awake=this.IsAwake();a.fixedRotation=this.IsFixedRotation();a.bullet=this.IsBullet();a.active=this.IsActive();a.gravityScale=this.GetGravityScale();return a}};eb.prototype={Clone:function(){var a=new eb;a.categoryBits=this.categoryBits;a.maskBits=this.maskBits;a.groupIndex=this.groupIndex;return a},Assign:function(a){this.categoryBits=a.categoryBits;this.maskBits=
a.maskBits;this.groupIndex=a.groupIndex},_serialize:function(a){a=a||{};a.categoryBits=this.categoryBits;a.maskBits=this.maskBits;a.groupIndex=this.groupIndex;return a},_deserialize:function(a){this.categoryBits=a.categoryBits;this.maskBits=a.maskBits;this.groupIndex=a.groupIndex}};fb.prototype={_deserialize:function(a){this.friction=a.friction;this.restitution=a.restitution;this.density=a.density;this.isSensor=a.isSensor;this.filter._deserialize(a.filter)}};Wb.prototype={GetType:function(){return this.m_shape.GetType()},
GetShape:function(){return this.m_shape},SetSensor:function(a){a!=this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=a)},IsSensor:function(){return this.m_isSensor},SetFilterData:function(a){this.m_filter=a;this.Refilter()},GetFilterData:function(){return this.m_filter},Refilter:function(){if(null!=this.m_body){for(var a=this.m_body.GetContactList();a;){var b=a.contact,c=b.GetFixtureA(),e=b.GetFixtureB();c!=this&&e!=this||b.FlagForFiltering();a=a.next}a=this.m_body.GetWorld();if(null!=a)for(a=
a.m_contactManager.m_broadPhase,b=0;b<this.m_proxyCount;++b)a.TouchProxy(this.m_proxies[b].proxyId)}},GetBody:function(){return this.m_body},GetNext:function(){return this.m_next},GetUserData:function(){return this.m_userData},SetUserData:function(a){this.m_userData=a},TestPoint:function(a){return this.m_shape.TestPoint(this.m_body.GetTransform(),a)},RayCast:function(a,b,c){return this.m_shape.RayCast(a,b,this.m_body.GetTransform(),c)},GetMassData:function(a){this.m_shape.ComputeMass(a,this.m_density)},
SetDensity:function(a){this.m_density=a},GetDensity:function(){return this.m_density},GetFriction:function(){return this.m_friction},SetFriction:function(a){this.m_friction=a},GetRestitution:function(){return this.m_restitution},SetRestitution:function(a){this.m_restitution=a},GetAABB:function(a){return this.m_proxies[a].aabb},Create:function(a,b){this.m_userData=b.userData;this.m_friction=b.friction;this.m_restitution=b.restitution;this.m_body=a;this.m_next=null;this.m_filter.Assign(b.filter);this.m_isSensor=
b.isSensor;this.m_shape=b.shape.Clone();var c=this.m_shape.GetChildCount();this.m_proxies=Array(c);for(var e=0;e<c;++e)this.m_proxies[e]=new $c,this.m_proxies[e].fixture=null,this.m_proxies[e].proxyId=Ga.e_nullProxy;this.m_proxyCount=0;this.m_density=b.density},Destroy:function(){this.m_shape=this.m_proxies=null},CreateProxies:function(a,b){this.m_proxyCount=this.m_shape.GetChildCount();for(var c=0;c<this.m_proxyCount;++c){var e=this.m_proxies[c];this.m_shape.ComputeAABB(e.aabb,b,c);e.proxyId=a.CreateProxy(e.aabb,
e);e.fixture=this;e.childIndex=c}},DestroyProxies:function(a){for(var b=0;b<this.m_proxyCount;++b){var c=this.m_proxies[b];a.DestroyProxy(c.proxyId);c.proxyId=Ga.e_nullProxy}this.m_proxyCount=0},Synchronize:function(a,b,c){if(0!=this.m_proxyCount)for(var e=0;e<this.m_proxyCount;++e){var f=this.m_proxies[e],g=new X,k=new X;this.m_shape.ComputeAABB(g,b,f.childIndex);this.m_shape.ComputeAABB(k,c,f.childIndex);f.aabb.Combine(g,k);g=d.Subtract(c.p,b.p);a.MoveProxy(f.proxyId,f.aabb,g)}},ComputeDistance:function(a,
b,c,e){this.m_shape.ComputeDistance(this.m_body.GetTransform(),a,b,c,e)},_serialize:function(a){a=a||{};a.shape=null;a.friction=this.m_friction;a.restitution=this.m_restitution;a.density=this.m_density;a.isSensor=this.m_isSensor;a.filter=this.m_filter._serialize();return a}};zc.prototype={SayGoodbyeJoint:function(a){},SayGoodbyeFixture:function(a){},SayGoodbyeParticleGroup:function(a){},SayGoodbyeParticle:function(a){}};Xb.prototype={ShouldCollide:function(a,b){var c=a.GetFilterData(),e=b.GetFilterData();
return c.groupIndex==e.groupIndex&&0!=c.groupIndex?0<c.groupIndex:0!=(c.maskBits&e.categoryBits)&&0!=(c.categoryBits&e.maskBits)}};Yb.prototype={BeginContact:function(a){},EndContact:function(a){},PreSolve:function(a,b){},PostSolve:function(a,b){}};Bc.prototype={ReportFixture:function(a){return!1},ReportParticle:function(a){return!1}};Cc.prototype={ReportFixture:function(a,b,c,e){},ReportParticle:function(a,b,c,e){return 0}};var Rc=ua.create("step"),Sc=ua.create("collide","step"),Tc=ua.create("solve",
"step"),Uc=ua.create("solveTOI","step"),Vc=ua.create("broadphase","step");Gc.prototype={QueryCallback:function(a){a=this.broadPhase.GetUserData(a);return this.callback.ReportFixture(a.fixture)}};Hc.prototype={RayCastCallback:function(a,b){var c=this.broadPhase.GetUserData(b),e=c.fixture,f=c.childIndex,c=new Tb;if(e.RayCast(c,a,f)){var f=c.fraction,g=d.Add(d.Multiply(1-f,a.p1),d.Multiply(f,a.p2));return this.callback.ReportFixture(e,g,c.normal,f)}return a.maxFraction}};P.m_local_sweep_backupA=new sa;
P.m_local_sweep_backupB=new sa;P.m_local_sweep_backupC=new sa;P.prototype={Destroy:function(){for(var a=this.m_bodyList;a;){for(var b=a.m_next,a=a.m_fixtureList;a;){var c=a.m_next;a.m_proxyCount=0;a.Destroy();a=c}a=b}},SetDestructionListener:function(a){this.m_destructionListener=a},SetContactFilter:function(a){this.m_contactManager.m_contactFilter=a},SetContactListener:function(a){this.m_contactManager.m_contactListener=a},SetDebugDraw:function(a){this.g_debugDraw=a},CreateBody:function(a){if(this.IsLocked())return null;
a=new t(a,this);a.m_prev=null;if(a.m_next=this.m_bodyList)this.m_bodyList.m_prev=a;this.m_bodyList=a;++this.m_bodyCount;return a},DestroyBody:function(a){if(!this.IsLocked()){for(var b=a.m_jointList;b;){var c=b,b=b.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(c.joint);this.DestroyJoint(c.joint);a.m_jointList=b}a.m_jointList=null;for(b=a.m_contactList;b;)c=b,b=b.next,this.m_contactManager.Destroy(c.contact);a.m_contactList=null;for(b=a.m_fixtureList;b;)c=b,b=b.m_next,
this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(c),c.DestroyProxies(this.m_contactManager.m_broadPhase),c.Destroy(),a.m_fixtureList=b,a.m_fixtureCount-=1;a.m_fixtureList=null;a.m_fixtureCount=0;a.m_prev&&(a.m_prev.m_next=a.m_next);a.m_next&&(a.m_next.m_prev=a.m_prev);a==this.m_bodyList&&(this.m_bodyList=a.m_next);a.m_destroyed=!0;--this.m_bodyCount}},CreateJoint:function(a){if(this.IsLocked())return null;var b=s.Create(a);b.m_prev=null;if(b.m_next=this.m_jointList)this.m_jointList.m_prev=
b;this.m_jointList=b;++this.m_jointCount;b.m_edgeA.joint=b;b.m_edgeA.other=b.m_bodyB;b.m_edgeA.prev=null;if(b.m_edgeA.next=b.m_bodyA.m_jointList)b.m_bodyA.m_jointList.prev=b.m_edgeA;b.m_bodyA.m_jointList=b.m_edgeA;b.m_edgeB.joint=b;b.m_edgeB.other=b.m_bodyA;b.m_edgeB.prev=null;if(b.m_edgeB.next=b.m_bodyB.m_jointList)b.m_bodyB.m_jointList.prev=b.m_edgeB;b.m_bodyB.m_jointList=b.m_edgeB;var c=a.bodyA,e=a.bodyB;if(!1==a.collideConnected)for(a=e.GetContactList();a;)a.other==c&&a.contact.FlagForFiltering(),
a=a.next;return b},DestroyJoint:function(a){if(!this.IsLocked()){var b=a.m_collideConnected;a.m_prev&&(a.m_prev.m_next=a.m_next);a.m_next&&(a.m_next.m_prev=a.m_prev);a==this.m_jointList&&(this.m_jointList=a.m_next);var c=a.m_bodyA,e=a.m_bodyB;c.SetAwake(!0);e.SetAwake(!0);a.m_edgeA.prev&&(a.m_edgeA.prev.next=a.m_edgeA.next);a.m_edgeA.next&&(a.m_edgeA.next.prev=a.m_edgeA.prev);a.m_edgeA==c.m_jointList&&(c.m_jointList=a.m_edgeA.next);a.m_edgeA.prev=null;a.m_edgeA.next=null;a.m_edgeB.prev&&(a.m_edgeB.prev.next=
a.m_edgeB.next);a.m_edgeB.next&&(a.m_edgeB.next.prev=a.m_edgeB.prev);a.m_edgeB==e.m_jointList&&(e.m_jointList=a.m_edgeB.next);a.m_edgeB.prev=null;a.m_edgeB.next=null;s.Destroy(a);--this.m_jointCount;if(!1==b)for(a=e.GetContactList();a;)a.other==c&&a.contact.FlagForFiltering(),a=a.next}},Step:function(a,b,c){Rc.start();this.m_flags&P.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~P.e_newFixture);this.m_flags|=P.e_locked;this.p_step.dt=a;this.p_step.velocityIterations=b;this.p_step.positionIterations=
c;this.p_step.inv_dt=0<a?1/a:0;this.p_step.dtRatio=this.m_inv_dt0*a;this.p_step.warmStarting=this.m_warmStarting;Sc.start();this.m_contactManager.Collide();Sc.stop();this.m_stepComplete&&0<this.p_step.dt&&(Tc.start(),this.m_particleSystem.Solve(this.p_step),this.Solve(this.p_step),Tc.stop());this.m_continuousPhysics&&0<this.p_step.dt&&(Uc.start(),this.SolveTOI(this.p_step),Uc.stop());0<this.p_step.dt&&(this.m_inv_dt0=this.p_step.inv_dt);this.m_flags&P.e_clearForces&&this.ClearForces();this.m_flags&=
~P.e_locked;Rc.stop()},ClearForces:function(){for(var a=this.m_bodyList;a;a=a.GetNext())a.m_force.x=a.m_force.y=0,a.m_torque=0},DrawDebugData:function(){if(null!=this.g_debugDraw){var a=this.g_debugDraw.GetFlags();if(a&ba.e_shapeBit){for(var b=this.m_bodyList;b;b=b.GetNext())for(var c=b.GetTransform(),e=b.GetFixtureList();e;e=e.GetNext())!1==b.IsActive()?this.DrawShape(e,c,new ea(0.5,0.5,0.3)):b.GetType()==t.b2_staticBody?this.DrawShape(e,c,new ea(0.5,0.9,0.5)):b.GetType()==t.b2_kinematicBody?this.DrawShape(e,
c,new ea(0.5,0.5,0.9)):!1==b.IsAwake()?this.DrawShape(e,c,new ea(0.6,0.6,0.6)):this.DrawShape(e,c,new ea(0.9,0.7,0.7));this.DrawParticleSystem(this.m_particleSystem)}if(a&ba.e_jointBit)for(c=this.m_jointList;c;c=c.GetNext())this.DrawJoint(c);if(a&ba.e_pairBit)for(c=new ea(0.3,0.9,0.9),b=this.m_contactManager.m_contactList;b;b=b.GetNext()){var f=b.GetFixtureA(),e=b.GetFixtureB(),f=f.GetAABB(b.GetChildIndexA()).GetCenter(),e=e.GetAABB(b.GetChildIndexB()).GetCenter();this.g_debugDraw.DrawSegment(f,e,
c)}if(a&ba.e_aabbBit)for(var c=new ea(0.9,0.3,0.9),f=new ea(0.3,0.3,0.9),g=this.m_contactManager.m_broadPhase,b=this.m_bodyList;b;b=b.GetNext())if(!1!=b.IsActive())for(e=b.GetFixtureList();e;e=e.GetNext())for(var k=0;k<e.m_proxyCount;++k){var h=g.GetFatAABB(e.m_proxies[k].proxyId),l=[];l[0]=new d(h.lowerBound.x,h.lowerBound.y);l[1]=new d(h.upperBound.x,h.lowerBound.y);l[2]=new d(h.upperBound.x,h.upperBound.y);l[3]=new d(h.lowerBound.x,h.upperBound.y);this.g_debugDraw.DrawPolygon(l,4,c);h=new X;e.GetShape().ComputeAABB(h,
b.GetTransform(),0);l=[];l[0]=new d(h.lowerBound.x,h.lowerBound.y);l[1]=new d(h.upperBound.x,h.lowerBound.y);l[2]=new d(h.upperBound.x,h.upperBound.y);l[3]=new d(h.lowerBound.x,h.upperBound.y);this.g_debugDraw.DrawPolygon(l,4,f)}if(a&ba.e_centerOfMassBit)for(b=this.m_bodyList;b;b=b.GetNext())c=b.GetTransform().Clone(),c.p=b.GetWorldCenter(),this.g_debugDraw.DrawTransform(c)}},QueryAABB:function(a,b){var c=new Gc;c.broadPhase=this.m_contactManager.m_broadPhase;c.callback=a;this.m_contactManager.m_broadPhase.Query(c,
b);this.m_particleSystem.QueryAABB(a,b)},RayCast:function(a,b,c){var e=new Hc;e.broadPhase=this.m_contactManager.m_broadPhase;e.callback=a;var f=new sb;f.maxFraction=1;f.p1=b;f.p2=c;this.m_contactManager.m_broadPhase.RayCast(e,f);this.m_particleSystem.RayCast(a,b,c)},GetBodyList:function(){return this.m_bodyList},GetJointList:function(){return this.m_jointList},GetContactList:function(){return this.m_contactManager.m_contactList},SetAllowSleeping:function(a){if(a!=this.m_allowSleep&&(this.m_allowSleep=
a,!1==this.m_allowSleep))for(a=this.m_bodyList;a;a=a.m_next)a.SetAwake(!0)},GetAllowSleeping:function(){return this.m_allowSleep},SetWarmStarting:function(a){this.m_warmStarting=a},GetWarmStarting:function(){return this.m_warmStarting},SetContinuousPhysics:function(a){this.m_continuousPhysics=a},GetContinuousPhysics:function(){return this.m_continuousPhysics},SetSubStepping:function(a){this.m_subStepping=a},GetSubStepping:function(){return this.m_subStepping},GetProxyCount:function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},
GetBodyCount:function(){return this.m_bodyCount},GetJointCount:function(){return this.m_jointCount},GetContactCount:function(){return this.m_contactManager.m_contactCount},GetTreeHeight:function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()},GetTreeBalance:function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()},GetTreeQuality:function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()},SetGravity:function(a){this.m_gravity=a},GetGravity:function(){return this.m_gravity},
IsLocked:function(){return(this.m_flags&P.e_locked)==P.e_locked},SetAutoClearForces:function(a){this.m_flags=a?this.m_flags|P.e_clearForces:this.m_flags&~P.e_clearForces},GetAutoClearForces:function(){return(this.m_flags&P.e_clearForces)==P.e_clearForces},ShiftOrigin:function(a){if((this.m_flags&P.e_locked)!=P.e_locked){for(var b=this.m_bodyList;b;b=b.m_next)b.m_xf.p.Subtract(a),b.m_sweep.c0.Subtract(a),b.m_sweep.c.Subtract(a);for(b=this.m_jointList;b;b=b.m_next)b.ShiftOrigin(a);this.m_contactManager.m_broadPhase.ShiftOrigin(a)}},
GetContactManager:function(){return this.m_contactManager},Solve:function(a){for(var b=this.m_bodyList;b;b=b.m_next)b.m_xf0.Assign(b.m_xf);this.p_island.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,this.m_contactManager.m_contactListener);for(b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~t.e_islandFlag;for(var c=this.m_contactManager.m_contactList;c;c=c.m_next)c.m_flags&=~w.e_islandFlag;for(c=this.m_jointList;c;c=c.m_next)c.m_islandFlag=!1;for(var c=Array(this.m_bodyCount),
e=this.m_bodyList;e;e=e.m_next)if(!(e.m_flags&t.e_islandFlag)&&!1!=e.IsAwake()&&!1!=e.IsActive()&&e.GetType()!=t.b2_staticBody){this.p_island.Clear();var f=0;c[f++]=e;for(e.m_flags|=t.e_islandFlag;0<f;)if(b=c[--f],this.p_island.AddBody(b),b.SetAwake(!0),b.GetType()!=t.b2_staticBody){for(var g=b.m_contactList;g;g=g.next){var d=g.contact;if(!(d.m_flags&w.e_islandFlag)&&!1!=d.IsEnabled()&&!1!=d.IsTouching()){var h=d.m_fixtureB.m_isSensor;d.m_fixtureA.m_isSensor||h||(this.p_island.AddContact(d),d.m_flags|=
w.e_islandFlag,d=g.other,d.m_flags&t.e_islandFlag||(c[f++]=d,d.m_flags|=t.e_islandFlag))}}for(b=b.m_jointList;b;b=b.next)!0!=b.joint.m_islandFlag&&(d=b.other,!1!=d.IsActive()&&(this.p_island.AddJoint(b.joint),b.joint.m_islandFlag=!0,d.m_flags&t.e_islandFlag||(c[f++]=d,d.m_flags|=t.e_islandFlag)))}this.p_island.Solve(a,this.m_gravity,this.m_allowSleep);for(f=0;f<this.p_island.m_bodyCount;++f)b=this.p_island.m_bodies[f],b.GetType()==t.b2_staticBody&&(b.m_flags&=~t.e_islandFlag)}Vc.start();for(b=this.m_bodyList;b;b=
b.GetNext())0!=(b.m_flags&t.e_islandFlag)&&b.GetType()!=t.b2_staticBody&&b.SynchronizeFixtures();this.m_contactManager.FindNewContacts();Vc.stop()},SolveTOI:function(a){this.p_island.Initialize(64,32,0,this.m_contactManager.m_contactListener);if(this.m_stepComplete){for(var b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~t.e_islandFlag,b.m_sweep.alpha0=0;for(var c=this.m_contactManager.m_contactList;c;c=c.m_next)c.m_flags&=~(w.e_toiFlag|w.e_islandFlag),c.m_toiCount=0,c.m_toi=1}for(;;){for(var e=null,b=
1,c=this.m_contactManager.m_contactList;c;c=c.m_next)if(!1!=c.IsEnabled()&&!(8<c.m_toiCount)){var f=1;if(c.m_flags&w.e_toiFlag)f=c.m_toi;else{var g=c.GetFixtureA(),d=c.GetFixtureB();if(g.IsSensor()||d.IsSensor())continue;var f=g.GetBody(),h=d.GetBody(),l=f.m_type,m=h.m_type,n=f.IsAwake()&&l!=t.b2_staticBody,p=h.IsAwake()&&m!=t.b2_staticBody;if(!1==n&&!1==p)continue;l=f.IsBullet()||l!=t.b2_dynamicBody;m=h.IsBullet()||m!=t.b2_dynamicBody;if(!1==l&&!1==m)continue;m=f.m_sweep.alpha0;f.m_sweep.alpha0<
h.m_sweep.alpha0?(m=h.m_sweep.alpha0,f.m_sweep.Advance(m)):h.m_sweep.alpha0<f.m_sweep.alpha0&&(m=f.m_sweep.alpha0,h.m_sweep.Advance(m));n=c.GetChildIndexA();p=c.GetChildIndexB();l=new yc;l.proxyA.Set(g.GetShape(),n);l.proxyB.Set(d.GetShape(),p);l.sweepA.Assign(f.m_sweep);l.sweepB.Assign(h.m_sweep);l.tMax=1;f=new ha;R(f,l);h=f.t;f=f.state==ha.e_touching?O(m+(1-m)*h,1):1;c.m_toi=f;c.m_flags|=w.e_toiFlag}f<b&&(e=c,b=f)}if(null==e||1-10*la<b){this.m_stepComplete=!0;break}g=e.GetFixtureA();d=e.GetFixtureB();
f=g.GetBody();h=d.GetBody();P.m_local_sweep_backupA.Assign(f.m_sweep);P.m_local_sweep_backupB.Assign(h.m_sweep);f.Advance(b);h.Advance(b);e.Update(this.m_contactManager.m_contactListener);e.m_flags&=~w.e_toiFlag;++e.m_toiCount;if(!1==e.IsEnabled()||!1==e.IsTouching())e.SetEnabled(!1),f.m_sweep.Assign(P.m_local_sweep_backupA),h.m_sweep.Assign(P.m_local_sweep_backupB),f.SynchronizeTransform(),h.SynchronizeTransform();else{f.SetAwake(!0);h.SetAwake(!0);this.p_island.Clear();this.p_island.AddBody(f);
this.p_island.AddBody(h);this.p_island.AddContact(e);f.m_flags|=t.e_islandFlag;h.m_flags|=t.e_islandFlag;e.m_flags|=w.e_islandFlag;c=[f,h];for(e=0;2>e;++e)if(g=c[e],g.m_type==t.b2_dynamicBody)for(d=g.m_contactList;d&&this.p_island.m_bodyCount!=this.p_island.m_bodyCapacity&&this.p_island.m_contactCount!=this.p_island.m_contactCapacity;d=d.next)m=d.contact,m.m_flags&w.e_islandFlag||(l=d.other,l.m_type==t.b2_dynamicBody&&!1==g.IsBullet()&&!1==l.IsBullet())||(n=m.m_fixtureB.m_isSensor,m.m_fixtureA.m_isSensor||
n||(P.m_local_sweep_backupC.Assign(l.m_sweep),0==(l.m_flags&t.e_islandFlag)&&l.Advance(b),m.Update(this.m_contactManager.m_contactListener),!1==m.IsEnabled()?(l.m_sweep.Assign(P.m_local_sweep_backupC),l.SynchronizeTransform()):!1==m.IsTouching()?(l.m_sweep.Assign(P.m_local_sweep_backupC),l.SynchronizeTransform()):(m.m_flags|=w.e_islandFlag,this.p_island.AddContact(m),l.m_flags&t.e_islandFlag||(l.m_flags|=t.e_islandFlag,l.m_type!=t.b2_staticBody&&l.SetAwake(!0),this.p_island.AddBody(l)))));c=new gb;
c.dt=(1-b)*a.dt;c.inv_dt=1/c.dt;c.dtRatio=1;c.positionIterations=20;c.velocityIterations=a.velocityIterations;c.warmStarting=!1;this.p_island.SolveTOI(c,f.m_islandIndex,h.m_islandIndex);for(e=0;e<this.p_island.m_bodyCount;++e)if(g=this.p_island.m_bodies[e],g.m_flags&=~t.e_islandFlag,g.m_type==t.b2_dynamicBody)for(g.SynchronizeFixtures(),d=g.m_contactList;d;d=d.next)d.contact.m_flags&=~(w.e_toiFlag|w.e_islandFlag);this.m_contactManager.FindNewContacts();if(this.m_subStepping){this.m_stepComplete=!1;
break}}}},DrawJoint:function(a){var b=a.GetBodyA(),c=a.GetBodyB(),b=b.GetTransform(),c=c.GetTransform(),e=b.p,f=c.p,c=a.GetAnchorA(),b=a.GetAnchorB(),d=new ea(0.5,0.8,0.8);switch(a.GetType()){case s.e_distanceJoint:this.g_debugDraw.DrawSegment(c,b,d);break;case s.e_pulleyJoint:e=a.GetGroundAnchorA();a=a.GetGroundAnchorB();this.g_debugDraw.DrawSegment(e,c,d);this.g_debugDraw.DrawSegment(a,b,d);this.g_debugDraw.DrawSegment(e,a,d);break;case s.e_mouseJoint:break;case s.e_motorJoint:this.g_debugDraw.DrawPoint(a.GetLinearOffset(),
5,d);default:this.g_debugDraw.DrawSegment(e,c,d),this.g_debugDraw.DrawSegment(c,b,d),this.g_debugDraw.DrawSegment(f,b,d)}},DrawShape:function(a,b,c){switch(a.GetType()){case G.e_circle:var e=a.GetShape();a=V(b,e.m_p);e=e.m_radius;b=C(b.q,new d(1,0));this.g_debugDraw.DrawSolidCircle(a,e,b,c);break;case G.e_edge:a=a.GetShape();var f=V(b,a.m_vertex1),g=V(b,a.m_vertex2);this.g_debugDraw.DrawSegment(f,g,c);break;case G.e_chain:a=a.GetShape();var k=a.m_count;a=a.m_vertices;f=V(b,a[0]);for(e=1;e<k;++e)g=
V(b,a[e]),this.g_debugDraw.DrawSegment(f,g,c),f=g;break;case G.e_polygon:f=a.GetShape();k=f.m_count;a=Array(wa);for(e=0;e<k;++e)a[e]=V(b,f.m_vertices[e]);this.g_debugDraw.DrawSolidPolygon(a,k,c)}},GetParticleMaxCount:function(){return this.m_particleSystem.GetParticleMaxCount()},SetParticleMaxCount:function(a){this.m_particleSystem.SetParticleMaxCount(a)},SetParticleDensity:function(a){this.m_particleSystem.SetParticleDensity(a)},GetParticleDensity:function(){return this.m_particleSystem.GetParticleDensity()},
SetParticleGravityScale:function(a){this.m_particleSystem.SetParticleGravityScale(a)},GetParticleGravityScale:function(){return this.m_particleSystem.GetParticleGravityScale()},SetParticleDamping:function(a){this.m_particleSystem.SetParticleDamping(a)},GetParticleDamping:function(){return this.m_particleSystem.GetParticleDamping()},SetParticleRadius:function(a){this.m_particleSystem.SetParticleRadius(a)},GetParticleRadius:function(){return this.m_particleSystem.GetParticleRadius()},CreateParticle:function(a){return this.IsLocked()?
0:this.m_particleSystem.CreateParticle(a)},DestroyParticle:function(a,b){this.m_particleSystem.DestroyParticle(a,b)},DestroyParticlesInShape:function(a,b,c){return this.IsLocked()?0:this.m_particleSystem.DestroyParticlesInShape(a,b,c)},CreateParticleGroup:function(a){return this.IsLocked()?null:this.m_particleSystem.CreateParticleGroup(a)},JoinParticleGroups:function(a,b){this.IsLocked()||this.m_particleSystem.JoinParticleGroups(a,b)},DestroyParticlesInGroup:function(a,b){this.IsLocked()||this.m_particleSystem.DestroyParticlesInGroup(a,
b)},GetParticleFlagsBuffer:function(){return this.m_particleSystem.GetParticleFlagsBuffer()},GetParticlePositionBuffer:function(){return this.m_particleSystem.GetParticlePositionBuffer()},GetParticleVelocityBuffer:function(){return this.m_particleSystem.GetParticleVelocityBuffer()},GetParticleColorBuffer:function(){return this.m_particleSystem.GetParticleColorBuffer()},GetParticleUserDataBuffer:function(){return this.m_particleSystem.GetParticleUserDataBuffer()},GetParticleGroupBuffer:function(){return this.m_particleSystem.GetParticleGroupBuffer()},
SetParticleFlagsBuffer:function(a,b){this.m_particleSystem.SetParticleFlagsBuffer(a,b)},SetParticlePositionBuffer:function(a,b){this.m_particleSystem.SetParticlePositionBuffer(a,b)},SetParticleVelocityBuffer:function(a,b){this.m_particleSystem.SetParticleVelocityBuffer(a,b)},SetParticleColorBuffer:function(a,b){this.m_particleSystem.SetParticleColorBuffer(a,b)},SetParticleUserDataBuffer:function(a,b){this.m_particleSystem.SetParticleUserDataBuffer(a,b)},GetParticleContacts:function(){return this.m_particleSystem.m_contactBuffer},
GetParticleContactCount:function(){return this.m_particleSystem.m_contactCount},GetParticleBodyContacts:function(){return this.m_particleSystem.m_bodyContactBuffer},GetParticleBodyContactCount:function(){return this.m_particleSystem.m_bodyContactCount},ComputeParticleCollisionEnergy:function(){return this.m_particleSystem.ComputeParticleCollisionEnergy()},GetParticleGroupList:function(){return this.m_particleSystem.GetParticleGroupList()},GetParticleGroupCount:function(){return this.m_particleSystem.GetParticleGroupCount()},
GetParticleCount:function(){return this.m_particleSystem.GetParticleCount()},DrawParticleSystem:function(a){var b=a.GetParticleCount();if(b){var c=a.GetParticleRadius(),e=a.GetParticlePositionBuffer();a.m_colorBuffer.data?(a=a.GetParticleColorBuffer(),this.g_debugDraw.DrawParticles(e,c,a,b)):this.g_debugDraw.DrawParticles(e,c,null,b)}}};P.e_newFixture=1;P.e_locked=2;P.e_clearForces=4;Ic.prototype={Push:function(a){this.m_back>=this.m_end||(this.m_buffer[this.m_back++]=a)},Pop:function(){this.m_front++},
Empty:function(){return this.m_front>=this.m_back},Front:function(){return this.m_buffer[this.m_front]}};Z.Generator=function(){this.center=new d;this.tag=0};Z.b2VoronoiDiagramTask=function(a,b,c,e){this.m_x=a;this.m_y=b;this.m_i=c;this.m_generator=e};Z.prototype={AddGenerator:function(a,b){var c=this.m_generatorBuffer[this.m_generatorCount++];c.center=a.Clone();c.tag=b},Generate:function(a){var b=1/a,c=new d(+W,+W);a=new d(-W,-W);for(var e=0;e<this.m_generatorCount;e++){var f=this.m_generatorBuffer[e],
c=Da(c,f.center);a=Ea(a,f.center)}this.m_countX=1+Math.floor(b*(a.x-c.x));this.m_countY=1+Math.floor(b*(a.y-c.y));this.m_diagram=[];for(a=0;a<this.m_countX*this.m_countY;++a)this.m_diagram[a]=null;for(var g=new Ic(4*this.m_countX*this.m_countX),e=0;e<this.m_generatorCount;e++){f=this.m_generatorBuffer[e];f.center=d.Multiply(b,d.Subtract(f.center,c));var k=H(0,O(Math.floor(f.center.x),this.m_countX-1)),h=H(0,O(Math.floor(f.center.y),this.m_countY-1));g.Push(new Z.b2VoronoiDiagramTask(k,h,k+h*this.m_countX,
f))}for(;!g.Empty();)k=g.Front().m_x,h=g.Front().m_y,a=g.Front().m_i,f=g.Front().m_generator,g.Pop(),this.m_diagram[a]||(this.m_diagram[a]=f,0<k&&g.Push(new Z.b2VoronoiDiagramTask(k-1,h,a-1,f)),0<h&&g.Push(new Z.b2VoronoiDiagramTask(k,h-1,a-this.m_countX,f)),k<this.m_countX-1&&g.Push(new Z.b2VoronoiDiagramTask(k+1,h,a+1,f)),h<this.m_countY-1&&g.Push(new Z.b2VoronoiDiagramTask(k,h+1,a+this.m_countX,f)));b=this.m_countX+this.m_countY;for(c=0;c<b;c++){for(h=0;h<this.m_countY;h++)for(k=0;k<this.m_countX-
1;k++){a=k+h*this.m_countX;var l=this.m_diagram[a],e=this.m_diagram[a+1];l!=e&&(g.Push(new Z.b2VoronoiDiagramTask(k,h,a,e)),g.Push(new Z.b2VoronoiDiagramTask(k+1,h,a+1,l)))}for(h=0;h<this.m_countY-1;h++)for(k=0;k<this.m_countX;k++)a=k+h*this.m_countX,l=this.m_diagram[a],e=this.m_diagram[a+this.m_countX],l!=e&&(g.Push(new Z.b2VoronoiDiagramTask(k,h,a,e)),g.Push(new Z.b2VoronoiDiagramTask(k,h+1,a+this.m_countX,l)));for(f=!1;!g.Empty();)if(k=g.Front().m_x,h=g.Front().m_y,a=g.Front().m_i,e=g.Front().m_generator,
g.Pop(),l=this.m_diagram[a],l!=e){var m=l.center.x-k,l=l.center.y-h,n=e.center.x-k,p=e.center.y-h;m*m+l*l>n*n+p*p&&(this.m_diagram[a]=e,0<k&&g.Push(new Z.b2VoronoiDiagramTask(k-1,h,a-1,e)),0<h&&g.Push(new Z.b2VoronoiDiagramTask(k,h-1,a-this.m_countX,e)),k<this.m_countX-1&&g.Push(new Z.b2VoronoiDiagramTask(k+1,h,a+1,e)),h<this.m_countY-1&&g.Push(new Z.b2VoronoiDiagramTask(k,h+1,a+this.m_countX,e)),f=!0)}if(!f)break}},GetNodes:function(a){for(var b=0;b<this.m_countY-1;b++)for(var c=0;c<this.m_countX-
1;c++){var e=c+b*this.m_countX,f=this.m_diagram[e],d=this.m_diagram[e+1],k=this.m_diagram[e+this.m_countX],e=this.m_diagram[e+1+this.m_countX];d!=k&&(f!=d&&f!=k&&a(f.tag,d.tag,k.tag),e!=d&&e!=k&&a(d.tag,e.tag,k.tag))}}};La.prototype={IsZero:function(){return!this.r&&!this.g&&!this.b&&!this.a},GetColor:function(){return new ea(1/255*this.r,1/255*this.g,1/255*this.b)},Set:function(a,b,c,e){a instanceof ea?(this.r=255*a.r,this.g=255*a.g,this.b=255*a.b,this.a=255):(this.r=a,this.g=b,this.b=c,this.a=e)},
Assign:function(a){this.r=a.r;this.g=a.g;this.b=a.b;this.a=a.a},Clone:function(){return new La(this.r,this.g,this.b,this.a)}};La.zero=new La;I.b2_waterParticle=0;I.b2_zombieParticle=2;I.b2_wallParticle=4;I.b2_springParticle=8;I.b2_elasticParticle=16;I.b2_viscousParticle=32;I.b2_powderParticle=64;I.b2_tensileParticle=128;I.b2_colorMixingParticle=256;I.b2_destructionListener=512;ta.prototype={GetNext:function(){return this.m_next},GetParticleCount:function(){return this.m_lastIndex-this.m_firstIndex},
GetBufferIndex:function(){return this.m_firstIndex},GetGroupFlags:function(){return this.m_groupFlags},SetGroupFlags:function(a){this.m_groupFlags=a},GetMass:function(){this.UpdateStatistics();return this.m_mass},GetInertia:function(){this.UpdateStatistics();return this.m_inertia},GetCenter:function(){this.UpdateStatistics();return this.m_center},GetLinearVelocity:function(){this.UpdateStatistics();return this.m_linearVelocity},GetAngularVelocity:function(){this.UpdateStatistics();return this.m_angularVelocity},
GetTransform:function(){return this.m_transform},GetPosition:function(){return this.m_transform.p},GetAngle:function(){return this.m_transform.q.GetAngle()},GetUserData:function(){return this.m_userData},SetUserData:function(a){this.m_userData=a},UpdateStatistics:function(){if(this.m_timestamp!=this.m_system.m_timestamp){var a=this.m_system.GetParticleMass();this.m_mass=0;this.m_center.SetZero();this.m_linearVelocity.SetZero();for(var b=this.m_firstIndex;b<this.m_lastIndex;b++)this.m_mass+=a,this.m_center.Add(d.Multiply(a,
this.m_system.m_positionBuffer.data[b])),this.m_linearVelocity.Add(d.Multiply(a,this.m_system.m_velocityBuffer.data[b]));0<this.m_mass&&(this.m_center.Multiply(1/this.m_mass),this.m_linearVelocity.Multiply(1/this.m_mass));this.m_angularVelocity=this.m_inertia=0;for(b=this.m_firstIndex;b<this.m_lastIndex;b++){var c=d.Subtract(this.m_system.m_positionBuffer.data[b],this.m_center),e=d.Subtract(this.m_system.m_velocityBuffer.data[b],this.m_linearVelocity);this.m_inertia+=a*v(c,c);this.m_angularVelocity+=
a*u(c,e)}0<this.m_inertia&&(this.m_angularVelocity*=1/this.m_inertia);this.m_timestamp=this.m_system.m_timestamp}}};ta.b2_solidParticleGroup=1;ta.b2_rigidParticleGroup=2;D.ParticleBuffer=function(){this.data=null;this.userSuppliedCapacity=0};D.Proxy=function(){this.tag=this.index=0};D.Proxy.LessThan_p_p=function(a,b){return a.tag<b.tag};D.Proxy.LessThan_i_p=function(a,b){return a<b.tag};D.Proxy.LessThan_p_i=function(a,b){return a.tag<b};D.Pair=function(){this.distance=this.strength=this.flags=this.indexA=
this.indexB=0};D.Triad=function(){this.strength=this.flags=this.indexA=this.indexB=this.indexC=0;this.pa=new d;this.pb=new d;this.pc=new d;this.s=this.kc=this.kb=this.ka=0};D.k_pairFlags=I.b2_springParticle;D.k_triadFlags=I.b2_elasticParticle;D.k_noPressureFlags=I.b2_powderParticle;D.xTruncBits=12;D.yTruncBits=12;D.tagBits=32;D.yOffset=1<<D.yTruncBits-1;D.yShift=D.tagBits-D.yTruncBits;D.xShift=D.tagBits-D.yTruncBits-D.xTruncBits;D.xScale=1<<D.xShift;D.xOffset=D.xScale*(1<<D.xTruncBits-1);D.xMask=
(1<<D.xTruncBits)-1;D.yMask=(1<<D.yTruncBits)-1;D.prototype={ReallocateBuffer3:function(a,b,c){a=a?a.slice():[];a.length=c;return a},ReallocateBuffer5:function(a,b,c,e,f){f&&!a||b||(a=this.ReallocateBuffer3(a,c,e));return a},ReallocateBuffer4:function(a,b,c,e){return this.ReallocateBuffer5(a.data,a.userSuppliedCapacity,b,c,e)},RequestParticleBuffer:function(a){a||(a=Array(this.m_internalAllocatedCapacity));return a},CreateParticle:function(a){if(this.m_count>=this.m_internalAllocatedCapacity){var b=
this.m_count?2*this.m_count:256,b=Ta(b,this.m_maxCount),b=Ta(b,this.m_flagsBuffer.userSuppliedCapacity),b=Ta(b,this.m_positionBuffer.userSuppliedCapacity),b=Ta(b,this.m_velocityBuffer.userSuppliedCapacity),b=Ta(b,this.m_colorBuffer.userSuppliedCapacity),b=Ta(b,this.m_userDataBuffer.userSuppliedCapacity);this.m_internalAllocatedCapacity<b&&(this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,b,!1),this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,
this.m_internalAllocatedCapacity,b,!1),this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,b,!1),this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,b,!1),this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,b,!0),this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,0,this.m_internalAllocatedCapacity,b,!0),this.m_colorBuffer.data=
this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,b,!0),this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,b,!1),this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,b,!0),this.m_internalAllocatedCapacity=b)}if(this.m_count>=this.m_internalAllocatedCapacity)return this.b2_invalidParticleIndex;b=this.m_count++;this.m_flagsBuffer.data[b]=a.flags;this.m_positionBuffer.data[b]=a.position.Clone();
this.m_velocityBuffer.data[b]=a.velocity.Clone();this.m_groupBuffer[b]=null;this.m_depthBuffer&&(this.m_depthBuffer[b]=0);if(this.m_colorBuffer.data||!a.color.IsZero())this.m_colorBuffer.data=this.RequestParticleBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[b]=a.color.Clone();if(this.m_userDataBuffer.data||a.userData)this.m_userDataBuffer.data=this.RequestParticleBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[b]=a.userData;this.m_proxyCount>=this.m_proxyCapacity&&(a=this.m_proxyCount?
2*this.m_proxyCount:256,this.m_proxyBuffer=this.ReallocateBuffer3(this.m_proxyBuffer,this.m_proxyCapacity,a),this.m_proxyCapacity=a);this.m_proxyBuffer[this.m_proxyCount]=new D.Proxy;return this.m_proxyBuffer[this.m_proxyCount++].index=b},DestroyParticle:function(a,b){var c=I.b2_zombieParticle;b&&(c|=I.b2_destructionListener);this.m_flagsBuffer.data[a]|=c},DestroyParticlesInShape:function(a,b,c){function e(a,b,c,e){this.m_system=a;this.m_shape=b;this.m_xf=c;this.m_callDestructionListener=e;this.m_destroyed=
0}e.prototype={ReportFixture:function(a){return!1},ReportParticle:function(a){this.m_shape.TestPoint(this.m_xf,this.m_system.m_positionBuffer.data[a])&&(this.m_system.DestroyParticle(a,this.m_callDestructionListener),this.m_destroyed++);return!0},Destroyed:function(){return this.m_destroyed}};c=new e(this,a,b,c);var f=new X;a.ComputeAABB(f,b,0);this.m_world.QueryAABB(c,f);return c.Destroyed()},DestroyParticlesInGroup:function(a,b){for(var c=a.m_firstIndex;c<a.m_lastIndex;c++)this.DestroyParticle(c,
b)},CreateParticleGroup:function(a){var b=this.GetParticleStride(),c=new Y;c.SetIdentity();var e=c.Clone(),f=this.m_count;if(a.shape){var g=new I;g.flags=a.flags;g.color=a.color;g.userData=a.userData;var k=a.shape;e.Set(a.position,a.angle);for(var h=new X,l=k.GetChildCount(),m=0;m<l;m++)if(0==m)k.ComputeAABB(h,c,m);else{var n=new X;k.ComputeAABB(n,c,m);h.Combine(n)}for(l=Math.floor(h.lowerBound.y/b)*b;l<h.upperBound.y;l+=b)for(m=Math.floor(h.lowerBound.x/b)*b;m<h.upperBound.x;m+=b)n=new d(m,l),k.TestPoint(c,
n)&&(n=V(e,n),g.position.Assign(n),g.velocity.Assign(d.Add(a.linearVelocity,S(a.angularVelocity,d.Subtract(n,a.position)))),this.CreateParticle(g))}c=this.m_count;g=new ta;g.m_system=this;g.m_firstIndex=f;g.m_lastIndex=c;g.m_groupFlags=a.groupFlags;g.m_strength=a.strength;g.m_userData=a.userData;g.m_transform=e;g.m_destroyAutomatically=a.destroyAutomatically;g.m_prev=null;if(g.m_next=this.m_groupList)this.m_groupList.m_prev=g;this.m_groupList=g;++this.m_groupCount;for(e=f;e<c;e++)this.m_groupBuffer[e]=
g;this.UpdateContacts(!0);if(a.flags&D.k_pairFlags)for(e=0;e<this.m_contactCount;e++)k=this.m_contactBuffer[e],h=k.indexA,l=k.indexB,h>l&&(m=h,h=l,l=m),f<=h&&l<c&&(this.m_pairCount>=this.m_pairCapacity&&(m=this.m_pairCount?2*this.m_pairCount:256,this.m_pairBuffer=this.ReallocateBuffer3(this.m_pairBuffer,this.m_pairCapacity,m),this.m_pairCapacity=m),m=this.m_pairBuffer[this.m_pairCount]=new D.Pair,m.indexA=h,m.indexB=l,m.flags=k.flags,m.strength=a.strength,m.distance=Na(this.m_positionBuffer.data[h],
this.m_positionBuffer.data[l]),this.m_pairCount++);if(a.flags&D.k_triadFlags){k=new Z(c-f);for(e=f;e<c;e++)k.AddGenerator(this.m_positionBuffer.data[e],e);k.Generate(b/2);var p=this;k.GetNodes(function(b,c,e){var f=p.m_positionBuffer.data[b],g=p.m_positionBuffer.data[c],h=p.m_positionBuffer.data[e],k=d.Subtract(f,g),l=d.Subtract(g,h),m=d.Subtract(h,f),n=4*p.m_squaredDiameter;v(k,k)<n&&v(l,l)<n&&v(m,m)<n&&(p.m_triadCount>=p.m_triadCapacity&&(n=p.m_triadCount?2*p.m_triadCount:256,p.m_triadBuffer=p.ReallocateBuffer3(p.m_triadBuffer,
p.m_triadCapacity,n),p.m_triadCapacity=n),n=p.m_triadBuffer[p.m_triadCount]=new D.Triad,n.indexA=b,n.indexB=c,n.indexC=e,n.flags=p.m_flagsBuffer.data[b]|p.m_flagsBuffer.data[c]|p.m_flagsBuffer.data[e],n.strength=a.strength,b=d.Multiply(1/3,d.Add(f,d.Add(g,h))),n.pa=d.Subtract(f,b),n.pb=d.Subtract(g,b),n.pc=d.Subtract(h,b),n.ka=-v(m,k),n.kb=-v(k,l),n.kc=-v(l,m),n.s=u(f,g)+u(g,h)+u(h,f),p.m_triadCount++)})}a.groupFlags&ta.b2_solidParticleGroup&&this.ComputeDepthForGroup(g);return g},JoinParticleGroups:function(a,
b){this.RotateBuffer(b.m_firstIndex,b.m_lastIndex,this.m_count);this.RotateBuffer(a.m_firstIndex,a.m_lastIndex,b.m_firstIndex);for(var c=0,e=a.m_firstIndex;e<b.m_lastIndex;e++)c|=this.m_flagsBuffer.data[e];this.UpdateContacts(!0);if(c&D.k_pairFlags)for(e=0;e<this.m_contactCount;e++){var f=this.m_contactBuffer[e],d=f.indexA,k=f.indexB;if(d>k)var h=d,d=k,k=h;a.m_firstIndex<=d&&d<a.m_lastIndex&&b.m_firstIndex<=k&&k<b.m_lastIndex&&(this.m_pairCount>=this.m_pairCapacity&&(h=this.m_pairCount?2*this.m_pairCount:
256,this.m_pairBuffer=this.ReallocateBuffer3(this.m_pairBuffer,this.m_pairCapacity,h),this.m_pairCapacity=h),h=this.m_pairBuffer[this.m_pairCount]=new D.Pair,h.indexA=d,h.indexB=k,h.flags=f.flags,h.strength=O(a.m_strength,b.m_strength),h.distance=Na(this.m_positionBuffer.data[d],this.m_positionBuffer.data[k]),this.m_pairCount++)}if(c&D.k_triadFlags){c=new Z(b.m_lastIndex-a.m_firstIndex);for(e=a.m_firstIndex;e<b.m_lastIndex;e++)this.m_flagsBuffer.data[e]&I.b2_zombieParticle||c.AddGenerator(this.m_positionBuffer.data[e],
e);c.Generate(this.GetParticleStride()/2);e=new JoinParticleGroupsCallback;e.system=this;e.groupA=a;e.groupB=b;c.GetNodes(e)}for(e=b.m_firstIndex;e<b.m_lastIndex;e++)this.m_groupBuffer[e]=a;c=a.m_groupFlags|b.m_groupFlags;a.m_groupFlags=c;a.m_lastIndex=b.m_lastIndex;b.m_firstIndex=b.m_lastIndex;this.DestroyParticleGroup(b);c&ta.b2_solidParticleGroup&&this.ComputeDepthForGroup(a)},DestroyParticleGroup:function(a){this.m_world.m_destructionListener&&this.m_world.m_destructionListener.SayGoodbye(a);
for(var b=a.m_firstIndex;b<a.m_lastIndex;b++)this.m_groupBuffer[b]=null;a.m_prev&&(a.m_prev.m_next=a.m_next);a.m_next&&(a.m_next.m_prev=a.m_prev);a==this.m_groupList&&(this.m_groupList=a.m_next);--this.m_groupCount},ComputeDepthForGroup:function(a){for(var b=a.m_firstIndex;b<a.m_lastIndex;b++)this.m_accumulationBuffer[b]=0;for(b=0;b<this.m_contactCount;b++){var c=this.m_contactBuffer[b],e=c.indexA,f=c.indexB;if(e>=a.m_firstIndex&&e<a.m_lastIndex&&f>=a.m_firstIndex&&f<a.m_lastIndex){var d=c.weight;
this.m_accumulationBuffer[e]+=d;this.m_accumulationBuffer[f]+=d}}this.m_depthBuffer=this.RequestParticleBuffer(this.m_depthBuffer);for(b=a.m_firstIndex;b<a.m_lastIndex;b++)d=this.m_accumulationBuffer[b],this.m_depthBuffer[b]=0.8>d?0:W;for(var d=a.GetParticleCount(),k=0;k<d;k++){for(var h=!1,b=0;b<this.m_contactCount;b++)if(c=this.m_contactBuffer[b],e=c.indexA,f=c.indexB,e>=a.m_firstIndex&&e<a.m_lastIndex&&f>=a.m_firstIndex&&f<a.m_lastIndex){var l=1-c.weight,c=this.m_depthBuffer[e],m=this.m_depthBuffer[f],
n=m+l,l=c+l;c>n&&(c=n,h=!0);m>l&&(m=l,h=!0);this.m_depthBuffer[e]=c;this.m_depthBuffer[f]=m}if(!h)break}for(b=a.m_firstIndex;b<a.m_lastIndex;b++)e=this.m_depthBuffer[b],e=e<W?e*this.m_particleDiameter:0,this.m_depthBuffer[b]=e},AddContact:function(a,b){var c=d.Subtract(this.m_positionBuffer.data[b],this.m_positionBuffer.data[a]),e=v(c,c);if(e<this.m_squaredDiameter){if(this.m_contactCount>=this.m_contactCapacity){var f=this.m_contactCount?2*this.m_contactCount:256;this.m_contactBuffer=this.ReallocateBuffer3(this.m_contactBuffer,
this.m_contactCapacity,f);this.m_contactCapacity=f}var f=1/va(e),g=this.m_contactBuffer[this.m_contactCount]=new ad;g.indexA=a;g.indexB=b;g.flags=this.m_flagsBuffer.data[a]|this.m_flagsBuffer.data[b];g.weight=1-e*f*this.m_inverseDiameter;g.normal.Assign(d.Multiply(f,c));this.m_contactCount++}},UpdateContacts:function(a){for(var b=this.m_proxyCount,c=0;c<b;++c){var e=this.m_proxyBuffer[c],f=this.m_positionBuffer.data[e.index];e.tag=ya(this.m_inverseDiameter*f.x,this.m_inverseDiameter*f.y)}this.m_proxyBuffer.qsort(0,
b,function(a,b){return D.Proxy.LessThan_p_p(a,b)});for(e=c=this.m_contactCount=0;c<b;c++){for(var d=this.m_proxyBuffer[c].tag+(0<<D.yShift)+(1<<D.xShift),f=c+1;f<b&&!(d<this.m_proxyBuffer[f].tag);f++)this.AddContact(this.m_proxyBuffer[c].index,this.m_proxyBuffer[f].index);for(f=this.m_proxyBuffer[c].tag+(1<<D.yShift)+(-1<<D.xShift);e<b&&!(f<=this.m_proxyBuffer[e].tag);e++);d=this.m_proxyBuffer[c].tag+(1<<D.yShift)+(1<<D.xShift);for(f=e;f<b&&!(d<this.m_proxyBuffer[f].tag);f++)this.AddContact(this.m_proxyBuffer[c].index,
this.m_proxyBuffer[f].index)}a&&(this.m_contactCount=this.m_contactBuffer.collapse(cd,this.m_contactCount))},UpdateBodyContacts:function(){function a(a){this.m_system=a}var b=new X;b.lowerBound.x=+W;b.lowerBound.y=+W;b.upperBound.x=-W;b.upperBound.y=-W;for(var c=0;c<this.m_count;c++){var e=this.m_positionBuffer.data[c];b.lowerBound.Assign(Da(b.lowerBound,e));b.upperBound.Assign(Ea(b.upperBound,e))}b.lowerBound.x-=this.m_particleDiameter;b.lowerBound.y-=this.m_particleDiameter;b.upperBound.x+=this.m_particleDiameter;
b.upperBound.y+=this.m_particleDiameter;this.m_bodyContactCount=0;a.prototype={ReportFixture:function(a){if(a.IsSensor())return!0;for(var b=a.GetShape(),c=a.GetBody(),e=c.GetWorldCenter(),l=c.GetMass(),m=c.GetInertia()-l*c.GetLocalCenter().LengthSquared(),l=0<l?1/l:0,m=0<m?1/m:0,b=b.GetChildCount(),n=0;n<b;n++){var p=a.GetAABB(n).Clone();p.lowerBound.x-=this.m_system.m_particleDiameter;p.lowerBound.y-=this.m_system.m_particleDiameter;p.upperBound.x+=this.m_system.m_particleDiameter;p.upperBound.y+=
this.m_system.m_particleDiameter;for(var q=this.m_system.m_proxyCount,r=this.m_system.m_proxyBuffer.lower_bound(0,q,ya(this.m_system.m_inverseDiameter*p.lowerBound.x,this.m_system.m_inverseDiameter*p.lowerBound.y),function(a,b){return D.Proxy.LessThan_p_i(a,b)}),q=this.m_system.m_proxyBuffer.upper_bound(r,q,ya(this.m_system.m_inverseDiameter*p.upperBound.x,this.m_system.m_inverseDiameter*p.upperBound.y),function(a,b){return D.Proxy.LessThan_i_p(a,b)});r!=q;++r){var J=this.m_system.m_proxyBuffer[r].index,
y=this.m_system.m_positionBuffer.data[J];if(p.lowerBound.x<=y.x&&y.x<=p.upperBound.x&&p.lowerBound.y<=y.y&&y.y<=p.upperBound.y){var s=[0],t=new d;a.ComputeDistance(y,s,t,n);if(s[0]<this.m_system.m_particleDiameter){var x=this.m_system.m_flagsBuffer.data[J]&I.b2_wallParticle?0:this.m_system.GetParticleInvMass(),y=d.Subtract(y,e),y=u(y,t);if(this.m_system.m_bodyContactCount>=this.m_system.m_bodyContactCapacity){var A=this.m_system.m_bodyContactCount?2*this.m_system.m_bodyContactCount:256;this.m_system.m_bodyContactBuffer=
this.m_system.ReallocateBuffer3(this.m_system.m_bodyContactBuffer,this.m_system.m_bodyContactCapacity,A);this.m_system.m_bodyContactCapacity=A}A=this.m_system.m_bodyContactBuffer[this.m_system.m_bodyContactCount]=new bd;A.index=J;A.body=c;A.weight=1-s[0]*this.m_system.m_inverseDiameter;A.normal.Assign(t.Negate());A.mass=1/(x+l+m*y*y);this.m_system.m_bodyContactCount++}}}}return!0},ReportParticle:function(a){return!1}};c=new a(this);this.m_world.QueryAABB(c,b)},Solve:function(a){++this.m_timestamp;
if(0!=this.m_count){for(var b=this.m_allParticleFlags=0;b<this.m_count;b++)this.m_allParticleFlags|=this.m_flagsBuffer.data[b];this.m_allParticleFlags&I.b2_zombieParticle&&this.SolveZombie();this.m_allGroupFlags=0;for(b=this.m_groupList;b;b=b.GetNext())this.m_allGroupFlags|=b.m_groupFlags;for(var c=d.Multiply(a.dt*this.m_gravityScale,this.m_world.GetGravity()),e=this.GetCriticalVelocitySquared(a),b=0;b<this.m_count;b++){var f=this.m_velocityBuffer.data[b];f.Add(c);var g=v(f,f);g>e&&f.Multiply(va(e/
g))}this.SolveCollision(a);this.m_allGroupFlags&ta.b2_rigidParticleGroup&&this.SolveRigid(a);this.m_allParticleFlags&I.b2_wallParticle&&this.SolveWall(a);for(b=0;b<this.m_count;b++)this.m_positionBuffer.data[b].Add(d.Multiply(a.dt,this.m_velocityBuffer.data[b]));this.UpdateBodyContacts();this.UpdateContacts(!1);this.m_allParticleFlags&I.b2_viscousParticle&&this.SolveViscous(a);this.m_allParticleFlags&I.b2_powderParticle&&this.SolvePowder(a);this.m_allParticleFlags&I.b2_tensileParticle&&this.SolveTensile(a);
this.m_allParticleFlags&I.b2_elasticParticle&&this.SolveElastic(a);this.m_allParticleFlags&I.b2_springParticle&&this.SolveSpring(a);this.m_allGroupFlags&ta.b2_solidParticleGroup&&this.SolveSolid(a);this.m_allParticleFlags&I.b2_colorMixingParticle&&this.SolveColorMixing(a);this.SolvePressure(a);this.SolveDamping(a)}},SolveCollision:function(a){function b(a,b){this.m_system=a;this.m_step=b}var c=new X;c.lowerBound.x=+W;c.lowerBound.y=+W;c.upperBound.x=-W;c.upperBound.y=-W;for(var e=0;e<this.m_count;e++){var f=
this.m_positionBuffer.data[e],g=d.Add(f,d.Multiply(a.dt,this.m_velocityBuffer.data[e]));c.lowerBound=Da(c.lowerBound,Da(f,g));c.upperBound=Ea(c.upperBound,Ea(f,g))}b.prototype={ReportFixture:function(a){if(a.IsSensor())return!0;for(var b=a.GetShape(),c=a.GetBody(),e=this.m_system.m_proxyCount,b=b.GetChildCount(),f=0;f<b;f++){var g=a.GetAABB(f).Clone();g.lowerBound.x-=this.m_system.m_particleDiameter;g.lowerBound.y-=this.m_system.m_particleDiameter;g.upperBound.x+=this.m_system.m_particleDiameter;
g.upperBound.y+=this.m_system.m_particleDiameter;for(var q=this.m_system.m_proxyBuffer.lower_bound(0,e,ya(this.m_system.m_inverseDiameter*g.lowerBound.x,this.m_system.m_inverseDiameter*g.lowerBound.y),function(a,b){return D.Proxy.LessThan_p_i(a,b)}),r=this.m_system.m_proxyBuffer.upper_bound(q,e,ya(this.m_system.m_inverseDiameter*g.upperBound.x,this.m_system.m_inverseDiameter*g.upperBound.y),function(a,b){return D.Proxy.LessThan_i_p(a,b)});q!=r;++q){var J=this.m_system.m_proxyBuffer[q].index,y=this.m_system.m_positionBuffer.data[J];
if(g.lowerBound.x<=y.x&&y.x<=g.upperBound.x&&g.lowerBound.y<=y.y&&y.y<=g.upperBound.y){var s=this.m_system.m_velocityBuffer.data[J],t=new Tb,x=new sb;x.p1=V(c.m_xf,Ca(c.m_xf0,y));x.p2=d.Add(y,d.Multiply(this.m_step.dt,s));x.maxFraction=1;a.RayCast(t,x,f)&&(x=d.Add(d.Add(d.Multiply(1-t.fraction,x.p1),d.Multiply(t.fraction,x.p2)),d.Multiply(Q,t.normal)),y=d.Multiply(this.m_step.inv_dt,d.Subtract(x,y)),this.m_system.m_velocityBuffer.data[J].Assign(y),J=d.Multiply(this.m_system.GetParticleMass(),d.Subtract(s,
y)),J=d.Multiply(v(J,t.normal),t.normal),c.ApplyLinearImpulse(J,x,!0))}}}return!0},ReportParticle:function(a){return!1}};a=new b(this,a);this.m_world.QueryAABB(a,c)},SolvePressure:function(a){for(var b=0;b<this.m_count;b++)this.m_accumulationBuffer[b]=0;for(b=0;b<this.m_bodyContactCount;b++){var c=this.m_bodyContactBuffer[b],e=c.index,f=c.weight;this.m_accumulationBuffer[e]+=f}for(b=0;b<this.m_contactCount;b++){var c=this.m_contactBuffer[b],e=c.indexA,g=c.indexB,f=c.weight;this.m_accumulationBuffer[e]+=
f;this.m_accumulationBuffer[g]+=f}if(this.m_allParticleFlags&D.k_noPressureFlags)for(b=0;b<this.m_count;b++)this.m_flagsBuffer.data[b]&D.k_noPressureFlags&&(this.m_accumulationBuffer[b]=0);for(var k=this.m_pressureStrength*this.GetCriticalPressure(a),b=0;b<this.m_count;b++)f=this.m_accumulationBuffer[b],c=k*H(0,O(f,5)-1),this.m_accumulationBuffer[b]=c;a=a.dt/(this.m_density*this.m_particleDiameter);for(b=0;b<this.m_bodyContactCount;b++){var c=this.m_bodyContactBuffer[b],e=c.index,g=c.body,f=c.weight,
h=c.mass,l=c.normal,m=this.m_positionBuffer.data[e],c=this.m_accumulationBuffer[e]+k*f,f=d.Multiply(a*f*h*c,l);this.m_velocityBuffer.data[e].Subtract(d.Multiply(this.GetParticleInvMass(),f));g.ApplyLinearImpulse(f,m,!0)}for(b=0;b<this.m_contactCount;b++)c=this.m_contactBuffer[b],e=c.indexA,g=c.indexB,f=c.weight,l=c.normal,c=this.m_accumulationBuffer[e]+this.m_accumulationBuffer[g],f=d.Multiply(a*f*c,l),this.m_velocityBuffer.data[e].Subtract(f),this.m_velocityBuffer.data[g].Add(f)},SolveDamping:function(a){a=
this.m_dampingStrength;for(var b=0;b<this.m_bodyContactCount;b++){var c=this.m_bodyContactBuffer[b],e=c.index,f=c.body,g=c.weight,k=c.mass,h=c.normal,c=this.m_positionBuffer.data[e],l=d.Subtract(f.GetLinearVelocityFromWorldPoint(c),this.m_velocityBuffer.data[e]),l=v(l,h);0>l&&(g=d.Multiply(a*g*k*l,h),this.m_velocityBuffer.data[e].Add(d.Multiply(this.GetParticleInvMass(),g)),f.ApplyLinearImpulse(g.Negate(),c,!0))}for(b=0;b<this.m_contactCount;b++)c=this.m_contactBuffer[b],e=c.indexA,f=c.indexB,g=c.weight,
h=c.normal,l=d.Subtract(this.m_velocityBuffer.data[f],this.m_velocityBuffer.data[e]),l=v(l,h),0>l&&(g=d.Multiply(a*g*l,h),this.m_velocityBuffer.data[e].Add(g),this.m_velocityBuffer.data[f].Subtract(g))},SolveWall:function(a){for(a=0;a<this.m_count;a++)this.m_flagsBuffer.data[a]&I.b2_wallParticle&&this.m_velocityBuffer.data[a].SetZero()},SolveRigid:function(a){for(var b=this.m_groupList;b;b=b.GetNext())if(b.m_groupFlags&ta.b2_rigidParticleGroup){b.UpdateStatistics();var c=new F(a.dt*b.m_angularVelocity),
e=new Y(d.Add(b.m_center,d.Subtract(d.Multiply(a.dt,b.m_linearVelocity),C(c,b.m_center))),c);b.m_transform=oc(e,b.m_transform);c=new Y;c.p.x=a.inv_dt*e.p.x;c.p.y=a.inv_dt*e.p.y;c.q.s=a.inv_dt*e.q.s;c.q.c=a.inv_dt*(e.q.c-1);for(e=b.m_firstIndex;e<b.m_lastIndex;e++)this.m_velocityBuffer.data[e].Assign(V(c,this.m_positionBuffer.data[e]))}},SolveElastic:function(a){a=a.inv_dt*this.m_elasticStrength;for(var b=0;b<this.m_triadCount;b++){var c=this.m_triadBuffer[b];if(c.flags&I.b2_elasticParticle){var e=
c.indexA,f=c.indexB,g=c.indexC,k=c.pa,h=c.pb,l=c.pc,m=this.m_positionBuffer.data[e],n=this.m_positionBuffer.data[f],p=this.m_positionBuffer.data[g],q=d.Multiply(1/3,d.Add(m,d.Add(n,p))),r=new F;r.s=u(k,m)+u(h,n)+u(l,p);r.c=v(k,m)+v(h,n)+v(l,p);var J=1/va(r.s*r.s+r.c*r.c);r.s*=J;r.c*=J;c=a*c.strength;this.m_velocityBuffer.data[e].Add(d.Multiply(c,d.Subtract(C(r,k),d.Subtract(m,q))));this.m_velocityBuffer.data[f].Add(d.Multiply(c,d.Subtract(C(r,h),d.Subtract(n,q))));this.m_velocityBuffer.data[g].Add(d.Multiply(c,
d.Subtract(C(r,l),d.Subtract(p,q))))}}},SolveSpring:function(a){a=a.inv_dt*this.m_springStrength;for(var b=0;b<this.m_pairCount;b++){var c=this.m_pairBuffer[b];if(c.flags&I.b2_springParticle){var e=c.indexA,f=c.indexB,g=d.Subtract(this.m_positionBuffer.data[f],this.m_positionBuffer.data[e]),k=c.distance,h=g.Length(),c=d.Multiply(a*c.strength*(k-h)/h,g);this.m_velocityBuffer.data[e].Subtract(c);this.m_velocityBuffer.data[f].Add(c)}}},SolveTensile:function(a){this.m_accumulation2Buffer=this.RequestParticleBuffer(this.m_accumulation2Buffer);
for(var b=0;b<this.m_count;b++)this.m_accumulationBuffer[b]=0,this.m_accumulation2Buffer[b]=new d;for(b=0;b<this.m_contactCount;b++){var c=this.m_contactBuffer[b];if(c.flags&I.b2_tensileParticle){var e=c.indexA,f=c.indexB,g=c.weight,c=c.normal;this.m_accumulationBuffer[e]+=g;this.m_accumulationBuffer[f]+=g;this.m_accumulation2Buffer[e].Subtract(d.Multiply((1-g)*g,c));this.m_accumulation2Buffer[f].Add(d.Multiply((1-g)*g,c))}}var k=this.m_surfaceTensionStrengthA*this.GetCriticalVelocity(a);a=this.m_surfaceTensionStrengthB*
this.GetCriticalVelocity(a);for(b=0;b<this.m_contactCount;b++)if(c=this.m_contactBuffer[b],c.flags&I.b2_tensileParticle){var e=c.indexA,f=c.indexB,g=c.weight,c=c.normal,h=this.m_accumulationBuffer[e]+this.m_accumulationBuffer[f],l=d.Subtract(this.m_accumulation2Buffer[f],this.m_accumulation2Buffer[e]),g=(k*(h-2)+a*v(l,c))*g,g=d.Multiply(g,c);this.m_velocityBuffer.data[e].Subtract(g);this.m_velocityBuffer.data[f].Add(g)}},SolveViscous:function(a){a=this.m_viscousStrength;for(var b=0;b<this.m_bodyContactCount;b++){var c=
this.m_bodyContactBuffer[b],e=c.index;if(this.m_flagsBuffer.data[e]&I.b2_viscousParticle){var f=c.body,g=c.weight,k=c.mass,c=this.m_positionBuffer.data[e],h=d.Subtract(f.GetLinearVelocityFromWorldPoint(c),this.m_velocityBuffer.data[e]),g=d.Multiply(a*k*g,h);this.m_velocityBuffer.data[e].Add(d.Multiply(this.GetParticleInvMass(),g));f.ApplyLinearImpulse(g.Negate(),c,!0)}}for(b=0;b<this.m_contactCount;b++)c=this.m_contactBuffer[b],c.flags&I.b2_viscousParticle&&(e=c.indexA,f=c.indexB,g=c.weight,h=d.Subtract(this.m_velocityBuffer.data[f],
this.m_velocityBuffer.data[e]),g=d.Multiply(a*g,h),this.m_velocityBuffer.data[e].Add(g),this.m_velocityBuffer.data[f].Subtract(g))},SolvePowder:function(a){a=this.m_powderStrength*this.GetCriticalVelocity(a);for(var b=0;b<this.m_bodyContactCount;b++){var c=this.m_bodyContactBuffer[b],e=c.index;if(this.m_flagsBuffer.data[e]&I.b2_powderParticle){var f=c.weight;if(0.25<f){var g=c.body,k=this.m_positionBuffer.data[e],h=c.normal,c=d.Multiply(a*c.mass*(f-0.25),h);this.m_velocityBuffer.data[e].Subtract(d.Multiply(this.GetParticleInvMass(),
c));g.ApplyLinearImpulse(c,k,!0)}}}for(b=0;b<this.m_contactCount;b++)c=this.m_contactBuffer[b],c.flags&I.b2_powderParticle&&(f=c.weight,0.25<f&&(e=c.indexA,g=c.indexB,h=c.normal,c=d.Multiply(a*(f-0.25),h),this.m_velocityBuffer.data[e].Subtract(c),this.m_velocityBuffer.data[g].Add(c)))},SolveSolid:function(a){this.m_depthBuffer=this.RequestParticleBuffer(this.m_depthBuffer);a=a.inv_dt*this.m_ejectionStrength;for(var b=0;b<this.m_contactCount;b++){var c=this.m_contactBuffer[b],e=c.indexA,f=c.indexB;
this.m_groupBuffer[e]!=this.m_groupBuffer[f]&&(c=d.Multiply(a*(this.m_depthBuffer[e]+this.m_depthBuffer[f])*c.weight,c.normal),this.m_velocityBuffer.data[e].Subtract(c),this.m_velocityBuffer.data[f].Add(c))}},SolveColorMixing:function(a){this.m_colorBuffer.data=this.RequestParticleBuffer(this.m_colorBuffer.data);a=Math.floor(256*this.m_colorMixingStrength);for(var b=0;b<this.m_contactCount;b++){var c=this.m_contactBuffer[b],e=c.indexA,c=c.indexB;if(this.m_flagsBuffer.data[e]&this.m_flagsBuffer.data[c]&
I.b2_colorMixingParticle){var e=this.m_colorBuffer.data[e],c=this.m_colorBuffer.data[c],f=a*(c.r-e.r)>>8,d=a*(c.g-e.g)>>8,k=a*(c.b-e.b)>>8,h=a*(c.a-e.a)>>8;e.r+=f;e.g+=d;e.b+=k;e.a+=h;c.r-=f;c.g-=d;c.b-=k;c.a-=h}}},SolveZombie:function(){for(var a=0,b=Array(this.m_count),c=0;c<this.m_count;c++){var e=this.m_flagsBuffer.data[c];if(e&I.b2_zombieParticle){var f=this.m_world.m_destructionListener;e&I.b2_destructionListener&&f&&f.SayGoodbyeParticle(c);b[c]=D.b2_invalidParticleIndex}else b[c]=a,c!=a&&(this.m_flagsBuffer.data[a]=
this.m_flagsBuffer.data[c],this.m_positionBuffer.data[a]=this.m_positionBuffer.data[c],this.m_velocityBuffer.data[a]=this.m_velocityBuffer.data[c],this.m_groupBuffer[a]=this.m_groupBuffer[c],this.m_depthBuffer&&(this.m_depthBuffer[a]=this.m_depthBuffer[c]),this.m_colorBuffer.data&&(this.m_colorBuffer.data[a]=this.m_colorBuffer.data[c]),this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[a]=this.m_userDataBuffer.data[c])),a++}for(c=0;c<this.m_proxyCount;c++)e=this.m_proxyBuffer[c],e.index=b[e.index];
this.m_proxyCount=this.m_proxyBuffer.collapse(function(a){return 0>a.index},this.m_proxyCount);for(c=0;c<this.m_contactCount;c++)e=this.m_contactBuffer[c],e.indexA=b[e.indexA],e.indexB=b[e.indexB];this.m_contactCount=this.m_contactBuffer.collapse(function(a){return 0>a.indexA||0>a.indexB},this.m_contactCount);for(c=0;c<this.m_bodyContactCount;c++)e=this.m_bodyContactBuffer[c],e.index=b[e.index];this.m_bodyContactCount=this.m_bodyContactBuffer.collapse(function(a){return 0>a.index},this.m_bodyContactCount);
for(c=0;c<this.m_pairCount;c++)e=this.m_pairBuffer[c],e.indexA=b[e.indexA],e.indexB=b[e.indexB];this.m_pairCount=this.m_pairBuffer.collapse(function(a){return 0>a.indexA||0>a.indexB},this.m_pairCount);for(c=0;c<this.m_triadCount;c++)e=this.m_triadBuffer[c],e.indexA=b[e.indexA],e.indexB=b[e.indexB],e.indexC=b[e.indexC];this.m_triadCount=this.m_triadBuffer.collapse(function(a){return 0>a.indexA||0>a.indexB||0>a.indexC},this.m_triadCount);for(e=this.m_groupList;e;e=e.GetNext()){for(var f=a,d=0,k=!1,
c=e.m_firstIndex;c<e.m_lastIndex;c++){var h=b[c];0<=h?(f=O(f,h),d=H(d,h+1)):k=!0}f<d?(e.m_firstIndex=f,e.m_lastIndex=d,k&&e.m_groupFlags&ta.b2_rigidParticleGroup&&(e.m_toBeSplit=!0)):(e.m_firstIndex=0,e.m_lastIndex=0,e.m_destroyAutomatically&&(e.m_toBeDestroyed=!0))}this.m_count=a;for(e=this.m_groupList;e;)a=e.GetNext(),e.m_toBeDestroyed&&this.DestroyParticleGroup(e),e=a},RotateBuffer:function(a,b,c){function e(e){return e<a?e:e<b?e+c-b:e<c?e+a-b:e}if(a!=b&&b!=c){this.m_flagsBuffer.data.rotate(a,
b,c);this.m_positionBuffer.data.rotate(a,b,c);this.m_velocityBuffer.data.rotate(a,b,c);this.m_groupBuffer.rotate(a,b,c);this.m_depthBuffer&&this.m_depthBuffer.rotate(a,b,c);this.m_colorBuffer.data&&this.m_colorBuffer.data.rotate(a,b,c);this.m_userDataBuffer.data&&this.m_userDataBuffer.data.rotate(a,b,c);for(var f=0;f<this.m_proxyCount;f++){var d=this.m_proxyBuffer[f];d.index=e(d.index)}for(f=0;f<this.m_contactCount;f++)d=this.m_contactBuffer[f],d.indexA=e(d.indexA),d.indexB=e(d.indexB);for(f=0;f<
this.m_bodyContactCount;f++)d=this.m_bodyContactBuffer[f],d.index=e(d.index);for(f=0;f<this.m_pairCount;f++)d=this.m_pairBuffer[f],d.indexA=e(d.indexA),d.indexB=e(d.indexB);for(f=0;f<this.m_triadCount;f++)d=this.m_triadBuffer[f],d.indexA=e(d.indexA),d.indexB=e(d.indexB),d.indexC=e(d.indexC);for(f=this.m_groupList;f;f=f.GetNext())f.m_firstIndex=e(f.m_firstIndex),f.m_lastIndex=e(f.m_lastIndex-1)+1}},SetParticleRadius:function(a){this.m_particleDiameter=2*a;this.m_squaredDiameter=this.m_particleDiameter*
this.m_particleDiameter;this.m_inverseDiameter=1/this.m_particleDiameter},SetParticleDensity:function(a){this.m_density=a;this.m_inverseDensity=1/this.m_density},GetParticleDensity:function(){return this.m_density},SetParticleGravityScale:function(a){this.m_gravityScale=a},GetParticleGravityScale:function(){return this.m_gravityScale},SetParticleDamping:function(a){this.m_dampingStrength=a},GetParticleDamping:function(){return this.m_dampingStrength},GetParticleRadius:function(){return this.m_particleDiameter/
2},GetCriticalVelocity:function(a){return this.m_particleDiameter*a.inv_dt},GetCriticalVelocitySquared:function(a){a=this.GetCriticalVelocity(a);return a*a},GetCriticalPressure:function(a){return this.m_density*this.GetCriticalVelocitySquared(a)},GetParticleStride:function(){return 0.75*this.m_particleDiameter},GetParticleMass:function(){var a=this.GetParticleStride();return this.m_density*a*a},GetParticleInvMass:function(){return 1.777777*this.m_inverseDensity*this.m_inverseDiameter*this.m_inverseDiameter},
GetParticleFlagsBuffer:function(){return this.m_flagsBuffer.data},GetParticlePositionBuffer:function(){return this.m_positionBuffer.data},GetParticleVelocityBuffer:function(){return this.m_velocityBuffer.data},GetParticleColorBuffer:function(){this.m_colorBuffer.data=this.RequestParticleBuffer(this.m_colorBuffer.data);return this.m_colorBuffer.data},GetParticleUserDataBuffer:function(){this.m_userDataBuffer.data=this.RequestParticleBuffer(this.m_userDataBuffer.data);return this.m_userDataBuffer.data},
GetParticleMaxCount:function(){return this.m_maxCount},SetParticleMaxCount:function(a){this.m_maxCount=a},GetParticleGroupBuffer:function(){return this.m_groupBuffer},SetParticleBuffer:function(a,b,c){a.data=b;a.userSuppliedCapacity=c},SetParticleFlagsBuffer:function(a,b){this.SetParticleBuffer(this.m_flagsBuffer,a,b)},SetParticlePositionBuffer:function(a,b){this.SetParticleBuffer(this.m_positionBuffer,a,b)},SetParticleVelocityBuffer:function(a,b){this.SetParticleBuffer(this.m_velocityBuffer,a,b)},
SetParticleColorBuffer:function(a,b){this.SetParticleBuffer(this.m_colorBuffer,a,b)},SetParticleUserDataBuffer:function(a,b){this.SetParticleBuffer(this.m_userDataBuffer,a,b)},QueryAABB:function(a,b){if(0!=this.m_proxyCount)for(var c=this.m_proxyCount,e=this.m_proxyBuffer.lower_bound(0,c,ya(this.m_inverseDiameter*b.lowerBound.x,this.m_inverseDiameter*b.lowerBound.y),function(a,b){return D.Proxy.LessThan_p_i(a,b)}),c=this.m_proxyBuffer.upper_bound(e,c,ya(this.m_inverseDiameter*b.upperBound.x,this.m_inverseDiameter*
b.upperBound.y),function(a,b){return D.Proxy.LessThan_i_p(a,b)});e<c;++e){var f=this.m_proxyBuffer[e].index,d=this.m_positionBuffer.data[f];if(b.lowerBound.x<d.x&&d.x<b.upperBound.x&&b.lowerBound.y<d.y&&d.y<b.upperBound.y&&!a.ReportParticle(f))break}},RayCast:function(a,b,c){if(0!=this.m_proxyCount){var e=this.m_proxyCount,f=this.m_proxyBuffer.lower_bound(0,e,ya(this.m_inverseDiameter*O(b.x,c.x)-1,this.m_inverseDiameter*O(b.y,c.y)-1),function(a,b){return D.Proxy.LessThan_p_i(a,b)}),e=this.m_proxyBuffer.upper_bound(0,
e,ya(this.m_inverseDiameter*H(b.x,c.x)+1,this.m_inverseDiameter*H(b.y,c.y)+1),function(a,b){return D.Proxy.LessThan_i_p(a,b)}),g=1;c=d.Subtract(c,b);for(var k=v(c,c);f<e;++f){var h=this.m_proxyBuffer[f].index,l=d.Subtract(b,this.m_positionBuffer.data[h]),m=v(l,c),n=v(l,l),n=m*m-k*(n-this.m_squaredDiameter);if(0<=n){var p=va(n),n=(-m-p)/k;if(!(n>g)){if(0>n&&(n=(-m+p)/k,0>n||n>g))continue;l=d.Add(l,d.Subtract(n,c));l.Normalize();h=a.ReportParticle(h,d.Add(b,d.Multiply(n,c)),l,n);g=O(g,h);if(0>=g)break}}}}},
ComputeParticleCollisionEnergy:function(){for(var a=0,b=0;b<this.m_contactCount;b++){var c=this.m_contactBuffer[b],e=c.normal,c=d.Subtract(this.m_velocityBuffer.data[c.indexB],this.m_velocityBuffer.data[c.indexA]),e=v(c,e);0>e&&(a+=e*e)}return 0.5*this.GetParticleMass()*a},GetParticleGroupList:function(){return this.m_groupList},GetParticleGroupCount:function(){return this.m_groupCount},GetParticleCount:function(){return this.m_count}};wb.prototype={Clear:function(){this.other=this.prev=this.next=
null}};w.m_local_tempManifold=new L;w.prototype={Create:function(a,b,c,e){this.m_toi=0;this.m_flags=w.e_enabledFlag;this.m_fixtureA=a||null;this.m_fixtureB=c||null;this.m_indexA=b||0;this.m_indexB=e||0;this.m_manifold.pointCount=0;this.m_next=this.m_prev=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null;this.m_toiCount=0;a?(this.m_friction=va(this.m_fixtureA.m_friction*
this.m_fixtureB.m_friction),this.m_restitution=$b(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)):this.m_restitution=this.m_friction=0;this.m_tangentSpeed=0},GetManifold:function(){return this.m_manifold},GetWorldManifold:function(a){var b=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody(),e=this.m_fixtureA.GetShape(),f=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,b.GetTransform(),e.m_radius,c.GetTransform(),f.m_radius)},IsTouching:function(){return(this.m_flags&w.e_touchingFlag)==
w.e_touchingFlag},SetEnabled:function(a){this.m_flags=a?this.m_flags|w.e_enabledFlag:this.m_flags&~w.e_enabledFlag},IsEnabled:function(){return(this.m_flags&w.e_enabledFlag)==w.e_enabledFlag},GetNext:function(){return this.m_next},GetFixtureA:function(){return this.m_fixtureA},GetChildIndexA:function(){return this.m_indexA},GetFixtureB:function(){return this.m_fixtureB},GetChildIndexB:function(){return this.m_indexB},SetFriction:function(a){this.m_friction=a},GetFriction:function(){return this.m_friction},
ResetFriction:function(){this.m_friction=va(this.m_fixtureA.m_friction*this.m_fixtureB.m_friction)},SetRestitution:function(a){this.m_restitution=a},GetRestitution:function(){return this.m_restitution},ResetRestitution:function(){this.m_restitution=$b(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},SetTangentSpeed:function(a){this.m_tangentSpeed=a},GetTangentSpeed:function(){return this.m_tangentSpeed},Evaluate:function(a,b,c){},FlagForFiltering:function(){this.m_flags|=w.e_filterFlag},
m_oldManifold:null,Update:function(a){w.m_local_tempManifold.Assign(this.m_manifold);this.m_flags|=w.e_enabledFlag;var b=!1,c=(this.m_flags&w.e_touchingFlag)==w.e_touchingFlag,e=this.m_fixtureA.IsSensor(),f=this.m_fixtureB.IsSensor(),e=e||f,f=this.m_fixtureA.GetBody(),d=this.m_fixtureB.GetBody(),b=f.GetTransform(),k=d.GetTransform();if(e)f=this.m_fixtureA.GetShape(),d=this.m_fixtureB.GetShape(),b=ga(f,this.m_indexA,d,this.m_indexB,b,k),this.m_manifold.pointCount=0;else{this.Evaluate(this.m_manifold,
b,k);b=0<this.m_manifold.pointCount;for(k=0;k<this.m_manifold.pointCount;++k){var h=this.m_manifold.points[k];h.normalImpulse=0;h.tangentImpulse=0;for(var l=h.id,m=0;m<w.m_local_tempManifold.pointCount;++m){var n=w.m_local_tempManifold.points[m];if(n.id.Get()==l.Get()){h.normalImpulse=n.normalImpulse;h.tangentImpulse=n.tangentImpulse;break}}}b!=c&&(f.SetAwake(!0),d.SetAwake(!0))}this.m_flags=b?this.m_flags|w.e_touchingFlag:this.m_flags&~w.e_touchingFlag;!1==c&&!0==b&&a&&a.BeginContact(this);!0==c&&
!1==b&&a&&a.EndContact(this);!1==e&&b&&a&&a.PreSolve(this,w.m_local_tempManifold)}};w.e_islandFlag=1;w.e_touchingFlag=2;w.e_enabledFlag=4;w.e_filterFlag=8;w.e_bulletHitFlag=16;w.e_toiFlag=32;xb.prototype={Evaluate:function(a,b,c){tc(a,this.m_fixtureA.GetShape(),b,this.m_fixtureB.GetShape(),c)},Create:function(a,b,c,e){this.parent.prototype.Create.call(this,a,0,c,0)}};xb._extend(w);var Mb=new Ja;yb.prototype={Evaluate:function(a,b,c){this.m_fixtureA.GetShape().GetChildEdge(Mb,this.m_indexA);Vb(a,Mb,
b,this.m_fixtureB.GetShape(),c)},Create:function(a,b,c,e){this.parent.prototype.Create.call(this,a,b,c,e)}};yb._extend(w);Ua.prototype={Evaluate:function(a,b,c){this.m_fixtureA.GetShape().GetChildEdge(Mb,this.m_indexA);db(a,Mb,b,this.m_fixtureB.GetShape(),c)},Create:function(a,b,c,e){this.parent.prototype.Create.call(this,a,b,c,e)}};Ua.Create=function(a,b,c,e){return new Ua(a,b,c,e)};Ua._extend(w);Va.prototype={Evaluate:function(a,b,c){Vb(a,this.m_fixtureA.GetShape(),b,this.m_fixtureB.GetShape(),
c)},Create:function(a,b,c,e){this.parent.prototype.Create.call(this,a,0,c,0)}};Va.Create=function(a,b,c,e){return new Va(a,c)};Va._extend(w);Wa.prototype={Evaluate:function(a,b,c){db(a,this.m_fixtureA.GetShape(),b,this.m_fixtureB.GetShape(),c)},Create:function(a,b,c,e){this.parent.prototype.Create.call(this,a,0,c,0)}};Wa.Create=function(a,b,c,e){return new Wa(a,c)};Wa._extend(w);Xa.prototype={Evaluate:function(a,b,c){uc(a,this.m_fixtureA.GetShape(),b,this.m_fixtureB.GetShape(),c)},Create:function(a,
b,c,e){this.parent.prototype.Create.call(this,a,0,c,0)}};Xa.Create=function(a,b,c,e){return new Xa(a,c)};Xa._extend(w);Ya.prototype={Evaluate:function(a,b,c){fa(a,this.m_fixtureA.GetShape(),b,this.m_fixtureB.GetShape(),c)},Create:function(a,b,c,e){this.parent.prototype.Create.call(this,a,0,c,0)}};Ya.Create=function(a,b,c,e){return new Ya(a,c)};Ya._extend(w);w.AddType=function(a,b,c){w.s_registers[b]||(w.s_registers[b]=[]);w.s_registers[b][c]=new ac;w.s_registers[b][c].fcn=a;w.s_registers[b][c].primary=
!0;b!=c&&(w.s_registers[c]||(w.s_registers[c]=[]),w.s_registers[c][b]=new ac,w.s_registers[c][b].fcn=a,w.s_registers[c][b].primary=!1);a.garbage=[];a.alloc=2};w.InitializeRegisters=function(){w.AddType(xb,G.e_circle,G.e_circle);w.AddType(Xa,G.e_polygon,G.e_circle);w.AddType(Ya,G.e_polygon,G.e_polygon);w.AddType(Va,G.e_edge,G.e_circle);w.AddType(Wa,G.e_edge,G.e_polygon);w.AddType(yb,G.e_chain,G.e_circle);w.AddType(Ua,G.e_chain,G.e_polygon)};w.RetrieveGarbage=function(a){var b;if(b=a.garbage.pop())return b;
for(b=0;b<a.alloc-1;++b)a.garbage.push(new a);a.alloc+=32;return new a};w.Create=function(a,b,c,e){!1==w.s_initialized&&(w.InitializeRegisters(),w.s_initialized=!0);var f=a.GetType(),d=c.GetType(),k=w.s_registers[f]?w.s_registers[f][d]?w.s_registers[f][d].fcn:null:null;return k?(k=w.RetrieveGarbage(k),w.s_registers[f][d].primary?k.Create(a,b,c,e):k.Create(c,e,a,b),k):null};w.Destroy=function(a){var b=a.m_fixtureA,c=a.m_fixtureB;0<a.m_manifold.pointCount&&!1==b.IsSensor()&&!1==c.IsSensor()&&(b.GetBody().SetAwake(!0),
c.GetBody().SetAwake(!0));b=b.GetType();c=c.GetType();a.m_nodeA.Clear();a.m_nodeB.Clear();w.s_registers[b][c].fcn.garbage.push(a)};w.s_registers=[];w.s_initialized=!1;var Jc=new Xb,Kc=new Yb;Zb.prototype={AddPair:function(a,b){var c=a.fixture,e=b.fixture,f=a.childIndex,d=b.childIndex,k=c.GetBody(),h=e.GetBody();if(k!=h){for(var l=h.GetContactList();l;){if(l.other==k){var m=l.contact.GetFixtureA(),n=l.contact.GetFixtureB(),p=l.contact.GetChildIndexA(),q=l.contact.GetChildIndexB();if(m==c&&n==e&&p==
f&&q==d||m==e&&n==c&&p==d&&q==f)return}l=l.next}!1==h.ShouldCollide(k)||this.m_contactFilter&&!1==this.m_contactFilter.ShouldCollide(c,e)||(f=w.Create(c,f,e,d),null!=f&&(c=f.GetFixtureA(),e=f.GetFixtureB(),f.GetChildIndexA(),f.GetChildIndexB(),k=c.GetBody(),h=e.GetBody(),f.m_prev=null,f.m_next=this.m_contactList,null!=this.m_contactList&&(this.m_contactList.m_prev=f),this.m_contactList=f,f.m_nodeA.contact=f,f.m_nodeA.other=h,f.m_nodeA.prev=null,f.m_nodeA.next=k.m_contactList,null!=k.m_contactList&&
(k.m_contactList.prev=f.m_nodeA),k.m_contactList=f.m_nodeA,f.m_nodeB.contact=f,f.m_nodeB.other=k,f.m_nodeB.prev=null,f.m_nodeB.next=h.m_contactList,null!=h.m_contactList&&(h.m_contactList.prev=f.m_nodeB),h.m_contactList=f.m_nodeB,!1==c.IsSensor()&&!1==e.IsSensor()&&(k.SetAwake(!0),h.SetAwake(!0)),++this.m_contactCount))}},FindNewContacts:function(){this.m_broadPhase.UpdatePairs(this)},Destroy:function(a){var b=a.GetFixtureA(),c=a.GetFixtureB(),b=b.GetBody(),c=c.GetBody();this.m_contactListener&&a.IsTouching()&&
this.m_contactListener.EndContact(a);a.m_prev&&(a.m_prev.m_next=a.m_next);a.m_next&&(a.m_next.m_prev=a.m_prev);a==this.m_contactList&&(this.m_contactList=a.m_next);a.m_nodeA.prev&&(a.m_nodeA.prev.next=a.m_nodeA.next);a.m_nodeA.next&&(a.m_nodeA.next.prev=a.m_nodeA.prev);a.m_nodeA==b.m_contactList&&(b.m_contactList=a.m_nodeA.next);a.m_nodeB.prev&&(a.m_nodeB.prev.next=a.m_nodeB.next);a.m_nodeB.next&&(a.m_nodeB.next.prev=a.m_nodeB.prev);a.m_nodeB==c.m_contactList&&(c.m_contactList=a.m_nodeB.next);w.Destroy(a);
--this.m_contactCount},Collide:function(){for(var a=this.m_contactList;a;){var b=a.GetFixtureA(),c=a.GetFixtureB(),e=a.GetChildIndexA(),f=a.GetChildIndexB(),d=b.GetBody(),k=c.GetBody();if(a.m_flags&w.e_filterFlag){if(!1==k.ShouldCollide(d)){b=a;a=b.GetNext();this.Destroy(b);continue}if(this.m_contactFilter&&!1==this.m_contactFilter.ShouldCollide(b,c)){b=a;a=b.GetNext();this.Destroy(b);continue}a.m_flags&=~w.e_filterFlag}d=d.IsAwake()&&d.m_type!=t.b2_staticBody;k=k.IsAwake()&&k.m_type!=t.b2_staticBody;
!1==d&&!1==k?a=a.GetNext():!1==this.m_broadPhase.TestOverlap(b.m_proxies[e].proxyId,c.m_proxies[f].proxyId)?(b=a,a=b.GetNext(),this.Destroy(b)):(a.Update(this.m_contactListener),a=a.GetNext())}}};bc.prototype={Initialize:function(a,b,c,e){switch(a.type){case L.e_circles:var f=b.q.c*a.localPoint.x-b.q.s*a.localPoint.y+b.p.x;b=b.q.s*a.localPoint.x+b.q.c*a.localPoint.y+b.p.y;var d=c.q.c*a.localPoints[0].x-c.q.s*a.localPoints[0].y+c.p.x;c=c.q.s*a.localPoints[0].x+c.q.c*a.localPoints[0].y+c.p.y;this.point.x=
0.5*(f+d);this.point.y=0.5*(b+c);this.normal.x=d-f;this.normal.y=c-b;c=this.normal.x;b=this.normal.y;this.normal.Normalize();this.separation=c*this.normal.x+b*this.normal.y-a.radiusA-a.radiusB;break;case L.e_faceA:this.normal.x=b.q.c*a.localNormal.x-b.q.s*a.localNormal.y;this.normal.y=b.q.s*a.localNormal.x+b.q.c*a.localNormal.y;var f=b.q.c*a.localPoint.x-b.q.s*a.localPoint.y+b.p.x,d=b.q.s*a.localPoint.x+b.q.c*a.localPoint.y+b.p.y,k=c.q.c*a.localPoints[e].x-c.q.s*a.localPoints[e].y+c.p.x;c=c.q.s*a.localPoints[e].x+
c.q.c*a.localPoints[e].y+c.p.y;this.separation=(k-f)*this.normal.x+(c-d)*this.normal.y-a.radiusA-a.radiusB;this.point.x=k;this.point.y=c;break;case L.e_faceB:this.normal.x=c.q.c*a.localNormal.x-c.q.s*a.localNormal.y,this.normal.y=c.q.s*a.localNormal.x+c.q.c*a.localNormal.y,f=c.q.c*a.localPoint.x-c.q.s*a.localPoint.y+c.p.x,d=c.q.s*a.localPoint.x+c.q.c*a.localPoint.y+c.p.y,k=b.q.c*a.localPoints[e].x-b.q.s*a.localPoints[e].y+b.p.x,c=b.q.s*a.localPoints[e].x+b.q.c*a.localPoints[e].y+b.p.y,this.separation=
(k-f)*this.normal.x+(c-d)*this.normal.y-a.radiusA-a.radiusB,this.point.x=k,this.point.y=c,this.normal.x=-this.normal.x,this.normal.y=-this.normal.y}}};E.cs_xfA=new Y;E.cs_xfB=new Y;E.temp_solver_manifold=new bc;E.prototype={Init:function(a){this.m_step=a.step;this.m_count=a.count;this.m_positionConstraints.length=this.m_count;this.m_velocityConstraints.length=this.m_count;this.m_positions=a.positions;this.m_velocities=a.velocities;this.m_contacts=a.contacts;for(a=0;a<this.m_count;++a){var b=this.m_contacts[a],
c=b.m_fixtureA,e=b.m_fixtureB,f=c.GetShape(),d=e.GetShape(),f=f.m_radius,k=d.m_radius,h=c.GetBody(),l=e.GetBody(),e=b.GetManifold(),c=e.pointCount,d=this.m_velocityConstraints[a]||new Nc;d.friction=b.m_friction;d.restitution=b.m_restitution;d.tangentSpeed=b.m_tangentSpeed;d.indexA=h.m_islandIndex;d.indexB=l.m_islandIndex;d.invMassA=h.m_invMass;d.invMassB=l.m_invMass;d.invIA=h.m_invI;d.invIB=l.m_invI;d.contactIndex=a;d.pointCount=c;d.K.SetZero();d.normalMass.SetZero();this.m_velocityConstraints[a]=
d;b=this.m_positionConstraints[a]||new Mc;b.indexA=h.m_islandIndex;b.indexB=l.m_islandIndex;b.invMassA=h.m_invMass;b.invMassB=l.m_invMass;b.localCenterA.x=h.m_sweep.localCenter.x;b.localCenterA.y=h.m_sweep.localCenter.y;b.localCenterB.x=l.m_sweep.localCenter.x;b.localCenterB.y=l.m_sweep.localCenter.y;b.invIA=h.m_invI;b.invIB=l.m_invI;b.localNormal.x=e.localNormal.x;b.localNormal.y=e.localNormal.y;b.localPoint.x=e.localPoint.x;b.localPoint.y=e.localPoint.y;b.pointCount=c;b.radiusA=f;b.radiusB=k;b.type=
e.type;this.m_positionConstraints[a]=b;for(f=0;f<c;++f)k=e.points[f],h=d.points[f],this.m_step.warmStarting?(h.normalImpulse=this.m_step.dtRatio*k.normalImpulse,h.tangentImpulse=this.m_step.dtRatio*k.tangentImpulse):(h.normalImpulse=0,h.tangentImpulse=0),h.rA.SetZero(),h.rB.SetZero(),h.normalMass=0,h.tangentMass=0,h.velocityBias=0,b.localPoints[f]=k.localPoint}},InitializeVelocityConstraints:function(){for(var a=0;a<this.m_count;++a){var b=this.m_velocityConstraints[a],c=this.m_positionConstraints[a],
e=c.radiusA,f=c.radiusB,d=this.m_contacts[b.contactIndex].GetManifold(),k=b.indexA,h=b.indexB,l=b.invMassA,m=b.invMassB,n=b.invIA,p=b.invIB,q=c.localCenterA,r=c.localCenterB,c=this.m_positions[k].c,J=this.m_velocities[k].v,y=this.m_velocities[k].w,s=this.m_positions[h].c,t=this.m_positions[h].a,x=this.m_velocities[h].v,h=this.m_velocities[h].w;E.cs_xfA.q.Set(this.m_positions[k].a);E.cs_xfB.q.Set(t);E.cs_xfA.p.x=c.x-(E.cs_xfA.q.c*q.x-E.cs_xfA.q.s*q.y);E.cs_xfA.p.y=c.y-(E.cs_xfA.q.s*q.x+E.cs_xfA.q.c*
q.y);E.cs_xfB.p.x=s.x-(E.cs_xfB.q.c*r.x-E.cs_xfB.q.s*r.y);E.cs_xfB.p.y=s.y-(E.cs_xfB.q.s*r.x+E.cs_xfB.q.c*r.y);k=new Sb;k.Initialize(d,E.cs_xfA,e,E.cs_xfB,f);b.normal.x=k.normal.x;b.normal.y=k.normal.y;e=b.pointCount;for(f=0;f<e;++f)d=b.points[f],d.rA.x=k.points[f].x-c.x,d.rA.y=k.points[f].y-c.y,d.rB.x=k.points[f].x-s.x,d.rB.y=k.points[f].y-s.y,q=d.rA.x*b.normal.y-d.rA.y*b.normal.x,r=d.rB.x*b.normal.y-d.rB.y*b.normal.x,q=l+m+n*q*q+p*r*r,d.normalMass=0<q?1/q:0,r=1*b.normal.y,t=-1*b.normal.x,q=d.rA.x*
t-d.rA.y*r,r=d.rB.x*t-d.rB.y*r,q=l+m+n*q*q+p*r*r,d.tangentMass=0<q?1/q:0,d.velocityBias=0,q=b.normal.x*(x.x+-h*d.rB.y-J.x- -y*d.rA.y)+b.normal.y*(x.y+h*d.rB.x-J.y-y*d.rA.x),-1>q&&(d.velocityBias=-b.restitution*q);2==b.pointCount&&(J=b.points[0],s=b.points[1],c=J.rA.x*b.normal.y-J.rA.y*b.normal.x,J=J.rB.x*b.normal.y-J.rB.y*b.normal.x,y=s.rA.x*b.normal.y-s.rA.y*b.normal.x,h=s.rB.x*b.normal.y-s.rB.y*b.normal.x,s=l+m+n*c*c+p*J*J,x=l+m+n*y*y+p*h*h,l=l+m+n*c*y+p*J*h,s*s<1E3*(s*x-l*l)?(b.K.ex.x=s,b.K.ex.y=
l,b.K.ey.x=l,b.K.ey.y=x,b.normalMass.Assign(b.K.GetInverse())):b.pointCount=1)}},WarmStart:function(){for(var a=0;a<this.m_count;++a){for(var b=this.m_velocityConstraints[a],c=b.indexA,e=b.indexB,f=b.invMassA,d=b.invIA,k=b.invMassB,h=b.invIB,l=b.pointCount,m=this.m_velocities[c].v,n=this.m_velocities[c].w,p=this.m_velocities[e].v,q=this.m_velocities[e].w,r=b.normal,s=1*r.y,y=-1*r.x,t=0;t<l;++t){var u=b.points[t],x=u.normalImpulse*r.x+u.tangentImpulse*s,A=u.normalImpulse*r.y+u.tangentImpulse*y,n=n-
d*(u.rA.x*A-u.rA.y*x);m.x-=f*x;m.y-=f*A;q+=h*(u.rB.x*A-u.rB.y*x);p.x+=k*x;p.y+=k*A}this.m_velocities[c].w=n;this.m_velocities[e].w=q}},SolveVelocityConstraints:function(){for(var a=0;a<this.m_count;++a){for(var b=this.m_velocityConstraints[a],c=b.indexA,e=b.indexB,d=b.invMassA,g=b.invIA,k=b.invMassB,h=b.invIB,l=b.pointCount,m=this.m_velocities[c].v,n=this.m_velocities[c].w,p=this.m_velocities[e].v,q=this.m_velocities[e].w,r=b.normal,s=1*r.y,y=-1*r.x,t=b.friction,u=0;u<l;++u){var x=b.points[u],A=p.x+
-q*x.rB.y-m.x- -n*x.rA.y,v=p.y+q*x.rB.x-m.y-n*x.rA.x,A=x.tangentMass*-(A*s+v*y-b.tangentSpeed),v=t*x.normalImpulse,v=ca(x.tangentImpulse+A,-v,v),A=v-x.tangentImpulse;x.tangentImpulse=v;v=A*s;A*=y;m.x-=d*v;m.y-=d*A;n-=g*(x.rA.x*A-x.rA.y*v);p.x+=k*v;p.y+=k*A;q+=h*(x.rB.x*A-x.rB.y*v)}if(1==b.pointCount)x=b.points[0],A=p.x+-q*x.rB.y-m.x- -n*x.rA.y,v=p.y+q*x.rB.x-m.y-n*x.rA.x,A=-x.normalMass*(A*r.x+v*r.y-x.velocityBias),v=H(x.normalImpulse+A,0),A=v-x.normalImpulse,x.normalImpulse=v,v=A*r.x,A*=r.y,m.x-=
d*v,m.y-=d*A,n-=g*(x.rA.x*A-x.rA.y*v),p.x+=k*v,p.y+=k*A,q+=h*(x.rB.x*A-x.rB.y*v);else for(var l=b.points[0],s=b.points[1],x=l.normalImpulse,u=s.normalImpulse,A=(p.x+-q*l.rB.y-m.x- -n*l.rA.y)*r.x+(p.y+q*l.rB.x-m.y-n*l.rA.x)*r.y,v=(p.x+-q*s.rB.y-m.x- -n*s.rA.y)*r.x+(p.y+q*s.rB.x-m.y-n*s.rA.x)*r.y,w=A-l.velocityBias,C=v-s.velocityBias,w=w-(b.K.ex.x*x+b.K.ey.x*u),C=C-(b.K.ex.y*x+b.K.ey.y*u);;){y=-(b.normalMass.ex.x*w+b.normalMass.ey.x*C);t=-(b.normalMass.ex.y*w+b.normalMass.ey.y*C);if(0<=y&&0<=t){x=y-
x;u=t-u;b=x*r.x;x*=r.y;A=u*r.x;r=u*r.y;m.x-=d*(b+A);m.y-=d*(x+r);n-=g*(l.rA.x*x-l.rA.y*b+(s.rA.x*r-s.rA.y*A));p.x+=k*(b+A);p.y+=k*(x+r);q+=h*(l.rB.x*x-l.rB.y*b+(s.rB.x*r-s.rB.y*A));l.normalImpulse=y;s.normalImpulse=t;break}y=-l.normalMass*w;t=0;v=b.K.ex.y*y+C;if(0<=y&&0<=v){x=y-x;u=t-u;b=x*r.x;x*=r.y;A=u*r.x;r=u*r.y;m.x-=d*(b+A);m.y-=d*(x+r);n-=g*(l.rA.x*x-l.rA.y*b+(s.rA.x*r-s.rA.y*A));p.x+=k*(b+A);p.y+=k*(x+r);q+=h*(l.rB.x*x-l.rB.y*b+(s.rB.x*r-s.rB.y*A));l.normalImpulse=y;s.normalImpulse=t;break}y=
0;t=-s.normalMass*C;A=b.K.ey.x*t+w;if(0<=t&&0<=A){x=y-x;u=t-u;b=x*r.x;x*=r.y;A=u*r.x;r=u*r.y;m.x-=d*(b+A);m.y-=d*(x+r);n-=g*(l.rA.x*x-l.rA.y*b+(s.rA.x*r-s.rA.y*A));p.x+=k*(b+A);p.y+=k*(x+r);q+=h*(l.rB.x*x-l.rB.y*b+(s.rB.x*r-s.rB.y*A));l.normalImpulse=y;s.normalImpulse=t;break}t=y=0;A=w;v=C;if(0<=A&&0<=v){x=y-x;u=t-u;b=x*r.x;x*=r.y;A=u*r.x;r=u*r.y;m.x-=d*(b+A);m.y-=d*(x+r);n-=g*(l.rA.x*x-l.rA.y*b+(s.rA.x*r-s.rA.y*A));p.x+=k*(b+A);p.y+=k*(x+r);q+=h*(l.rB.x*x-l.rB.y*b+(s.rB.x*r-s.rB.y*A));l.normalImpulse=
y;s.normalImpulse=t;break}break}this.m_velocities[c].w=n;this.m_velocities[e].w=q}},StoreImpulses:function(){for(var a=0;a<this.m_count;++a)for(var b=this.m_velocityConstraints[a],c=this.m_contacts[b.contactIndex].GetManifold(),e=0;e<b.pointCount;++e)c.points[e].normalImpulse=b.points[e].normalImpulse,c.points[e].tangentImpulse=b.points[e].tangentImpulse},SolvePositionConstraints:function(){for(var a=0,b=0;b<this.m_count;++b){for(var c=this.m_positionConstraints[b],e=c.indexA,d=c.indexB,g=c.localCenterA,
k=c.invMassA,h=c.invIA,l=c.localCenterB,m=c.invMassB,n=c.invIB,p=c.pointCount,q=this.m_positions[e].c,r=this.m_positions[e].a,s=this.m_positions[d].c,t=this.m_positions[d].a,u=0;u<p;++u){E.cs_xfA.q.Set(r);E.cs_xfB.q.Set(t);E.cs_xfA.p.x=q.x-(E.cs_xfA.q.c*g.x-E.cs_xfA.q.s*g.y);E.cs_xfA.p.y=q.y-(E.cs_xfA.q.s*g.x+E.cs_xfA.q.c*g.y);E.cs_xfB.p.x=s.x-(E.cs_xfB.q.c*l.x-E.cs_xfB.q.s*l.y);E.cs_xfB.p.y=s.y-(E.cs_xfB.q.s*l.x+E.cs_xfB.q.c*l.y);E.temp_solver_manifold.Initialize(c,E.cs_xfA,E.cs_xfB,u);var v=E.temp_solver_manifold.normal,
x=E.temp_solver_manifold.point,A=E.temp_solver_manifold.separation,w=x.x-q.x,C=x.y-q.y,B=x.x-s.x,x=x.y-s.y,a=O(a,A),A=ca(0.2*(A+Q),-0.2,0),z=w*v.y-C*v.x,D=B*v.y-x*v.x,z=k+m+h*z*z+n*D*D,z=0<z?-A/z:0,A=z*v.x,v=z*v.y;q.x-=k*A;q.y-=k*v;r-=h*(w*v-C*A);s.x+=m*A;s.y+=m*v;t+=n*(B*v-x*A)}this.m_positions[e].a=r;this.m_positions[d].a=t}return a>=-3*Q},SolveTOIPositionConstraints:function(a,b){for(var c=0,e=0;e<this.m_count;++e){var f=this.m_positionConstraints[e],g=f.indexA,k=f.indexB,h=f.localCenterA,l=f.localCenterB,
m=f.pointCount,n=0,p=0;if(g==a||g==b)n=f.invMassA,p=f.invIA;var q=0,r=0;if(k==a||k==b)q=f.invMassB,r=f.invIB;for(var s=this.m_positions[g].c,t=this.m_positions[g].a,v=this.m_positions[k].c,w=this.m_positions[k].a,x=0;x<m;++x){E.cs_xfA.q.Set(t);E.cs_xfB.q.Set(w);E.cs_xfA.p.Assign(d.Subtract(s,C(E.cs_xfA.q,h)));E.cs_xfB.p.Assign(d.Subtract(v,C(E.cs_xfB.q,l)));E.temp_solver_manifold.Initialize(f,E.cs_xfA,E.cs_xfB,x);var A=E.temp_solver_manifold.normal,z=E.temp_solver_manifold.point,B=E.temp_solver_manifold.separation,
D=d.Subtract(z,s),z=d.Subtract(z,v),c=O(c,B),B=ca(0.75*(B+Q),-0.2,0),F=u(D,A),H=u(z,A),F=n+q+p*F*F+r*H*H,A=d.Multiply(0<F?-B/F:0,A);s.Subtract(d.Multiply(n,A));t-=p*u(D,A);v.Add(d.Multiply(q,A));w+=r*u(z,A)}this.m_positions[g].a=t;this.m_positions[k].a=w}return c>=-1.5*Q}};var Wc=ua.create("solve initialization","solve"),Xc=ua.create("warm starting","solve initialization"),Yc=ua.create("solve velocities","solve"),Zc=ua.create("solve positions","solve");K._solverData=new Fc;K._solverDef=new Oc;K._solver=
new E;K.prototype={Clear:function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0},Initialize:function(a,b,c,e){this.m_listener=e;this.m_bodyCapacity=a;this.m_contactCapacity=b;this.m_jointCapacity=c;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;this.m_bodies.length=a;this.m_contacts.length=b;this.m_joints.length=c;this.m_velocities.length=a;this.m_positions.length=a},Solve:function(a,b,c){Wc.start();for(var e=a.dt,d=0;d<this.m_bodyCount;++d){var g=this.m_bodies[d];this.m_positions[d].c.Assign(g.m_sweep.c);
var k=g.m_sweep.a;this.m_velocities[d].v.Assign(g.m_linearVelocity);var h=g.m_angularVelocity;g.m_sweep.c0.Assign(g.m_sweep.c);g.m_sweep.a0=g.m_sweep.a;g.m_type==t.b2_dynamicBody&&(this.m_velocities[d].v.x+=e*(g.m_gravityScale*b.x+g.m_invMass*g.m_force.x),this.m_velocities[d].v.y+=e*(g.m_gravityScale*b.y+g.m_invMass*g.m_force.y),h+=e*g.m_invI*g.m_torque,this.m_velocities[d].v.x*=1/(1+e*g.m_linearDamping),this.m_velocities[d].v.y*=1/(1+e*g.m_linearDamping),h*=1/(1+e*g.m_angularDamping));this.m_positions[d].a=
k;this.m_velocities[d].w=h}K._solverData.step=a;K._solverData.positions=this.m_positions;K._solverData.velocities=this.m_velocities;K._solverDef.step=a;K._solverDef.contacts=this.m_contacts;K._solverDef.count=this.m_contactCount;K._solverDef.positions=this.m_positions;K._solverDef.velocities=this.m_velocities;K._solverDef.allocator=this.m_allocator;K._solver.Init(K._solverDef);K._solver.InitializeVelocityConstraints();a.warmStarting&&(Xc.start(),K._solver.WarmStart(),Xc.stop());for(d=0;d<this.m_jointCount;++d)this.m_joints[d].InitVelocityConstraints(K._solverData);
Wc.stop();Yc.start();for(d=0;d<a.velocityIterations;++d){for(h=0;h<this.m_jointCount;++h)this.m_joints[h].SolveVelocityConstraints(K._solverData);K._solver.SolveVelocityConstraints()}K._solver.StoreImpulses();Yc.stop();Zc.start();for(d=0;d<this.m_bodyCount;++d){g=this.m_positions[d].c;k=this.m_positions[d].a;b=this.m_velocities[d].v;var h=this.m_velocities[d].w,l=e*b.x,m=e*b.y,l=l*l+m*m;4<l&&(l=2/va(l),b.x*=l,b.y*=l);l=e*h;l*l>dc&&(l=qb/aa(l),h*=l);g.x+=e*b.x;g.y+=e*b.y;k+=e*h;this.m_positions[d].a=
k;this.m_velocities[d].w=h}k=!1;for(d=0;d<a.positionIterations;++d){g=K._solver.SolvePositionConstraints();b=!0;for(h=0;h<this.m_jointCount;++h)l=this.m_joints[h].SolvePositionConstraints(K._solverData),b=b&&l;if(g&&b){k=!0;break}}for(d=0;d<this.m_bodyCount;++d)a=this.m_bodies[d],a.m_sweep.c.Assign(this.m_positions[d].c),a.m_sweep.a=this.m_positions[d].a,a.m_linearVelocity.Assign(this.m_velocities[d].v),a.m_angularVelocity=this.m_velocities[d].w,a.SynchronizeTransform();Zc.stop();this.Report(K._solver.m_velocityConstraints);
if(c){c=W;a=ec*ec;for(d=0;d<this.m_bodyCount;++d)g=this.m_bodies[d],g.GetType()!=t.b2_staticBody&&(0==(g.m_flags&t.e_autoSleepFlag)||g.m_angularVelocity*g.m_angularVelocity>a||1E-4<v(g.m_linearVelocity,g.m_linearVelocity)?c=g.m_sleepTime=0:(g.m_sleepTime+=e,c=O(c,g.m_sleepTime)));if(0.5<=c&&k)for(d=0;d<this.m_bodyCount;++d)g=this.m_bodies[d],g.SetAwake(!1)}},SolveTOI:function(a,b,c){for(var e=0;e<this.m_bodyCount;++e){var f=this.m_bodies[e];this.m_positions[e].c.Assign(f.m_sweep.c);this.m_positions[e].a=
f.m_sweep.a;this.m_velocities[e].v.Assign(f.m_linearVelocity);this.m_velocities[e].w=f.m_angularVelocity}K._solverDef.contacts=this.m_contacts;K._solverDef.count=this.m_contactCount;K._solverDef.step=a;K._solverDef.positions=this.m_positions;K._solverDef.velocities=this.m_velocities;K._solver.Init(K._solverDef);for(e=0;e<a.positionIterations&&!K._solver.SolveTOIPositionConstraints(b,c);++e);this.m_bodies[b].m_sweep.c0.Assign(this.m_positions[b].c);this.m_bodies[b].m_sweep.a0=this.m_positions[b].a;
this.m_bodies[c].m_sweep.c0.Assign(this.m_positions[c].c);this.m_bodies[c].m_sweep.a0=this.m_positions[c].a;K._solver.InitializeVelocityConstraints();for(e=0;e<a.velocityIterations;++e)K._solver.SolveVelocityConstraints();a=a.dt;for(e=0;e<this.m_bodyCount;++e){b=this.m_positions[e].c;c=this.m_positions[e].a;var f=this.m_velocities[e].v,g=this.m_velocities[e].w,k=d.Multiply(a,f);4<v(k,k)&&(k=2/k.Length(),f.Multiply(k));k=a*g;k*k>dc&&(k=qb/aa(k),g*=k);b.Add(d.Multiply(a,f));c+=a*g;this.m_positions[e].a=
c;this.m_velocities[e].w=g;k=this.m_bodies[e];k.m_sweep.c.Assign(b);k.m_sweep.a=c;k.m_linearVelocity.Assign(f);k.m_angularVelocity=g;k.SynchronizeTransform()}this.Report(K._solver.m_velocityConstraints)},AddBody:function(a){a.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount]=a;this.m_positions[this.m_bodyCount]||(this.m_positions[this.m_bodyCount]=new Dc,this.m_velocities[this.m_bodyCount]=new Ec);++this.m_bodyCount},AddContact:function(a){this.m_contacts[this.m_contactCount++]=a},AddJoint:function(a){this.m_joints[this.m_jointCount++]=
a},Report:function(a){if(null!=this.m_listener)for(var b=0;b<this.m_contactCount;++b){var c=this.m_contacts[b],d=a[b],f=new Ac;f.count=d.pointCount;for(var g=0;g<d.pointCount;++g)f.normalImpulses[g]=d.points[g].normalImpulse,f.tangentImpulses[g]=d.points[g].tangentImpulse;this.m_listener.PostSolve(c,f)}}};oa.prototype={_deserialize:function(a,b,c){this.bodyA=b[a.bodyA];this.bodyB=b[a.bodyB];this.collideConnected=a.collideConnected}};s.prototype={GetType:function(){return this.m_type},GetBodyA:function(){return this.m_bodyA},
GetBodyB:function(){return this.m_bodyB},GetAnchorA:function(){},GetAnchorB:function(){},GetReactionForce:function(a){},GetReactionTorque:function(a){},GetNext:function(){return this.m_next},GetUserData:function(){return this.m_userData},SetUserData:function(a){this.m_userData=a},IsActive:function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},GetCollideConnected:function(){return this.m_collideConnected},ShiftOrigin:function(a){},InitVelocityConstraints:function(a){},SolveVelocityConstraints:function(a){},
SolvePositionConstraints:function(a){},_serialize:function(a){a=a||{};a.bodyA=null;a.bodyB=null;a.type=this.m_type;a.collideConnected=this.m_collideConnected;return a}};s.e_inactiveLimit=0;s.e_atLowerLimit=1;s.e_atUpperLimit=2;s.e_equalLimits=3;s.e_unknownJoint=0;s.e_revoluteJoint=1;s.e_prismaticJoint=2;s.e_distanceJoint=3;s.e_pulleyJoint=4;s.e_mouseJoint=5;s.e_gearJoint=6;s.e_wheelJoint=7;s.e_weldJoint=8;s.e_frictionJoint=9;s.e_ropeJoint=10;s.e_motorJoint=11;s.Create=function(a){var b=null;switch(a.type){case s.e_distanceJoint:b=
new Bb(a);break;case s.e_mouseJoint:b=new Ab(a);break;case s.e_prismaticJoint:b=new Cb(a);break;case s.e_revoluteJoint:b=new zb(a);break;case s.e_pulleyJoint:b=new Kb(a);break;case s.e_gearJoint:b=new Hb(a);break;case s.e_wheelJoint:b=new Fb(a);break;case s.e_weldJoint:b=new Eb(a);break;case s.e_frictionJoint:b=new Db(a);break;case s.e_ropeJoint:b=new Lb(a);break;case s.e_motorJoint:b=new Ib(a)}return b};s.Destroy=function(a){};hb.prototype={Initialize:function(a,b,c){this.bodyA=a;this.bodyB=b;this.localAnchorA=
this.bodyA.GetLocalPoint(c);this.localAnchorB=this.bodyB.GetLocalPoint(c);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},_deserialize:function(a,b,c){this.parent.prototype._deserialize.call(this,a,b,c);this.localAnchorA._deserialize(a.localAnchorA);this.localAnchorB._deserialize(a.localAnchorB);this.referenceAngle=a.referenceAngle;this.lowerAngle=a.lowerAngle;this.upperAngle=a.upperAngle;this.maxMotorTorque=a.maxMotorTorque;this.motorSpeed=a.motorSpeed;this.enableLimit=a.enableLimit;
this.enableMotor=a.enableMotor}};hb._extend(oa);zb.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},GetReferenceAngle:function(){return this.m_referenceAngle},GetJointAngle:function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},GetJointSpeed:function(){return this.m_bodyB.m_angularVelocity-
this.m_bodyA.m_angularVelocity},IsLimitEnabled:function(){return this.m_enableLimit},EnableLimit:function(a){a!=this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=a,this.m_impulse.z=0)},GetLowerLimit:function(){return this.m_lowerAngle},GetUpperLimit:function(){return this.m_upperAngle},SetLimits:function(a,b){if(a!=this.m_lowerAngle||b!=this.m_upperAngle)this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=a,this.m_upperAngle=
b},IsMotorEnabled:function(){return this.m_enableMotor},EnableMotor:function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=a},SetMotorSpeed:function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=a},GetMotorSpeed:function(){return this.m_motorSpeed},SetMaxMotorTorque:function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorTorque=a},GetMaxMotorTorque:function(){return this.m_maxMotorTorque},GetReactionForce:function(a){var b=
new d(this.m_impulse.x,this.m_impulse.y);return d.Multiply(a,b)},GetReactionTorque:function(a){return a*this.m_impulse.z},GetMotorTorque:function(a){return a*this.m_motorImpulse},InitVelocityConstraints:function(a){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA=this.m_bodyA.m_sweep.localCenter;this.m_localCenterB=this.m_bodyB.m_sweep.localCenter;this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;
this.m_invIB=this.m_bodyB.m_invI;var b=a.positions[this.m_indexA].a,c=a.velocities[this.m_indexA].v.Clone(),e=a.velocities[this.m_indexA].w,f=a.positions[this.m_indexB].a,g=a.velocities[this.m_indexB].v.Clone(),k=a.velocities[this.m_indexB].w,h=new F(b),l=new F(f);this.m_rA=C(h,d.Subtract(this.m_localAnchorA,this.m_localCenterA));this.m_rB=C(l,d.Subtract(this.m_localAnchorB,this.m_localCenterB));var h=this.m_invMassA,l=this.m_invMassB,m=this.m_invIA,n=this.m_invIB,p=0==m+n;this.m_mass.ex.x=h+l+this.m_rA.y*
this.m_rA.y*m+this.m_rB.y*this.m_rB.y*n;this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*m-this.m_rB.y*this.m_rB.x*n;this.m_mass.ez.x=-this.m_rA.y*m-this.m_rB.y*n;this.m_mass.ex.y=this.m_mass.ey.x;this.m_mass.ey.y=h+l+this.m_rA.x*this.m_rA.x*m+this.m_rB.x*this.m_rB.x*n;this.m_mass.ez.y=this.m_rA.x*m+this.m_rB.x*n;this.m_mass.ex.z=this.m_mass.ez.x;this.m_mass.ey.z=this.m_mass.ez.y;this.m_mass.ez.z=m+n;this.m_motorMass=m+n;0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass);if(!1==this.m_enableMotor||
p)this.m_motorImpulse=0;this.m_enableLimit&&!1==p?(b=f-b-this.m_referenceAngle,aa(this.m_upperAngle-this.m_lowerAngle)<2*za?this.m_limitState=s.e_equalLimits:b<=this.m_lowerAngle?(this.m_limitState!=s.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=s.e_atLowerLimit):b>=this.m_upperAngle?(this.m_limitState!=s.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=s.e_atUpperLimit):(this.m_limitState=s.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=s.e_inactiveLimit;a.step.warmStarting?
(this.m_impulse.Multiply(a.step.dtRatio),this.m_motorImpulse*=a.step.dtRatio,b=new d(this.m_impulse.x,this.m_impulse.y),c.Subtract(d.Multiply(h,b)),e-=m*(u(this.m_rA,b)+this.m_motorImpulse+this.m_impulse.z),g.Add(d.Multiply(l,b)),k+=n*(u(this.m_rB,b)+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0);a.velocities[this.m_indexA].v.Assign(c);a.velocities[this.m_indexA].w=e;a.velocities[this.m_indexB].v.Assign(g);a.velocities[this.m_indexB].w=k},SolveVelocityConstraints:function(a){var b=
a.velocities[this.m_indexA].v.Clone(),c=a.velocities[this.m_indexA].w,e=a.velocities[this.m_indexB].v.Clone(),f=a.velocities[this.m_indexB].w,g=this.m_invMassA,k=this.m_invMassB,h=this.m_invIA,l=this.m_invIB,m=0==h+l;if(this.m_enableMotor&&this.m_limitState!=s.e_equalLimits&&!1==m){var n=f-c-this.m_motorSpeed,n=-this.m_motorMass*n,p=this.m_motorImpulse,q=a.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=ca(this.m_motorImpulse+n,-q,q);n=this.m_motorImpulse-p;c-=h*n;f+=l*n}this.m_enableLimit&&this.m_limitState!=
s.e_inactiveLimit&&!1==m?(m=d.Subtract(d.Subtract(d.Add(e,S(f,this.m_rB)),b),S(c,this.m_rA)),n=new N(m.x,m.y,f-c),n=this.m_mass.Solve33(n).Negate(),this.m_limitState==s.e_equalLimits?this.m_impulse.Add(n):this.m_limitState==s.e_atLowerLimit?(p=this.m_impulse.z+n.z,0>p?(m=d.Add(m.Negate(),d.Multiply(this.m_impulse.z,new d(this.m_mass.ez.x,this.m_mass.ez.y))),m=this.m_mass.Solve22(m),n.x=m.x,n.y=m.y,n.z=-this.m_impulse.z,this.m_impulse.x+=m.x,this.m_impulse.y+=m.y,this.m_impulse.z=0):this.m_impulse.Add(n)):
this.m_limitState==s.e_atUpperLimit&&(p=this.m_impulse.z+n.z,0<p?(m=d.Add(m.Negate(),d.Multiply(this.m_impulse.z,new d(this.m_mass.ez.x,this.m_mass.ez.y))),m=this.m_mass.Solve22(m),n.x=m.x,n.y=m.y,n.z=-this.m_impulse.z,this.m_impulse.x+=m.x,this.m_impulse.y+=m.y,this.m_impulse.z=0):this.m_impulse.Add(n)),m=new d(n.x,n.y),b.Subtract(d.Multiply(g,m)),c-=h*(u(this.m_rA,m)+n.z),e.Add(d.Multiply(k,m)),f+=l*(u(this.m_rB,m)+n.z)):(n=d.Subtract(d.Subtract(d.Add(e,S(f,this.m_rB)),b),S(c,this.m_rA)),n=this.m_mass.Solve22(n.Negate()),
this.m_impulse.x+=n.x,this.m_impulse.y+=n.y,b.Subtract(d.Multiply(g,n)),c-=h*u(this.m_rA,n),e.Add(d.Multiply(k,n)),f+=l*u(this.m_rB,n));a.velocities[this.m_indexA].v.Assign(b);a.velocities[this.m_indexA].w=c;a.velocities[this.m_indexB].v.Assign(e);a.velocities[this.m_indexB].w=f},SolvePositionConstraints:function(a){var b=a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,e=a.positions[this.m_indexB].c.Clone(),f=a.positions[this.m_indexB].a,g=new F(c),k=new F(f),h=0,l=0,l=0==this.m_invIA+
this.m_invIB;if(this.m_enableLimit&&this.m_limitState!=s.e_inactiveLimit&&!1==l){var m=f-c-this.m_referenceAngle,l=0;this.m_limitState==s.e_equalLimits?(m=ca(m-this.m_lowerAngle,-pb,pb),l=-this.m_motorMass*m,h=aa(m)):this.m_limitState==s.e_atLowerLimit?(m-=this.m_lowerAngle,h=-m,m=ca(m+za,-pb,0),l=-this.m_motorMass*m):this.m_limitState==s.e_atUpperLimit&&(h=m-=this.m_upperAngle,m=ca(m-za,0,pb),l=-this.m_motorMass*m);c-=this.m_invIA*l;f+=this.m_invIB*l}g.Set(c);k.Set(f);var g=C(g,d.Subtract(this.m_localAnchorA,
this.m_localCenterA)),k=C(k,d.Subtract(this.m_localAnchorB,this.m_localCenterB)),m=d.Subtract(d.Subtract(d.Add(e,k),b),g),l=m.Length(),n=this.m_invMassA,p=this.m_invMassB,q=this.m_invIA,r=this.m_invIB,t=new $;t.ex.x=n+p+q*g.y*g.y+r*k.y*k.y;t.ex.y=-q*g.x*g.y-r*k.x*k.y;t.ey.x=t.ex.y;t.ey.y=n+p+q*g.x*g.x+r*k.x*k.x;m=t.Solve(m).Negate();b.Subtract(d.Multiply(n,m));c-=q*u(g,m);e.Add(d.Multiply(p,m));f+=r*u(k,m);a.positions[this.m_indexA].c.Assign(b);a.positions[this.m_indexA].a=c;a.positions[this.m_indexB].c.Assign(e);
a.positions[this.m_indexB].a=f;return l<=Q&&h<=za},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.localAnchorA=this.m_localAnchorA._serialize();a.localAnchorB=this.m_localAnchorB._serialize();a.referenceAngle=this.m_referenceAngle;a.lowerAngle=this.m_lowerAngle;a.upperAngle=this.m_upperAngle;a.maxMotorTorque=this.m_maxMotorTorque;a.motorSpeed=this.m_motorSpeed;a.enableLimit=this.m_enableLimit;a.enableMotor=this.m_enableMotor;return a}};zb._extend(s);Pc._extend(oa);
Ab.prototype={GetAnchorA:function(){return this.m_targetA},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(a){return d.Multiply(a,this.m_impulse)},GetReactionTorque:function(a){return 0*a},SetTarget:function(a){!1==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0);this.m_targetA.Assign(a)},GetTarget:function(){return this.m_targetA},SetMaxForce:function(a){this.m_maxForce=a},GetMaxForce:function(){return this.m_maxForce},SetFrequency:function(a){this.m_frequencyHz=
a},GetFrequency:function(){return this.m_frequencyHz},SetDampingRatio:function(a){this.m_dampingRatio=a},GetDampingRatio:function(){return this.m_dampingRatio},ShiftOrigin:function(a){this.m_targetA.Subtract(a)},InitVelocityConstraints:function(a){this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter);this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIB=this.m_bodyB.m_invI;var b=a.positions[this.m_indexB].c.Clone(),c=a.positions[this.m_indexB].a,e=a.velocities[this.m_indexB].v.Clone(),
f=a.velocities[this.m_indexB].w,c=new F(c),g=this.m_bodyB.GetMass(),k=2*ja*this.m_frequencyHz,h=g*k*k,l=a.step.dt;this.m_gamma=l*(2*g*this.m_dampingRatio*k+l*h);0!=this.m_gamma&&(this.m_gamma=1/this.m_gamma);this.m_beta=l*h*this.m_gamma;this.m_rB.Assign(C(c,d.Subtract(this.m_localAnchorB,this.m_localCenterB)));c=new $;c.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma;c.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y;c.ey.x=c.ex.y;c.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+
this.m_gamma;this.m_mass.Assign(c.GetInverse());this.m_C.Assign(d.Subtract(d.Add(b,this.m_rB),this.m_targetA));this.m_C.Multiply(this.m_beta);f*=0.98;a.step.warmStarting?(this.m_impulse.Multiply(a.step.dtRatio),e.Add(d.Multiply(this.m_invMassB,this.m_impulse)),f+=this.m_invIB*u(this.m_rB,this.m_impulse)):this.m_impulse.SetZero();a.velocities[this.m_indexB].v.Assign(e);a.velocities[this.m_indexB].w=f},SolveVelocityConstraints:function(a){var b=a.velocities[this.m_indexB].v.Clone(),c=a.velocities[this.m_indexB].w,
e=d.Add(b,S(c,this.m_rB)),e=Ma(this.m_mass,d.Add(d.Add(e,this.m_C),d.Multiply(this.m_gamma,this.m_impulse)).Negate()),f=this.m_impulse.Clone();this.m_impulse.Add(e);var g=a.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>g*g&&this.m_impulse.Multiply(g/this.m_impulse.Length());e.Assign(d.Subtract(this.m_impulse,f));b.Add(d.Multiply(this.m_invMassB,e));c+=this.m_invIB*u(this.m_rB,e);a.velocities[this.m_indexB].v.Assign(b);a.velocities[this.m_indexB].w=c},SolvePositionConstraints:function(a){return!0}};
Ab._extend(s);ib.prototype={Initialize:function(a,b,c,e){this.bodyA=a;this.bodyB=b;this.localAnchorA=this.bodyA.GetLocalPoint(c);this.localAnchorB=this.bodyB.GetLocalPoint(e);this.length=d.Subtract(e,c).Length()},_deserialize:function(a,b,c){this.parent.prototype._deserialize.call(this,a,b,c);this.localAnchorA._deserialize(a.localAnchorA);this.localAnchorB._deserialize(a.localAnchorB);this.length=a.length;this.frequencyHz=a.frequencyHz;this.dampingRatio=a.dampingRatio}};ib._extend(oa);Bb.prototype=
{GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(a){return d.Multiply(a*this.m_impulse,this.m_u)},GetReactionTorque:function(a){return 0},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},SetLength:function(a){this.m_length=a},GetLength:function(){return this.m_length},SetFrequency:function(a){this.m_frequencyHz=
a},GetFrequency:function(){return this.m_frequencyHz},SetDampingRatio:function(a){this.m_dampingRatio=a},GetDampingRatio:function(){return this.m_dampingRatio},InitVelocityConstraints:function(a){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;
this.m_invIB=this.m_bodyB.m_invI;var b=a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,e=a.velocities[this.m_indexA].v.Clone(),f=a.velocities[this.m_indexA].w,g=a.positions[this.m_indexB].c.Clone(),k=a.positions[this.m_indexB].a,h=a.velocities[this.m_indexB].v.Clone(),l=a.velocities[this.m_indexB].w,c=new F(c),k=new F(k);this.m_rA=C(c,d.Subtract(this.m_localAnchorA,this.m_localCenterA));this.m_rB=C(k,d.Subtract(this.m_localAnchorB,this.m_localCenterB));this.m_u=d.Subtract(d.Subtract(d.Add(g,
this.m_rB),b),this.m_rA);g=this.m_u.Length();g>Q?this.m_u.Multiply(1/g):this.m_u.Set(0,0);b=u(this.m_rA,this.m_u);k=u(this.m_rB,this.m_u);b=this.m_invMassA+this.m_invIA*b*b+this.m_invMassB+this.m_invIB*k*k;this.m_mass=0!=b?1/b:0;if(0<this.m_frequencyHz){var g=g-this.m_length,k=2*ja*this.m_frequencyHz,c=this.m_mass*k*k,m=a.step.dt;this.m_gamma=m*(2*this.m_mass*this.m_dampingRatio*k+m*c);this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0;this.m_bias=g*m*c*this.m_gamma;b+=this.m_gamma;this.m_mass=0!=b?1/
b:0}else this.m_bias=this.m_gamma=0;a.step.warmStarting?(this.m_impulse*=a.step.dtRatio,b=d.Multiply(this.m_impulse,this.m_u),e.Subtract(d.Multiply(this.m_invMassA,b)),f-=this.m_invIA*u(this.m_rA,b),h.Add(d.Multiply(this.m_invMassB,b)),l+=this.m_invIB*u(this.m_rB,b)):this.m_impulse=0;a.velocities[this.m_indexA].v.Assign(e);a.velocities[this.m_indexA].w=f;a.velocities[this.m_indexB].v.Assign(h);a.velocities[this.m_indexB].w=l},SolveVelocityConstraints:function(a){var b=a.velocities[this.m_indexA].v.Clone(),
c=a.velocities[this.m_indexA].w,e=a.velocities[this.m_indexB].v.Clone(),f=a.velocities[this.m_indexB].w,g=d.Add(b,S(c,this.m_rA)),k=d.Add(e,S(f,this.m_rB)),g=v(this.m_u,d.Subtract(k,g)),g=-this.m_mass*(g+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=g;g=d.Multiply(g,this.m_u);b.Subtract(d.Multiply(this.m_invMassA,g));c-=this.m_invIA*u(this.m_rA,g);e.Add(d.Multiply(this.m_invMassB,g));f+=this.m_invIB*u(this.m_rB,g);a.velocities[this.m_indexA].v.Assign(b);a.velocities[this.m_indexA].w=c;
a.velocities[this.m_indexB].v.Assign(e);a.velocities[this.m_indexB].w=f},SolvePositionConstraints:function(a){if(0<this.m_frequencyHz)return!0;var b=a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,e=a.positions[this.m_indexB].c.Clone(),f=a.positions[this.m_indexB].a,g=new F(c),k=new F(f),g=C(g,d.Subtract(this.m_localAnchorA,this.m_localCenterA)),k=C(k,d.Subtract(this.m_localAnchorB,this.m_localCenterB)),h=d.Subtract(d.Subtract(d.Add(e,k),b),g),l=h.Normalize()-this.m_length,l=ca(l,
-0.2,0.2),h=d.Multiply(-this.m_mass*l,h);b.Subtract(d.Multiply(this.m_invMassA,h));c-=this.m_invIA*u(g,h);e.Add(d.Multiply(this.m_invMassB,h));f+=this.m_invIB*u(k,h);a.positions[this.m_indexA].c.Assign(b);a.positions[this.m_indexA].a=c;a.positions[this.m_indexB].c.Assign(e);a.positions[this.m_indexB].a=f;return aa(l)<Q},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.localAnchorA=this.m_localAnchorA._serialize();a.localAnchorB=this.m_localAnchorB._serialize();a.length=
this.m_length;a.frequencyHz=this.m_frequencyHz;a.dampingRatio=this.m_dampingRatio;return a}};Bb._extend(s);jb.prototype={Initialize:function(a,b,c,d){this.bodyA=a;this.bodyB=b;this.localAnchorA=this.bodyA.GetLocalPoint(c);this.localAnchorB=this.bodyB.GetLocalPoint(c);this.localAxisA=this.bodyA.GetLocalVector(d);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},_deserialize:function(a,b,c){this.parent.prototype._deserialize.call(this,a,b,c);this.localAnchorA._deserialize(a.localAnchorA);
this.localAnchorB._deserialize(a.localAnchorB);this.localAxisA._deserialize(a.localAxisA);this.referenceAngle=a.referenceAngle;this.enableLimit=a.enableLimit;this.lowerTranslation=a.lowerTranslation;this.upperTranslation=a.upperTranslation;this.enableMotor=a.enableMotor;this.maxMotorForce=a.maxMotorForce;this.motorSpeed=a.motorSpeed}};jb._extend(oa);Cb.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},
GetReactionForce:function(a){return d.Multiply(a,d.Add(d.Multiply(this.m_impulse.x,this.m_perp),d.Multiply(this.m_motorImpulse+this.m_impulse.z,this.m_axis)))},GetReactionTorque:function(a){return a*this.m_impulse.y},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},GetLocalAxisA:function(){return this.m_localXAxisA},GetReferenceAngle:function(){return this.m_referenceAngle},GetJointTranslation:function(){var a=this.m_bodyA.GetWorldPoint(this.m_localAnchorA),
b=this.m_bodyB.GetWorldPoint(this.m_localAnchorB),a=d.Subtract(b,a),b=this.m_bodyA.GetWorldVector(this.m_localXAxisA);return v(a,b)},GetJointSpeed:function(){var a=this.m_bodyA,b=this.m_bodyB,c=C(a.m_xf.q,d.Subtract(this.m_localAnchorA,a.m_sweep.localCenter)),e=C(b.m_xf.q,d.Subtract(this.m_localAnchorB,b.m_sweep.localCenter)),f=d.Add(a.m_sweep.c,c),g=d.Add(b.m_sweep.c,e),f=d.Subtract(g,f),g=C(a.m_xf.q,this.m_localXAxisA),k=a.m_linearVelocity,h=b.m_linearVelocity,a=a.m_angularVelocity,b=b.m_angularVelocity;
return v(f,S(a,g))+v(g,d.Subtract(d.Subtract(d.Add(h,S(b,e)),k),S(a,c)))},IsLimitEnabled:function(){return this.m_enableLimit},EnableLimit:function(a){a!=this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=a,this.m_impulse.z=0)},GetLowerLimit:function(){return this.m_lowerTranslation},GetUpperLimit:function(){return this.m_upperTranslation},SetLimits:function(a,b){if(a!=this.m_lowerTranslation||b!=this.m_upperTranslation)this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),
this.m_lowerTranslation=a,this.m_upperTranslation=b,this.m_impulse.z=0},IsMotorEnabled:function(){return this.m_enableMotor},EnableMotor:function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=a},SetMotorSpeed:function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=a},GetMotorSpeed:function(){return this.m_motorSpeed},SetMaxMotorForce:function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=a},GetMaxMotorForce:function(){return this.m_maxMotorForce},
GetMotorForce:function(a){return a*this.m_motorImpulse},InitVelocityConstraints:function(a){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA=this.m_bodyA.m_sweep.localCenter;this.m_localCenterB=this.m_bodyB.m_sweep.localCenter;this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var b=a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,e=a.velocities[this.m_indexA].v.Clone(),
f=a.velocities[this.m_indexA].w,g=a.positions[this.m_indexB].c.Clone(),k=a.positions[this.m_indexB].a,h=a.velocities[this.m_indexB].v.Clone(),l=a.velocities[this.m_indexB].w,m=new F(c),k=new F(k),n=C(m,d.Subtract(this.m_localAnchorA,this.m_localCenterA)),p=C(k,d.Subtract(this.m_localAnchorB,this.m_localCenterB)),q=d.Add(d.Subtract(g,b),d.Subtract(p,n)),b=this.m_invMassA,g=this.m_invMassB,k=this.m_invIA,c=this.m_invIB;this.m_axis=C(m,this.m_localXAxisA);this.m_a1=u(d.Add(q,n),this.m_axis);this.m_a2=
u(p,this.m_axis);this.m_motorMass=b+g+k*this.m_a1*this.m_a1+c*this.m_a2*this.m_a2;0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass);this.m_perp=C(m,this.m_localYAxisA);this.m_s1=u(d.Add(q,n),this.m_perp);this.m_s2=u(p,this.m_perp);var m=b+g+k*this.m_s1*this.m_s1+c*this.m_s2*this.m_s2,n=k*this.m_s1+c*this.m_s2,p=k*this.m_s1*this.m_a1+c*this.m_s2*this.m_a2,r=k+c;0==r&&(r=1);var t=k*this.m_a1+c*this.m_a2,y=b+g+k*this.m_a1*this.m_a1+c*this.m_a2*this.m_a2;this.m_K.ex.Set(m,n,p);this.m_K.ey.Set(n,
r,t);this.m_K.ez.Set(p,t,y);this.m_enableLimit?(q=v(this.m_axis,q),aa(this.m_upperTranslation-this.m_lowerTranslation)<2*Q?this.m_limitState=s.e_equalLimits:q<=this.m_lowerTranslation?this.m_limitState!=s.e_atLowerLimit&&(this.m_limitState=s.e_atLowerLimit,this.m_impulse.z=0):q>=this.m_upperTranslation?this.m_limitState!=s.e_atUpperLimit&&(this.m_limitState=s.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=s.e_inactiveLimit,this.m_impulse.z=0)):(this.m_limitState=s.e_inactiveLimit,this.m_impulse.z=
0);!1==this.m_enableMotor&&(this.m_motorImpulse=0);a.step.warmStarting?(this.m_impulse.Multiply(a.step.dtRatio),this.m_motorImpulse*=a.step.dtRatio,q=d.Add(d.Multiply(this.m_impulse.x,this.m_perp),d.Multiply(this.m_motorImpulse+this.m_impulse.z,this.m_axis)),m=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,n=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,e.Subtract(d.Multiply(b,q)),f-=k*m,h.Add(d.Multiply(g,
q)),l+=c*n):(this.m_impulse.SetZero(),this.m_motorImpulse=0);a.velocities[this.m_indexA].v.Assign(e);a.velocities[this.m_indexA].w=f;a.velocities[this.m_indexB].v.Assign(h);a.velocities[this.m_indexB].w=l},SolveVelocityConstraints:function(a){var b=a.velocities[this.m_indexA].v.Clone(),c=a.velocities[this.m_indexA].w,e=a.velocities[this.m_indexB].v.Clone(),f=a.velocities[this.m_indexB].w,g=this.m_invMassA,k=this.m_invMassB,h=this.m_invIA,l=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!=s.e_equalLimits){var m=
v(this.m_axis,d.Subtract(e,b))+this.m_a2*f-this.m_a1*c,n=this.m_motorMass*(this.m_motorSpeed-m),p=this.m_motorImpulse,m=a.step.dt*this.m_maxMotorForce;this.m_motorImpulse=ca(this.m_motorImpulse+n,-m,m);n=this.m_motorImpulse-p;p=d.Multiply(n,this.m_axis);m=n*this.m_a1;n*=this.m_a2;b.Subtract(d.Multiply(g,p));c-=h*m;e.Add(d.Multiply(k,p));f+=l*n}p=new d;p.x=v(this.m_perp,d.Subtract(e,b))+this.m_s2*f-this.m_s1*c;p.y=f-c;if(this.m_enableLimit&&this.m_limitState!=s.e_inactiveLimit){var n=v(this.m_axis,
d.Subtract(e,b))+this.m_a2*f-this.m_a1*c,m=new N(p.x,p.y,n),n=this.m_impulse.Clone(),q=this.m_K.Solve33(m.Negate());this.m_impulse.Add(q);this.m_limitState==s.e_atLowerLimit?this.m_impulse.z=H(this.m_impulse.z,0):this.m_limitState==s.e_atUpperLimit&&(this.m_impulse.z=O(this.m_impulse.z,0));p=d.Subtract(p.Negate(),d.Multiply(this.m_impulse.z-n.z,new d(this.m_K.ez.x,this.m_K.ez.y)));p=d.Add(this.m_K.Solve22(p),new d(n.x,n.y));this.m_impulse.x=p.x;this.m_impulse.y=p.y;q=N.Subtract(this.m_impulse,n);
p=d.Add(d.Multiply(q.x,this.m_perp),d.Multiply(q.z,this.m_axis));m=q.x*this.m_s1+q.y+q.z*this.m_a1;n=q.x*this.m_s2+q.y+q.z*this.m_a2}else q=this.m_K.Solve22(p.Negate()),this.m_impulse.x+=q.x,this.m_impulse.y+=q.y,p=d.Multiply(q.x,this.m_perp),m=q.x*this.m_s1+q.y,n=q.x*this.m_s2+q.y;b.Subtract(d.Multiply(g,p));c-=h*m;e.Add(d.Multiply(k,p));f+=l*n;a.velocities[this.m_indexA].v.Assign(b);a.velocities[this.m_indexA].w=c;a.velocities[this.m_indexB].v.Assign(e);a.velocities[this.m_indexB].w=f},SolvePositionConstraints:function(a){var b=
a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,e=a.positions[this.m_indexB].c.Clone(),f=a.positions[this.m_indexB].a,g=new F(c),k=new F(f),h=this.m_invMassA,l=this.m_invMassB,m=this.m_invIA,n=this.m_invIB,p=C(g,d.Subtract(this.m_localAnchorA,this.m_localCenterA)),q=C(k,d.Subtract(this.m_localAnchorB,this.m_localCenterB)),r=d.Subtract(d.Subtract(d.Add(e,q),b),p),s=C(g,this.m_localXAxisA),t=u(d.Add(r,p),s),k=u(q,s),g=C(g,this.m_localYAxisA),w=u(d.Add(r,p),g),z=u(q,g),x=new N,A=
new d;A.x=v(g,r);A.y=f-c-this.m_referenceAngle;var p=aa(A.x),q=aa(A.y),B=!1,D=0;this.m_enableLimit&&(r=v(s,r),aa(this.m_upperTranslation-this.m_lowerTranslation)<2*Q?(D=ca(r,-0.2,0.2),p=H(p,aa(r)),B=!0):r<=this.m_lowerTranslation?(D=ca(r-this.m_lowerTranslation+Q,-0.2,0),p=H(p,this.m_lowerTranslation-r),B=!0):r>=this.m_upperTranslation&&(D=ca(r-this.m_upperTranslation-Q,0,0.2),p=H(p,r-this.m_upperTranslation),B=!0));if(B){var B=h+l+m*w*w+n*z*z,E=m*w+n*z,x=m*w*t+n*z*k,G=m+n;0==G&&(G=1);var I=m*t+n*
k,K=h+l+m*t*t+n*k*k,r=new Ba;r.ex.Set(B,E,x);r.ey.Set(E,G,I);r.ez.Set(x,I,K);x=new N;x.x=A.x;x.y=A.y;x.z=D;x=r.Solve33(x.Negate())}else B=h+l+m*w*w+n*z*z,E=m*w+n*z,G=m+n,0==G&&(G=1),r=new $,r.ex.Set(B,E),r.ey.Set(E,G),A=r.Solve(A.Negate()),x.x=A.x,x.y=A.y,x.z=0;s=d.Add(d.Multiply(x.x,g),d.Multiply(x.z,s));t=x.x*w+x.y+x.z*t;k=x.x*z+x.y+x.z*k;b.Subtract(d.Multiply(h,s));c-=m*t;e.Add(d.Multiply(l,s));f+=n*k;a.positions[this.m_indexA].c.Assign(b);a.positions[this.m_indexA].a=c;a.positions[this.m_indexB].c.Assign(e);
a.positions[this.m_indexB].a=f;return p<=Q&&q<=za},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.localAnchorA=this.m_localAnchorA._serialize();a.localAnchorB=this.m_localAnchorB._serialize();a.localAxisA=this.m_localXAxisA._serialize();a.referenceAngle=this.m_referenceAngle;a.enableLimit=this.m_enableLimit;a.lowerTranslation=this.m_lowerTranslation;a.upperTranslation=this.m_upperTranslation;a.enableMotor=this.m_enableMotor;a.maxMotorForce=this.m_maxMotorForce;a.motorSpeed=
this.m_motorSpeed;return a}};Cb._extend(s);kb.prototype={Initialize:function(a,b,c){this.bodyA=a;this.bodyB=b;this.localAnchorA.Assign(this.bodyA.GetLocalPoint(c));this.localAnchorB.Assign(this.bodyB.GetLocalPoint(c))},_deserialize:function(a,b,c){this.parent.prototype._deserialize.call(this,a,b,c);this.localAnchorA._deserialize(a.localAnchorA);this.localAnchorB._deserialize(a.localAnchorB);this.maxForce=a.maxForce;this.maxTorque=a.maxTorque}};kb._extend(oa);Db.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},
GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(a){return d.Multiply(a,this.m_linearImpulse)},GetReactionTorque:function(a){return a*this.m_angularImpulse},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},SetMaxForce:function(a){this.m_maxForce=a},GetMaxForce:function(){return this.m_maxForce},SetMaxTorque:function(a){this.m_maxTorque=a},GetMaxTorque:function(){return this.m_maxTorque},
InitVelocityConstraints:function(a){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var b=a.positions[this.m_indexA].a,c=a.velocities[this.m_indexA].v.Clone(),e=a.velocities[this.m_indexA].w,f=a.positions[this.m_indexB].a,
g=a.velocities[this.m_indexB].v.Clone(),k=a.velocities[this.m_indexB].w,b=new F(b),f=new F(f);this.m_rA=C(b,d.Subtract(this.m_localAnchorA,this.m_localCenterA));this.m_rB=C(f,d.Subtract(this.m_localAnchorB,this.m_localCenterB));var f=this.m_invMassA,b=this.m_invMassB,h=this.m_invIA,l=this.m_invIB,m=new $;m.ex.x=f+b+h*this.m_rA.y*this.m_rA.y+l*this.m_rB.y*this.m_rB.y;m.ex.y=-h*this.m_rA.x*this.m_rA.y-l*this.m_rB.x*this.m_rB.y;m.ey.x=m.ex.y;m.ey.y=f+b+h*this.m_rA.x*this.m_rA.x+l*this.m_rB.x*this.m_rB.x;
this.m_linearMass=m.GetInverse();this.m_angularMass=h+l;0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass);a.step.warmStarting?(this.m_linearImpulse.Multiply(a.step.dtRatio),this.m_angularImpulse*=a.step.dtRatio,m=new d(this.m_linearImpulse.x,this.m_linearImpulse.y),c.Subtract(d.Multiply(f,m)),e-=h*(u(this.m_rA,m)+this.m_angularImpulse),g.Add(d.Multiply(b,m)),k+=l*(u(this.m_rB,m)+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0);a.velocities[this.m_indexA].v.Assign(c);
a.velocities[this.m_indexA].w=e;a.velocities[this.m_indexB].v.Assign(g);a.velocities[this.m_indexB].w=k},SolveVelocityConstraints:function(a){var b=a.velocities[this.m_indexA].v.Clone(),c=a.velocities[this.m_indexA].w,e=a.velocities[this.m_indexB].v.Clone(),f=a.velocities[this.m_indexB].w,g=this.m_invMassA,k=this.m_invMassB,h=this.m_invIA,l=this.m_invIB,m=a.step.dt,n;n=-this.m_angularMass*(f-c);var p=this.m_angularImpulse,q=m*this.m_maxTorque;this.m_angularImpulse=ca(this.m_angularImpulse+n,-q,q);
n=this.m_angularImpulse-p;c-=h*n;f+=l*n;n=d.Add(e,d.Subtract(S(f,this.m_rB),d.Subtract(b,S(c,this.m_rA))));n=Ma(this.m_linearMass,n).Negate();p=this.m_linearImpulse.Clone();this.m_linearImpulse.Add(n);q=m*this.m_maxForce;this.m_linearImpulse.LengthSquared()>q*q&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(q));n=d.Subtract(this.m_linearImpulse,p);b.Subtract(d.Multiply(g,n));c-=h*u(this.m_rA,n);e.Add(d.Multiply(k,n));f+=l*u(this.m_rB,n);a.velocities[this.m_indexA].v.Assign(b);a.velocities[this.m_indexA].w=
c;a.velocities[this.m_indexB].v.Assign(e);a.velocities[this.m_indexB].w=f},SolvePositionConstraints:function(a){return!0},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.localAnchorA=this.m_localAnchorA._serialize();a.localAnchorB=this.m_localAnchorB._serialize();a.maxForce=this.m_maxForce;a.maxTorque=this.m_maxTorque;return a}};Db._extend(s);lb.prototype={Initialize:function(a,b,c){this.bodyA=a;this.bodyB=b;this.localAnchorA.Assign(this.bodyA.GetLocalPoint(c));this.localAnchorB.Assign(this.bodyB.GetLocalPoint(c));
this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},_deserialize:function(a,b,c){this.parent.prototype._deserialize.call(this,a,b,c);this.localAnchorA._deserialize(a.localAnchorA);this.localAnchorB._deserialize(a.localAnchorB);this.referenceAngle=a.referenceAngle;this.frequencyHz=a.frequencyHz;this.dampingRatio=a.dampingRatio}};lb._extend(oa);Eb.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},
GetReactionForce:function(a){var b=new d(this.m_impulse.x,this.m_impulse.y);return d.Multiply(a,b)},GetReactionTorque:function(a){return a*this.m_impulse.z},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},GetReferenceAngle:function(){return this.m_referenceAngle},SetFrequency:function(a){this.m_frequencyHz=a},GetFrequency:function(){return this.m_frequencyHz},SetDampingRatio:function(a){this.m_dampingRatio=a},GetDampingRatio:function(){return this.m_dampingRatio},
InitVelocityConstraints:function(a){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var b=a.positions[this.m_indexA].a,c=a.velocities[this.m_indexA].v.Clone(),e=a.velocities[this.m_indexA].w,f=a.positions[this.m_indexB].a,
g=a.velocities[this.m_indexB].v.Clone(),k=a.velocities[this.m_indexB].w,h=new F(b),l=new F(f);this.m_rA.Assign(C(h,d.Subtract(this.m_localAnchorA,this.m_localCenterA)));this.m_rB.Assign(C(l,d.Subtract(this.m_localAnchorB,this.m_localCenterB)));var h=this.m_invMassA,l=this.m_invMassB,m=this.m_invIA,n=this.m_invIB,p=new Ba;p.ex.x=h+l+this.m_rA.y*this.m_rA.y*m+this.m_rB.y*this.m_rB.y*n;p.ey.x=-this.m_rA.y*this.m_rA.x*m-this.m_rB.y*this.m_rB.x*n;p.ez.x=-this.m_rA.y*m-this.m_rB.y*n;p.ex.y=p.ey.x;p.ey.y=
h+l+this.m_rA.x*this.m_rA.x*m+this.m_rB.x*this.m_rB.x*n;p.ez.y=this.m_rA.x*m+this.m_rB.x*n;p.ex.z=p.ez.x;p.ey.z=p.ez.y;p.ez.z=m+n;if(0<this.m_frequencyHz){p.GetInverse22(this.m_mass);var p=m+n,q=0<p?1/p:0,b=f-b-this.m_referenceAngle,f=2*ja*this.m_frequencyHz,r=q*f*f,s=a.step.dt;this.m_gamma=s*(2*q*this.m_dampingRatio*f+s*r);this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0;this.m_bias=b*s*r*this.m_gamma;p+=this.m_gamma;this.m_mass.ez.z=0!=p?1/p:0}else 0==p.ez.z?p.GetInverse22(this.m_mass):p.GetSymInverse33(this.m_mass),
this.m_bias=this.m_gamma=0;a.step.warmStarting?(this.m_impulse.Multiply(a.step.dtRatio),p=new d(this.m_impulse.x,this.m_impulse.y),c.Subtract(d.Multiply(h,p)),e-=m*(u(this.m_rA,p)+this.m_impulse.z),g.Add(d.Multiply(l,p)),k+=n*(u(this.m_rB,p)+this.m_impulse.z)):this.m_impulse.SetZero();a.velocities[this.m_indexA].v.Assign(c);a.velocities[this.m_indexA].w=e;a.velocities[this.m_indexB].v.Assign(g);a.velocities[this.m_indexB].w=k},SolveVelocityConstraints:function(a){var b=a.velocities[this.m_indexA].v.Clone(),
c=a.velocities[this.m_indexA].w,e=a.velocities[this.m_indexB].v.Clone(),f=a.velocities[this.m_indexB].w,g=this.m_invMassA,k=this.m_invMassB,h=this.m_invIA,l=this.m_invIB;if(0<this.m_frequencyHz){var m=-this.m_mass.ez.z*(f-c+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=m;c-=h*m;f+=l*m;m=d.Subtract(d.Subtract(d.Add(e,S(f,this.m_rB)),b),S(c,this.m_rA));m=lc(this.m_mass,m).Negate();this.m_impulse.x+=m.x;this.m_impulse.y+=m.y;m=m.Clone();b.Subtract(d.Multiply(g,m));c-=h*u(this.m_rA,m);
e.Add(d.Multiply(k,m));f+=l*u(this.m_rB,m)}else{var m=d.Subtract(d.Subtract(d.Add(e,S(f,this.m_rB)),b),S(c,this.m_rA)),m=new N(m.x,m.y,f-c),n=kc(this.m_mass,m).Negate();this.m_impulse.Add(n);m=new d(n.x,n.y);b.Subtract(d.Multiply(g,m));c-=h*(u(this.m_rA,m)+n.z);e.Add(d.Multiply(k,m));f+=l*(u(this.m_rB,m)+n.z)}a.velocities[this.m_indexA].v.Assign(b);a.velocities[this.m_indexA].w=c;a.velocities[this.m_indexB].v.Assign(e);a.velocities[this.m_indexB].w=f},SolvePositionConstraints:function(a){var b=a.positions[this.m_indexA].c.Clone(),
c=a.positions[this.m_indexA].a,e=a.positions[this.m_indexB].c.Clone(),f=a.positions[this.m_indexB].a,g=new F(c),k=new F(f),h=this.m_invMassA,l=this.m_invMassB,m=this.m_invIA,n=this.m_invIB,g=C(g,d.Subtract(this.m_localAnchorA,this.m_localCenterA)),k=C(k,d.Subtract(this.m_localAnchorB,this.m_localCenterB)),p,q,r=new Ba;r.ex.x=h+l+g.y*g.y*m+k.y*k.y*n;r.ey.x=-g.y*g.x*m-k.y*k.x*n;r.ez.x=-g.y*m-k.y*n;r.ex.y=r.ey.x;r.ey.y=h+l+g.x*g.x*m+k.x*k.x*n;r.ez.y=g.x*m+k.x*n;r.ex.z=r.ez.x;r.ey.z=r.ez.y;r.ez.z=m+n;
if(0<this.m_frequencyHz){var s=d.Subtract(d.Subtract(d.Add(e,k),b),g);p=s.Length();q=0;r=r.Solve22(s).Negate();b.Subtract(d.Multiply(h,r));c-=m*u(g,r);e.Add(d.Multiply(l,r));f+=n*u(k,r)}else{var s=d.Subtract(d.Subtract(d.Add(e,k),b),g),t=f-c-this.m_referenceAngle;p=s.Length();q=aa(t);t=new N(s.x,s.y,t);0<r.ez.z?s=r.Solve33(t).Invert():(r=r.Solve22(s).Invert(),s=new N(r.x,r.y,0));r=new d(s.x,s.y);b.Subtract(d.Multiply(h,r));c-=m*(u(g,r)+s.z);e.Add(d.Multiply(l,r));f+=n*(u(k,r)+s.z)}a.positions[this.m_indexA].c.Assign(b);
a.positions[this.m_indexA].a=c;a.positions[this.m_indexB].c.Assign(e);a.positions[this.m_indexB].a=f;return p<=Q&&q<=za},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.localAnchorA=this.m_localAnchorA._serialize();a.localAnchorB=this.m_localAnchorB._serialize();a.referenceAngle=this.m_referenceAngle;a.frequencyHz=this.m_frequencyHz;a.dampingRatio=this.m_dampingRatio;return a}};Eb._extend(s);mb.prototype={Initialize:function(a,b,c,d){this.bodyA=a;this.bodyB=b;this.localAnchorA.Assign(this.bodyA.GetLocalPoint(c));
this.localAnchorB.Assign(this.bodyB.GetLocalPoint(c));this.localAxisA.Assign(this.bodyA.GetLocalVector(d))},_deserialize:function(a,b,c){this.parent.prototype._deserialize.call(this,a,b,c);this.localAnchorA._deserialize(a.localAnchorA);this.localAnchorB._deserialize(a.localAnchorB);this.localAxisA._deserialize(a.localAxisA);this.enableMotor=a.enableMotor;this.maxMotorTorque=a.maxMotorTorque;this.motorSpeed=a.motorSpeed;this.frequencyHz=a.frequencyHz;this.dampingRatio=a.dampingRatio}};mb._extend(oa);
Fb.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(a){return d.Multiply(a,d.Add(d.Multiply(this.m_impulse,this.m_ay),d.Multiply(this.m_springImpulse,this.m_ax)))},GetReactionTorque:function(a){return a*this.m_motorImpulse},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},GetLocalAxisA:function(){return this.m_localXAxisA},
GetJointTranslation:function(){var a=this.m_bodyA,b=this.m_bodyB,c=a.GetWorldPoint(this.m_localAnchorA),b=b.GetWorldPoint(this.m_localAnchorB),c=d.Subtract(b,c),a=a.GetWorldVector(this.m_localXAxisA);return v(c,a)},GetJointSpeed:function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},IsMotorEnabled:function(){return this.m_enableMotor},EnableMotor:function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=a},SetMotorSpeed:function(a){this.m_bodyA.SetAwake(!0);
this.m_bodyB.SetAwake(!0);this.m_motorSpeed=a},GetMotorSpeed:function(){return this.m_motorSpeed},SetMaxMotorTorque:function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorTorque=a},GetMaxMotorTorque:function(){return this.m_maxMotorTorque},GetMotorTorque:function(a){return a*this.m_motorImpulse},SetSpringFrequencyHz:function(a){this.m_frequencyHz=a},GetSpringFrequencyHz:function(){return this.m_frequencyHz},SetSpringDampingRatio:function(a){this.m_dampingRatio=a},GetSpringDampingRatio:function(){return this.m_dampingRatio},
InitVelocityConstraints:function(a){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var b=this.m_invMassA,c=this.m_invMassB,e=this.m_invIA,f=this.m_invIB,g=a.positions[this.m_indexA].c.Clone(),k=a.positions[this.m_indexA].a,
h=a.velocities[this.m_indexA].v.Clone(),l=a.velocities[this.m_indexA].w,m=a.positions[this.m_indexB].c.Clone(),n=a.positions[this.m_indexB].a,p=a.velocities[this.m_indexB].v.Clone(),q=a.velocities[this.m_indexB].w,k=new F(k),r=new F(n),n=C(k,d.Subtract(this.m_localAnchorA,this.m_localCenterA)),r=C(r,d.Subtract(this.m_localAnchorB,this.m_localCenterB)),g=d.Subtract(d.Subtract(d.Add(m,r),g),n);this.m_ay.Assign(C(k,this.m_localYAxisA));this.m_sAy=u(d.Add(g,n),this.m_ay);this.m_sBy=u(r,this.m_ay);this.m_mass=
b+c+e*this.m_sAy*this.m_sAy+f*this.m_sBy*this.m_sBy;0<this.m_mass&&(this.m_mass=1/this.m_mass);this.m_gamma=this.m_bias=this.m_springMass=0;0<this.m_frequencyHz?(this.m_ax.Assign(C(k,this.m_localXAxisA)),this.m_sAx=u(d.Add(g,n),this.m_ax),this.m_sBx=u(r,this.m_ax),b=b+c+e*this.m_sAx*this.m_sAx+f*this.m_sBx*this.m_sBx,0<b&&(this.m_springMass=1/b,c=v(g,this.m_ax),m=2*ja*this.m_frequencyHz,g=2*this.m_springMass*this.m_dampingRatio*m,m*=this.m_springMass*m,k=a.step.dt,this.m_gamma=k*(g+k*m),0<this.m_gamma&&
(this.m_gamma=1/this.m_gamma),this.m_bias=c*k*m*this.m_gamma,this.m_springMass=b+this.m_gamma,0<this.m_springMass&&(this.m_springMass=1/this.m_springMass))):this.m_springImpulse=0;this.m_enableMotor?(this.m_motorMass=e+f,0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass)):this.m_motorImpulse=this.m_motorMass=0;a.step.warmStarting?(this.m_impulse*=a.step.dtRatio,this.m_springImpulse*=a.step.dtRatio,this.m_motorImpulse*=a.step.dtRatio,e=d.Add(d.Multiply(this.m_impulse,this.m_ay),d.Multiply(this.m_springImpulse,
this.m_ax)),f=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,b=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse,h.Subtract(d.Multiply(this.m_invMassA,e)),l-=this.m_invIA*f,p.Add(d.Multiply(this.m_invMassB,e)),q+=this.m_invIB*b):this.m_motorImpulse=this.m_springImpulse=this.m_impulse=0;a.velocities[this.m_indexA].v.Assign(h);a.velocities[this.m_indexA].w=l;a.velocities[this.m_indexB].v.Assign(p);a.velocities[this.m_indexB].w=q},SolveVelocityConstraints:function(a){var b=
this.m_invMassA,c=this.m_invMassB,e=this.m_invIA,f=this.m_invIB,g=a.velocities[this.m_indexA].v.Clone(),k=a.velocities[this.m_indexA].w,h=a.velocities[this.m_indexB].v.Clone(),l=a.velocities[this.m_indexB].w,m=v(this.m_ax,d.Subtract(h,g))+this.m_sBx*l-this.m_sAx*k,m=-this.m_springMass*(m+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=m;var n=d.Multiply(m,this.m_ax),p=m*this.m_sAx,m=m*this.m_sBx;g.Subtract(d.Multiply(b,n));k-=e*p;h.Add(d.Multiply(c,n));l+=f*m;m=l-k-this.m_motorSpeed;
m*=-this.m_motorMass;n=this.m_motorImpulse;p=a.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=ca(this.m_motorImpulse+m,-p,p);m=this.m_motorImpulse-n;k-=e*m;l+=f*m;m=v(this.m_ay,d.Subtract(h,g))+this.m_sBy*l-this.m_sAy*k;m*=-this.m_mass;this.m_impulse+=m;n=d.Multiply(m,this.m_ay);p=m*this.m_sAy;m*=this.m_sBy;g.Subtract(d.Multiply(b,n));k-=e*p;h.Add(d.Multiply(c,n));l+=f*m;a.velocities[this.m_indexA].v.Assign(g);a.velocities[this.m_indexA].w=k;a.velocities[this.m_indexB].v.Assign(h);a.velocities[this.m_indexB].w=
l},SolvePositionConstraints:function(a){var b=a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,e=a.positions[this.m_indexB].c.Clone(),f=a.positions[this.m_indexB].a,g=new F(c),k=new F(f),h=C(g,d.Subtract(this.m_localAnchorA,this.m_localCenterA)),k=C(k,d.Subtract(this.m_localAnchorB,this.m_localCenterB)),l=d.Add(d.Subtract(e,b),d.Subtract(k,h)),g=C(g,this.m_localYAxisA),h=u(d.Add(l,h),g),k=u(k,g),l=v(l,g),m=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*
this.m_sBy*this.m_sBy,m=0!=m?-l/m:0,g=d.Multiply(m,g),h=m*h,k=m*k;b.Subtract(d.Multiply(this.m_invMassA,g));c-=this.m_invIA*h;e.Add(d.Multiply(this.m_invMassB,g));f+=this.m_invIB*k;a.positions[this.m_indexA].c.Assign(b);a.positions[this.m_indexA].a=c;a.positions[this.m_indexB].c.Assign(e);a.positions[this.m_indexB].a=f;return aa(l)<=Q},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.localAnchorA=this.m_localAnchorA._serialize();a.localAnchorB=this.m_localAnchorB._serialize();
a.localAxisA=this.m_localAxisA._serialize();a.enableMotor=this.m_enableMotor;a.maxMotorTorque=this.m_maxMotorTorque;a.motorSpeed=this.m_motorSpeed;a.frequencyHz=this.m_frequencyHz;a.dampingRatio=this.m_dampingRatio;return a}};Fb._extend(s);Gb.prototype={_deserialize:function(a,b,c){this.parent.prototype._deserialize.call(this,a,b,c);this.joint1=a.joint1;this.joint2=a.joint2;this.ratio=a.ratio}};Gb._extend(oa);Hb.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},
GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(a){var b=d.Multiply(this.m_impulse,this.m_JvAC);return d.Multiply(a,b)},GetReactionTorque:function(a){return a*this.m_impulse*this.m_JwA},GetJoint1:function(){return this.m_joint1},GetJoint2:function(){return this.m_joint2},SetRatio:function(a){this.m_ratio=a},GetRatio:function(){return this.m_ratio},InitVelocityConstraints:function(a){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;
this.m_indexC=this.m_bodyC.m_islandIndex;this.m_indexD=this.m_bodyD.m_islandIndex;this.m_lcA.Assign(this.m_bodyA.m_sweep.localCenter);this.m_lcB.Assign(this.m_bodyB.m_sweep.localCenter);this.m_lcC.Assign(this.m_bodyC.m_sweep.localCenter);this.m_lcD.Assign(this.m_bodyD.m_sweep.localCenter);this.m_mA=this.m_bodyA.m_invMass;this.m_mB=this.m_bodyB.m_invMass;this.m_mC=this.m_bodyC.m_invMass;this.m_mD=this.m_bodyD.m_invMass;this.m_iA=this.m_bodyA.m_invI;this.m_iB=this.m_bodyB.m_invI;this.m_iC=this.m_bodyC.m_invI;
this.m_iD=this.m_bodyD.m_invI;var b=a.positions[this.m_indexA].a,c=a.velocities[this.m_indexA].v.Clone(),e=a.velocities[this.m_indexA].w,f=a.positions[this.m_indexB].a,g=a.velocities[this.m_indexB].v.Clone(),k=a.velocities[this.m_indexB].w,h=a.positions[this.m_indexC].a,l=a.velocities[this.m_indexC].v.Clone(),m=a.velocities[this.m_indexC].w,n=a.positions[this.m_indexD].a,p=a.velocities[this.m_indexD].v.Clone(),q=a.velocities[this.m_indexD].w,b=new F(b),f=new F(f),r=new F(h),h=new F(n);this.m_mass=
0;this.m_typeA==s.e_revoluteJoint?(this.m_JvAC.SetZero(),this.m_JwC=this.m_JwA=1,this.m_mass+=this.m_iA+this.m_iC):(n=C(r,this.m_localAxisC),r=C(r,d.Subtract(this.m_localAnchorC,this.m_lcC)),b=C(b,d.Subtract(this.m_localAnchorA,this.m_lcA)),this.m_JvAC.Assign(n),this.m_JwC=u(r,n),this.m_JwA=u(b,n),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA);this.m_typeB==s.e_revoluteJoint?(this.m_JvBD.SetZero(),this.m_JwD=this.m_JwB=this.m_ratio,this.m_mass+=this.m_ratio*
this.m_ratio*(this.m_iB+this.m_iD)):(n=C(h,this.m_localAxisD),b=C(h,d.Subtract(this.m_localAnchorD,this.m_lcD)),f=C(f,d.Subtract(this.m_localAnchorB,this.m_lcB)),this.m_JvBD.Assign(d.Multiply(this.m_ratio,n)),this.m_JwD=this.m_ratio*u(b,n),this.m_JwB=this.m_ratio*u(f,n),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB);this.m_mass=0<this.m_mass?1/this.m_mass:0;a.step.warmStarting?(c.Add(d.Multiply(this.m_mA*this.m_impulse,
this.m_JvAC)),e+=this.m_iA*this.m_impulse*this.m_JwA,g.Add(d.Multiply(this.m_mB*this.m_impulse,this.m_JvBD)),k+=this.m_iB*this.m_impulse*this.m_JwB,l.Subtract(d.Multiply(this.m_mC*this.m_impulse,this.m_JvAC)),m-=this.m_iC*this.m_impulse*this.m_JwC,p.Subtract(d.Multiply(this.m_mD*this.m_impulse,this.m_JvBD)),q-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0;a.velocities[this.m_indexA].v.Assign(c);a.velocities[this.m_indexA].w=e;a.velocities[this.m_indexB].v.Assign(g);a.velocities[this.m_indexB].w=
k;a.velocities[this.m_indexC].v.Assign(l);a.velocities[this.m_indexC].w=m;a.velocities[this.m_indexD].v.Assign(p);a.velocities[this.m_indexD].w=q},SolveVelocityConstraints:function(a){var b=a.velocities[this.m_indexA].v.Clone(),c=a.velocities[this.m_indexA].w,e=a.velocities[this.m_indexB].v.Clone(),f=a.velocities[this.m_indexB].w,g=a.velocities[this.m_indexC].v.Clone(),k=a.velocities[this.m_indexC].w,h=a.velocities[this.m_indexD].v.Clone(),l=a.velocities[this.m_indexD].w,m=v(this.m_JvAC,d.Subtract(b,
g))+v(this.m_JvBD,d.Subtract(e,h)),m=m+(this.m_JwA*c-this.m_JwC*k+(this.m_JwB*f-this.m_JwD*l)),m=-this.m_mass*m;this.m_impulse+=m;b.Add(d.Multiply(this.m_mA*m,this.m_JvAC));c+=this.m_iA*m*this.m_JwA;e.Add(d.Multiply(this.m_mB*m,this.m_JvBD));f+=this.m_iB*m*this.m_JwB;g.Subtract(d.Multiply(this.m_mC*m,this.m_JvAC));k-=this.m_iC*m*this.m_JwC;h.Subtract(d.Multiply(this.m_mD*m,this.m_JvBD));l-=this.m_iD*m*this.m_JwD;a.velocities[this.m_indexA].v.Assign(b);a.velocities[this.m_indexA].w=c;a.velocities[this.m_indexB].v.Assign(e);
a.velocities[this.m_indexB].w=f;a.velocities[this.m_indexC].v.Assign(g);a.velocities[this.m_indexC].w=k;a.velocities[this.m_indexD].v.Assign(h);a.velocities[this.m_indexD].w=l},SolvePositionConstraints:function(a){var b=a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,e=a.positions[this.m_indexB].c.Clone(),f=a.positions[this.m_indexB].a,g=a.positions[this.m_indexC].c.Clone(),k=a.positions[this.m_indexC].a,h=a.positions[this.m_indexD].c.Clone(),l=a.positions[this.m_indexD].a,m=new F(c),
n=new F(f),p=new F(k),q=new F(l),r=new d,t=new d,y,w,z=0;if(this.m_typeA==s.e_revoluteJoint)r.SetZero(),m=y=1,z+=this.m_iA+this.m_iC,p=c-k-this.m_referenceAngleA;else{w=C(p,this.m_localAxisC);y=C(p,d.Subtract(this.m_localAnchorC,this.m_lcC));var x=C(m,d.Subtract(this.m_localAnchorA,this.m_lcA));r.Assign(w);m=u(y,w);y=u(x,w);z+=this.m_mC+this.m_mA+this.m_iC*m*m+this.m_iA*y*y;w=d.Subtract(this.m_localAnchorC,this.m_lcC);p=pa(p,d.Add(x,d.Subtract(b,g)));p=v(d.Subtract(p,w),this.m_localAxisC)}if(this.m_typeB==
s.e_revoluteJoint)t.SetZero(),n=w=this.m_ratio,z+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),q=f-l-this.m_referenceAngleB;else{w=C(q,this.m_localAxisD);var A=C(q,d.Subtract(this.m_localAnchorD,this.m_lcD)),x=C(n,d.Subtract(this.m_localAnchorB,this.m_lcB));t.Assign(d.Multiply(this.m_ratio,w));n=this.m_ratio*u(A,w);w=this.m_ratio*u(x,w);z+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*n*n+this.m_iB*w*w;A=d.Subtract(this.m_localAnchorD,this.m_lcD);q=pa(q,d.Add(x,d.Subtract(e,h)));q=
v(d.Subtract(q,A),this.m_localAxisD)}q=p+this.m_ratio*q-this.m_constant;p=0;0<z&&(p=-q/z);b.Add(d.Multiply(this.m_mA,d.Multiply(p,r)));c+=this.m_iA*p*y;e.Add(d.Multiply(this.m_mB,d.Multiply(p,t)));f+=this.m_iB*p*w;g.Subtract(d.Multiply(this.m_mC,d.Multiply(p,r)));k-=this.m_iC*p*m;h.Subtract(d.Multiply(this.m_mD,d.Multiply(p,t)));l-=this.m_iD*p*n;a.positions[this.m_indexA].c.Assign(b);a.positions[this.m_indexA].a=c;a.positions[this.m_indexB].c.Assign(e);a.positions[this.m_indexB].a=f;a.positions[this.m_indexC].c.Assign(g);
a.positions[this.m_indexC].a=k;a.positions[this.m_indexD].c.Assign(h);a.positions[this.m_indexD].a=l;return 0<Q},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.joint1=this.m_joint1.__temp_joint_id;a.joint2=this.m_joint2.__temp_joint_id;a.ratio=this.m_ratio;return a}};Hb._extend(s);nb.prototype={Initialize:function(a,b){this.bodyA=a;this.bodyB=b;var c=this.bodyB.GetPosition();this.linearOffset.Assign(this.bodyA.GetLocalPoint(c));c=this.bodyA.GetAngle();this.angularOffset=
this.bodyB.GetAngle()-c},_deserialize:function(a,b,c){this.parent.prototype._deserialize.call(this,a,b,c);this.linearOffset._deserialize(a.linearOffset);this.angularOffset=a.angularOffset;this.maxForce=a.maxForce;this.maxTorque=a.maxTorque;this.correctionFactor=a.correctionFactor}};nb._extend(oa);Ib.prototype={GetAnchorA:function(){return this.m_bodyA.GetPosition()},GetAnchorB:function(){return this.m_bodyB.GetPosition()},GetReactionForce:function(a){return d.Multiply(a,this.m_linearImpulse)},GetReactionTorque:function(a){return a*
this.m_angularImpulse},SetLinearOffset:function(a){if(a.x!=this.m_linearOffset.x||a.y!=this.m_linearOffset.y)this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Assign(a)},GetLinearOffset:function(){return this.m_linearOffset},SetAngularOffset:function(a){a!=this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=a)},GetAngularOffset:function(){return this.m_angularOffset},SetMaxForce:function(a){this.m_maxForce=a},GetMaxForce:function(){return this.m_maxForce},
SetMaxTorque:function(a){this.m_maxTorque=a},GetMaxTorque:function(){return this.m_maxTorque},SetCorrectionFactor:function(a){this.m_correctionFactor=a},GetCorrectionFactor:function(){return this.m_correctionFactor},InitVelocityConstraints:function(a){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=
this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var b=a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,e=a.velocities[this.m_indexA].v.Clone(),f=a.velocities[this.m_indexA].w,g=a.positions[this.m_indexB].c.Clone(),k=a.positions[this.m_indexB].a,h=a.velocities[this.m_indexB].v.Clone(),l=a.velocities[this.m_indexB].w,m=new F(c),n=new F(k);this.m_rA.Assign(C(m,this.m_localCenterA.Negate()));this.m_rB.Assign(C(n,this.m_localCenterB.Negate()));
var n=this.m_invMassA,p=this.m_invMassB,q=this.m_invIA,r=this.m_invIB,s=new $;s.ex.x=n+p+q*this.m_rA.y*this.m_rA.y+r*this.m_rB.y*this.m_rB.y;s.ex.y=-q*this.m_rA.x*this.m_rA.y-r*this.m_rB.x*this.m_rB.y;s.ey.x=s.ex.y;s.ey.y=n+p+q*this.m_rA.x*this.m_rA.x+r*this.m_rB.x*this.m_rB.x;this.m_linearMass.Assign(s.GetInverse());this.m_angularMass=q+r;0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass);this.m_linearError.x=g.x+this.m_rB.x-b.x-this.m_rA.x-(m.c*this.m_linearOffset.x-m.s*this.m_linearOffset.y);
this.m_linearError.y=g.y+this.m_rB.y-b.y-this.m_rA.y-(m.s*this.m_linearOffset.x+m.c*this.m_linearOffset.y);this.m_angularError=k-c-this.m_angularOffset;a.step.warmStarting?(this.m_linearImpulse.Multiply(a.step.dtRatio),this.m_angularImpulse*=a.step.dtRatio,b=new d(this.m_linearImpulse.x,this.m_linearImpulse.y),e.Subtract(d.Multiply(n,b)),f-=q*(u(this.m_rA,b)+this.m_angularImpulse),h.Add(d.Multiply(p,b)),l+=r*(u(this.m_rB,b)+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=
0);a.velocities[this.m_indexA].v.Assign(e);a.velocities[this.m_indexA].w=f;a.velocities[this.m_indexB].v.Assign(h);a.velocities[this.m_indexB].w=l},SolveVelocityConstraints:function(a){var b=a.velocities[this.m_indexA].v.Clone(),c=a.velocities[this.m_indexA].w,e=a.velocities[this.m_indexB].v.Clone(),f=a.velocities[this.m_indexB].w,g=this.m_invMassA,k=this.m_invMassB,h=this.m_invIA,l=this.m_invIB,m=a.step.dt,n=a.step.inv_dt,p=f-c+n*this.m_correctionFactor*this.m_angularError,p=-this.m_angularMass*
p,q=this.m_angularImpulse,r=m*this.m_maxTorque;this.m_angularImpulse=ca(this.m_angularImpulse+p,-r,r);p=this.m_angularImpulse-q;c-=h*p;f+=l*p;p=new d(e.x+-f*this.m_rB.x-b.x- -c*this.m_rA.x+n*this.m_correctionFactor*this.m_linearError.x,e.y+f*this.m_rB.y-b.y-c*this.m_rA.y+n*this.m_correctionFactor*this.m_linearError.y);p=Ma(this.m_linearMass,p).Negate();q=this.m_linearImpulse.Clone();this.m_linearImpulse.Add(p);r=m*this.m_maxForce;this.m_linearImpulse.LengthSquared()>r*r&&(this.m_linearImpulse.Normalize(),
this.m_linearImpulse.Multiply(r));p.Assign(d.Subtract(this.m_linearImpulse,q));b.Subtract(d.Multiply(g,p));c-=h*u(this.m_rA,p);e.Add(d.Multiply(k,p));f+=l*u(this.m_rB,p);a.velocities[this.m_indexA].v.Assign(b);a.velocities[this.m_indexA].w=c;a.velocities[this.m_indexB].v.Assign(e);a.velocities[this.m_indexB].w=f},SolvePositionConstraints:function(a){return!0},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.linearOffset=this.m_linearOffset._serialize();a.angularOffset=
this.m_angularOffset;a.maxForce=this.m_maxForce;a.maxTorque=this.m_maxTorque;a.correctionFactor=this.m_correctionFactor;return a}};Ib._extend(s);Jb.prototype={Initialize:function(a,b,c,e,f,g,k){this.bodyA=a;this.bodyB=b;this.groundAnchorA.Assign(c);this.groundAnchorB.Assign(e);this.localAnchorA.Assign(this.bodyA.GetLocalPoint(f));this.localAnchorB.Assign(this.bodyB.GetLocalPoint(g));this.lengthA=d.Subtract(f,c).Length();this.lengthB=d.Subtract(g,e).Length();this.ratio=k},_deserialize:function(a,b,
c){this.parent.prototype._deserialize.call(this,a,b,c);this.groundAnchorA._deserialize(a.groundAnchorA);this.groundAnchorB._deserialize(a.groundAnchorB);this.localAnchorA._deserialize(a.localAnchorA);this.localAnchorB._deserialize(a.localAnchorB);this.lengthA=a.lengthA;this.lengthB=a.lengthB;this.ratio=a.ratio}};Jb._extend(oa);Kb.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(a){var b=
d.Multiply(this.m_impulse,this.m_uB);return d.Multiply(a,b)},GetReactionTorque:function(a){return 0},GetGroundAnchorA:function(){return this.m_groundAnchorA},GetGroundAnchorB:function(){return this.m_groundAnchorB},GetLengthA:function(){return this.m_lengthA},GetLengthB:function(){return this.m_lengthB},GetRatio:function(){return this.m_ratio},GetCurrentLengthA:function(){var a=this.m_bodyA.GetWorldPoint(this.m_localAnchorA);return d.Subtract(a,this.m_groundAnchorA).Length()},GetCurrentLengthB:function(){var a=
this.m_bodyB.GetWorldPoint(this.m_localAnchorB);return d.Subtract(a,this.m_groundAnchorB).Length()},ShiftOrigin:function(a){this.m_groundAnchorA.Subtract(a);this.m_groundAnchorB.Subtract(a)},InitVelocityConstraints:function(a){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;
this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var b=a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,e=a.velocities[this.m_indexA].v.Clone(),f=a.velocities[this.m_indexA].w,g=a.positions[this.m_indexB].c.Clone(),k=a.positions[this.m_indexB].a,h=a.velocities[this.m_indexB].v.Clone(),l=a.velocities[this.m_indexB].w,c=new F(c),k=new F(k);this.m_rA.Assign(C(c,d.Subtract(this.m_localAnchorA,this.m_localCenterA)));this.m_rB.Assign(C(k,d.Subtract(this.m_localAnchorB,
this.m_localCenterB)));this.m_uA.Assign(d.Add(b,d.Subtract(this.m_rA,this.m_groundAnchorA)));this.m_uB.Assign(d.Add(g,d.Subtract(this.m_rB,this.m_groundAnchorB)));b=this.m_uA.Length();g=this.m_uB.Length();b>10*Q?this.m_uA.Multiply(1/b):this.m_uA.SetZero();g>10*Q?this.m_uB.Multiply(1/g):this.m_uB.SetZero();b=u(this.m_rA,this.m_uA);g=u(this.m_rB,this.m_uB);this.m_mass=this.m_invMassA+this.m_invIA*b*b+this.m_ratio*this.m_ratio*(this.m_invMassB+this.m_invIB*g*g);0<this.m_mass&&(this.m_mass=1/this.m_mass);
a.step.warmStarting?(this.m_impulse*=a.step.dtRatio,b=d.Multiply(-this.m_impulse,this.m_uA),g=d.Multiply(-this.m_ratio*this.m_impulse,this.m_uB),e.Add(d.Multiply(this.m_invMassA,b)),f+=this.m_invIA*u(this.m_rA,b),h.Add(d.Multiply(this.m_invMassB,g)),l+=this.m_invIB*u(this.m_rB,g)):this.m_impulse=0;a.velocities[this.m_indexA].v.Assign(e);a.velocities[this.m_indexA].w=f;a.velocities[this.m_indexB].v.Assign(h);a.velocities[this.m_indexB].w=l},SolveVelocityConstraints:function(a){var b=a.velocities[this.m_indexA].v.Clone(),
c=a.velocities[this.m_indexA].w,e=a.velocities[this.m_indexB].v.Clone(),f=a.velocities[this.m_indexB].w,g=d.Add(b,S(c,this.m_rA)),k=d.Add(e,S(f,this.m_rB)),g=-v(this.m_uA,g)-this.m_ratio*v(this.m_uB,k),k=-this.m_mass*g;this.m_impulse+=k;g=d.Multiply(-k,this.m_uA);k=d.Multiply(-this.m_ratio,d.Multiply(k,this.m_uB));b.Add(d.Multiply(this.m_invMassA,g));c+=this.m_invIA*u(this.m_rA,g);e.Add(d.Multiply(this.m_invMassB,k));f+=this.m_invIB*u(this.m_rB,k);a.velocities[this.m_indexA].v.Assign(b);a.velocities[this.m_indexA].w=
c;a.velocities[this.m_indexB].v.Assign(e);a.velocities[this.m_indexB].w=f},SolvePositionConstraints:function(a){var b=a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,e=a.positions[this.m_indexB].c.Clone(),f=a.positions[this.m_indexB].a,g=new F(c),k=new F(f),g=C(g,d.Subtract(this.m_localAnchorA,this.m_localCenterA)),k=C(k,d.Subtract(this.m_localAnchorB,this.m_localCenterB)),h=d.Add(b,d.Subtract(g,this.m_groundAnchorA)),l=d.Add(e,d.Subtract(k,this.m_groundAnchorB)),m=h.Length(),
n=l.Length();m>10*Q?h.Multiply(1/m):h.SetZero();n>10*Q?l.Multiply(1/n):l.SetZero();var p=u(g,h),q=u(k,l),p=this.m_invMassA+this.m_invIA*p*p+this.m_ratio*this.m_ratio*(this.m_invMassB+this.m_invIB*q*q);0<p&&(p=1/p);n=this.m_constant-m-this.m_ratio*n;m=aa(n);n*=-p;h=d.Multiply(-n,h);l=d.Multiply(-this.m_ratio,d.Multiply(n,l));b.Add(d.Multiply(this.m_invMassA,h));c+=this.m_invIA*u(g,h);e.Add(d.Multiply(this.m_invMassB,l));f+=this.m_invIB*u(k,l);a.positions[this.m_indexA].c.Assign(b);a.positions[this.m_indexA].a=
c;a.positions[this.m_indexB].c.Assign(e);a.positions[this.m_indexB].a=f;return m<Q},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.groundAnchorA=this.m_groundAnchorA._serialize();a.groundAnchorB=this.m_groundAnchorB._serialize();a.localAnchorA=this.m_localAnchorA._serialize();a.localAnchorB=this.m_localAnchorB._serialize();a.lengthA=this.m_lengthA;a.lengthB=this.m_lengthB;a.ratio=this.m_ratio;return a}};Kb._extend(s);ob.prototype={_deserialize:function(a,b,c){this.parent.prototype._deserialize.call(this,
a,b,c);this.localAnchorA._deserialize(a.localAnchorA);this.localAnchorB._deserialize(a.localAnchorB);this.maxLength=a.maxLength}};ob._extend(oa);Lb.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(a){return d.Multiply(a*this.m_impulse,this.m_u)},GetReactionTorque:function(a){return 0},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},
SetMaxLength:function(a){this.m_maxLength=a},GetMaxLength:function(){return this.m_maxLength},GetLimitState:function(){return this.m_state},InitVelocityConstraints:function(a){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=
this.m_bodyB.m_invI;var b=a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,e=a.velocities[this.m_indexA].v.Clone(),f=a.velocities[this.m_indexA].w,g=a.positions[this.m_indexB].c.Clone(),k=a.positions[this.m_indexB].a,h=a.velocities[this.m_indexB].v.Clone(),l=a.velocities[this.m_indexB].w,c=new F(c),k=new F(k);this.m_rA.Assign(C(c,d.Subtract(this.m_localAnchorA,this.m_localCenterA)));this.m_rB.Assign(C(k,d.Subtract(this.m_localAnchorB,this.m_localCenterB)));this.m_u.Assign(d.Subtract(d.Subtract(d.Add(g,
this.m_rB),b),this.m_rA));this.m_length=this.m_u.Length();this.m_state=0<this.m_length-this.m_maxLength?s.e_atUpperLimit:s.e_inactiveLimit;this.m_length>Q?(this.m_u.Multiply(1/this.m_length),b=u(this.m_rA,this.m_u),g=u(this.m_rB,this.m_u),b=this.m_invMassA+this.m_invIA*b*b+this.m_invMassB+this.m_invIB*g*g,this.m_mass=0!=b?1/b:0,a.step.warmStarting?(this.m_impulse*=a.step.dtRatio,b=d.Multiply(this.m_impulse,this.m_u),e.Subtract(d.Multiply(this.m_invMassA,b)),f-=this.m_invIA*u(this.m_rA,b),h.Add(d.Multiply(this.m_invMassB,
b)),l+=this.m_invIB*u(this.m_rB,b)):this.m_impulse=0,a.velocities[this.m_indexA].v.Assign(e),a.velocities[this.m_indexA].w=f,a.velocities[this.m_indexB].v.Assign(h),a.velocities[this.m_indexB].w=l):(this.m_u.SetZero(),this.m_impulse=this.m_mass=0)},SolveVelocityConstraints:function(a){var b=a.velocities[this.m_indexA].v.Clone(),c=a.velocities[this.m_indexA].w,e=a.velocities[this.m_indexB].v.Clone(),f=a.velocities[this.m_indexB].w,g=d.Add(b,S(c,this.m_rA)),k=d.Add(e,S(f,this.m_rB)),h=this.m_length-
this.m_maxLength,g=v(this.m_u,d.Subtract(k,g));0>h&&(g+=a.step.inv_dt*h);h=-this.m_mass*g;g=this.m_impulse;this.m_impulse=O(0,this.m_impulse+h);h=this.m_impulse-g;h=d.Multiply(h,this.m_u);b.Subtract(d.Multiply(this.m_invMassA,h));c-=this.m_invIA*u(this.m_rA,h);e.Add(d.Multiply(this.m_invMassB,h));f+=this.m_invIB*u(this.m_rB,h);a.velocities[this.m_indexA].v.Assign(b);a.velocities[this.m_indexA].w=c;a.velocities[this.m_indexB].v.Assign(e);a.velocities[this.m_indexB].w=f},SolvePositionConstraints:function(a){var b=
a.positions[this.m_indexA].c.Clone(),c=a.positions[this.m_indexA].a,e=a.positions[this.m_indexB].c.Clone(),f=a.positions[this.m_indexB].a,g=new F(c),k=new F(f),g=C(g,d.Subtract(this.m_localAnchorA,this.m_localCenterA)),k=C(k,d.Subtract(this.m_localAnchorB,this.m_localCenterB)),h=d.Subtract(d.Subtract(d.Add(e,k),b),g),l=h.Normalize(),m=l-this.m_maxLength,m=ca(m,0,0.2),h=d.Multiply(-this.m_mass*m,h);b.Subtract(d.Multiply(this.m_invMassA,h));c-=this.m_invIA*u(g,h);e.Add(d.Multiply(this.m_invMassB,h));
f+=this.m_invIB*u(k,h);a.positions[this.m_indexA].c.Assign(b);a.positions[this.m_indexA].a=c;a.positions[this.m_indexB].c.Assign(e);a.positions[this.m_indexB].a=f;return l-this.m_maxLength<Q},_serialize:function(a){a=a||{};this.parent.prototype._serialize.call(this,a);a.localAnchorA=this.m_localAnchorA._serialize();a.localAnchorB=this.m_localAnchorB._serialize();a.maxLength=this.m_maxLength;return a}};Lb._extend(s);var hd=Math.exp;Qc.prototype={Initialize:function(a){this.m_count=a.count;this.m_ps=
Array(this.m_count);this.m_p0s=Array(this.m_count);this.m_vs=Array(this.m_count);this.m_ims=Array(this.m_count);for(var b=0;b<this.m_count;++b){this.m_ps[b]=a.vertices[b].Clone();this.m_p0s[b]=a.vertices[b].Clone();this.m_vs[b]=new d;var c=a.masses[b];this.m_ims[b]=0<c?1/c:0}var e=this.m_count-1,c=this.m_count-2;this.m_Ls=Array(e);this.m_as=Array(c);for(b=0;b<e;++b){var f=this.m_ps[b],g=this.m_ps[b+1];this.m_Ls[b]=Na(f,g)}for(b=0;b<c;++b)f=this.m_ps[b],g=this.m_ps[b+1],e=this.m_ps[b+2],f=d.Subtract(g,
f),e=d.Subtract(e,g),g=u(f,e),f=v(f,e),this.m_as[b]=fc(g,f);this.m_gravity=a.gravity.Clone();this.m_damping=a.damping;this.m_k2=a.k2;this.m_k3=a.k3},Step:function(a,b){if(0!=a){for(var c=hd(-a*this.m_damping),e=0;e<this.m_count;++e)this.m_p0s[e].Assign(this.m_ps[e]),0<this.m_ims[e]&&this.m_vs[e].Add(d.Multiply(a,this.m_gravity)),this.m_vs[e].Multiply(c),this.m_ps[e].Add(d.Multiply(a,this.m_vs[e]));for(e=0;e<b;++e)this.SolveC2(),this.SolveC3(),this.SolveC2();c=1/a;for(e=0;e<this.m_count;++e)this.m_vs[e]=
d.Multiply(c,d.Subtract(this.m_ps[e],this.m_p0s[e]))}},GetVertexCount:function(){return this.m_count},GetVertices:function(){return this.m_ps},Draw:function(a){for(var b=new ea(0.4,0.5,0.7),c=0;c<this.m_count-1;++c)a.DrawSegment(this.m_ps[c],this.m_ps[c+1],b)},SetAngle:function(a){for(var b=this.m_count-2,c=0;c<b;++c)this.m_as[c]=a},SolveC2:function(){for(var a=this.m_count-1,b=0;b<a;++b){var c=this.m_ps[b],e=this.m_ps[b+1],f=d.Subtract(e,c),g=f.Normalize(),k=this.m_ims[b],h=this.m_ims[b+1];if(0!=
k+h){var l=h/(k+h);c.Subtract(d.Multiply(k/(k+h)*this.m_k2*(this.m_Ls[b]-g),f));e.Add(d.Multiply(this.m_k2*l*(this.m_Ls[b]-g),f))}}},SolveC3:function(){for(var a=this.m_count-2,b=0;b<a;++b){var c=this.m_ps[b],e=this.m_ps[b+1],f=this.m_ps[b+2],g=this.m_ims[b],k=this.m_ims[b+1],h=this.m_ims[b+2],l=d.Subtract(e,c),m=d.Subtract(f,e),n=l.LengthSquared(),p=m.LengthSquared();if(0!=n*p){var q=u(l,m),r=v(l,m),q=fc(q,r),l=d.Multiply(-1/n,l.Skew()),n=d.Multiply(1/p,m.Skew()),m=d.Negate(l),p=d.Subtract(l,n),
l=n,n=g*v(m,m)+k*v(p,p)+h*v(l,l);if(0!=n){n=1/n;for(r=q-this.m_as[b];r>ja;)q-=2*ja,r=q-this.m_as[b];for(;r<-ja;)q+=2*ja,r=q-this.m_as[b];q=-this.m_k3*n*r;c.Add(d.Multiply(g*q,m));e.Add(d.Multiply(k*q,p));f.Add(d.Multiply(h*q,l))}}}}};var id=function(){function a(a){return new d(a?a.x||0:0,a?a.y||0:0)}function b(a){for(var b=Array(a.x.length),c=0;c<b.length;++c)b[c]=new d(a.x[c],a.y[c]);return b}function c(b,c){var d=b.name,e;if("undefined"!==typeof b["int"])e=b["int"];else if("undefined"!==typeof b["float"])e=
b["float"];else if("undefined"!==typeof b.string)e=b.string;else if("undefined"!==typeof b.bool)e=b.bool;else if("undefined"!==typeof b.vec2)e=a(b.vec2);else throw Error("unknown property type");if(c.hasOwnProperty(d))throw Error("custom property possibly overwriting an existing one");c[d]=e}function e(){this.world=null;this.stepsPerSecond=this.velocityIterations=this.positionIterations=0;this.fixtures={};this.bodies={};this.joints={};Object.seal(this)}var f={revolute:hb,distance:ib,prismatic:jb,
wheel:mb,rope:ob,motor:nb,weld:lb,friction:kb};return{parseWorld:function(g,k){var h=new e;h.world=k=k||new P(new d(0,0));h.positionIterations=g.positionIterations||0;h.velocityIterations=g.velocityIterations||0;h.stepsPerSecond=g.stepsPerSecond||0;g.gravity&&k.SetGravity(a(g.gravity));k.SetAllowSleeping(g.allowSleep||!1);k.SetAutoClearForces(g.autoClearForces||!1);k.SetWarmStarting(g.warmStarting||!1);k.SetContinuousPhysics(g.continuousPhysics||!1);k.SetSubStepping(g.subStepping||!1);var l=[],m=
g.body;if(m)for(var n=0;n<m.length;++n){var p;p=m[n];var q=k,r=new vb;r.type=p.type||t.b2_staticBody;r.angle=p.angle||0;r.angularDamping=p.angularDamping||0;r.angularVelocity=p.angularVelocity||0;r.awake=p.awake||!1;r.bullet=p.bullet||!1;r.fixedRotation=p.fixedRotation||!1;r.linearDamping=p.linearDamping||!1;r.linearVelocity=a(p.linearVelocity);r.gravityScale="undefined"!==typeof p.gravityScale?p.gravityScale:1;var u=new qc;u.mass=p["massData-mass"]||0;u.center=a(p["massData-center"]);u.I=p["massData-I"]||
0;r.position=a(p.position);q=q.CreateBody(r);q.name=p.name;q.SetMassData(u);if(p.fixture)for(u=0;u<p.fixture.length;++u){var r=p.fixture[u],y=q,v=new fb;v.density=r.density||0;v.filter.categoryBits="undefined"===typeof r["filter-categoryBits"]?1:r["filter-categoryBits"];v.filter.maskBits="undefined"===typeof r["filter-maskBits"]?65535:r["filter-maskBits"];v.filter.groupIndex="undefined"===typeof r["filter-groupIndex"]?0:r["filter-groupIndex"];v.friction=r.friction||0;v.restitution=r.restitution||
0;v.isSensor=r.sensor||0;var w=void 0;if("undefined"!==typeof r.circle)w=new Qa,w.m_p=a(r.circle.center),w.m_radius=r.circle.radius||0;else if("undefined"!==typeof r.polygon){var x=b(r.polygon.vertices),w=new Fa;w.Set(x,x.length)}else if("undefined"!==typeof r.chain){x=b(r.chain.vertices);w=new qa;w.m_count=x.length;w.m_vertices=x;if(w.m_hasNextVertex=r.chain.hasNextVertex)w.m_nextVertex=a(r.chain.nextVertex);if(w.m_hasPrevVertex=r.chain.hasPrevVertex)w.m_prevVertex=a(r.chain.prevVertex)}else throw Error("unknown shape type");
v.shape=w;y=y.CreateFixture(v);y.name=r.name;if(r.customProperties)for(v=0;v<r.customProperties.length;++v)c(r,y)}if(p.customProperties)for(u=0;u<p.customProperties.length;++u)c(p,q);p=q;l.push(p);for(q=p.GetFixtureList();q;q=q.GetNext())h.fixtures[q.name]||(h.fixtures[q.name]=[]),h.fixtures[q.name].push(q);h.bodies[p.name]||(h.bodies[p.name]=[]);h.bodies[p.name].push(p)}m=[];if(p=g.joint)for(n=0;n<p.length;++n){q=p[n];u=k;r=l;if(!f[q.type])throw Error("unknown joint type");y=new f[q.type];switch(y.type){case s.e_revoluteJoint:y.localAnchorA=
a(q.anchorA);y.localAnchorB=a(q.anchorB);y.enableLimit=q.enableLimit||!1;y.enableMotor=q.enableMotor||!1;y.lowerAngle=q.lowerLimit||0;y.maxMotorTorque=q.maxMotorTorque||0;y.motorSpeed=q.motorSpeed||0;y.referenceAngle=q.refAngle||0;y.upperAngle=q.upperLimit||0;break;case s.e_distanceJoint:y.localAnchorA=a(q.anchorA);y.localAnchorB=a(q.anchorB);y.dampingRatio=q.dampingRatio||0;y.frequencyHz=q.frequency||0;y.length=q.length||0;break;case s.e_prismaticJoint:y.localAnchorA=a(q.anchorA);y.localAnchorB=
a(q.anchorB);y.enableLimit=q.enableLimit||!1;y.enableMotor=q.enableMotor||!1;y.localAxisA=a(q.localAxisA);y.lowerTranslation=q.lowerLimit||0;y.maxMotorForce=q.maxMotorForce||0;y.motorSpeed=q.motorSpeed||0;y.referenceAngle=q.refAngle||0;y.upperTranslation=q.upperLimit||0;break;case s.e_wheelJoint:y.localAnchorA=a(q.anchorA);y.localAnchorB=a(q.anchorB);y.enableMotor=q.enableMotor||!1;y.localAxisA=a(q.localAxisA);y.maxMotorTorque=q.maxMotorTorque||0;y.motorSpeed=q.motorSpeed||0;y.dampingRatio=q.springDampingRatio||
0;y.frequencyHz=q.springFrequency||0;break;case s.e_ropeJoint:y.localAnchorA=a(q.anchorA);y.localAnchorB=a(q.anchorB);y.maxLength=q.maxLength||0;break;case s.e_motorJoint:y.linearOffset=a(q.anchorA);y.angularOffset=q.refAngle||0;y.maxForce=q.maxForce||0;y.maxTorque=q.maxTorque||0;y.correctionFactor=q.correctionFactor||0;break;case s.e_weldJoint:y.localAnchorA=a(q.anchorA);y.localAnchorB=a(q.anchorB);y.referenceAngle=q.refAngle||0;y.dampingRatio=q.dampingRatio||0;y.frequencyHz=q.frequencyHz||0;break;
case s.e_frictionJoint:y.localAnchorA=a(q.anchorA);y.localAnchorB=a(q.anchorB);y.maxForce=q.maxForce||0;y.maxTorque=q.maxTorque||0;break;default:throw Error("wat?");}y.bodyA=r[q.bodyA||0];y.bodyB=r[q.bodyB||0];y.collideConnected=q.collideConnected||!1;u=u.CreateJoint(y);u.name=q.name;if(q.customProperties)for(r=0;r<q.customProperties.length;++r)c(q,u);q=u;m.push(q);h.joints[q.name]||(h.joints[q.name]=[]);h.joints[q.name].push(q)}return h}}}(),Za=[{trimmed:"version",name:"b2_version",def:dd},{trimmed:"Vec2",
name:"b2Vec2",def:d},{trimmed:"Vec3",name:"b2Vec3",def:N},{trimmed:"Mat22",name:"b2Mat22",def:$},{trimmed:"Mat33",name:"b2Mat33",def:Ba},{trimmed:"Rot",name:"b2Rot",def:F},{trimmed:"Transform",name:"b2Transform",def:Y},{trimmed:"Sweep",name:"b2Sweep",def:sa},{trimmed:"Dot_v2_v2",name:"b2Dot_v2_v2",def:v},{trimmed:"Cross_v2_v2",name:"b2Cross_v2_v2",def:u},{trimmed:"Cross_v2_f",name:"b2Cross_v2_f",def:jc},{trimmed:"Cross_f_v2",name:"b2Cross_f_v2",def:S},{trimmed:"Mul_m22_v2",name:"b2Mul_m22_v2",def:Ma},
{trimmed:"MulT_m22_v2",name:"b2MulT_m22_v2",def:function(a,b){return new d(v(b,a.ex),v(b,a.ey))}},{trimmed:"Distance",name:"b2Distance",def:Na},{trimmed:"DistanceSquared",name:"b2DistanceSquared",def:rb},{trimmed:"Dot_v3_v3",name:"b2Dot_v3_v3",def:Oa},{trimmed:"Cross_v3_v3",name:"b2Cross_v3_v3",def:Pa},{trimmed:"Mul_m22_m22",name:"b2Mul_m22_m22",def:function(a,b){return new $(Ma(a,b.ex),Ma(a,b.ey))}},{trimmed:"MulT_m22_m22",name:"b2MulT_m22_m22",def:function(a,b){var c=new d(v(a.ex,b.ex),v(a.ey,b.ex)),
e=new d(v(a.ex,b.ey),v(a.ey,b.ey));return new $(c,e)}},{trimmed:"Mul_m33_v3",name:"b2Mul_m33_v3",def:kc},{trimmed:"Mul22_m33_v2",name:"b2Mul22_m33_v2",def:lc},{trimmed:"Mul_r_r",name:"b2Mul_r_r",def:mc},{trimmed:"MulT_r_r",name:"b2MulT_r_r",def:nc},{trimmed:"Mul_r_v2",name:"b2Mul_r_v2",def:C},{trimmed:"MulT_r_v2",name:"b2MulT_r_v2",def:pa},{trimmed:"Mul_t_v2",name:"b2Mul_t_v2",def:V},{trimmed:"Min_v2",name:"b2Min_v2",def:Da},{trimmed:"Max_v2",name:"b2Max_v2",def:Ea},{trimmed:"Clamp",name:"b2Clamp",
def:ca},{trimmed:"MulT_t_v2",name:"b2MulT_t_v2",def:Ca},{trimmed:"Mul_t_t",name:"b2Mul_t_t",def:oc},{trimmed:"MulT_t_t",name:"b2MulT_t_t",def:Nb},{trimmed:"Clamp_v2",name:"b2Clamp_v2",def:function(a,b,c){return Ea(b,Da(a,c))}},{trimmed:"NextPowerOfTwo",name:"b2NextPowerOfTwo",def:function(a){a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;return(a|a>>16)+1}},{trimmed:"Abs_v2",name:"b2Abs_v2",def:$a},{trimmed:"Abs_m22",name:"b2Abs_m22",def:function(a){return new $($a(a.ex),$a(a.ey))}},{trimmed:"IsPowerOfTwo",name:"b2IsPowerOfTwo",
def:function(a){return 0<a&&0==(a&a-1)}},{trimmed:"RandomFloat",name:"b2RandomFloat",def:function(a,b){var c=Math.random();return"undefined"!==typeof a?(b-a)*c+a:2*c-1}},{trimmed:"Timer",name:"b2Timer",def:pc},{trimmed:"Color",name:"b2Color",def:ea},{trimmed:"Draw",name:"b2Draw",def:ba},{trimmed:"ContactID",name:"b2ContactID",def:U},{trimmed:"ManifoldPoint",name:"b2ManifoldPoint",def:ma},{trimmed:"Manifold",name:"b2Manifold",def:L},{trimmed:"WorldManifold",name:"b2WorldManifold",def:Sb},{trimmed:"GetPointStates",
name:"b2GetPointStates",def:function(a,b,c,d){for(var f=0;f<na;++f)a[f]=L.b2_nullState,b[f]=L.b2_nullState;for(f=0;f<c.pointCount;++f){var g=c.points[f].id;a[f]=L.b2_removeState;for(var k=0;k<d.pointCount;++k)if(d.points[k].id.Get()==g.Get()){a[f]=L.b2_persistState;break}}for(f=0;f<d.pointCount;++f)for(g=d.points[f].id,b[f]=L.b2_addState,k=0;k<c.pointCount;++k)if(c.points[k].id.Get()==g.Get()){b[f]=L.b2_persistState;break}}},{trimmed:"ClipVertex",name:"b2ClipVertex",def:Ia},{trimmed:"RayCastInput",
name:"b2RayCastInput",def:sb},{trimmed:"RayCastOutput",name:"b2RayCastOutput",def:Tb},{trimmed:"AABB",name:"b2AABB",def:X},{trimmed:"CollideCircles",name:"b2CollideCircles",def:tc},{trimmed:"CollidePolygonAndCircle",name:"b2CollidePolygonAndCircle",def:uc},{trimmed:"FindMaxSeparation",name:"b2FindMaxSeparation",def:Ub},{trimmed:"FindIncidentEdge",name:"b2FindIncidentEdge",def:vc},{trimmed:"CollidePolygons",name:"b2CollidePolygons",def:fa},{trimmed:"CollideEdgeAndCircle",name:"b2CollideEdgeAndCircle",
def:Vb},{trimmed:"EPAxis",name:"b2EPAxis",def:da},{trimmed:"TempPolygon",name:"b2TempPolygon",def:wc},{trimmed:"ReferenceFace",name:"b2ReferenceFace",def:xc},{trimmed:"EPCollider",name:"b2EPCollider",def:M},{trimmed:"CollideEdgeAndPolygon",name:"b2CollideEdgeAndPolygon",def:db},{trimmed:"ClipSegmentToLine",name:"b2ClipSegmentToLine",def:cb},{trimmed:"TestShapeOverlap",name:"b2TestShapeOverlap",def:ga},{trimmed:"TestOverlap",name:"b2TestOverlap",def:tb},{trimmed:"Shape",name:"b2Shape",def:G},{trimmed:"CircleShape",
name:"b2CircleShape",def:Qa},{trimmed:"EdgeShape",name:"b2EdgeShape",def:Ja},{trimmed:"ChainShape",name:"b2ChainShape",def:qa},{trimmed:"PolygonShape",name:"b2PolygonShape",def:Fa},{trimmed:"Pair",name:"b2Pair",def:rc},{trimmed:"PairLessThan",name:"b2PairLessThan",def:sc},{trimmed:"BroadPhase",name:"b2BroadPhase",def:Ga},{trimmed:"DistanceProxy",name:"b2DistanceProxy",def:Ra},{trimmed:"SimplexCache",name:"b2SimplexCache",def:Ob},{trimmed:"DistanceInput",name:"b2DistanceInput",def:Pb},{trimmed:"DistanceOutput",
name:"b2DistanceOutput",def:Qb},{trimmed:"SimplexVertex",name:"b2SimplexVertex",def:bb},{trimmed:"Simplex",name:"b2Simplex",def:Rb},{trimmed:"DistanceFunc",name:"b2DistanceFunc",def:xa},{trimmed:"TreeNode",name:"b2TreeNode",def:Sa},{trimmed:"DynamicTree",name:"b2DynamicTree",def:Ha},{trimmed:"TOIInput",name:"b2TOIInput",def:yc},{trimmed:"TOIOutput",name:"b2TOIOutput",def:ha},{trimmed:"SeparationFunction",name:"b2SeparationFunction",def:ia},{trimmed:"TimeOfImpact",name:"b2TimeOfImpact",def:R},{trimmed:"BodyDef",
name:"b2BodyDef",def:vb},{trimmed:"Body",name:"b2Body",def:t},{trimmed:"Filter",name:"b2Filter",def:eb},{trimmed:"FixtureDef",name:"b2FixtureDef",def:fb},{trimmed:"Fixture",name:"b2Fixture",def:Wb},{trimmed:"DestructionListener",name:"b2DestructionListener",def:zc},{trimmed:"ContactFilter",name:"b2ContactFilter",def:Xb},{trimmed:"ContactImpulse",name:"b2ContactImpulse",def:Ac},{trimmed:"ContactListener",name:"b2ContactListener",def:Yb},{trimmed:"QueryCallback",name:"b2QueryCallback",def:Bc},{trimmed:"RayCastCallback",
name:"b2RayCastCallback",def:Cc},{trimmed:"TimeStep",name:"b2TimeStep",def:gb},{trimmed:"Position",name:"b2Position",def:Dc},{trimmed:"Velocity",name:"b2Velocity",def:Ec},{trimmed:"SolverData",name:"b2SolverData",def:Fc},{trimmed:"World",name:"b2World",def:P},{trimmed:"MixFriction",name:"b2MixFriction",def:function(a,b){return va(a*b)}},{trimmed:"MixRestitution",name:"b2MixRestitution",def:$b},{trimmed:"ContactRegister",name:"b2ContactRegister",def:ac},{trimmed:"ContactEdge",name:"b2ContactEdge",
def:wb},{trimmed:"Contact",name:"b2Contact",def:w},{trimmed:"CircleContact",name:"b2CircleContact",def:xb},{trimmed:"PolygonContact",name:"b2PolygonContact",def:Ya},{trimmed:"ChainAndCircleContact",name:"b2ChainAndCircleContact",def:yb},{trimmed:"ChainAndPolygonContact",name:"b2ChainAndPolygonContact",def:Ua},{trimmed:"EdgeAndCircleContact",name:"b2EdgeAndCircleContact",def:Va},{trimmed:"EdgeAndPolygonContact",name:"b2EdgeAndPolygonContact",def:Wa},{trimmed:"PolygonAndCircleContact",name:"b2PolygonAndCircleContact",
def:Xa},{trimmed:"defaultFilter",name:"b2_defaultFilter",def:Jc},{trimmed:"defaultListener",name:"b2_defaultListener",def:Kc},{trimmed:"ContactManager",name:"b2ContactManager",def:Zb},{trimmed:"VelocityConstraintPoint",name:"b2VelocityConstraintPoint",def:Lc},{trimmed:"ContactPositionConstraint",name:"b2ContactPositionConstraint",def:Mc},{trimmed:"ContactVelocityConstraint",name:"b2ContactVelocityConstraint",def:Nc},{trimmed:"PositionSolverManifold",name:"b2PositionSolverManifold",def:bc},{trimmed:"ContactSolverDef",
name:"b2ContactSolverDef",def:Oc},{trimmed:"ContactSolver",name:"b2ContactSolver",def:E},{trimmed:"Island",name:"b2Island",def:K},{trimmed:"Jacobian",name:"b2Jacobian",def:function(){this.linear=new d;this.angularB=this.angularA=0}},{trimmed:"JointEdge",name:"b2JointEdge",def:cc},{trimmed:"JointDef",name:"b2JointDef",def:oa},{trimmed:"Joint",name:"b2Joint",def:s},{trimmed:"RevoluteJointDef",name:"b2RevoluteJointDef",def:hb},{trimmed:"RevoluteJoint",name:"b2RevoluteJoint",def:zb},{trimmed:"MouseJointDef",
name:"b2MouseJointDef",def:Pc},{trimmed:"MouseJoint",name:"b2MouseJoint",def:Ab},{trimmed:"DistanceJointDef",name:"b2DistanceJointDef",def:ib},{trimmed:"DistanceJoint",name:"b2DistanceJoint",def:Bb},{trimmed:"PrismaticJointDef",name:"b2PrismaticJointDef",def:jb},{trimmed:"PrismaticJoint",name:"b2PrismaticJoint",def:Cb},{trimmed:"FrictionJointDef",name:"b2FrictionJointDef",def:kb},{trimmed:"FrictionJoint",name:"b2FrictionJoint",def:Db},{trimmed:"WeldJointDef",name:"b2WeldJointDef",def:lb},{trimmed:"WeldJoint",
name:"b2WeldJoint",def:Eb},{trimmed:"WheelJointDef",name:"b2WheelJointDef",def:mb},{trimmed:"WheelJoint",name:"b2WheelJoint",def:Fb},{trimmed:"GearJointDef",name:"b2GearJointDef",def:Gb},{trimmed:"GearJoint",name:"b2GearJoint",def:Hb},{trimmed:"MotorJointDef",name:"b2MotorJointDef",def:nb},{trimmed:"MotorJoint",name:"b2MotorJoint",def:Ib},{trimmed:"PulleyJointDef",name:"b2PulleyJointDef",def:Jb},{trimmed:"PulleyJoint",name:"b2PulleyJoint",def:Kb},{trimmed:"RopeJointDef",name:"b2RopeJointDef",def:ob},
{trimmed:"RopeJoint",name:"b2RopeJoint",def:Lb},{trimmed:"RopeDef",name:"b2RopeDef",def:function(){this.vertices=null;this.count=0;this.masses=null;this.gravity=new d;this.damping=0.1;this.k2=0.9;this.k3=0.1}},{trimmed:"Rope",name:"b2Rope",def:Qc},{trimmed:"maxManifoldPoints",name:"b2_maxManifoldPoints",def:na},{trimmed:"maxPolygonVertices",name:"b2_maxPolygonVertices",def:wa},{trimmed:"aabbExtension",name:"b2_aabbExtension",def:0.1},{trimmed:"aabbMultiplier",name:"b2_aabbMultiplier",def:2},{trimmed:"linearSlop",
name:"b2_linearSlop",def:Q},{trimmed:"angularSlop",name:"b2_angularSlop",def:za},{trimmed:"polygonRadius",name:"b2_polygonRadius",def:ab},{trimmed:"maxSubSteps",name:"b2_maxSubSteps",def:8},{trimmed:"maxTOIContacts",name:"b2_maxTOIContacts",def:32},{trimmed:"velocityThreshold",name:"b2_velocityThreshold",def:1},{trimmed:"maxLinearCorrection",name:"b2_maxLinearCorrection",def:0.2},{trimmed:"maxAngularCorrection",name:"b2_maxAngularCorrection",def:pb},{trimmed:"maxTranslation",name:"b2_maxTranslation",
def:2},{trimmed:"maxTranslationSquared",name:"b2_maxTranslationSquared",def:4},{trimmed:"maxRotation",name:"b2_maxRotation",def:qb},{trimmed:"maxRotationSquared",name:"b2_maxRotationSquared",def:dc},{trimmed:"baumgarte",name:"b2_baumgarte",def:0.2},{trimmed:"toiBaugarte",name:"b2_toiBaugarte",def:0.75},{trimmed:"timeToSleep",name:"b2_timeToSleep",def:0.5},{trimmed:"linearSleepTolerance",name:"b2_linearSleepTolerance",def:0.01},{trimmed:"angularSleepTolerance",name:"b2_angularSleepTolerance",def:ec},
{trimmed:"epsilon",name:"b2_epsilon",def:la},{trimmed:"JsonSerializer",name:"b2JsonSerializer",def:{serialize:function(a){var b=[],c,d,f;for(f=a.GetBodyList();f;f=f.GetNext())for(c=f.GetFixtureList();c;c=c.GetNext())d=c.GetShape(),c.__temp_shape_id=b.length,b.push(d._serialize());var g=[];for(f=a.GetBodyList();f;f=f.GetNext())for(f.__temp_fixture_ids=[],c=f.GetFixtureList();c;c=c.GetNext())d=c._serialize(),d.shape=c.__temp_shape_id,delete c.__temp_shape_id,f.__temp_fixture_ids.push(g.length),g.push(d);
var k=[];for(f=a.GetBodyList();f;f=f.GetNext()){d=f._serialize();d.fixtures=[];for(c=0;c<f.__temp_fixture_ids.length;++c)d.fixtures.push(f.__temp_fixture_ids[c]);delete f.__temp_fixture_ids;f.__temp_body_id=k.length;k.push(d)}var h=[];f=a.GetJointList();for(c=0;f;f=f.GetNext(),++c)f.__temp_joint_id=c;for(f=a.GetJointList();f;f=f.GetNext())f.GetType()!==s.e_mouseJoint&&(d=f._serialize(),d.bodyA=f.GetBodyA().__temp_body_id,d.bodyB=f.GetBodyB().__temp_body_id,h.push(d));for(f=a.GetJointList();f;f=f.GetNext())delete f.__temp_joint_id;
for(f=a.GetBodyList();f;f=f.GetNext())delete f.__temp_body_id;return{shapes:b,fixtures:g,bodies:k,joints:h}},deserialize:function(a,b,c){a=JSON.parse(a);if(c){for(var d=b.GetBodyList();d;)c=d.GetNext(),b.DestroyBody(d),d=c;for(d=b.GetJointList();d;)c=d.GetNext(),b.DestroyJoint(d),d=c}var f=[];for(c=0;c<a.shapes.length;++c){var d=a.shapes[c],g;switch(d.m_type){case G.e_circle:g=new Qa;break;case G.e_edge:g=new Ja;break;case G.e_chain:g=new qa;break;case G.e_polygon:g=new Fa}g._deserialize(d);f.push(g)}d=
[];for(c=0;c<a.fixtures.length;++c){g=a.fixtures[c];var k=new fb;k._deserialize(g);k.shape=f[g.shape];d.push(k)}g=[];for(c=0;c<a.bodies.length;++c){f=a.bodies[c];k=new vb;k._deserialize(f);for(var k=b.CreateBody(k),h=0;h<f.fixtures.length;++h)k.CreateFixture(d[f.fixtures[h]]);g.push(k)}d=[];f=[];for(c=0;c<a.joints.length;++c){k=a.joints[c];switch(k.type){case s.e_revoluteJoint:h=new hb;break;case s.e_prismaticJoint:h=new jb;break;case s.e_distanceJoint:h=new ib;break;case s.e_pulleyJoint:h=new Jb;
break;case s.e_gearJoint:h=new Gb;break;case s.e_wheelJoint:h=new mb;break;case s.e_weldJoint:h=new lb;break;case s.e_frictionJoint:h=new kb;break;case s.e_ropeJoint:h=new ob;break;case s.e_motorJoint:h=new nb;break;default:throw Error("unknown joint");}h._deserialize(k,g);k.type===s.e_gearJoint?(f.push([h,d.length]),d.push(null)):(k=b.CreateJoint(h),d.push(k))}for(c=0;c<f.length;++c)f[c][0].joint1=d[f[c][0].joint1],f[c][0].joint2=d[f[c][0].joint2],k=b.CreateJoint(f[c][0]),d[f[c][1]]=k}}},{trimmed:"RUBELoader",
name:"b2RUBELoader",def:id},{trimmed:"Profiler",name:"b2Profiler",def:ua},{trimmed:"ParticleDef",name:"b2ParticleDef",def:I},{trimmed:"ParticleColor",name:"b2ParticleColor",def:La},{trimmed:"ParticleGroupDef",name:"b2ParticleGroupDef",def:function(){this.groupFlags=this.flags=0;this.position=new d;this.angle=0;this.linearVelocity=new d;this.angularVelocity=0;this.color=new La;this.strength=1;this.shape=null;this.destroyAutomatically=!0;this.userData=null}},{trimmed:"ParticleGroup",name:"b2ParticleGroup",
def:ta},{trimmed:"ParticleSystem",name:"b2ParticleSystem",def:D}];if("undefined"!==typeof b2_compatibility&&"undefined"!==typeof window)for(var Aa=0;Aa<Za.length;++Aa)window[Za[Aa].name]=Za[Aa].def;else{for(var gc={},Aa=0;Aa<Za.length;++Aa)gc[Za[Aa].trimmed]=Za[Aa].def;"undefined"!==typeof module?module.exports=gc:window.b2=gc}})();
